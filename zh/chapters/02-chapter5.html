<!DOCTYPE HTML>
<html lang="en" >
    <!-- Start book C 語言編程透視 -->
    <head>
        <!-- head:start -->
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <title>緩衝區溢出與注入分析 | C 語言編程透視</title>
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="generator" content="GitBook 2.1.0">
        
        
        <meta name="HandheldFriendly" content="true"/>
        <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
        <meta name="apple-mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-status-bar-style" content="black">
        <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../../gitbook/images/apple-touch-icon-precomposed-152.png">
        <link rel="shortcut icon" href="../../gitbook/images/favicon.ico" type="image/x-icon">
        
    <link rel="stylesheet" href="../../gitbook/style.css">
    
        
        <link rel="stylesheet" href="../../gitbook/plugins/gitbook-plugin-google_code_prettify/google-code-prettify.css">
        
    
        
        <link rel="stylesheet" href="../../gitbook/plugins/gitbook-plugin-maxiang/maxiang.css">
        
    
    

        
    
    
    <link rel="next" href="../../zh/chapters/02-chapter6.html" />
    
    
    <link rel="prev" href="../../zh/chapters/02-chapter4.html" />
    

        <!-- head:end -->
    </head>
    <body>
        <!-- body:start -->
        
    <div class="book" data-level="7" data-basepath="../.." data-revision="Wed Sep 02 2015 19:26:26 GMT+0800 (CST)">
    

<div class="book-summary">
    <div class="book-search">
        <input type="text" placeholder="Type to search" class="form-control" />
    </div>
    <ul class="summary">
        
        
        
        

        

        
    
        <li class="chapter " data-level="0" data-path="index.html">
            
                
                    <a href="../../index.html">
                        <i class="fa fa-check"></i>
                        
                        Introduction
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="1" data-path="zh/preface/01-chapter0.html">
            
                
                    <a href="../../zh/preface/01-chapter0.html">
                        <i class="fa fa-check"></i>
                        
                            <b>1.</b>
                        
                        版本修訂歷史
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="2" data-path="zh/preface/01-chapter1.html">
            
                
                    <a href="../../zh/preface/01-chapter1.html">
                        <i class="fa fa-check"></i>
                        
                            <b>2.</b>
                        
                        前言
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="3" data-path="zh/chapters/02-chapter1.html">
            
                
                    <a href="../../zh/chapters/02-chapter1.html">
                        <i class="fa fa-check"></i>
                        
                            <b>3.</b>
                        
                        把 Vim 打造成源代碼編輯器
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="4" data-path="zh/chapters/02-chapter2.html">
            
                
                    <a href="../../zh/chapters/02-chapter2.html">
                        <i class="fa fa-check"></i>
                        
                            <b>4.</b>
                        
                        Gcc 編譯的背後
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="5" data-path="zh/chapters/02-chapter3.html">
            
                
                    <a href="../../zh/chapters/02-chapter3.html">
                        <i class="fa fa-check"></i>
                        
                            <b>5.</b>
                        
                        程序執行的一剎那
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="6" data-path="zh/chapters/02-chapter4.html">
            
                
                    <a href="../../zh/chapters/02-chapter4.html">
                        <i class="fa fa-check"></i>
                        
                            <b>6.</b>
                        
                        動態符號鏈接的細節
                    </a>
                
            
            
        </li>
    
        <li class="chapter active" data-level="7" data-path="zh/chapters/02-chapter5.html">
            
                
                    <a href="../../zh/chapters/02-chapter5.html">
                        <i class="fa fa-check"></i>
                        
                            <b>7.</b>
                        
                        緩衝區溢出與注入分析
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="8" data-path="zh/chapters/02-chapter6.html">
            
                
                    <a href="../../zh/chapters/02-chapter6.html">
                        <i class="fa fa-check"></i>
                        
                            <b>8.</b>
                        
                        進程的內存映像
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="9" data-path="zh/chapters/02-chapter7.html">
            
                
                    <a href="../../zh/chapters/02-chapter7.html">
                        <i class="fa fa-check"></i>
                        
                            <b>9.</b>
                        
                        進程和進程的基本操作
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="10" data-path="zh/chapters/02-chapter8.html">
            
                
                    <a href="../../zh/chapters/02-chapter8.html">
                        <i class="fa fa-check"></i>
                        
                            <b>10.</b>
                        
                        打造史上最小可執行ELF文件(45字節)
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="11" data-path="zh/chapters/02-chapter9.html">
            
                
                    <a href="../../zh/chapters/02-chapter9.html">
                        <i class="fa fa-check"></i>
                        
                            <b>11.</b>
                        
                        代碼測試、調試與優化
                    </a>
                
            
            
        </li>
    


        
        <li class="divider"></li>
        <li>
            <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
                Published with GitBook
            </a>
        </li>
        
    </ul>
</div>

    <div class="book-body">
        <div class="body-inner">
            <div class="book-header">
    <!-- Actions Left -->
    <a href="#" class="btn pull-left toggle-summary" aria-label="Table of Contents"><i class="fa fa-align-justify"></i></a>
    <a href="#" class="btn pull-left toggle-search" aria-label="Search"><i class="fa fa-search"></i></a>
    
    <div id="font-settings-wrapper" class="dropdown pull-left">
        <a href="#" class="btn toggle-dropdown" aria-label="Font Settings"><i class="fa fa-font"></i>
        </a>
        <div class="dropdown-menu font-settings">
    <div class="dropdown-caret">
        <span class="caret-outer"></span>
        <span class="caret-inner"></span>
    </div>

    <div class="buttons">
        <button type="button" id="reduce-font-size" class="button size-2">A</button>
        <button type="button" id="enlarge-font-size" class="button size-2">A</button>
    </div>

    <div class="buttons font-family-list">
        <button type="button" data-font="0" class="button">Serif</button>
        <button type="button" data-font="1" class="button">Sans</button>
    </div>

    <div class="buttons color-theme-list">
        <button type="button" id="color-theme-preview-0" class="button size-3" data-theme="0">White</button>
        <button type="button" id="color-theme-preview-1" class="button size-3" data-theme="1">Sepia</button>
        <button type="button" id="color-theme-preview-2" class="button size-3" data-theme="2">Night</button>
    </div>
</div>

    </div>

    <!-- Actions Right -->
    
    <div class="dropdown pull-right">
        <a href="#" class="btn toggle-dropdown" aria-label="Share"><i class="fa fa-share-alt"></i>
        </a>
        <div class="dropdown-menu font-settings dropdown-left">
            <div class="dropdown-caret">
                <span class="caret-outer"></span>
                <span class="caret-inner"></span>
            </div>
            <div class="buttons">
                <button type="button" data-sharing="twitter" class="button">
                    Share on Twitter
                </button>
                <button type="button" data-sharing="google-plus" class="button">
                    Share on Google
                </button>
                <button type="button" data-sharing="facebook" class="button">
                    Share on Facebook
                </button>
                <button type="button" data-sharing="weibo" class="button">
                    Share on Weibo
                </button>
                <button type="button" data-sharing="instapaper" class="button">
                    Share on Instapaper
                </button>
            </div>
        </div>
    </div>
    

    
    <a href="#" target="_blank" class="btn pull-right google-plus-sharing-link sharing-link" data-sharing="google-plus" aria-label="Google"><i class="fa fa-google-plus"></i></a>
    
    
    <a href="#" target="_blank" class="btn pull-right facebook-sharing-link sharing-link" data-sharing="facebook" aria-label="Facebook"><i class="fa fa-facebook"></i></a>
    
    
    <a href="#" target="_blank" class="btn pull-right twitter-sharing-link sharing-link" data-sharing="twitter" aria-label="Twitter"><i class="fa fa-twitter"></i></a>
    
    
    


    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href="../../" >C 語言編程透視</a>
    </h1>
</div>

            <div class="page-wrapper" tabindex="-1">
                <div class="page-inner">
                
                
                    <section class="normal" id="section-">
                    
                        <h1 id="%E7%B7%A9%E8%A1%9D%E5%8D%80%E6%BA%A2%E5%87%BA%E8%88%87%E6%B3%A8%E5%85%A5%E5%88%86%E6%9E%90">&#x7DE9;&#x885D;&#x5340;&#x6EA2;&#x51FA;&#x8207;&#x6CE8;&#x5165;&#x5206;&#x6790;</h1>
<ul>
<li><a href="#toc_14869_27504_1">&#x524D;&#x8A00;</a></li>
<li><a href="#toc_14869_27504_2">&#x9032;&#x7A0B;&#x7684;&#x5167;&#x5B58;&#x6620;&#x50CF;</a><ul>
<li><a href="#toc_14869_27504_3">&#x5E38;&#x7528;&#x5BC4;&#x5B58;&#x5668;&#x521D;&#x8B58;</a></li>
<li><a href="#toc_14869_27504_4">call&#xFF0C;ret &#x6307;&#x4EE4;&#x7684;&#x4F5C;&#x7528;&#x5206;&#x6790;</a></li>
<li><a href="#toc_14869_27504_5">&#x4EC0;&#x9EBC;&#x662F;&#x7CFB;&#x7D71;&#x8ABF;&#x7528;</a></li>
<li><a href="#toc_14869_27504_6">&#x4EC0;&#x9EBC;&#x662F; ELF &#x6587;&#x4EF6;</a></li>
<li><a href="#toc_14869_27504_7">&#x7A0B;&#x5E8F;&#x57F7;&#x884C;&#x57FA;&#x672C;&#x904E;&#x7A0B;</a></li>
<li><a href="#toc_14869_27504_8">Linux &#x4E0B;&#x7A0B;&#x5E8F;&#x7684;&#x5167;&#x5B58;&#x6620;&#x50CF;</a></li>
<li><a href="#toc_14869_27504_9">&#x68E7;&#x5728;&#x5167;&#x5B58;&#x4E2D;&#x7684;&#x7D44;&#x7E54;</a></li>
</ul>
</li>
<li><a href="#toc_14869_27504_10">&#x7DE9;&#x885D;&#x5340;&#x6EA2;&#x51FA;</a><ul>
<li><a href="#toc_14869_27504_11">&#x5BE6;&#x4F8B;&#x5206;&#x6790;&#xFF1A;&#x5B57;&#x7B26;&#x4E32;&#x8907;&#x88FD;</a></li>
<li><a href="#toc_14869_27504_12">&#x7DE9;&#x885D;&#x5340;&#x6EA2;&#x51FA;&#x5F8C;&#x679C;</a></li>
<li><a href="#toc_14869_27504_13">&#x7DE9;&#x885D;&#x5340;&#x6EA2;&#x51FA;&#x61C9;&#x5C0D;&#x7B56;&#x7565;</a></li>
<li><a href="#toc_14869_27504_14">&#x5982;&#x4F55;&#x4FDD;&#x8B77; ebp &#x4E0D;&#x88AB;&#x4FEE;&#x6539;</a></li>
<li><a href="#toc_14869_27504_15">&#x5982;&#x4F55;&#x4FDD;&#x8B77; eip &#x4E0D;&#x88AB;&#x4FEE;&#x6539;&#xFF1F;</a></li>
<li><a href="#toc_14869_27504_16">&#x7DE9;&#x885D;&#x5340;&#x6EA2;&#x51FA;&#x6AA2;&#x6E2C;</a></li>
</ul>
</li>
<li><a href="#toc_14869_27504_17">&#x7DE9;&#x885D;&#x5340;&#x6CE8;&#x5165;&#x5BE6;&#x4F8B;</a><ul>
<li><a href="#toc_14869_27504_18">&#x6E96;&#x5099;&#xFF1A;&#x628A; C &#x8A9E;&#x8A00;&#x51FD;&#x6578;&#x8F49;&#x63DB;&#x70BA;&#x5B57;&#x7B26;&#x4E32;&#x5E8F;&#x5217;</a></li>
<li><a href="#toc_14869_27504_19">&#x6CE8;&#x5165;&#xFF1A;&#x5728; C &#x8A9E;&#x8A00;&#x4E2D;&#x57F7;&#x884C;&#x5B57;&#x7B26;&#x4E32;&#x5316;&#x7684;&#x4EE3;&#x78BC;</a></li>
<li><a href="#toc_14869_27504_20">&#x6CE8;&#x5165;&#x539F;&#x7406;&#x5206;&#x6790;</a></li>
<li><a href="#toc_14869_27504_21">&#x7DE9;&#x885D;&#x5340;&#x6CE8;&#x5165;&#x8207;&#x9632;&#x7BC4;</a></li>
</ul>
</li>
<li><a href="#toc_14869_27504_22">&#x5F8C;&#x8A18;</a></li>
<li><a href="#toc_14869_27504_23">&#x53C3;&#x8003;&#x8CC7;&#x6599;</a></li>
</ul>
<p><span id="toc_14869_27504_1"></span></p>
<h2 id="%E5%89%8D%E8%A8%80">&#x524D;&#x8A00;</h2>
<p>&#x96D6;&#x7136;&#x7A0B;&#x5E8F;&#x52A0;&#x8F09;&#x4EE5;&#x53CA;&#x52D5;&#x614B;&#x7B26;&#x865F;&#x93C8;&#x63A5;&#x90FD;&#x5DF2;&#x7D93;&#x5F88;&#x7406;&#x89E3;&#x4E86;&#xFF0C;&#x4F46;&#x662F;&#x9019;&#x5925;&#x537B;&#x88AB;&#x9032;&#x7A0B;&#x7684;&#x5167;&#x5B58;&#x6620;&#x50CF;&#x7D66;&#x201D;&#x7CFE;&#x7E8F;&quot;&#x4F4F;&#x3002;&#x770B;&#x8457;&#x770B;&#x8457;&#x5C31;&#x4E00;&#x767C;&#x4E0D;&#x53EF;&#x6536;&#x62FE;&#x2014;&#x2014;&#x5F88;&#x6709;&#x8DA3;&#x3002;</p>
<p>&#x4E0B;&#x9762;&#x4E00;&#x8D77;&#x4F86;&#x63A2;&#x7A76;&#x201C;&#x7DE9;&#x885D;&#x5340;&#x6EA2;&#x51FA;&#x548C;&#x6CE8;&#x5165;&#x201D;&#x554F;&#x984C;&#xFF08;&#x4E3B;&#x8981;&#x662F;&#x95DC;&#x5FC3;&#x7A0B;&#x5E8F;&#x7684;&#x5167;&#x5B58;&#x6620;&#x50CF;&#xFF09;&#x3002;</p>
<p><span id="toc_14869_27504_2"></span></p>
<h2 id="%E9%80%B2%E7%A8%8B%E7%9A%84%E5%85%A7%E5%AD%98%E6%98%A0%E5%83%8F">&#x9032;&#x7A0B;&#x7684;&#x5167;&#x5B58;&#x6620;&#x50CF;</h2>
<p>&#x6C38;&#x9060;&#x7684; <code>Hello World</code>&#xFF0C;&#x592A;&#x719F;&#x6089;&#x4E86;&#x5427;&#xFF0C;</p>
<pre><code>#include &lt;stdio.h&gt;
int main(void)
{
    printf(&quot;Hello World\n&quot;);
    return 0;
}
</code></pre><p>&#x5982;&#x679C;&#x8981;&#x7528;&#x5167;&#x806F;&#x5F59;&#x7DE8;&#xFF08;<code>inline assembly</code>&#xFF09;&#x4F86;&#x5BEB;&#x5462;&#xFF1F;</p>
<pre><code> 1  /* shellcode.c */
 2  void main()
 3  {
 4      __asm__ __volatile__(&quot;jmp forward;&quot;
 5                   &quot;backward:&quot;
 6                           &quot;popl   %esi;&quot;
 7                           &quot;movl   $4, %eax;&quot;
 8                           &quot;movl   $2, %ebx;&quot;
 9                           &quot;movl   %esi, %ecx;&quot;
10                           &quot;movl   $12, %edx;&quot;
11                           &quot;int    $0x80;&quot;    /* system call 1 */
12                           &quot;movl   $1, %eax;&quot;
13                           &quot;movl   $0, %ebx;&quot;
14                           &quot;int    $0x80;&quot;    /* system call 2 */
15                   &quot;forward:&quot;
16                           &quot;call   backward;&quot;
17                           &quot;.string \&quot;Hello World\\n\&quot;;&quot;);
18  }
</code></pre><p>&#x770B;&#x8D77;&#x4F86;&#x5F88;&#x8907;&#x96DC;&#xFF0C;&#x5BE6;&#x969B;&#x4E0A;&#x5C31;&#x505A;&#x4E86;&#x4E00;&#x500B;&#x4E8B;&#x60C5;&#xFF0C;&#x5F80;&#x7D42;&#x7AEF;&#x4E0A;&#x5BEB;&#x4E86;&#x500B; <code>Hello World</code> &#x3002;&#x4E0D;&#x904E;&#x9019;&#x500B;&#x975E;&#x5E38;&#x6709;&#x610F;&#x601D;&#x3002;&#x5148;&#x7C21;&#x55AE;&#x5206;&#x6790;&#x4E00;&#x4E0B;&#x6D41;&#x7A0B;&#xFF1A;</p>
<ul>
<li>&#x7B2C; 4 &#x884C;&#x6307;&#x4EE4;&#x7684;&#x4F5C;&#x7528;&#x662F;&#x8DF3;&#x8F49;&#x5230;&#x7B2C; 15 &#x884C;&#xFF08;&#x5373; <code>forward</code> &#x6A19;&#x8A18;&#x8655;&#xFF09;&#xFF0C;&#x63A5;&#x8457;&#x57F7;&#x884C;&#x7B2C; 16 &#x884C;&#x3002;</li>
<li>&#x7B2C; 16 &#x884C;&#x8ABF;&#x7528; <code>backward</code>&#xFF0C;&#x8DF3;&#x8F49;&#x5230;&#x7B2C; 5 &#x884C;&#xFF0C;&#x63A5;&#x8457;&#x57F7;&#x884C; 6 &#x5230; 14 &#x884C;&#x3002;</li>
<li>&#x7B2C; 6 &#x884C;&#x5230;&#x7B2C; 11 &#x884C;&#x8CA0;&#x8CAC;&#x5728;&#x7D42;&#x7AEF;&#x6253;&#x5370;&#x51FA; <code>Hello World</code> &#x5B57;&#x7B26;&#x4E32;&#xFF08;&#x7B49;&#x4E00;&#x4E0B;&#x8A73;&#x7D30;&#x4ECB;&#x7D39;&#xFF09;&#x3002;</li>
<li>&#x7B2C; 12 &#x884C;&#x5230;&#x7B2C; 14 &#x884C;&#x9000;&#x51FA;&#x7A0B;&#x5E8F;&#xFF08;&#x7B49;&#x4E00;&#x4E0B;&#x8A73;&#x7D30;&#x4ECB;&#x7D39;&#xFF09;&#x3002;</li>
</ul>
<p>&#x70BA;&#x4E86;&#x66F4;&#x597D;&#x7684;&#x7406;&#x89E3;&#x4E0A;&#x9762;&#x7684;&#x4EE3;&#x78BC;&#x548C;&#x5F8C;&#x7E8C;&#x7684;&#x5206;&#x6790;&#xFF0C;&#x5148;&#x4F86;&#x4ECB;&#x7D39;&#x5E7E;&#x500B;&#x6BD4;&#x8F03;&#x91CD;&#x8981;&#x7684;&#x5167;&#x5BB9;&#x3002;</p>
<p><span id="toc_14869_27504_3"></span></p>
<h3 id="%E5%B8%B8%E7%94%A8%E5%AF%84%E5%AD%98%E5%99%A8%E5%88%9D%E8%AD%98">&#x5E38;&#x7528;&#x5BC4;&#x5B58;&#x5668;&#x521D;&#x8B58;</h3>
<p><code>X86</code> &#x8655;&#x7406;&#x5668;&#x5E73;&#x81FA;&#x6709;&#x4E09;&#x500B;&#x5E38;&#x7528;&#x5BC4;&#x5B58;&#x5668;&#xFF1A;&#x7A0B;&#x5E8F;&#x6307;&#x4EE4;&#x6307;&#x91DD;&#x3001;&#x7A0B;&#x5E8F;&#x5806;&#x68E7;&#x6307;&#x91DD;&#x8207;&#x7A0B;&#x5E8F;&#x57FA;&#x6307;&#x91DD;&#xFF1A;</p>
<table>
<thead>
<tr>
<th>&#x5BC4;&#x5B58;&#x5668;</th>
<th>&#x540D;&#x7A31;</th>
<th>&#x8A3B;&#x91CB;</th>
</tr>
</thead>
<tbody>
<tr>
<td>EIP</td>
<td>&#x7A0B;&#x5E8F;&#x6307;&#x4EE4;&#x6307;&#x91DD;</td>
<td>&#x901A;&#x5E38;&#x6307;&#x5411;&#x4E0B;&#x4E00;&#x689D;&#x6307;&#x4EE4;&#x7684;&#x4F4D;&#x7F6E;</td>
</tr>
<tr>
<td>ESP</td>
<td>&#x7A0B;&#x5E8F;&#x5806;&#x68E7;&#x6307;&#x91DD;</td>
<td>&#x901A;&#x5E38;&#x6307;&#x5411;&#x7576;&#x524D;&#x5806;&#x68E7;&#x7684;&#x7576;&#x524D;&#x4F4D;&#x7F6E;</td>
</tr>
<tr>
<td>EBP</td>
<td>&#x7A0B;&#x5E8F;&#x57FA;&#x6307;&#x91DD;</td>
<td>&#x901A;&#x5E38;&#x6307;&#x5411;&#x51FD;&#x6578;&#x4F7F;&#x7528;&#x7684;&#x5806;&#x68E7;&#x9802;&#x7AEF;</td>
</tr>
</tbody>
</table>
<p>&#x7576;&#x7136;&#xFF0C;&#x4E0A;&#x9762;&#x90FD;&#x662F;&#x64F4;&#x5C55;&#x7684;&#x5BC4;&#x5B58;&#x5668;&#xFF0C;&#x7528;&#x65BC; 32 &#x4F4D;&#x7CFB;&#x7D71;&#xFF0C;&#x5C0D;&#x61C9;&#x7684; 16 &#x7CFB;&#x7D71;&#x70BA; <code>ip</code>&#xFF0C;<code>sp</code>&#xFF0C;<code>bp</code> &#x3002;</p>
<p><span id="toc_14869_27504_4"></span></p>
<h3 id="call%EF%BC%8Cret-%E6%8C%87%E4%BB%A4%E7%9A%84%E4%BD%9C%E7%94%A8%E5%88%86%E6%9E%90">call&#xFF0C;ret &#x6307;&#x4EE4;&#x7684;&#x4F5C;&#x7528;&#x5206;&#x6790;</h3>
<ul>
<li><p>call` &#x6307;&#x4EE4;</p>
<p>  &#x8DF3;&#x8F49;&#x5230;&#x67D0;&#x500B;&#x4F4D;&#x7F6E;&#xFF0C;&#x4E26;&#x5728;&#x4E4B;&#x524D;&#x628A;&#x4E0B;&#x4E00;&#x689D;&#x6307;&#x4EE4;&#x7684;&#x5730;&#x5740;&#xFF08;<code>EIP</code>&#xFF09;&#x5165;&#x68E7;&#xFF08;&#x70BA;&#x4E86;&#x65B9;&#x4FBF;&#x201D;&#x7A0B;&#x5E8F;&#x201C;&#x8FD4;&#x56DE;&#x4EE5;&#x5F8C;&#x80FD;&#x5920;&#x63A5;&#x8457;&#x57F7;&#x884C;&#xFF09;&#x3002;&#x9019;&#x6A23;&#x7684;&#x8A71;&#x5C31;&#x6709;&#xFF1A;</p>
<pre><code>  call backward   ==&gt;   push eip
                        jmp backward
</code></pre></li>
<li><p>ret &#x6307;&#x4EE4;</p>
<p>  &#x901A;&#x5E38; <code>call</code> &#x6307;&#x4EE4;&#x548C; <code>ret</code> &#x662F;&#x914D;&#x5408;&#x4F7F;&#x7528;&#x7684;&#xFF0C;&#x524D;&#x8005;&#x58D3;&#x5165;&#x8DF3;&#x8F49;&#x524D;&#x7684;&#x4E0B;&#x4E00;&#x689D;&#x6307;&#x4EE4;&#x5730;&#x5740;&#xFF0C;&#x5F8C;&#x8005;&#x5F48;&#x51FA; <code>call</code> &#x6307;&#x4EE4;&#x58D3;&#x5165;&#x7684;&#x90A3;&#x689D;&#x6307;&#x4EE4;&#xFF0C;&#x5F9E;&#x800C;&#x53EF;&#x4EE5;&#x5728;&#x51FD;&#x6578;&#x8ABF;&#x7528;&#x7D50;&#x675F;&#x4EE5;&#x5F8C;&#x63A5;&#x8457;&#x57F7;&#x884C;&#x5F8C;&#x9762;&#x7684;&#x6307;&#x4EE4;&#x3002;</p>
<pre><code>  ret                    ==&gt;   pop eip
</code></pre></li>
</ul>
<p>&#x901A;&#x5E38;&#x5728;&#x51FD;&#x6578;&#x8ABF;&#x7528;&#x5F8C;&#xFF0C;&#x9084;&#x9700;&#x8981;&#x6062;&#x5FA9; <code>esp</code> &#x548C; <code>ebp</code>&#xFF0C;&#x6062;&#x5FA9; <code>esp</code> &#x5373;&#x6062;&#x5FA9;&#x7576;&#x524D;&#x68E7;&#x6307;&#x91DD;&#xFF0C;&#x4EE5;&#x4FBF;&#x91CB;&#x653E;&#x8ABF;&#x7528;&#x51FD;&#x6578;&#x6642;&#x70BA;&#x5B58;&#x5132;&#x51FD;&#x6578;&#x7684;&#x5C40;&#x90E8;&#x8B8A;&#x91CF;&#x800C;&#x81EA;&#x52D5;&#x5206;&#x914D;&#x7684;&#x7A7A;&#x9593;&#xFF1B;&#x6062;&#x5FA9; <code>ebp</code> &#x662F;&#x5F9E;&#x68E7;&#x4E2D;&#x5F48;&#x51FA;&#x4E00;&#x500B;&#x6578;&#x64DA;&#x9805;&#xFF08;&#x901A;&#x5E38;&#x51FD;&#x6578;&#x8ABF;&#x7528;&#x904E;&#x5F8C;&#x7684;&#x7B2C;&#x4E00;&#x689D;&#x8A9E;&#x53E5;&#x5C31;&#x662F; <code>push ebp</code>&#xFF09;&#xFF0C;&#x5F9E;&#x800C;&#x6062;&#x5FA9;&#x7576;&#x524D;&#x7684;&#x51FD;&#x6578;&#x6307;&#x91DD;&#x70BA;&#x51FD;&#x6578;&#x8ABF;&#x7528;&#x8005;&#x672C;&#x8EAB;&#x3002;&#x9019;&#x5169;&#x500B;&#x52D5;&#x4F5C;&#x53EF;&#x4EE5;&#x901A;&#x904E;&#x4E00;&#x689D; <code>leave</code> &#x6307;&#x4EE4;&#x5B8C;&#x6210;&#x3002;</p>
<p>&#x9019;&#x4E09;&#x500B;&#x6307;&#x4EE4;&#x5C0D;&#x6211;&#x5011;&#x5F8C;&#x7E8C;&#x7684;&#x89E3;&#x91CB;&#x6703;&#x5F88;&#x6709;&#x5E6B;&#x52A9;&#x3002;&#x66F4;&#x591A;&#x95DC;&#x65BC; Intel &#x7684;&#x6307;&#x4EE4;&#x96C6;&#xFF0C;&#x8ACB;&#x53C3;&#x8003;&#xFF1A;<a href="http://www.x86.org/intel.doc/386manuals.htm" target="_blank">Intel 386 Manual</a>, x86 Assembly Language FAQ&#xFF1A;<a href="http://www.faqs.org/faqs/assembly-language/x86/general/part1/" target="_blank">part1</a>, <a href="http://www.faqs.org/faqs/assembly-language/x86/general/part2/" target="_blank">part2</a>, <a href="http://www.faqs.org/faqs/assembly-language/x86/general/part3/" target="_blank">part3</a>.</p>
<p><span id="toc_14869_27504_5"></span></p>
<h3 id="%E4%BB%80%E9%BA%BC%E6%98%AF%E7%B3%BB%E7%B5%B1%E8%AA%BF%E7%94%A8%EF%BC%88%E4%BB%A5-linux-2-6-21-%E7%89%88%E6%9C%AC%E5%92%8C-x86-%E5%B9%B3%E8%87%BA%E7%82%BA%E4%BE%8B%EF%BC%89">&#x4EC0;&#x9EBC;&#x662F;&#x7CFB;&#x7D71;&#x8ABF;&#x7528;&#xFF08;&#x4EE5; Linux 2.6.21 &#x7248;&#x672C;&#x548C; x86 &#x5E73;&#x81FA;&#x70BA;&#x4F8B;&#xFF09;</h3>
<p>&#x7CFB;&#x7D71;&#x8ABF;&#x7528;&#x662F;&#x7528;&#x6236;&#x548C;&#x5167;&#x6838;&#x4E4B;&#x9593;&#x7684;&#x63A5;&#x53E3;&#xFF0C;&#x7528;&#x6236;&#x5982;&#x679C;&#x60F3;&#x5BEB;&#x7A0B;&#x5E8F;&#xFF0C;&#x5F88;&#x591A;&#x6642;&#x5019;&#x76F4;&#x63A5;&#x8ABF;&#x7528;&#x4E86; C &#x5EAB;&#xFF0C;&#x4E26;&#x6C92;&#x6709;&#x95DC;&#x5FC3;&#x7E6B;&#x7D71;&#x8ABF;&#x7528;&#xFF0C;&#x800C;&#x5BE6;&#x969B;&#x4E0A; C &#x5EAB;&#x4E5F;&#x662F;&#x57FA;&#x65BC;&#x7CFB;&#x7D71;&#x8ABF;&#x7528;&#x7684;&#x3002;&#x9019;&#x6A23;&#x61C9;&#x7528;&#x7A0B;&#x5E8F;&#x548C;&#x5167;&#x6838;&#x4E4B;&#x9593;&#x5C31;&#x53EF;&#x4EE5;&#x901A;&#x904E;&#x7CFB;&#x7D71;&#x8ABF;&#x7528;&#x806F;&#x7E6B;&#x8D77;&#x4F86;&#x3002;&#x5B83;&#x5011;&#x5206;&#x5225;&#x8655;&#x65BC;&#x64CD;&#x4F5C;&#x7CFB;&#x7D71;&#x7684;&#x7528;&#x6236;&#x7A7A;&#x9593;&#x548C;&#x5167;&#x6838;&#x7A7A;&#x9593;&#xFF08;&#x4E3B;&#x8981;&#x662F;&#x5167;&#x5B58;&#x5730;&#x5740;&#x7A7A;&#x9593;&#x7684;&#x9694;&#x96E2;&#xFF09;&#x3002;</p>
<pre><code>&#x7528;&#x6236;&#x7A7A;&#x9593;         &#x61C9;&#x7528;&#x7A0B;&#x5E8F;(Applications)
                        |      |
                        |     C&#x5EAB;&#xFF08;&#x5982;glibc&#xFF09;
                        |      |
                       &#x7CFB;&#x7D71;&#x8ABF;&#x7528;(System Calls&#xFF0C;&#x5982;sys_read, sys_write, sys_exit)
                            |
&#x5167;&#x6838;&#x7A7A;&#x9593;              &#x5167;&#x6838;(Kernel)
</code></pre><p>&#x7CFB;&#x7D71;&#x8ABF;&#x7528;&#x5BE6;&#x969B;&#x4E0A;&#x4E5F;&#x662F;&#x4E00;&#x4E9B;&#x51FD;&#x6578;&#xFF0C;&#x5B83;&#x5011;&#x88AB;&#x5B9A;&#x7FA9;&#x5728; <code>arch/i386/kernel/sys_i386.c</code> &#xFF08;&#x8001;&#x7684;&#x5728; <code>arch/i386/kernel/sys.c</code>&#xFF09;&#x6587;&#x4EF6;&#x4E2D;&#xFF0C;&#x4E26;&#x4E14;&#x901A;&#x904E;&#x4E00;&#x5F35;&#x7CFB;&#x7D71;&#x8ABF;&#x7528;&#x8868;&#x7D44;&#x7E54;&#xFF0C;&#x8A72;&#x8868;&#x5728;&#x5167;&#x6838;&#x555F;&#x52D5;&#x6642;&#x5C31;&#x5DF2;&#x7D93;&#x52A0;&#x8F09;&#x4E86;&#xFF0C;&#x9019;&#x500B;&#x8868;&#x7684;&#x5165;&#x53E3;&#x5728;&#x5167;&#x6838;&#x6E90;&#x4EE3;&#x78BC;&#x7684; <code>arch/i386/kernel/syscall_table.S</code> &#x88E1;&#x982D;&#xFF08;&#x8001;&#x7684;&#x5728; <code>arch/i386/kernel/entry.S</code>&#xFF09;&#x3002;&#x9019;&#x6A23;&#xFF0C;&#x5982;&#x679C;&#x60F3;&#x6DFB;&#x52A0;&#x4E00;&#x500B;&#x65B0;&#x7684;&#x7CFB;&#x7D71;&#x8ABF;&#x7528;&#xFF0C;&#x4FEE;&#x6539;&#x4E0A;&#x9762;&#x5169;&#x500B;&#x5167;&#x6838;&#x4E2D;&#x7684;&#x6587;&#x4EF6;&#xFF0C;&#x4E26;&#x91CD;&#x65B0;&#x7DE8;&#x8B6F;&#x5167;&#x6838;&#x5C31;&#x53EF;&#x4EE5;&#x3002;&#x7576;&#x7136;&#xFF0C;&#x5982;&#x679C;&#x8981;&#x5728;&#x61C9;&#x7528;&#x7A0B;&#x5E8F;&#x4E2D;&#x4F7F;&#x7528;&#x5B83;&#x5011;&#xFF0C;&#x9084;&#x5F97;&#x628A;&#x5B83;&#x5BEB;&#x5230; <code>include/asm/unistd.h</code> &#x4E2D;&#x3002;</p>
<p>&#x5982;&#x679C;&#x8981;&#x5728; C &#x8A9E;&#x8A00;&#x4E2D;&#x4F7F;&#x7528;&#x67D0;&#x500B;&#x7CFB;&#x7D71;&#x8ABF;&#x7528;&#xFF0C;&#x9700;&#x8981;&#x5305;&#x542B;&#x982D;&#x6587;&#x4EF6; <code>/usr/include/asm/unistd.h</code>&#xFF0C;&#x88E1;&#x982D;&#x6709;&#x5404;&#x500B;&#x7CFB;&#x7D71;&#x8ABF;&#x7528;&#x7684;&#x8072;&#x660E;&#x4EE5;&#x53CA;&#x7CFB;&#x7D71;&#x8ABF;&#x7528;&#x865F;&#xFF08;&#x5C0D;&#x61C9;&#x65BC;&#x8ABF;&#x7528;&#x8868;&#x7684;&#x5165;&#x53E3;&#xFF0C;&#x5373;&#x5728;&#x8ABF;&#x7528;&#x8868;&#x4E2D;&#x7684;&#x7D22;&#x5F15;&#xFF0C;&#x70BA;&#x65B9;&#x4FBF;&#x67E5;&#x627E;&#x8ABF;&#x7528;&#x8868;&#x800C;&#x8A2D;&#x7ACB;&#x7684;&#xFF09;&#x3002;&#x5982;&#x679C;&#x662F;&#x81EA;&#x5DF1;&#x5B9A;&#x7FA9;&#x7684;&#x65B0;&#x7CFB;&#x7D71;&#x8ABF;&#x7528;&#xFF0C;&#x53EF;&#x80FD;&#x9084;&#x8981;&#x5728;&#x958B;&#x982D;&#x7528;&#x5B8F; <code>_syscall(type, name, type1, name1...)</code>&#x4F86;&#x8072;&#x660E;&#x597D;&#x53C3;&#x6578;&#x3002;</p>
<p>&#x5982;&#x679C;&#x8981;&#x5728;&#x5F59;&#x7DE8;&#x8A9E;&#x8A00;&#x4E2D;&#x4F7F;&#x7528;&#xFF0C;&#x9700;&#x8981;&#x7528;&#x5230; <code>int 0x80</code> &#x8ABF;&#x7528;&#xFF0C;&#x9019;&#x500B;&#x662F;&#x7CFB;&#x7D71;&#x8ABF;&#x7528;&#x7684;&#x4E2D;&#x65B7;&#x5165;&#x53E3;&#x3002;&#x6D89;&#x53CA;&#x5230;&#x50B3;&#x9001;&#x53C3;&#x6578;&#x7684;&#x5BC4;&#x5B58;&#x5668;&#x6709;&#x9019;&#x9EBC;&#x5E7E;&#x500B;&#xFF0C;<code>eax</code> &#x662F;&#x7CFB;&#x7D71;&#x8ABF;&#x7528;&#x865F;&#xFF08;&#x53EF;&#x4EE5;&#x5230; <code>/usr/include/asm-i386/unistd.h</code> &#x6216;&#x8005;&#x76F4;&#x63A5;&#x5230; <code>arch/i386/kernel/syscall_table.S</code> &#x67E5;&#x5230;&#xFF09;&#xFF0C;&#x5176;&#x4ED6;&#x5BC4;&#x5B58;&#x5668;&#x5982; <code>ebx</code>&#xFF0C;<code>ecx</code>&#xFF0C;<code>edx</code>&#xFF0C;<code>esi</code>&#xFF0C;<code>edi</code> &#x4E00;&#x6B21;&#x5B58;&#x653E;&#x7CFB;&#x7D71;&#x8ABF;&#x7528;&#x7684;&#x53C3;&#x6578;&#x3002;&#x800C;&#x7CFB;&#x7D71;&#x8ABF;&#x7528;&#x7684;&#x8FD4;&#x56DE;&#x503C;&#x5B58;&#x653E;&#x5728; <code>eax</code> &#x5BC4;&#x5B58;&#x5668;&#x4E2D;&#x3002;</p>
<p>&#x4E0B;&#x9762;&#x6211;&#x5011;&#x5C31;&#x5F88;&#x5BB9;&#x6613;&#x89E3;&#x91CB;&#x524D;&#x9762;&#x7684; <code>Shellcode.c</code> &#x7A0B;&#x5E8F;&#x6D41;&#x7A0B;&#x7684; 2&#xFF0C;3 &#x5169;&#x90E8;&#x5206;&#x4E86;&#x3002;&#x56E0;&#x70BA;&#x90FD;&#x7528;&#x4E86; <code>int 0x80</code> &#x4E2D;&#x65B7;&#xFF0C;&#x6240;&#x4EE5;&#x90FD;&#x7528;&#x5230;&#x4E86;&#x7CFB;&#x7D71;&#x8ABF;&#x7528;&#x3002;</p>
<p>&#x7B2C; 3 &#x90E8;&#x5206;&#x5F88;&#x7C21;&#x55AE;&#xFF0C;&#x7528;&#x5230;&#x7684;&#x7CFB;&#x7D71;&#x8ABF;&#x7528;&#x865F;&#x662F; 1&#xFF0C;&#x901A;&#x904E;&#x67E5;&#x8868;&#xFF08;&#x67E5; <code>/usr/include/asm-i386/unistd.h</code> &#x6216; <code>arch/i386/kernel/syscall_table.S</code>&#xFF09;&#x53EF;&#x4EE5;&#x767C;&#x73FE;&#x9019;&#x88E1;&#x662F; <code>sys_exit</code> &#x8ABF;&#x7528;&#xFF0C;&#x518D;&#x5F9E; <code>/usr/include/unistd.h</code> &#x6587;&#x4EF6;&#x770B;&#x9019;&#x500B;&#x7CFB;&#x7D71;&#x8ABF;&#x7528;&#x7684;&#x8072;&#x660E;&#xFF0C;&#x767C;&#x73FE;&#x53C3;&#x6578; <code>ebx</code> &#x662F;&#x7A0B;&#x5E8F;&#x9000;&#x51FA;&#x72C0;&#x614B;&#x3002;</p>
<p>&#x7B2C; 2 &#x90E8;&#x5206;&#x6BD4;&#x8F03;&#x6709;&#x8DA3;&#xFF0C;&#x800C;&#x4E14;&#x8907;&#x96DC;&#x4E00;&#x9EDE;&#x3002;&#x6211;&#x5011;&#x4F9D;&#x6B21;&#x4F86;&#x770B;&#x5404;&#x500B;&#x5BC4;&#x5B58;&#x5668;&#xFF0C;&#x9996;&#x5148;&#x6839;&#x64DA; <code>eax</code> &#x70BA; 4 &#x78BA;&#x5B9A;&#xFF08;&#x540C;&#x6A23;&#x67E5;&#x8868;&#xFF09;&#x7CFB;&#x7D71;&#x8ABF;&#x7528;&#x70BA; <code>sys_write</code>&#xFF0C;&#x800C;&#x67E5;&#x770B;&#x5B83;&#x7684;&#x8072;&#x660E;&#xFF08;&#x5F9E; <code>/usr/include/unistd.h</code>&#xFF09;&#xFF0C;&#x6211;&#x5011;&#x627E;&#x5230;&#x4E86;&#x53C3;&#x6578;&#x4F9D;&#x6B21;&#x70BA;&#x6587;&#x4EF6;&#x63CF;&#x8FF0;&#x7B26;&#x3001;&#x5B57;&#x7B26;&#x4E32;&#x6307;&#x91DD;&#x548C;&#x5B57;&#x7B26;&#x4E32;&#x9577;&#x5EA6;&#x3002;</p>
<ul>
<li>&#x7B2C;&#x4E00;&#x500B;&#x53C3;&#x6578;&#x662F; <code>ebx</code>&#xFF0C;&#x6B63;&#x597D;&#x662F; 2&#xFF0C;&#x5373;&#x6A19;&#x6E96;&#x932F;&#x8AA4;&#x8F38;&#x51FA;&#xFF0C;&#x9ED8;&#x8A8D;&#x70BA;&#x7D42;&#x7AEF;&#x3002;</li>
<li>&#x7B2C;&#x4E8C;&#x500B;&#x53C3;&#x6578;&#x662F; <code>ecx</code>&#xFF0C;&#x800C; <code>ecx</code> &#x7684;&#x5167;&#x5BB9;&#x4F86;&#x81EA; <code>esi</code>&#xFF0C;<code>esi</code> &#x4F86;&#x81EA;&#x525B;&#x5F48;&#x51FA;&#x68E7;&#x7684;&#x503C;&#xFF08;&#x898B;&#x7B2C; 6 &#x884C; <code>popl %esi;</code>&#xFF09;&#xFF0C;&#x800C;&#x4E4B;&#x524D;&#x525B;&#x597D;&#x6709; <code>call</code> &#x6307;&#x4EE4;&#x5F15;&#x8D77;&#x4E86;&#x6700;&#x8FD1;&#x4E00;&#x6B21;&#x58D3;&#x68E7;&#x64CD;&#x4F5C;&#xFF0C;&#x5165;&#x68E7;&#x7684;&#x5167;&#x5BB9;&#x525B;&#x597D;&#x662F; <code>call</code> &#x6307;&#x4EE4;&#x7684;&#x4E0B;&#x4E00;&#x689D;&#x6307;&#x4EE4;&#x7684;&#x5730;&#x5740;&#xFF0C;&#x5373; <code>.string</code> &#x6240;&#x5728;&#x884C;&#x7684;&#x5730;&#x5740;&#xFF0C;&#x9019;&#x6A23; <code>ecx</code> &#x525B;&#x597D;&#x5F15;&#x7528;&#x4E86; <code>Hello World\\n</code> &#x5B57;&#x7B26;&#x4E32;&#x7684;&#x5730;&#x5740;&#x3002;</li>
<li>&#x7B2C;&#x4E09;&#x500B;&#x53C3;&#x6578;&#x662F; <code>edx</code>&#xFF0C;&#x525B;&#x597D;&#x662F; 12&#xFF0C;&#x5373; <code>Hello World\\n</code> &#x5B57;&#x7B26;&#x4E32;&#x7684;&#x9577;&#x5EA6;&#xFF08;&#x5305;&#x62EC;&#x4E00;&#x500B;&#x7A7A;&#x5B57;&#x7B26;&#xFF09;&#x3002;&#x9019;&#x6A23;&#xFF0C;<code>Shellcode.c</code> &#x7684;&#x57F7;&#x884C;&#x6D41;&#x7A0B;&#x5C31;&#x5F88;&#x6E05;&#x695A;&#x4E86;&#xFF0C;&#x7B2C; 4&#xFF0C;5&#xFF0C;15&#xFF0C;16 &#x884C;&#x6307;&#x4EE4;&#x7684;&#x5DE7;&#x5999;&#x4E4B;&#x8655;&#x4E5F;&#x5C31;&#x5BB9;&#x6613;&#x7406;&#x89E3;&#x4E86;&#xFF08;&#x628A; <code>.string</code> &#x5B58;&#x653E;&#x5728; <code>call</code> &#x6307;&#x4EE4;&#x4E4B;&#x5F8C;&#xFF0C;&#x4E26;&#x7528; <code>popl</code> &#x6307;&#x4EE4;&#x628A; <code>eip</code> &#x5F48;&#x51FA;&#x7576;&#x4F5C;&#x5B57;&#x7B26;&#x4E32;&#x7684;&#x5165;&#x53E3;&#xFF09;&#x3002;</li>
</ul>
<p><span id="toc_14869_27504_6"></span></p>
<h3 id="%E4%BB%80%E9%BA%BC%E6%98%AF-elf-%E6%96%87%E4%BB%B6">&#x4EC0;&#x9EBC;&#x662F; ELF &#x6587;&#x4EF6;</h3>
<p>&#x9019;&#x88E1;&#x7684; ELF &#x4E0D;&#x662F;&#x201C;&#x7CBE;&#x9748;&#x201D;&#xFF0C;&#x800C;&#x662F; Executable and Linking Format &#x6587;&#x4EF6;&#xFF0C;&#x662F; Linux &#x4E0B;&#x7528;&#x4F86;&#x505A;&#x76EE;&#x6A19;&#x6587;&#x4EF6;&#x3001;&#x53EF;&#x57F7;&#x884C;&#x6587;&#x4EF6;&#x548C;&#x5171;&#x4EAB;&#x5EAB;&#x7684;&#x4E00;&#x7A2E;&#x6587;&#x4EF6;&#x683C;&#x5F0F;&#xFF0C;&#x5B83;&#x6709;&#x5C08;&#x9580;&#x7684;&#x6A19;&#x6E96;&#xFF0C;&#x4F8B;&#x5982;&#xFF1A;<a href="http://www.x86.org/ftp/manuals/tools/elf.pdf" target="_blank">X86 ELF format and ABI</a>&#xFF0C;<a href="http://www.xfocus.net/articles/200105/174.html" target="_blank">&#x4E2D;&#x6587;&#x7248;</a>&#x3002;</p>
<p>&#x4E0B;&#x9762;&#x7C21;&#x55AE;&#x63CF;&#x8FF0; <code>ELF</code> &#x7684;&#x683C;&#x5F0F;&#x3002;</p>
<p><code>ELF</code> &#x6587;&#x4EF6;&#x4E3B;&#x8981;&#x6709;&#x4E09;&#x7A2E;&#xFF0C;&#x5206;&#x5225;&#x662F;&#xFF1A;</p>
<ul>
<li>&#x53EF;&#x91CD;&#x5B9A;&#x4F4D;&#x7684;&#x76EE;&#x6A19;&#x6587;&#x4EF6;&#xFF0C;&#x5728;&#x7DE8;&#x8B6F;&#x6642;&#x7528; <code>gcc</code> &#x7684; <code>-c</code> &#x53C3;&#x6578;&#x6642;&#x7522;&#x751F;&#x3002;</li>
<li>&#x53EF;&#x57F7;&#x884C;&#x6587;&#x4EF6;&#xFF0C;&#x9019;&#x985E;&#x6587;&#x4EF6;&#x5C31;&#x662F;&#x6211;&#x5011;&#x5F8C;&#x9762;&#x8981;&#x8A0E;&#x8AD6;&#x7684;&#x53EF;&#x4EE5;&#x57F7;&#x884C;&#x7684;&#x6587;&#x4EF6;&#x3002;</li>
<li>&#x5171;&#x4EAB;&#x5EAB;&#xFF0C;&#x9019;&#x88E1;&#x4E3B;&#x8981;&#x662F;&#x52D5;&#x614B;&#x5171;&#x4EAB;&#x5EAB;&#xFF0C;&#x800C;&#x975C;&#x614B;&#x5171;&#x4EAB;&#x5EAB;&#x5247;&#x662F;&#x53EF;&#x91CD;&#x5B9A;&#x4F4D;&#x7684;&#x76EE;&#x6A19;&#x6587;&#x4EF6;&#x901A;&#x904E; <code>ar</code> &#x547D;&#x4EE4;&#x7D44;&#x7E54;&#x7684;&#x3002;</li>
</ul>
<p><code>ELF</code> &#x6587;&#x4EF6;&#x7684;&#x5927;&#x9AD4;&#x7D50;&#x69CB;&#xFF1A;</p>
<pre><code>ELF Header               #&#x7A0B;&#x5E8F;&#x982D;&#xFF0C;&#x6709;&#x8A72;&#x6587;&#x4EF6;&#x7684;Magic number(&#x53C3;&#x8003;man magic)&#xFF0C;&#x985E;&#x578B;&#x7B49;
Program Header Table     #&#x5C0D;&#x53EF;&#x57F7;&#x884C;&#x6587;&#x4EF6;&#x548C;&#x5171;&#x4EAB;&#x5EAB;&#x6709;&#x6548;&#xFF0C;&#x5B83;&#x63CF;&#x8FF0;&#x4E0B;&#x9762;&#x5404;&#x500B;&#x7BC0;(section)&#x7D44;&#x6210;&#x7684;&#x6BB5;
Section1
Section2
Section3
.....
Program Section Table   #&#x50C5;&#x5C0D;&#x53EF;&#x91CD;&#x5B9A;&#x4F4D;&#x76EE;&#x6A19;&#x6587;&#x4EF6;&#x548C;&#x975C;&#x614B;&#x5EAB;&#x6709;&#x6548;&#xFF0C;&#x7528;&#x65BC;&#x63CF;&#x8FF0;&#x5404;&#x500B;Section&#x7684;&#x91CD;&#x5B9A;&#x4F4D;&#x4FE1;&#x606F;&#x7B49;&#x3002;
</code></pre><p>&#x5C0D;&#x65BC;&#x53EF;&#x57F7;&#x884C;&#x6587;&#x4EF6;&#xFF0C;&#x6587;&#x4EF6;&#x6700;&#x5F8C;&#x7684; <code>Program Section Table</code> &#xFF08;&#x7BC0;&#x5340;&#x8868;&#xFF09;&#x548C;&#x4E00;&#x4E9B;&#x975E;&#x91CD;&#x5B9A;&#x4F4D;&#x7684; <code>Section</code>&#xFF0C;&#x6BD4;&#x5982; <code>.comment</code>&#xFF0C;<code>.note.XXX.debug</code> &#x7B49;&#x4FE1;&#x606F;&#x90FD;&#x53EF;&#x4EE5;&#x522A;&#x9664;&#x6389;&#xFF0C;&#x4E0D;&#x904E;&#x5982;&#x679C;&#x7528; <code>strip</code>&#xFF0C;<code>objcopy</code> &#x7B49;&#x5DE5;&#x5177;&#x522A;&#x9664;&#x6389;&#x4EE5;&#x5F8C;&#xFF0C;&#x5C31;&#x4E0D;&#x53EF;&#x6062;&#x5FA9;&#x4E86;&#x3002;&#x56E0;&#x70BA;&#x9019;&#x4E9B;&#x4FE1;&#x606F;&#x5C0D;&#x7A0B;&#x5E8F;&#x7684;&#x904B;&#x884C;&#x4E00;&#x822C;&#x6C92;&#x6709;&#x4EFB;&#x4F55;&#x7528;&#x8655;&#x3002;</p>
<p><code>ELF</code> &#x6587;&#x4EF6;&#x7684;&#x4E3B;&#x8981;&#x7BC0;&#x5340;&#xFF08;<code>section</code>&#xFF09;&#x6709; <code>.data</code>&#xFF0C;<code>.text</code>&#xFF0C;<code>.bss</code>&#xFF0C;<code>.interp</code> &#x7B49;&#xFF0C;&#x800C;&#x4E3B;&#x8981;&#x6BB5;&#xFF08;<code>segment</code>&#xFF09;&#x6709; <code>LOAD</code>&#xFF0C;<code>INTERP</code> &#x7B49;&#x3002;&#x5B83;&#x5011;&#x4E4B;&#x9593;&#xFF08;&#x7BC0;&#x5340;&#x548C;&#x6BB5;&#xFF09;&#x7684;&#x4E3B;&#x8981;&#x5C0D;&#x61C9;&#x95DC;&#x4FC2;&#x5982;&#x4E0B;&#xFF1A;</p>
<table>
<thead>
<tr>
<th>Section</th>
<th>&#x89E3;&#x91CB;</th>
<th>&#x5BE6;&#x4F8B;</th>
</tr>
</thead>
<tbody>
<tr>
<td>.data</td>
<td>&#x521D;&#x59CB;&#x5316;&#x7684;&#x6578;&#x64DA;</td>
<td>&#x6BD4;&#x5982; <code>int a=10</code></td>
</tr>
<tr>
<td>.bss</td>
<td>&#x672A;&#x521D;&#x59CB;&#x5316;&#x7684;&#x6578;&#x64DA;</td>
<td>&#x6BD4;&#x5982; <code>char sum[100];</code> &#x9019;&#x500B;&#x5728;&#x7A0B;&#x5E8F;&#x57F7;&#x884C;&#x4E4B;&#x524D;&#xFF0C;&#x5167;&#x6838;&#x5C07;&#x521D;&#x59CB;&#x5316;&#x70BA; 0</td>
</tr>
<tr>
<td>.text</td>
<td>&#x7A0B;&#x5E8F;&#x4EE3;&#x78BC;&#x6B63;&#x6587;</td>
<td>&#x5373;&#x53EF;&#x57F7;&#x884C;&#x6307;&#x4EE4;&#x96C6;</td>
</tr>
<tr>
<td>.interp</td>
<td>&#x63CF;&#x8FF0;&#x7A0B;&#x5E8F;&#x9700;&#x8981;&#x7684;&#x89E3;&#x91CB;&#x5668;&#xFF08;&#x52D5;&#x614B;&#x9023;&#x63A5;&#x548C;&#x88DD;&#x8F09;&#x7A0B;&#x5E8F;&#xFF09;</td>
<td>&#x5B58;&#x6709;&#x89E3;&#x91CB;&#x5668;&#x7684;&#x5168;&#x8DEF;&#x5F91;&#xFF0C;&#x5982; <code>/lib/ld-linux.so</code></td>
</tr>
</tbody>
</table>
<p>&#x800C;&#x7A0B;&#x5E8F;&#x5728;&#x57F7;&#x884C;&#x4EE5;&#x5F8C;&#xFF0C;<code>.data</code>&#xFF0C;<code>.bss</code>&#xFF0C;<code>.text</code> &#x7B49;&#x4E00;&#x4E9B;&#x7BC0;&#x5340;&#x6703;&#x88AB; <code>Program header table</code> &#x6620;&#x5C04;&#x5230; <code>LOAD</code> &#x6BB5;&#xFF0C;<code>.interp</code> &#x5247;&#x88AB;&#x6620;&#x5C04;&#x5230;&#x4E86; <code>INTERP</code> &#x6BB5;&#x3002;</p>
<p>&#x5C0D;&#x65BC; <code>ELF</code> &#x6587;&#x4EF6;&#x7684;&#x5206;&#x6790;&#xFF0C;&#x5EFA;&#x8B70;&#x4F7F;&#x7528; <code>file</code>&#xFF0C;<code>size</code>&#xFF0C;<code>readelf</code>&#xFF0C;<code>objdump</code>&#xFF0C;<code>strip</code>&#xFF0C;<code>objcopy</code>&#xFF0C;<code>gdb</code>&#xFF0C;<code>nm</code> &#x7B49;&#x5DE5;&#x5177;&#x3002;</p>
<p>&#x9019;&#x88E1;&#x7C21;&#x55AE;&#x5730;&#x6F14;&#x793A;&#x9019;&#x5E7E;&#x500B;&#x5DE5;&#x5177;&#xFF1A;</p>
<pre><code>$ gcc -g -o shellcode shellcode.c  #&#x5982;&#x679C;&#x8981;&#x7528;gdb&#x8ABF;&#x8A66;&#xFF0C;&#x7DE8;&#x8B6F;&#x6642;&#x52A0;&#x4E0A;-g&#x662F;&#x5FC5;&#x9808;&#x7684;
shellcode.c: In function &#x2018;main&#x2019;:
shellcode.c:3: warning: return type of &#x2018;main&#x2019; is not &#x2018;int&#x2019;
f$ file shellcode  #file&#x547D;&#x4EE4;&#x67E5;&#x770B;&#x6587;&#x4EF6;&#x985E;&#x578B;&#xFF0C;&#x60F3;&#x4E86;&#x89E3;&#x5DE5;&#x4F5C;&#x539F;&#x7406;&#xFF0C;&#x53EF;man magic,man file
shellcode: ELF 32-bit LSB executable, Intel 80386, version 1 (SYSV),
dynamically linked (uses shared libs), not stripped
$ readelf -l shellcode  #&#x5217;&#x51FA;ELF&#x6587;&#x4EF6;&#x524D;&#x9762;&#x7684;program head table&#xFF0C;&#x5F8C;&#x9762;&#x662F;&#x5B83;&#x63CF;
                       #&#x8FF0;&#x4E86;&#x5404;&#x500B;&#x6BB5;(segment)&#x548C;&#x7BC0;&#x5340;(section)&#x7684;&#x95DC;&#x4FC2;,&#x5373;&#x5404;&#x500B;&#x6BB5;&#x5305;&#x542B;&#x54EA;&#x4E9B;&#x7BC0;&#x5340;&#x3002;
Elf file type is EXEC (Executable file)
Entry point 0x8048280
There are 7 program headers, starting at offset 52

Program Headers:
  Type           Offset   VirtAddr   PhysAddr   FileSiz MemSiz  Flg Align
  PHDR           0x000034 0x08048034 0x08048034 0x000e0 0x000e0 R E 0x4
  INTERP         0x000114 0x08048114 0x08048114 0x00013 0x00013 R   0x1
      [Requesting program interpreter: /lib/ld-linux.so.2]
  LOAD           0x000000 0x08048000 0x08048000 0x0044c 0x0044c R E 0x1000
  LOAD           0x00044c 0x0804944c 0x0804944c 0x00100 0x00104 RW  0x1000
  DYNAMIC        0x000460 0x08049460 0x08049460 0x000c8 0x000c8 RW  0x4
  NOTE           0x000128 0x08048128 0x08048128 0x00020 0x00020 R   0x4
  GNU_STACK      0x000000 0x00000000 0x00000000 0x00000 0x00000 RW  0x4

 Section to Segment mapping:
  Segment Sections...
   00
   01     .interp
   02     .interp .note.ABI-tag .hash .dynsym .dynstr .gnu.version .gnu.version_r
          .rel.dyn .rel.plt .init .plt .text .fini .rodata .eh_frame
   03     .ctors .dtors .jcr .dynamic .got .got.plt .data .bss
   04     .dynamic
   05     .note.ABI-tag
   06
$ size shellcode   #&#x53EF;&#x7528;size&#x547D;&#x4EE4;&#x67E5;&#x770B;&#x5404;&#x500B;&#x6BB5;&#xFF08;&#x5C0D;&#x61C9;&#x5F8C;&#x9762;&#x5C07;&#x5206;&#x6790;&#x7684;&#x9032;&#x7A0B;&#x5167;&#x5B58;&#x6620;&#x50CF;&#xFF09;&#x7684;&#x5927;&#x5C0F;
   text    data     bss     dec     hex filename
    815     256       4    1075     433 shellcode
$ strip -R .note.ABI-tag shellcode #&#x53EF;&#x7528;strip&#x4F86;&#x7D66;&#x53EF;&#x57F7;&#x884C;&#x6587;&#x4EF6;&#x201C;&#x6E1B;&#x80A5;&#x201D;&#xFF0C;&#x522A;&#x9664;&#x7121;&#x7528;&#x4FE1;&#x606F;
$ size shellcode               #&#x201C;&#x6E1B;&#x80A5;&#x201D;&#x5F8C;&#x6548;&#x679C;&#x201C;&#x660E;&#x986F;&#x201D;&#xFF0C;&#x5C0D;&#x65BC;&#x5D4C;&#x5165;&#x5F0F;&#x7CFB;&#x7D71;&#x61C9;&#x8A72;&#x6709;&#x5F88;&#x5927;&#x7684;&#x4F5C;&#x7528;
   text    data     bss     dec     hex filename
    783     256       4    1043     413 shellcode
$ objdump -s -j .interp shellcode #&#x9019;&#x500B;&#x4E3B;&#x8981;&#x5DE5;&#x4F5C;&#x662F;&#x53CD;&#x7DE8;&#x8B6F;&#xFF0C;&#x4E0D;&#x904E;&#x7528;&#x4F86;&#x67E5;&#x770B;&#x5404;&#x500B;&#x7BC0;&#x5340;&#x4E5F;&#x5F88;&#x53B2;&#x5BB3;

shellcode:     file format elf32-i386

Contents of section .interp:
 8048114 2f6c6962 2f6c642d 6c696e75 782e736f  /lib/ld-linux.so
 8048124 2e3200                               .2.
</code></pre><p>&#x88DC;&#x5145;&#xFF1A;&#x5982;&#x679C;&#x8981;&#x522A;&#x9664;&#x53EF;&#x57F7;&#x884C;&#x6587;&#x4EF6;&#x7684; <code>Program Section Table</code>&#xFF0C;&#x53EF;&#x4EE5;&#x7528; <a href="http://www.muppetlabs.com/~breadbox/software/tiny/teensy.html" target="_blank">A Whirlwind Tutorial on Creating Really Teensy ELF Executables for Linux</a> &#x4E00;&#x6587;&#x7684;&#x4F5C;&#x8005;&#x5BEB;&#x7684; <a href="http://www.muppetlabs.com/~breadbox/software/elfkickers.html" target="_blank">elf kicker</a> &#x5DE5;&#x5177;&#x93C8;&#x4E2D;&#x7684; <code>sstrip</code> &#x5DE5;&#x5177;&#x3002;</p>
<p><span id="toc_14869_27504_7"></span></p>
<h3 id="%E7%A8%8B%E5%BA%8F%E5%9F%B7%E8%A1%8C%E5%9F%BA%E6%9C%AC%E9%81%8E%E7%A8%8B">&#x7A0B;&#x5E8F;&#x57F7;&#x884C;&#x57FA;&#x672C;&#x904E;&#x7A0B;</h3>
<p>&#x5728;&#x547D;&#x4EE4;&#x884C;&#x4E0B;&#xFF0C;&#x6572;&#x5165;&#x7A0B;&#x5E8F;&#x7684;&#x540D;&#x5B57;&#x6216;&#x8005;&#x662F;&#x5168;&#x8DEF;&#x5F91;&#xFF0C;&#x7136;&#x5F8C;&#x6309;&#x4E0B;&#x56DE;&#x8ECA;&#x5C31;&#x53EF;&#x4EE5;&#x555F;&#x52D5;&#x7A0B;&#x5E8F;&#xFF0C;&#x9019;&#x500B;&#x5177;&#x9AD4;&#x662F;&#x600E;&#x9EBC;&#x5DE5;&#x4F5C;&#x7684;&#x5462;&#xFF1F;</p>
<p>&#x9996;&#x5148;&#x8981;&#x518D;&#x8A8D;&#x8B58;&#x4E00;&#x4E0B;&#x6211;&#x5011;&#x7684;&#x547D;&#x4EE4;&#x884C;&#xFF0C;&#x547D;&#x4EE4;&#x884C;&#x662F;&#x5167;&#x6838;&#x548C;&#x7528;&#x6236;&#x4E4B;&#x9593;&#x7684;&#x63A5;&#x53E3;&#xFF0C;&#x5B83;&#x672C;&#x8EAB;&#x4E5F;&#x662F;&#x4E00;&#x500B;&#x7A0B;&#x5E8F;&#x3002;&#x5728; Linux &#x7CFB;&#x7D71;&#x555F;&#x52D5;&#x4EE5;&#x5F8C;&#x6703;&#x70BA;&#x6BCF;&#x500B;&#x7D42;&#x7AEF;&#x7528;&#x6236;&#x5EFA;&#x7ACB;&#x4E00;&#x500B;&#x9032;&#x7A0B;&#x57F7;&#x884C;&#x4E00;&#x500B; Shell &#x89E3;&#x91CB;&#x7A0B;&#x5E8F;&#xFF0C;&#x9019;&#x500B;&#x7A0B;&#x5E8F;&#x89E3;&#x91CB;&#x4E26;&#x57F7;&#x884C;&#x7528;&#x6236;&#x8F38;&#x5165;&#x7684;&#x547D;&#x4EE4;&#xFF0C;&#x4EE5;&#x5BE6;&#x73FE;&#x7528;&#x6236;&#x548C;&#x5167;&#x6838;&#x4E4B;&#x9593;&#x7684;&#x63A5;&#x53E3;&#x3002;&#x9019;&#x985E;&#x89E3;&#x91CB;&#x7A0B;&#x5E8F;&#x6709;&#x54EA;&#x4E9B;&#x5462;&#xFF1F;&#x76EE;&#x524D; Linux &#x4E0B;&#x6BD4;&#x8F03;&#x5E38;&#x7528;&#x7684;&#x6709; <code>/bin/bash</code> &#x3002;&#x90A3;&#x9EBC;&#x8A72;&#x7A0B;&#x5E8F;&#x63A5;&#x6536;&#x4E26;&#x57F7;&#x884C;&#x547D;&#x4EE4;&#x7684;&#x904E;&#x7A0B;&#x662F;&#x600E;&#x9EBC;&#x6A23;&#x7684;&#x5462;&#xFF1F;</p>
<p>&#x5148;&#x7C21;&#x55AE;&#x63CF;&#x8FF0;&#x4E00;&#x4E0B;&#x9019;&#x500B;&#x904E;&#x7A0B;&#xFF1A;</p>
<ul>
<li>&#x8B80;&#x53D6;&#x7528;&#x6236;&#x7531;&#x9375;&#x76E4;&#x8F38;&#x5165;&#x7684;&#x547D;&#x4EE4;&#x884C;&#x3002;</li>
<li>&#x5206;&#x6790;&#x547D;&#x4EE4;&#xFF0C;&#x4EE5;&#x547D;&#x4EE4;&#x540D;&#x4F5C;&#x70BA;&#x6587;&#x4EF6;&#x540D;&#xFF0C;&#x4E26;&#x5C07;&#x5176;&#x5B83;&#x53C3;&#x6578;&#x6539;&#x70BA;&#x7CFB;&#x7D71;&#x8ABF;&#x7528; <code>execve</code> &#x5167;&#x90E8;&#x8655;&#x7406;&#x6240;&#x8981;&#x6C42;&#x7684;&#x5F62;&#x5F0F;&#x3002;</li>
<li>&#x7D42;&#x7AEF;&#x9032;&#x7A0B;&#x8ABF;&#x7528; <code>fork</code> &#x5EFA;&#x7ACB;&#x4E00;&#x500B;&#x5B50;&#x9032;&#x7A0B;&#x3002;</li>
<li>&#x7D42;&#x7AEF;&#x9032;&#x7A0B;&#x672C;&#x8EAB;&#x7528;&#x7CFB;&#x7D71;&#x8ABF;&#x7528; <code>wait4</code> &#x4F86;&#x7B49;&#x5F85;&#x5B50;&#x9032;&#x7A0B;&#x5B8C;&#x6210;&#xFF08;&#x5982;&#x679C;&#x662F;&#x5F8C;&#x81FA;&#x547D;&#x4EE4;&#xFF0C;&#x5247;&#x4E0D;&#x7B49;&#x5F85;&#xFF09;&#x3002;&#x7576;&#x5B50;&#x9032;&#x7A0B;&#x904B;&#x884C;&#x6642;&#x8ABF;&#x7528; <code>execve</code>&#xFF0C;&#x5B50;&#x9032;&#x7A0B;&#x6839;&#x64DA;&#x6587;&#x4EF6;&#x540D;&#xFF08;&#x5373;&#x547D;&#x4EE4;&#x540D;&#xFF09;&#x5230;&#x76EE;&#x9304;&#x4E2D;&#x67E5;&#x627E;&#x6709;&#x95DC;&#x6587;&#x4EF6;&#xFF08;&#x9019;&#x662F;&#x547D;&#x4EE4;&#x89E3;&#x91CB;&#x7A0B;&#x5E8F;&#x69CB;&#x6210;&#x7684;&#x6587;&#x4EF6;&#xFF09;&#xFF0C;&#x5C07;&#x5B83;&#x8ABF;&#x5165;&#x5167;&#x5B58;&#xFF0C;&#x57F7;&#x884C;&#x9019;&#x500B;&#x7A0B;&#x5E8F;&#xFF08;&#x89E3;&#x91CB;&#x9019;&#x689D;&#x547D;&#x4EE4;&#xFF09;&#x3002;</li>
<li>&#x5982;&#x679C;&#x547D;&#x4EE4;&#x672B;&#x5C3E;&#x6709; <code>&amp;</code> &#x865F;&#xFF08;&#x5F8C;&#x81FA;&#x547D;&#x4EE4;&#x7B26;&#x865F;&#xFF09;&#xFF0C;&#x5247;&#x7D42;&#x7AEF;&#x9032;&#x7A0B;&#x4E0D;&#x7528;&#x7CFB;&#x7D71;&#x8ABF;&#x7528; <code>wait4</code> &#x7B49;&#x5F85;&#xFF0C;&#x7ACB;&#x5373;&#x767C;&#x63D0;&#x793A;&#x7B26;&#xFF0C;&#x8B93;&#x7528;&#x6236;&#x8F38;&#x5165;&#x4E0B;&#x4E00;&#x500B;&#x547D;&#x4EE4;&#xFF0C;&#x8F49; 1&#xFF09;&#x3002;&#x5982;&#x679C;&#x547D;&#x4EE4;&#x672B;&#x5C3E;&#x6C92;&#x6709; <code>&amp;</code> &#x865F;&#xFF0C;&#x5247;&#x7D42;&#x7AEF;&#x9032;&#x7A0B;&#x8981;&#x4E00;&#x76F4;&#x7B49;&#x5F85;&#xFF0C;&#x7576;&#x5B50;&#x9032;&#x7A0B;&#xFF08;&#x5373;&#x904B;&#x884C;&#x547D;&#x4EE4;&#x7684;&#x9032;&#x7A0B;&#xFF09;&#x5B8C;&#x6210;&#x8655;&#x7406;&#x5F8C;&#x7D42;&#x6B62;&#xFF0C;&#x5411;&#x7236;&#x9032;&#x7A0B;&#xFF08;&#x7D42;&#x7AEF;&#x9032;&#x7A0B;&#xFF09;&#x5831;&#x544A;&#xFF0C;&#x6B64;&#x6642;&#x7D42;&#x7AEF;&#x9032;&#x7A0B;&#x9192;&#x4F86;&#xFF0C;&#x5728;&#x505A;&#x5FC5;&#x8981;&#x7684;&#x5224;&#x5225;&#x7B49;&#x5DE5;&#x4F5C;&#x5F8C;&#xFF0C;&#x7D42;&#x7AEF;&#x9032;&#x7A0B;&#x767C;&#x63D0;&#x793A;&#x7B26;&#xFF0C;&#x8B93;&#x7528;&#x6236;&#x8F38;&#x5165;&#x65B0;&#x7684;&#x547D;&#x4EE4;&#xFF0C;&#x91CD;&#x8907;&#x4E0A;&#x8FF0;&#x8655;&#x7406;&#x904E;&#x7A0B;&#x3002;</li>
</ul>
<p>&#x73FE;&#x5728;&#x7528; <code>strace</code> &#x4F86;&#x8DDF;&#x8E64;&#x4E00;&#x4E0B;&#x7A0B;&#x5E8F;&#x57F7;&#x884C;&#x904E;&#x7A0B;&#x4E2D;&#x7528;&#x5230;&#x7684;&#x7CFB;&#x7D71;&#x8ABF;&#x7528;&#x3002;</p>
<pre><code>$ strace -f -o strace.out test
$ cat strace.out | grep \(.*\) | sed -e &quot;s#[0-9]* \([a-zA-Z0-9_]*\)(.*).*#\1#g&quot;
execve
brk
access
open
fstat64
mmap2
close
open
read
fstat64
mmap2
mmap2
mmap2
mmap2
close
mmap2
set_thread_area
mprotect
munmap
brk
brk
open
fstat64
mmap2
close
close
close
exit_group
</code></pre><p>&#x76F8;&#x95DC;&#x7684;&#x7CFB;&#x7D71;&#x8ABF;&#x7528;&#x57FA;&#x672C;&#x9AD4;&#x73FE;&#x4E86;&#x4E0A;&#x9762;&#x7684;&#x57F7;&#x884C;&#x904E;&#x7A0B;&#xFF0C;&#x9700;&#x8981;&#x6CE8;&#x610F;&#x7684;&#x662F;&#xFF0C;&#x88E1;&#x982D;&#x9084;&#x6D89;&#x53CA;&#x5230;&#x5167;&#x5B58;&#x6620;&#x5C04;&#xFF08;<code>mmap2</code>&#xFF09;&#x7B49;&#x3002;</p>
<p>&#x4E0B;&#x9762;&#x518D;&#x7F85;&#x55E6;&#x4E00;&#x4E9B;&#x6BD4;&#x8F03;&#x6709;&#x610F;&#x601D;&#x7684;&#x5167;&#x5BB9;&#xFF0C;&#x53C3;&#x8003;&#x300A;&#x6DF1;&#x5165;&#x7406;&#x89E3; Linux &#x5167;&#x6838;&#x300B;&#x7684;&#x7A0B;&#x5E8F;&#x7684;&#x57F7;&#x884C;&#xFF08;P681&#xFF09;&#x3002;</p>
<p>Linux &#x652F;&#x6301;&#x5F88;&#x591A;&#x4E0D;&#x540C;&#x7684;&#x53EF;&#x57F7;&#x884C;&#x6587;&#x4EF6;&#x683C;&#x5F0F;&#xFF0C;&#x9019;&#x4E9B;&#x4E0D;&#x540C;&#x7684;&#x683C;&#x5F0F;&#x662F;&#x5982;&#x4F55;&#x89E3;&#x91CB;&#x7684;&#x5462;&#xFF1F;&#x5E73;&#x6642;&#x6211;&#x5011;&#x5728;&#x547D;&#x4EE4;&#x884C;&#x4E0B;&#x6572;&#x5165;&#x4E00;&#x500B;&#x547D;&#x4EE4;&#x5C31;&#x5B8C;&#x4E86;&#xFF0C;&#x4E5F;&#x6C92;&#x6709;&#x53BB;&#x7BA1;&#x9019;&#x4E9B;&#x7D30;&#x7BC0;&#x3002;&#x5BE6;&#x969B;&#x4E0A; Linux &#x4E0B;&#x6709;&#x4E00;&#x500B; <code>struct linux_binfmt</code> &#x7D50;&#x69CB;&#x4F86;&#x7BA1;&#x7406;&#x4E0D;&#x540C;&#x7684;&#x53EF;&#x57F7;&#x884C;&#x6587;&#x4EF6;&#x985E;&#x578B;&#xFF0C;&#x9019;&#x500B;&#x7D50;&#x69CB;&#x4E2D;&#x6709;&#x5C0D;&#x61C9;&#x7684;&#x53EF;&#x57F7;&#x884C;&#x6587;&#x4EF6;&#x7684;&#x8655;&#x7406;&#x51FD;&#x6578;&#x3002;&#x5927;&#x6982;&#x7684;&#x904E;&#x7A0B;&#x5982;&#x4E0B;&#xFF1A;</p>
<ul>
<li><p>&#x5728;&#x7528;&#x6236;&#x614B;&#x57F7;&#x884C;&#x4E86; <code>execve</code> &#x5F8C;&#xFF0C;&#x5F15;&#x767C; <code>int 0x80</code> &#x4E2D;&#x65B7;&#xFF0C;&#x9032;&#x5165;&#x5167;&#x6838;&#x614B;&#xFF0C;&#x57F7;&#x884C;&#x5167;&#x6838;&#x614B;&#x7684;&#x76F8;&#x61C9;&#x51FD;&#x6578; <code>do_sys_execve</code>&#xFF0C;&#x8A72;&#x51FD;&#x6578;&#x53C8;&#x8ABF;&#x7528; <code>do_execve</code> &#x51FD;&#x6578;&#x3002; <code>do_execve</code> &#x51FD;&#x6578;&#x8B80;&#x5165;&#x53EF;&#x57F7;&#x884C;&#x6587;&#x4EF6;&#xFF0C;&#x6AA2;&#x67E5;&#x6B0A;&#x9650;&#xFF0C;&#x5982;&#x679C;&#x6C92;&#x554F;&#x984C;&#xFF0C;&#x7E7C;&#x7E8C;&#x8B80;&#x5165;&#x53EF;&#x57F7;&#x884C;&#x6587;&#x4EF6;&#x9700;&#x8981;&#x7684;&#x76F8;&#x95DC;&#x4FE1;&#x606F;&#xFF08;<code>struct linux_binprm</code> &#x63CF;&#x8FF0;&#x7684;&#xFF09;&#x3002;</p>
</li>
<li><p>&#x63A5;&#x8457;&#x57F7;&#x884C; <code>search_binary_handler</code>&#xFF0C;&#x6839;&#x64DA;&#x53EF;&#x57F7;&#x884C;&#x6587;&#x4EF6;&#x7684;&#x985E;&#x578B;&#xFF08;&#x7531;&#x4E0A;&#x4E00;&#x6B65;&#x7684;&#x6700;&#x5F8C;&#x78BA;&#x5B9A;&#xFF09;&#xFF0C;&#x5728; <code>linux_binfmt</code> &#x7D50;&#x69CB;&#x93C8;&#x8868;&#xFF08;<code>formats</code>&#xFF0C;&#x9019;&#x500B;&#x93C8;&#x8868;&#x53EF;&#x4EE5;&#x901A;&#x904E; <code>register_binfmt</code> &#x548C; <code>unregister_binfmt</code> &#x8A3B;&#x518A;&#x548C;&#x522A;&#x9664;&#x67D0;&#x4E9B;&#x53EF;&#x57F7;&#x884C;&#x6587;&#x4EF6;&#x7684;&#x4FE1;&#x606F;&#xFF0C;&#x56E0;&#x6B64;&#x8A3B;&#x518A;&#x65B0;&#x7684;&#x53EF;&#x57F7;&#x884C;&#x6587;&#x4EF6;&#x6210;&#x70BA;&#x53EF;&#x80FD;&#xFF0C;&#x5F8C;&#x9762;&#x518D;&#x4ECB;&#x7D39;&#xFF09;&#x4E0A;&#x67E5;&#x627E;&#xFF0C;&#x627E;&#x5230;&#x76F8;&#x61C9;&#x7684;&#x7D50;&#x69CB;&#xFF0C;&#x7136;&#x5F8C;&#x57F7;&#x884C;&#x76F8;&#x61C9;&#x7684; <code>load_binary</code> &#x51FD;&#x6578;&#x958B;&#x59CB;&#x52A0;&#x8F09;&#x53EF;&#x57F7;&#x884C;&#x6587;&#x4EF6;&#x3002;&#x5728;&#x8A72;&#x93C8;&#x8868;&#x7684;&#x6700;&#x5F8C;&#x4E00;&#x500B;&#x5143;&#x7D20;&#x7E3D;&#x662F;&#x5C0D;&#x89E3;&#x91CB;&#x8173;&#x672C;&#xFF08;<code>interpreted script</code>&#xFF09;&#x7684;&#x53EF;&#x57F7;&#x884C;&#x6587;&#x4EF6;&#x683C;&#x5F0F;&#x9032;&#x884C;&#x63CF;&#x8FF0;&#x7684;&#x4E00;&#x500B;&#x5C0D;&#x8C61;&#x3002;&#x9019;&#x7A2E;&#x683C;&#x5F0F;&#x53EA;&#x5B9A;&#x7FA9;&#x4E86; <code>load_binary</code> &#x65B9;&#x6CD5;&#xFF0C;&#x5176;&#x76F8;&#x61C9;&#x7684; <code>load_script</code> &#x51FD;&#x6578;&#x6AA2;&#x67E5;&#x9019;&#x7A2E;&#x53EF;&#x57F7;&#x884C;&#x6587;&#x4EF6;&#x662F;&#x5426;&#x4EE5;&#x5169;&#x500B; <code>#!</code> &#x5B57;&#x7B26;&#x958B;&#x59CB;&#xFF0C;&#x5982;&#x679C;&#x662F;&#xFF0C;&#x9019;&#x500B;&#x51FD;&#x6578;&#x5C31;&#x4EE5;&#x53E6;&#x4E00;&#x500B;&#x53EF;&#x57F7;&#x884C;&#x6587;&#x4EF6;&#x7684;&#x8DEF;&#x5F91;&#x540D;&#x4F5C;&#x70BA;&#x53C3;&#x6578;&#x89E3;&#x91CB;&#x7B2C;&#x4E00;&#x884C;&#x7684;&#x5176;&#x9918;&#x90E8;&#x5206;&#xFF0C;&#x4E26;&#x628A;&#x8173;&#x672C;&#x6587;&#x4EF6;&#x540D;&#x4F5C;&#x70BA;&#x53C3;&#x6578;&#x50B3;&#x905E;&#x4EE5;&#x57F7;&#x884C;&#x9019;&#x500B;&#x8173;&#x672C;&#xFF08;&#x5BE6;&#x969B;&#x4E0A;&#x8173;&#x672C;&#x7A0B;&#x5E8F;&#x628A;&#x81EA;&#x8EAB;&#x7684;&#x5167;&#x5BB9;&#x7576;&#x4F5C;&#x4E00;&#x500B;&#x53C3;&#x6578;&#x50B3;&#x905E;&#x7D66;&#x77AD;&#x89E3;&#x91CB;&#x7A0B;&#x5E8F;&#xFF08;&#x5982; <code>/bin/bash</code>&#xFF09;&#xFF0C;&#x800C;&#x9019;&#x500B;&#x89E3;&#x91CB;&#x7A0B;&#x5E8F;&#x901A;&#x5E38;&#x5728;&#x8173;&#x672C;&#x6587;&#x4EF6;&#x7684;&#x958B;&#x982D;&#x7528; <code>#!</code> &#x6A19;&#x8A18;&#xFF0C;&#x5982;&#x679C;&#x6C92;&#x6709;&#x6A19;&#x8A18;&#xFF0C;&#x90A3;&#x9EBC;&#x9ED8;&#x8A8D;&#x89E3;&#x91CB;&#x7A0B;&#x5E8F;&#x70BA;&#x7576;&#x524D; <code>SHELL</code>&#xFF09;&#x3002;</p>
</li>
<li><p>&#x5C0D;&#x65BC; <code>ELF</code> &#x985E;&#x578B;&#x6587;&#x4EF6;&#xFF0C;&#x5176;&#x8655;&#x7406;&#x51FD;&#x6578;&#x662F; <code>load_elf_binary</code>&#xFF0C;&#x5B83;&#x5148;&#x8B80;&#x5165; <code>ELF</code> &#x6587;&#x4EF6;&#x7684;&#x982D;&#x90E8;&#xFF0C;&#x6839;&#x64DA;&#x982D;&#x90E8;&#x4FE1;&#x606F;&#x8B80;&#x5165;&#x5404;&#x7A2E;&#x6578;&#x64DA;&#xFF0C;&#x518D;&#x6B21;&#x6383;&#x63CF;&#x7A0B;&#x5E8F;&#x6BB5;&#x63CF;&#x8FF0;&#x8868;&#xFF08;<code>Program Header Table</code>&#xFF09;&#xFF0C;&#x627E;&#x5230;&#x985E;&#x578B;&#x70BA; <code>PT_LOAD</code> &#x7684;&#x6BB5;&#xFF08;&#x5373; <code>.text</code>&#xFF0C;<code>.data</code>&#xFF0C;<code>.bss</code> &#x7B49;&#x7BC0;&#x5340;&#xFF09;&#xFF0C;&#x5C07;&#x5176;&#x6620;&#x5C04;&#xFF08;<code>elf_map</code>&#xFF09;&#x5230;&#x5167;&#x5B58;&#x7684;&#x56FA;&#x5B9A;&#x5730;&#x5740;&#x4E0A;&#xFF0C;&#x5982;&#x679C;&#x6C92;&#x6709;&#x52D5;&#x614B;&#x9023;&#x63A5;&#x5668;&#x7684;&#x63CF;&#x8FF0;&#x6BB5;&#xFF0C;&#x628A;&#x8FD4;&#x56DE;&#x7684;&#x5165;&#x53E3;&#x5730;&#x5740;&#x8A2D;&#x7F6E;&#x6210;&#x61C9;&#x7528;&#x7A0B;&#x5E8F;&#x5165;&#x53E3;&#x3002;&#x5B8C;&#x6210;&#x9019;&#x500B;&#x529F;&#x80FD;&#x7684;&#x662F; <code>start_thread</code>&#xFF0C;&#x5B83;&#x4E0D;&#x555F;&#x52D5;&#x4E00;&#x500B;&#x7DDA;&#x7A0B;&#xFF0C;&#x800C;&#x53EA;&#x662F;&#x7528;&#x4F86;&#x4FEE;&#x6539;&#x4E86; <code>pt_regs</code> &#x4E2D;&#x4FDD;&#x5B58;&#x7684; <code>PC</code> &#x7B49;&#x5BC4;&#x5B58;&#x5668;&#x7684;&#x503C;&#xFF0C;&#x4F7F;&#x5176;&#x6307;&#x5411;&#x52A0;&#x8F09;&#x7684;&#x61C9;&#x7528;&#x7A0B;&#x5E8F;&#x7684;&#x5165;&#x53E3;&#x3002;&#x7576;&#x5167;&#x6838;&#x64CD;&#x4F5C;&#x7D50;&#x675F;&#xFF0C;&#x8FD4;&#x56DE;&#x7528;&#x6236;&#x614B;&#x6642;&#x63A5;&#x8457;&#x5C31;&#x57F7;&#x884C;&#x61C9;&#x7528;&#x7A0B;&#x5E8F;&#x672C;&#x8EAB;&#x4E86;&#x3002;</p>
</li>
<li><p>&#x5982;&#x679C;&#x61C9;&#x7528;&#x7A0B;&#x5E8F;&#x4F7F;&#x7528;&#x4E86;&#x52D5;&#x614B;&#x9023;&#x63A5;&#x5EAB;&#xFF0C;&#x5167;&#x6838;&#x9664;&#x4E86;&#x52A0;&#x8F09;&#x6307;&#x5B9A;&#x7684;&#x53EF;&#x57F7;&#x884C;&#x6587;&#x4EF6;&#x5916;&#xFF0C;&#x9084;&#x8981;&#x628A;&#x63A7;&#x5236;&#x6B0A;&#x4EA4;&#x7D66;&#x52D5;&#x614B;&#x9023;&#x63A5;&#x5668;&#xFF08;<code>ld-linux.so</code>&#xFF09;&#x4EE5;&#x4FBF;&#x8655;&#x7406;&#x52D5;&#x614B;&#x9023;&#x63A5;&#x7684;&#x7A0B;&#x5E8F;&#x3002;&#x5167;&#x6838;&#x641C;&#x5C0B;&#x6BB5;&#x8868;&#xFF08;<code>Program Header Table</code>&#xFF09;&#xFF0C;&#x627E;&#x5230;&#x6A19;&#x8A18;&#x70BA; <code>PT_INTERP</code> &#x6BB5;&#x4E2D;&#x6240;&#x5C0D;&#x61C9;&#x7684;&#x52D5;&#x614B;&#x9023;&#x63A5;&#x5668;&#x7684;&#x540D;&#x7A31;&#xFF0C;&#x4E26;&#x4F7F;&#x7528; <code>load_elf_interp</code> &#x52A0;&#x8F09;&#x5176;&#x6620;&#x50CF;&#xFF0C;&#x4E26;&#x628A;&#x8FD4;&#x56DE;&#x7684;&#x5165;&#x53E3;&#x5730;&#x5740;&#x8A2D;&#x7F6E;&#x6210; <code>load_elf_interp</code> &#x7684;&#x8FD4;&#x56DE;&#x503C;&#xFF0C;&#x5373;&#x52D5;&#x614B;&#x93C8;&#x63A5;&#x5668;&#x7684;&#x5165;&#x53E3;&#x3002;&#x7576; <code>execve</code> &#x7CFB;&#x7D71;&#x8ABF;&#x7528;&#x9000;&#x51FA;&#x6642;&#xFF0C;&#x52D5;&#x614B;&#x9023;&#x63A5;&#x5668;&#x63A5;&#x8457;&#x904B;&#x884C;&#xFF0C;&#x5B83;&#x6AA2;&#x67E5;&#x61C9;&#x7528;&#x7A0B;&#x5E8F;&#x5C0D;&#x5171;&#x4EAB;&#x93C8;&#x63A5;&#x5EAB;&#x7684;&#x4F9D;&#x8CF4;&#x6027;&#xFF0C;&#x4E26;&#x5728;&#x9700;&#x8981;&#x6642;&#x5C0D;&#x5176;&#x52A0;&#x8F09;&#xFF0C;&#x5C0D;&#x7A0B;&#x5E8F;&#x7684;&#x5916;&#x90E8;&#x5F15;&#x7528;&#x9032;&#x884C;&#x91CD;&#x5B9A;&#x4F4D;&#xFF08;&#x5177;&#x9AD4;&#x904E;&#x7A0B;&#x898B;<a href="02-chapter7.html">&#x300A;&#x9032;&#x7A0B;&#x548C;&#x9032;&#x7A0B;&#x7684;&#x57FA;&#x672C;&#x64CD;&#x4F5C;&#x300B;</a>&#xFF09;&#x3002;&#x7136;&#x5F8C;&#x628A;&#x63A7;&#x5236;&#x6B0A;&#x4EA4;&#x7D66;&#x61C9;&#x7528;&#x7A0B;&#x5E8F;&#xFF0C;&#x5F9E; <code>ELF</code> &#x6587;&#x4EF6;&#x982D;&#x90E8;&#x4E2D;&#x5B9A;&#x7FA9;&#x7684;&#x7A0B;&#x5E8F;&#x9032;&#x5165;&#x9EDE;&#xFF08;&#x7528; <code>readelf -h</code> &#x53EF;&#x4EE5;&#x51FA;&#x770B;&#x5230;&#xFF0C;<code>Entry point address</code> &#x5373;&#x662F;&#xFF09;&#x958B;&#x59CB;&#x57F7;&#x884C;&#x3002;&#xFF08;&#x4E0D;&#x904E;&#x5C0D;&#x65BC;&#x975E; <code>LIB_BIND_NOW</code> &#x7684;&#x5171;&#x4EAB;&#x5EAB;&#x88DD;&#x8F09;&#x662F;&#x5728;&#x6709;&#x5916;&#x90E8;&#x5F15;&#x7528;&#x8ACB;&#x6C42;&#x6642;&#x624D;&#x57F7;&#x884C;&#x7684;&#xFF09;&#x3002;</p>
</li>
</ul>
<p>&#x5C0D;&#x65BC;&#x5167;&#x6838;&#x614B;&#x7684;&#x51FD;&#x6578;&#x8ABF;&#x7528;&#x904E;&#x7A0B;&#xFF0C;&#x6C92;&#x6709;&#x8FA6;&#x6CD5;&#x901A;&#x904E; <code>strace</code>&#xFF08;&#x5B83;&#x53EA;&#x80FD;&#x8DDF;&#x8E64;&#x5230;&#x7CFB;&#x7D71;&#x8ABF;&#x7528;&#x5C64;&#xFF09;&#x4F86;&#x505A;&#x7684;&#xFF0C;&#x56E0;&#x6B64;&#x8981;&#x60F3;&#x8DDF;&#x8E64;&#x5167;&#x6838;&#x4E2D;&#x5404;&#x500B;&#x7CFB;&#x7D71;&#x8ABF;&#x7528;&#x7684;&#x57F7;&#x884C;&#x7D30;&#x7BC0;&#xFF0C;&#x9700;&#x8981;&#x7528;&#x5176;&#x4ED6;&#x5DE5;&#x5177;&#x3002;&#x6BD4;&#x5982;&#x53EF;&#x4EE5;&#x901A;&#x904E; Ftrace &#x4F86;&#x8DDF;&#x8E64;&#x5167;&#x6838;&#x5177;&#x9AD4;&#x8ABF;&#x7528;&#x4E86;&#x54EA;&#x4E9B;&#x51FD;&#x6578;&#x3002;&#x7576;&#x7136;&#xFF0C;&#x4E5F;&#x53EF;&#x4EE5;&#x901A;&#x904E; <code>ctags/cscope/LXR</code> &#x7B49;&#x5DE5;&#x5177;&#x5206;&#x6790;&#x5167;&#x6838;&#x7684;&#x6E90;&#x4EE3;&#x78BC;&#x3002;</p>
<p>Linux &#x5141;&#x8A31;&#x81EA;&#x5DF1;&#x8A3B;&#x518A;&#x6211;&#x5011;&#x81EA;&#x5DF1;&#x5B9A;&#x7FA9;&#x7684;&#x53EF;&#x57F7;&#x884C;&#x683C;&#x5F0F;&#xFF0C;&#x4E3B;&#x8981;&#x63A5;&#x53E3;&#x662F; <code>/procy/sys/fs/binfmt_misc/register</code>&#xFF0C;&#x53EF;&#x4EE5;&#x5F80;&#x88E1;&#x982D;&#x5BEB;&#x5165;&#x7279;&#x5B9A;&#x683C;&#x5F0F;&#x7684;&#x5B57;&#x7B26;&#x4E32;&#x4F86;&#x5BE6;&#x73FE;&#x3002;&#x8A72;&#x5B57;&#x7B26;&#x4E32;&#x683C;&#x5F0F;&#x5982;&#x4E0B;&#xFF1A;
<code>:name:type:offset:string:mask:interpreter:</code></p>
<ul>
<li><code>name</code> &#x65B0;&#x683C;&#x5F0F;&#x7684;&#x6A19;&#x793A;&#x7B26;</li>
<li><code>type</code> &#x8B58;&#x5225;&#x985E;&#x578B;&#xFF08;<code>M</code> &#x8868;&#x793A;&#x9B54;&#x6578;&#xFF0C;<code>E</code> &#x8868;&#x793A;&#x64F4;&#x5C55;&#xFF09;</li>
<li><code>offset</code> &#x9B54;&#x6578;&#xFF08;<code>magic number</code>&#xFF0C;&#x8ACB;&#x53C3;&#x8003; <code>man magic</code> &#x548C; <code>man file</code>&#xFF09;&#x5728;&#x6587;&#x4EF6;&#x4E2D;&#x7684;&#x555F;&#x59CB;&#x504F;&#x79FB;&#x91CF;</li>
<li><code>string</code> &#x4EE5;&#x9B54;&#x6578;&#x6216;&#x8005;&#x4EE5;&#x64F4;&#x5C55;&#x540D;&#x5339;&#x914D;&#x7684;&#x5B57;&#x7BC0;&#x5E8F;&#x5217;</li>
<li><code>mask</code> &#x7528;&#x4F86;&#x5C4F;&#x853D;&#x6389; <code>string</code> &#x7684;&#x4E00;&#x4E9B;&#x4F4D;</li>
<li><code>interpreter</code> &#x7A0B;&#x5E8F;&#x89E3;&#x91CB;&#x5668;&#x7684;&#x5B8C;&#x6574;&#x8DEF;&#x5F91;&#x540D;</li>
</ul>
<p><span id="toc_14869_27504_8"></span></p>
<h3 id="linux-%E4%B8%8B%E7%A8%8B%E5%BA%8F%E7%9A%84%E5%85%A7%E5%AD%98%E6%98%A0%E5%83%8F">Linux &#x4E0B;&#x7A0B;&#x5E8F;&#x7684;&#x5167;&#x5B58;&#x6620;&#x50CF;</h3>
<p>Linux &#x4E0B;&#x662F;&#x5982;&#x4F55;&#x7D66;&#x9032;&#x7A0B;&#x5206;&#x914D;&#x5167;&#x5B58;&#xFF08;&#x9019;&#x88E1;&#x50C5;&#x8A0E;&#x8AD6;&#x865B;&#x64EC;&#x5167;&#x5B58;&#x7684;&#x5206;&#x914D;&#xFF09;&#x7684;&#x5462;&#xFF1F;&#x53EF;&#x4EE5;&#x5F9E; <code>/proc/&lt;pid&gt;/maps</code> &#x6587;&#x4EF6;&#x4E2D;&#x770B;&#x5230;&#x500B;&#x5927;&#x6982;&#x3002;&#x9019;&#x88E1;&#x7684; <code>pid</code> &#x662F;&#x9032;&#x7A0B;&#x865F;&#x3002;</p>
<p><code>/proc</code> &#x4E0B;&#x6709;&#x4E00;&#x500B;&#x6587;&#x4EF6;&#x6BD4;&#x8F03;&#x7279;&#x6B8A;&#xFF0C;&#x662F; <code>self</code>&#xFF0C;&#x5B83;&#x93C8;&#x63A5;&#x5230;&#x7576;&#x524D;&#x9032;&#x7A0B;&#x7684;&#x9032;&#x7A0B;&#x865F;&#xFF0C;&#x4F8B;&#x5982;&#xFF1A;</p>
<pre><code>$ ls /proc/self -l
lrwxrwxrwx 1 root root 64 2000-01-10 18:26 /proc/self -&gt; 11291/
$ ls /proc/self -l
lrwxrwxrwx 1 root root 64 2000-01-10 18:26 /proc/self -&gt; 11292/
</code></pre><p>&#x770B;&#x5230;&#x6C92;&#xFF1F;&#x6BCF;&#x6B21;&#x90FD;&#x4E0D;&#x4E00;&#x6A23;&#xFF0C;&#x9019;&#x6A23;&#x6211;&#x5011;&#x901A;&#x904E; <code>cat /proc/self/maps</code> &#x5C31;&#x53EF;&#x4EE5;&#x770B;&#x5230; <code>cat</code> &#x7A0B;&#x5E8F;&#x57F7;&#x884C;&#x6642;&#x7684;&#x5167;&#x5B58;&#x6620;&#x50CF;&#x4E86;&#x3002;</p>
<pre><code>$ cat -n /proc/self/maps
     1  08048000-0804c000 r-xp 00000000 03:01 273716     /bin/cat
     2  0804c000-0804d000 rw-p 00003000 03:01 273716     /bin/cat
     3  0804d000-0806e000 rw-p 0804d000 00:00 0          [heap]
     4  b7b90000-b7d90000 r--p 00000000 03:01 87528      /usr/lib/locale/locale-archive
     5  b7d90000-b7d91000 rw-p b7d90000 00:00 0
     6  b7d91000-b7ecd000 r-xp 00000000 03:01 466875     /lib/libc-2.5.so
     7  b7ecd000-b7ece000 r--p 0013c000 03:01 466875     /lib/libc-2.5.so
     8  b7ece000-b7ed0000 rw-p 0013d000 03:01 466875     /lib/libc-2.5.so
     9  b7ed0000-b7ed4000 rw-p b7ed0000 00:00 0
    10  b7eeb000-b7f06000 r-xp 00000000 03:01 402817     /lib/ld-2.5.so
    11  b7f06000-b7f08000 rw-p 0001b000 03:01 402817     /lib/ld-2.5.so
    12  bfbe3000-bfbf8000 rw-p bfbe3000 00:00 0          [stack]
    13  ffffe000-fffff000 r-xp 00000000 00:00 0          [vdso]
</code></pre><p>&#x7DE8;&#x865F;&#x662F;&#x539F;&#x6587;&#x4EF6;&#x88E1;&#x982D;&#x6C92;&#x6709;&#x7684;&#xFF0C;&#x70BA;&#x4E86;&#x8AAA;&#x660E;&#x65B9;&#x4FBF;&#xFF0C;&#x7528; <code>-n</code> &#x53C3;&#x6578;&#x52A0;&#x4E0A;&#x53BB;&#x7684;&#x3002;&#x6211;&#x5011;&#x5F9E;&#x4E2D;&#x53EF;&#x4EE5;&#x5F97;&#x5230;&#x5982;&#x4E0B;&#x4FE1;&#x606F;&#xFF1A;</p>
<ul>
<li>&#x7B2C; 1&#xFF0C;2 &#x884C;&#x5C0D;&#x61C9;&#x7684;&#x5167;&#x5B58;&#x5340;&#x662F;&#x6211;&#x5011;&#x7684;&#x7A0B;&#x5E8F;&#xFF08;&#x5305;&#x62EC;&#x6307;&#x4EE4;&#xFF0C;&#x6578;&#x64DA;&#x7B49;&#xFF09;</li>
<li>&#x7B2C; 3 &#x5230; 12 &#x884C;&#x5C0D;&#x61C9;&#x7684;&#x5167;&#x5B58;&#x5340;&#x662F;&#x5806;&#x68E7;&#x6BB5;&#xFF0C;&#x88E1;&#x982D;&#x4E5F;&#x6620;&#x50CF;&#x4E86;&#x7A0B;&#x5E8F;&#x5F15;&#x7528;&#x7684;&#x52D5;&#x614B;&#x9023;&#x63A5;&#x5EAB;</li>
<li>&#x7B2C; 13 &#x884C;&#x662F;&#x5167;&#x6838;&#x7A7A;&#x9593;</li>
</ul>
<p>&#x7E3D;&#x7D50;&#x4E00;&#x4E0B;&#xFF1A;</p>
<ul>
<li>&#x524D;&#x5169;&#x90E8;&#x5206;&#x662F;&#x7528;&#x6236;&#x7A7A;&#x9593;&#xFF0C;&#x53EF;&#x4EE5;&#x5F9E; <code>0x00000000</code> &#x5230; <code>0xbfffffff</code> &#xFF08;&#x5728;&#x6E2C;&#x8A66;&#x7684; <code>2.6.21.5-smp</code> &#x4E0A;&#x53EA;&#x5230; <code>bfbf8000</code>&#xFF09;&#xFF0C;&#x800C;&#x5167;&#x6838;&#x7A7A;&#x9593;&#x5F9E; <code>0xC0000000</code> &#x5230; <code>0xffffffff</code>&#xFF0C;&#x5206;&#x5225;&#x662F; <code>3G</code> &#x548C; <code>1G</code>&#xFF0C;&#x6240;&#x4EE5;&#x5C0D;&#x65BC;&#x6BCF;&#x4E00;&#x500B;&#x9032;&#x7A0B;&#x4F86;&#x8AAA;&#xFF0C;&#x5171;&#x4F54;&#x7528; <code>4G</code> &#x7684;&#x865B;&#x64EC;&#x5167;&#x5B58;&#x7A7A;&#x9593;</li>
<li>&#x5F9E;&#x7A0B;&#x5E8F;&#x672C;&#x8EAB;&#x4F54;&#x7528;&#x7684;&#x5167;&#x5B58;&#xFF0C;&#x5230;&#x5806;&#x68E7;&#x6BB5;&#xFF08;&#x52D5;&#x614B;&#x7372;&#x53D6;&#x5167;&#x5B58;&#x6216;&#x8005;&#x662F;&#x51FD;&#x6578;&#x904B;&#x884C;&#x904E;&#x7A0B;&#x4E2D;&#x7528;&#x4F86;&#x5B58;&#x5132;&#x5C40;&#x90E8;&#x8B8A;&#x91CF;&#x3001;&#x53C3;&#x6578;&#x7684;&#x7A7A;&#x9593;&#xFF0C;&#x524D;&#x8005;&#x662F; <code>heap</code>&#xFF0C;&#x5F8C;&#x8005;&#x662F; <code>stack</code>&#xFF09;&#xFF0C;&#x518D;&#x5230;&#x5167;&#x6838;&#x7A7A;&#x9593;&#xFF0C;&#x5730;&#x5740;&#x662F;&#x5F9E;&#x4F4E;&#x5230;&#x9AD8;&#x7684;</li>
<li>&#x68E7;&#x9802;&#x4E26;&#x975E; <code>0xC0000000</code> &#x4E0B;&#x7684;&#x4E00;&#x500B;&#x56FA;&#x5B9A;&#x6578;&#x503C;</li>
</ul>
<p>&#x7D50;&#x5408;&#x76F8;&#x95DC;&#x8CC7;&#x6599;&#xFF0C;&#x53EF;&#x4EE5;&#x5F97;&#x5230;&#x9019;&#x9EBC;&#x4E00;&#x500B;&#x6BD4;&#x8F03;&#x8A73;&#x7D30;&#x7684;&#x9032;&#x7A0B;&#x5167;&#x5B58;&#x6620;&#x50CF;&#x8868;&#xFF08;&#x4EE5; <code>Linux 2.6.21.5-smp</code> &#x70BA;&#x4F8B;&#xFF09;&#xFF1A;</p>
<table>
<thead>
<tr>
<th>&#x5730;&#x5740;</th>
<th>&#x5167;&#x6838;&#x7A7A;&#x9593;</th>
<th>&#x63CF;&#x8FF0;</th>
</tr>
</thead>
<tbody>
<tr>
<td>0xC0000000</td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td>(program flie) &#x7A0B;&#x5E8F;&#x540D;</td>
<td>execve &#x7684;&#x7B2C;&#x4E00;&#x500B;&#x53C3;&#x6578;</td>
</tr>
<tr>
<td></td>
<td>(environment) &#x74B0;&#x5883;&#x8B8A;&#x91CF;</td>
<td>execve &#x7684;&#x7B2C;&#x4E09;&#x500B;&#x53C3;&#x6578;&#xFF0C;main &#x7684;&#x7B2C;&#x4E09;&#x500B;&#x53C3;&#x6578;</td>
</tr>
<tr>
<td></td>
<td>(arguments) &#x53C3;&#x6578;</td>
<td>execve &#x7684;&#x7B2C;&#x4E8C;&#x500B;&#x53C3;&#x6578;&#xFF0C;main &#x7684;&#x5F62;&#x53C3;</td>
</tr>
<tr>
<td></td>
<td>(stack) &#x68E7;</td>
<td>&#x81EA;&#x52D5;&#x8B8A;&#x91CF;&#x4EE5;&#x53CA;&#x6BCF;&#x6B21;&#x51FD;&#x6578;&#x8ABF;&#x7528;&#x6642;&#x6240;&#x9700;&#x4FDD;&#x5B58;&#x7684;&#x4FE1;&#x606F;&#x90FD;</td>
</tr>
<tr>
<td></td>
<td></td>
<td>&#x5B58;&#x653E;&#x5728;&#x6B64;&#xFF0C;&#x5305;&#x62EC;&#x51FD;&#x6578;&#x8FD4;&#x56DE;&#x5730;&#x5740;&#x3001;&#x8ABF;&#x7528;&#x8005;&#x7684;</td>
</tr>
<tr>
<td></td>
<td></td>
<td>&#x74B0;&#x5883;&#x4FE1;&#x606F;&#x7B49;&#xFF0C;&#x51FD;&#x6578;&#x7684;&#x53C3;&#x6578;&#xFF0C;&#x5C40;&#x90E8;&#x8B8A;&#x91CF;&#x90FD;&#x5B58;&#x653E;&#x5728;&#x6B64;</td>
</tr>
<tr>
<td></td>
<td>(shared memory) &#x5171;&#x4EAB;&#x5167;&#x5B58;</td>
<td>&#x5171;&#x4EAB;&#x5167;&#x5B58;&#x7684;&#x5927;&#x6982;&#x4F4D;&#x7F6E;</td>
</tr>
<tr>
<td></td>
<td>...</td>
<td></td>
</tr>
<tr>
<td></td>
<td>...</td>
<td></td>
</tr>
<tr>
<td></td>
<td>(heap) &#x5806;</td>
<td>&#x4E3B;&#x8981;&#x5728;&#x9019;&#x88E1;&#x9032;&#x884C;&#x52D5;&#x614B;&#x5B58;&#x5132;&#x5206;&#x914D;&#xFF0C;&#x6BD4;&#x5982; malloc&#xFF0C;new &#x7B49;&#x3002;</td>
</tr>
<tr>
<td></td>
<td>...</td>
<td></td>
</tr>
<tr>
<td></td>
<td>.bss (uninitilized data)</td>
<td>&#x6C92;&#x6709;&#x521D;&#x59CB;&#x5316;&#x7684;&#x6578;&#x64DA;&#xFF08;&#x5168;&#x5C40;&#x8B8A;&#x91CF;&#x54E6;&#xFF09;</td>
</tr>
<tr>
<td></td>
<td>.data (initilized global data)</td>
<td>&#x5DF2;&#x7D93;&#x521D;&#x59CB;&#x5316;&#x7684;&#x5168;&#x5C40;&#x6578;&#x64DA;&#xFF08;&#x5168;&#x5C40;&#x8B8A;&#x91CF;&#xFF09;</td>
</tr>
<tr>
<td></td>
<td>.text (Executable Instructions)</td>
<td>&#x901A;&#x5E38;&#x662F;&#x53EF;&#x57F7;&#x884C;&#x6307;&#x4EE4;</td>
</tr>
<tr>
<td>0x08048000</td>
<td></td>
<td></td>
</tr>
<tr>
<td>0x00000000</td>
<td></td>
<td>...</td>
</tr>
</tbody>
</table>
<p>&#x5149;&#x770B;&#x6C92;&#x6709;&#x4EFB;&#x4F55;&#x6982;&#x5FF5;&#xFF0C;&#x6211;&#x5011;&#x7528; <code>gdb</code> &#x4F86;&#x770B;&#x770B;&#x525B;&#x624D;&#x90A3;&#x500B;&#x7C21;&#x55AE;&#x7684;&#x7A0B;&#x5E8F;&#x3002;</p>
<pre><code>$ gcc -g -o shellcode shellcode.c   #&#x8981;&#x7528;gdb&#x8ABF;&#x8A66;&#xFF0C;&#x5728;&#x7DE8;&#x8B6F;&#x6642;&#x9700;&#x8981;&#x52A0;-g&#x53C3;&#x6578;
$ gdb ./shellcode
(gdb) set args arg1 arg2 arg3 arg4  #&#x70BA;&#x4E86;&#x6E2C;&#x8A66;&#xFF0C;&#x8A2D;&#x7F6E;&#x5E7E;&#x500B;&#x53C3;&#x6578;
(gdb) l                             #&#x700F;&#x89BD;&#x4EE3;&#x78BC;
1 /* shellcode.c */
2 void main()
3 {
4     __asm__ __volatile__(&quot;jmp forward;&quot;
5     &quot;backward:&quot;
6        &quot;popl   %esi;&quot;
7        &quot;movl   $4, %eax;&quot;
8        &quot;movl   $2, %ebx;&quot;
9        &quot;movl   %esi, %ecx;&quot;
10               &quot;movl   $12, %edx;&quot;
(gdb) break 4               #&#x5728;&#x5F59;&#x7DE8;&#x5165;&#x53E3;&#x8A2D;&#x7F6E;&#x4E00;&#x500B;&#x65B7;&#x9EDE;&#xFF0C;&#x8B93;&#x7A0B;&#x5E8F;&#x904B;&#x884C;&#x5F8C;&#x505C;&#x5230;&#x9019;&#x88E1;
Breakpoint 1 at 0x8048332: file shellcode.c, line 4.
(gdb) r                     #&#x904B;&#x884C;&#x7A0B;&#x5E8F;
Starting program: /mnt/hda8/Temp/c/program/shellcode arg1 arg2 arg3 arg4

Breakpoint 1, main () at shellcode.c:4
4     __asm__ __volatile__(&quot;jmp forward;&quot;
(gdb) print $esp            #&#x6253;&#x5370;&#x7576;&#x524D;&#x5806;&#x68E7;&#x6307;&#x91DD;&#x503C;&#xFF0C;&#x7528;&#x65BC;&#x67E5;&#x627E;&#x6574;&#x500B;&#x68E7;&#x7684;&#x68E7;&#x9802;
$1 = (void *) 0xbffe1584
(gdb) x/100s $esp+4000      #&#x6539;&#x8B8A;&#x5F8C;&#x9762;&#x7684;4000&#xFF0C;&#x4E0D;&#x65B7;&#x5F80;&#x66F4;&#x5927;&#x7684;&#x7A7A;&#x9593;&#x627E;
(gdb) x/1s 0xbffe1fd9       #&#x5728; 0xbffe1fd9 &#x627E;&#x5230;&#x4E86;&#x7A0B;&#x5E8F;&#x540D;&#xFF0C;&#x9019;&#x88E1;&#x662F;&#x8A72;&#x6B21;&#x904B;&#x884C;&#x6642;&#x7684;&#x68E7;&#x9802;
0xbffe1fd9:      &quot;/mnt/hda8/Temp/c/program/shellcode&quot;
(gdb) x/10s 0xbffe17b7      #&#x5176;&#x4ED6;&#x74B0;&#x5883;&#x8B8A;&#x91CF;&#x4FE1;&#x606F;
0xbffe17b7:      &quot;CPLUS_INCLUDE_PATH=/usr/lib/qt/include&quot;
0xbffe17de:      &quot;MANPATH=/usr/local/man:/usr/man:/usr/X11R6/man:/usr/lib/java/man:/usr/share/texmf/man&quot;
0xbffe1834:      &quot;HOSTNAME=falcon.lzu.edu.cn&quot;
0xbffe184f:      &quot;TERM=xterm&quot;
0xbffe185a:      &quot;SSH_CLIENT=219.246.50.235 3099 22&quot;
0xbffe187c:      &quot;QTDIR=/usr/lib/qt&quot;
0xbffe188e:      &quot;SSH_TTY=/dev/pts/0&quot;
0xbffe18a1:      &quot;USER=falcon&quot;
...
(gdb) x/5s 0xbffe1780    #&#x4E00;&#x4E9B;&#x50B3;&#x905E;&#x7D66;main&#x51FD;&#x6578;&#x7684;&#x53C3;&#x6578;&#xFF0C;&#x5305;&#x62EC;&#x6587;&#x4EF6;&#x540D;&#x548C;&#x5176;&#x4ED6;&#x53C3;&#x6578;
0xbffe1780:      &quot;/mnt/hda8/Temp/c/program/shellcode&quot;
0xbffe17a3:      &quot;arg1&quot;
0xbffe17a8:      &quot;arg2&quot;
0xbffe17ad:      &quot;arg3&quot;
0xbffe17b2:      &quot;arg4&quot;
(gdb) print init  #&#x6253;&#x5370;init&#x51FD;&#x6578;&#x7684;&#x5730;&#x5740;&#xFF0C;&#x9019;&#x500B;&#x662F;/usr/lib/crti.o&#x88E1;&#x982D;&#x7684;&#x51FD;&#x6578;&#xFF0C;&#x505A;&#x4E00;&#x4E9B;&#x521D;&#x59CB;&#x5316;&#x64CD;&#x4F5C;
$2 = {&lt;text variable, no debug info&gt;} 0xb7e73d00 &lt;init&gt;
(gdb) print fini   #&#x4E5F;&#x5728;/usr/lib/crti.o&#x4E2D;&#x5B9A;&#x7FA9;&#xFF0C;&#x5728;&#x7A0B;&#x5E8F;&#x7D50;&#x675F;&#x6642;&#x505A;&#x4E00;&#x4E9B;&#x8655;&#x7406;&#x5DE5;&#x4F5C;
$3 = {&lt;text variable, no debug info&gt;} 0xb7f4a380 &lt;fini&gt;
(gdb) print _start #&#x5728;/usr/lib/crt1.o&#xFF0C;&#x9019;&#x500B;&#x624D;&#x662F;&#x7A0B;&#x5E8F;&#x7684;&#x5165;&#x53E3;&#xFF0C;&#x5FC5;&#x9808;&#x7684;&#xFF0C;ld&#x6703;&#x6AA2;&#x67E5;&#x9019;&#x500B;
$4 = {&lt;text variable, no debug info&gt;} 0x8048280 &lt;__libc_start_main@plt+20&gt;
(gdb) print main   #&#x9019;&#x88E1;&#x662F;&#x6211;&#x5011;&#x7684;main&#x51FD;&#x6578;
$5 = {void ()} 0x8048324 &lt;main&gt;
</code></pre><p>&#x88DC;&#x5145;&#xFF1A;&#x5728;&#x9032;&#x7A0B;&#x7684;&#x5167;&#x5B58;&#x6620;&#x50CF;&#x4E2D;&#x53EF;&#x80FD;&#x770B;&#x5230;&#x8AF8;&#x5982; <code>init</code>&#xFF0C;<code>fini</code>&#xFF0C;<code>_start</code> &#x7B49;&#x51FD;&#x6578;&#xFF08;&#x6216;&#x8005;&#x662F;&#x5165;&#x53E3;&#xFF09;&#xFF0C;&#x9019;&#x4E9B;&#x6771;&#x897F;&#x4E26;&#x4E0D;&#x662F;&#x6211;&#x5011;&#x81EA;&#x5DF1;&#x5BEB;&#x7684;&#x554A;&#xFF1F;&#x70BA;&#x4EC0;&#x9EBC;&#x6703;&#x8DD1;&#x5230;&#x6211;&#x5011;&#x7684;&#x4EE3;&#x78BC;&#x88E1;&#x982D;&#x5462;&#xFF1F;&#x5BE6;&#x969B;&#x4E0A;&#x9019;&#x4E9B;&#x6771;&#x897F;&#x662F;&#x93C8;&#x63A5;&#x7684;&#x6642;&#x5019; <code>gcc</code> &#x9ED8;&#x8A8D;&#x7D66;&#x9023;&#x63A5;&#x9032;&#x53BB;&#x7684;&#xFF0C;&#x4E3B;&#x8981;&#x7528;&#x4F86;&#x505A;&#x4E00;&#x4E9B;&#x9032;&#x7A0B;&#x7684;&#x521D;&#x59CB;&#x5316;&#x548C;&#x7D42;&#x6B62;&#x7684;&#x52D5;&#x4F5C;&#x3002;&#x66F4;&#x591A;&#x76F8;&#x95DC;&#x7684;&#x7D30;&#x7BC0;&#x53EF;&#x4EE5;&#x53C3;&#x8003;&#x8CC7;&#x6599;<a href="http://edu.stuccess.com/KnowCenter/Unix/13/hellguard_unix_faq/00000089.htm" target="_blank">&#x5982;&#x4F55;&#x7372;&#x53D6;&#x7576;&#x524D;&#x9032;&#x7A0B;&#x4E4B;&#x975C;&#x614B;&#x5F71;&#x50CF;&#x6587;&#x4EF6;</a>&#x548C;&quot;The Linux Kernel Primer&quot;&#xFF0C; P234&#xFF0C; Figure 4.11&#xFF0C;&#x5982;&#x679C;&#x60F3;&#x4E86;&#x89E3;&#x93C8;&#x63A5;&#xFF08;ld&#xFF09;&#x7684;&#x5177;&#x9AD4;&#x904E;&#x7A0B;&#xFF0C;&#x53EF;&#x4EE5;&#x770B;&#x770B;&#x672C;&#x7BC0;&#x53C3;&#x8003;&#x300A;Unix&#x74B0;&#x5883;&#x9AD8;&#x7D1A;&#x7DE8;&#x7A0B;&#x7DE8;&#x7A0B;&#x300B;&#x7B2C;7&#x7AE0; &quot;UnIx&#x9032;&#x7A0B;&#x7684;&#x74B0;&#x5883;&quot;&#xFF0C; P127&#x548C;P13&#xFF0C;<a href="http://linux.jinr.ru/usoft/WWW/www_debian.org/Documentation/elf/elf.html" target="_blank">ELF: From The Programmer&apos;s Perspective</a>&#xFF0C;<a href="http://womking.bokee.com/5967668.html" target="_blank">GNU-ld &#x9023;&#x63A5;&#x8173;&#x672C; Linker Scripts</a>&#x3002;</p>
<p>&#x4E0A;&#x9762;&#x7684;&#x64CD;&#x4F5C;&#x5C0D;&#x5806;&#x68E7;&#x7684;&#x64CD;&#x4F5C;&#x6BD4;&#x8F03;&#x5C11;&#xFF0C;&#x4E0B;&#x9762;&#x6211;&#x5011;&#x7528;&#x4E00;&#x500B;&#x4F8B;&#x5B50;&#x4F86;&#x6F14;&#x793A;&#x68E7;&#x5728;&#x5167;&#x5B58;&#x4E2D;&#x7684;&#x60C5;&#x6CC1;&#x3002;</p>
<p><span id="toc_14869_27504_9"></span></p>
<h3 id="%E6%A3%A7%E5%9C%A8%E5%85%A7%E5%AD%98%E4%B8%AD%E7%9A%84%E7%B5%84%E7%B9%94">&#x68E7;&#x5728;&#x5167;&#x5B58;&#x4E2D;&#x7684;&#x7D44;&#x7E54;</h3>
<p>&#x9019;&#x4E00;&#x7BC0;&#x4E3B;&#x8981;&#x4ECB;&#x7D39;&#x4E00;&#x500B;&#x51FD;&#x6578;&#x88AB;&#x8ABF;&#x7528;&#x6642;&#xFF0C;&#x53C3;&#x6578;&#x662F;&#x5982;&#x4F55;&#x50B3;&#x905E;&#x7684;&#xFF0C;&#x5C40;&#x90E8;&#x8B8A;&#x91CF;&#x662F;&#x5982;&#x4F55;&#x5B58;&#x5132;&#x7684;&#xFF0C;&#x5B83;&#x5011;&#x5C0D;&#x61C9;&#x7684;&#x68E7;&#x7684;&#x4F4D;&#x7F6E;&#x548C;&#x8B8A;&#x5316;&#x60C5;&#x6CC1;&#xFF0C;&#x5F9E;&#x800C;&#x52A0;&#x6DF1;&#x5C0D;&#x68E7;&#x7684;&#x7406;&#x89E3;&#x3002;&#x5728;&#x64CD;&#x4F5C;&#x6642;&#x767C;&#x73FE;&#x548C;&#x53C3;&#x8003;&#x8CC7;&#x6599;&#x7684;&#x7D50;&#x679C;&#x4E0D;&#x592A;&#x4E00;&#x6A23;&#xFF08;&#x53C3;&#x8003;&#x8CC7;&#x6599;&#x4E2D;&#x6C92;&#x6709; <code>edi</code> &#x548C; <code>esi</code> &#x76F8;&#x95DC;&#x4FE1;&#x606F;&#xFF0C;&#x518D;&#x7B2C;&#x4E8C;&#x90E8;&#x5206;&#x7684;&#x4E00;&#x500B;&#x5C0F;&#x7A0B;&#x5E8F;&#x88E1;&#x982D;&#x4E5F;&#x6C92;&#x6709;&#xFF09;&#xFF0C;&#x53EF;&#x80FD;&#x662F; <code>gcc</code> &#x7248;&#x672C;&#x7684;&#x554F;&#x984C;&#x6216;&#x8005;&#x662F;&#x5B83;&#x5C0D;&#x4E0D;&#x540C;&#x6E90;&#x4EE3;&#x78BC;&#x7684;&#x8655;&#x7406;&#x4E0D;&#x540C;&#x3002;&#x6211;&#x7684;&#x7248;&#x672C;&#x662F; <code>4.1.2</code> &#xFF08;&#x53EF;&#x4EE5;&#x901A;&#x904E; <code>gcc --version</code> &#x67E5;&#x770B;&#xFF09;&#x3002;</p>
<p>&#x5148;&#x4F86;&#x4E00;&#x6BB5;&#x7C21;&#x55AE;&#x7684;&#x7A0B;&#x5E8F;&#xFF0C;&#x9019;&#x500B;&#x7A0B;&#x5E8F;&#x9664;&#x4E86;&#x505A;&#x4E00;&#x500B;&#x52A0;&#x6CD5;&#x64CD;&#x4F5C;&#x5916;&#xFF0C;&#x9084;&#x8907;&#x88FD;&#x4E86;&#x4E00;&#x4E9B;&#x5B57;&#x7B26;&#x4E32;&#x3002;</p>
<pre><code>/* testshellcode.c */
#include &lt;stdio.h&gt;      /* printf */
#include &lt;string.h&gt;     /* memset, memcpy */

#define BUF_SIZE 8

#ifndef STR_SRC
# define STR_SRC &quot;AAAAAAA&quot;
#endif

int func(int a, int b, int c)
{
    int sum = 0;
    char buffer[BUF_SIZE];

    sum = a + b + c;

    memset(buffer, &apos;\0&apos;, BUF_SIZE);
    memcpy(buffer, STR_SRC, sizeof(STR_SRC)-1);

    return sum;
}

int main()
{
    int sum;

    sum = func(1, 2, 3);

    printf(&quot;sum = %d\n&quot;, sum);

    return 0;
}
</code></pre><p>&#x4E0A;&#x9762;&#x9019;&#x500B;&#x4EE3;&#x78BC;&#x6C92;&#x6709;&#x4EC0;&#x9EBC;&#x554F;&#x984C;&#xFF0C;&#x7DE8;&#x8B6F;&#x57F7;&#x884C;&#x4E00;&#x4E0B;&#xFF1A;</p>
<pre><code>$ make testshellcode
cc     testshellcode.c   -o testshellcode
$ ./testshellcode
sum = 6
</code></pre><p>&#x4E0B;&#x9762;&#x8ABF;&#x8A66;&#x4E00;&#x4E0B;&#xFF0C;&#x770B;&#x770B;&#x5728;&#x8ABF;&#x7528; <code>func</code> &#x5F8C;&#x7684;&#x68E7;&#x7684;&#x5167;&#x5BB9;&#x3002;</p>
<pre><code>$ gcc -g -o testshellcode testshellcode.c  #&#x70BA;&#x4E86;&#x8ABF;&#x8A66;&#xFF0C;&#x9700;&#x8981;&#x5728;&#x7DE8;&#x8B6F;&#x6642;&#x52A0;-g&#x9078;&#x9805;
$ gdb ./testshellcode   #&#x555F;&#x52D5;gdb&#x8ABF;&#x8A66;
...
(gdb) set logging on    #&#x5982;&#x679C;&#x8981;&#x8A18;&#x9304;&#x8ABF;&#x8A66;&#x904E;&#x7A0B;&#x4E2D;&#x7684;&#x4FE1;&#x606F;&#xFF0C;&#x53EF;&#x4EE5;&#x628A;&#x65E5;&#x8A8C;&#x8A18;&#x9304;&#x529F;&#x80FD;&#x6253;&#x958B;
Copying output to gdb.txt.
(gdb) l main            #&#x5217;&#x51FA;&#x6E90;&#x4EE3;&#x78BC;
20
21              return sum;
22      }
23
24      int main()
25      {
26              int sum;
27
28              sum = func(1, 2, 3);
29
(gdb) break 28   #&#x5728;&#x8ABF;&#x7528;func&#x51FD;&#x6578;&#x4E4B;&#x524D;&#x8B93;&#x7A0B;&#x5E8F;&#x505C;&#x4E00;&#x4E0B;&#xFF0C;&#x4EE5;&#x4FBF;&#x8A18;&#x9304;&#x7576;&#x6642;&#x7684;ebp(&#x57FA;&#x6307;&#x91DD;)
Breakpoint 1 at 0x80483ac: file testshellcode.c, line 28.
(gdb) break func #&#x8A2D;&#x7F6E;&#x65B7;&#x9EDE;&#x5728;&#x51FD;&#x6578;&#x5165;&#x53E3;&#xFF0C;&#x4EE5;&#x4FBF;&#x9010;&#x6B65;&#x8A18;&#x9304;&#x68E7;&#x4FE1;&#x606F;
Breakpoint 2 at 0x804835c: file testshellcode.c, line 13.
(gdb) disassemble main   #&#x53CD;&#x7DE8;&#x8B6F;main&#x51FD;&#x6578;&#xFF0C;&#x4EE5;&#x4FBF;&#x8A18;&#x9304;&#x8ABF;&#x7528;func&#x5F8C;&#x7684;&#x4E0B;&#x4E00;&#x689D;&#x6307;&#x4EE4;&#x5730;&#x5740;
Dump of assembler code for function main:
0x0804839b &lt;main+0&gt;:    lea    0x4(%esp),%ecx
0x0804839f &lt;main+4&gt;:    and    $0xfffffff0,%esp
0x080483a2 &lt;main+7&gt;:    pushl  0xfffffffc(%ecx)
0x080483a5 &lt;main+10&gt;:   push   %ebp
0x080483a6 &lt;main+11&gt;:   mov    %esp,%ebp
0x080483a8 &lt;main+13&gt;:   push   %ecx
0x080483a9 &lt;main+14&gt;:   sub    $0x14,%esp
0x080483ac &lt;main+17&gt;:   push   $0x3
0x080483ae &lt;main+19&gt;:   push   $0x2
0x080483b0 &lt;main+21&gt;:   push   $0x1
0x080483b2 &lt;main+23&gt;:   call   0x8048354 &lt;func&gt;
0x080483b7 &lt;main+28&gt;:   add    $0xc,%esp
0x080483ba &lt;main+31&gt;:   mov    %eax,0xfffffff8(%ebp)
0x080483bd &lt;main+34&gt;:   sub    $0x8,%esp
0x080483c0 &lt;main+37&gt;:   pushl  0xfffffff8(%ebp)
0x080483c3 &lt;main+40&gt;:   push   $0x80484c0
0x080483c8 &lt;main+45&gt;:   call   0x80482a0 &lt;printf@plt&gt;
0x080483cd &lt;main+50&gt;:   add    $0x10,%esp
0x080483d0 &lt;main+53&gt;:   mov    $0x0,%eax
0x080483d5 &lt;main+58&gt;:   mov    0xfffffffc(%ebp),%ecx
0x080483d8 &lt;main+61&gt;:   leave
0x080483d9 &lt;main+62&gt;:   lea    0xfffffffc(%ecx),%esp
0x080483dc &lt;main+65&gt;:   ret
End of assembler dump.
(gdb) r        #&#x904B;&#x884C;&#x7A0B;&#x5E8F;
Starting program: /mnt/hda8/Temp/c/program/testshellcode

Breakpoint 1, main () at testshellcode.c:28
28              sum = func(1, 2, 3);
(gdb) print $ebp  #&#x6253;&#x5370;&#x8ABF;&#x7528;func&#x51FD;&#x6578;&#x4E4B;&#x524D;&#x7684;&#x57FA;&#x5730;&#x5740;&#xFF0C;&#x5373;Previous frame pointer&#x3002;
$1 = (void *) 0xbf84fdd8
(gdb) n           #&#x57F7;&#x884C;call&#x6307;&#x4EE4;&#x4E26;&#x8DF3;&#x8F49;&#x5230;func&#x51FD;&#x6578;&#x7684;&#x5165;&#x53E3;

Breakpoint 2, func (a=1, b=2, c=3) at testshellcode.c:13
13              int sum = 0;
(gdb) n
16              sum = a + b + c;
(gdb) x/11x $esp  #&#x6253;&#x5370;&#x7576;&#x524D;&#x68E7;&#x7684;&#x5167;&#x5BB9;&#xFF0C;&#x53EF;&#x4EE5;&#x770B;&#x51FA;&#xFF0C;&#x5730;&#x5740;&#x5F9E;&#x4F4E;&#x5230;&#x9AD8;&#xFF0C;&#x6CE8;&#x610F;&#x6A19;&#x8A18;&#x6709;&#x85CD;&#x8272;&#x548C;&#x7D05;&#x8272;&#x7684;&#x503C;
                 #&#x5B83;&#x5011;&#x5206;&#x5225;&#x662F;&#x524D;&#x4E00;&#x500B;&#x68E7;&#x57FA;&#x5730;&#x5740;(ebp)&#x548C;call&#x8ABF;&#x7528;&#x4E4B;&#x5F8C;&#x7684;&#x4E0B;&#x4E00;&#x689D;&#x6307;&#x4EE4;&#x7684;&#x6307;&#x91DD;(eip)
0xbf84fd94:     0x00000000      0x00000000      0x080482e0      0x00000000
0xbf84fda4:     0xb7f2bce0      0x00000000      0xbf84fdd8      0x080483b7
0xbf84fdb4:     0x00000001      0x00000002      0x00000003
(gdb) n       #&#x57F7;&#x884C;sum = a + b + c&#xFF0C;&#x5F8C;&#xFF0C;&#x6BD4;&#x8F03;&#x68E7;&#x5167;&#x5BB9;&#x7B2C;&#x4E00;&#x884C;&#xFF0C;&#x7B2C;4&#x5217;&#xFF0C;&#x7531;0&#x8B8A;&#x70BA;6
18              memset(buffer, &apos;\0&apos;, BUF_SIZE);
(gdb) x/11x $esp
0xbf84fd94:     0x00000000      0x00000000      0x080482e0      0x00000006
0xbf84fda4:     0xb7f2bce0      0x00000000      0xbf84fdd8      0x080483b7
0xbf84fdb4:     0x00000001      0x00000002      0x00000003
(gdb) n
19              memcpy(buffer, STR_SRC, sizeof(STR_SRC)-1);
(gdb) x/11x $esp #&#x7DE9;&#x885D;&#x5340;&#x521D;&#x59CB;&#x5316;&#x4EE5;&#x5F8C;&#x8B8A;&#x6210;&#x4E86;0
0xbf84fd94:     0x00000000      0x00000000      0x00000000      0x00000006
0xbf84fda4:     0xb7f2bce0      0x00000000      0xbf84fdd8      0x080483b7
0xbf84fdb4:     0x00000001      0x00000002      0x00000003
(gdb) n
21              return sum;
(gdb) x/11x $esp #&#x9032;&#x884C;copy&#x4EE5;&#x5F8C;&#xFF0C;&#x9019;&#x5169;&#x5217;&#x7684;&#x503C;&#x8B8A;&#x4E86;&#xFF0C;&#x5927;&#x5C0F;&#x525B;&#x597D;&#x662F;7&#x500B;&#x5B57;&#x7BC0;&#xFF0C;&#x6700;&#x5F8C;&#x4E00;&#x500B;&#x5B57;&#x7BC0;&#x70BA;&apos;\0&apos;
0xbf84fd94:     0x00000000      0x41414141      0x00414141      0x00000006
0xbf84fda4:     0xb7f2bce0      0x00000000      0xbf84fdd8      0x080483b7
0xbf84fdb4:     0x00000001      0x00000002      0x00000003
(gdb) c
Continuing.
sum = 6

Program exited normally.
(gdb) quit
</code></pre><p>&#x5F9E;&#x4E0A;&#x9762;&#x7684;&#x64CD;&#x4F5C;&#x904E;&#x7A0B;&#xFF0C;&#x6211;&#x5011;&#x53EF;&#x4EE5;&#x5F97;&#x51FA;&#x5927;&#x6982;&#x7684;&#x68E7;&#x5206;&#x4F48;(<code>func</code> &#x51FD;&#x6578;&#x7D50;&#x675F;&#x4E4B;&#x524D;)&#x5982;&#x4E0B;&#xFF1A;</p>
<table>
<thead>
<tr>
<th>&#x5730;&#x5740;</th>
<th>&#x503C;(hex)</th>
<th>&#x7B26;&#x865F;&#x6216;&#x8005;&#x5BC4;&#x5B58;&#x5668;</th>
<th>&#x8A3B;&#x91CB;</th>
</tr>
</thead>
<tbody>
<tr>
<td>&#x4F4E;&#x5730;&#x5740;</td>
<td></td>
<td></td>
<td>&#x68E7;&#x9802;&#x65B9;&#x5411;</td>
</tr>
<tr>
<td>0xbf84fd98</td>
<td>0x41414141</td>
<td>buf[0]</td>
<td>&#x53EF;&#x4EE5;&#x770B;&#x51FA;little endian(&#x5C0F;&#x7AEF;&#xFF0C;&#x91CD;&#x8981;&#x7684;&#x6578;&#x64DA;&#x5728;&#x524D;&#x9762;)</td>
</tr>
<tr>
<td>0xbf84fd9c</td>
<td>0x00414141</td>
<td>buf[1]</td>
<td></td>
</tr>
<tr>
<td>0xbf84fda0</td>
<td>0x00000006</td>
<td>sum</td>
<td>&#x53EF;&#x898B;&#x9019;&#x4E0A;&#x9762;&#x90FD;&#x662F;func&#x51FD;&#x6578;&#x88E1;&#x982D;&#x7684;&#x5C40;&#x90E8;&#x8B8A;&#x91CF;</td>
</tr>
<tr>
<td>0xbf84fda4</td>
<td>0xb7f2bce0</td>
<td>esi</td>
<td>&#x6E90;&#x7D22;&#x5F15;&#x6307;&#x91DD;&#xFF0C;&#x53EF;&#x4EE5;&#x901A;&#x904E;&#x7522;&#x751F;&#x4E2D;&#x9593;&#x4EE3;&#x78BC;&#x67E5;&#x770B;&#xFF0C;&#x8C8C;&#x4F3C;&#x6C92;&#x4EC0;&#x9EBC;&#x4F5C;&#x7528;</td>
</tr>
<tr>
<td>0xbf84fda8</td>
<td>0x00000000</td>
<td>edi</td>
<td>&#x76EE;&#x7684;&#x7D22;&#x5F15;&#x6307;&#x91DD;</td>
</tr>
<tr>
<td>0xbf84fdac</td>
<td>0xbf84fdd8</td>
<td>ebp</td>
<td>&#x8ABF;&#x7528;func&#x4E4B;&#x524D;&#x7684;&#x68E7;&#x7684;&#x57FA;&#x5730;&#x5740;&#xFF0C;&#x4EE5;&#x4FBF;&#x8ABF;&#x7528;&#x51FD;&#x6578;&#x7D50;&#x675F;&#x4E4B;&#x5F8C;&#x6062;&#x5FA9;</td>
</tr>
<tr>
<td>0xbf84fdb0</td>
<td>0x080483b7</td>
<td>eip</td>
<td>&#x8ABF;&#x7528;func&#x4E4B;&#x524D;&#x7684;&#x6307;&#x4EE4;&#x6307;&#x91DD;&#xFF0C;&#x4EE5;&#x4FBF;&#x8ABF;&#x7528;&#x51FD;&#x6578;&#x7D50;&#x675F;&#x4E4B;&#x5F8C;&#x7E7C;&#x7E8C;&#x57F7;&#x884C;</td>
</tr>
<tr>
<td>0xbf84fdb4</td>
<td>0x00000001</td>
<td>a</td>
<td>&#x7B2C;&#x4E00;&#x500B;&#x53C3;&#x6578;</td>
</tr>
<tr>
<td>0xbf84fdb8</td>
<td>0x00000002</td>
<td>b</td>
<td>&#x7B2C;&#x4E8C;&#x500B;&#x53C3;&#x6578;</td>
</tr>
<tr>
<td>0xbf84fdbc</td>
<td>0x00000003</td>
<td>c</td>
<td>&#x7B2C;&#x4E09;&#x500B;&#x53C3;&#x6578;&#xFF0C;&#x53EF;&#x898B;&#x53C3;&#x6578;&#x662F;&#x5F9E;&#x6700;&#x5F8C;&#x4E00;&#x500B;&#x958B;&#x59CB;&#x58D3;&#x68E7;&#x7684;</td>
</tr>
<tr>
<td>&#x9AD8;&#x5730;&#x5740;</td>
<td></td>
<td></td>
<td>&#x68E7;&#x5E95;&#x65B9;&#x5411;</td>
</tr>
</tbody>
</table>
<p>&#x5148;&#x8AAA;&#x660E;&#x4E00;&#x4E0B; <code>edi</code> &#x548C; <code>esi</code> &#x7684;&#x7531;&#x4F86;&#xFF08;&#x5728;&#x4E0A;&#x9762;&#x7684;&#x8ABF;&#x8A66;&#x904E;&#x7A0B;&#x4E2D;&#x6211;&#x5011;&#x4E26;&#x6C92;&#x6709;&#x770B;&#x5230;&#xFF09;&#xFF0C;&#x662F;&#x901A;&#x904E;&#x7522;&#x751F;&#x4E2D;&#x9593;&#x5F59;&#x7DE8;&#x4EE3;&#x78BC;&#x5206;&#x6790;&#x5F97;&#x51FA;&#x7684;&#x3002;</p>
<pre><code>$ gcc -S testshellcode.c
</code></pre><p>&#x5728;&#x7522;&#x751F;&#x7684; <code>testShellcode.s</code> &#x4EE3;&#x78BC;&#x88E1;&#x982D;&#x7684; <code>func</code> &#x90E8;&#x5206;&#x770B;&#x5230; <code>push ebp</code> &#x4E4B;&#x5F8C;&#x5C31; <code>push</code> &#x4E86; <code>edi</code> &#x548C; <code>esi</code> &#x3002;&#x4F46;&#x662F;&#x641C;&#x7D22;&#x4E86;&#x4E00;&#x4E0B;&#x4EE3;&#x78BC;&#xFF0C;&#x767C;&#x73FE;&#x5C31;&#x9019;&#x500B;&#x51FD;&#x6578;&#x88E1;&#x982D;&#x5F15;&#x7528;&#x4E86;&#x9019;&#x5169;&#x500B;&#x5BC4;&#x5B58;&#x5668;&#xFF0C;&#x6240;&#x4EE5;&#x4FDD;&#x5B58;&#x5B83;&#x5011;&#x6C92;&#x4EC0;&#x9EBC;&#x7528;&#xFF0C;&#x522A;&#x9664;&#x4EE5;&#x5F8C;&#x7DE8;&#x8B6F;&#x7522;&#x751F;&#x76EE;&#x6A19;&#x4EE3;&#x78BC;&#x5F8C;&#x8B49;&#x660E;&#x662F;&#x6C92;&#x7528;&#x7684;&#x3002;</p>
<pre><code>$ cat testshellcode.s
...
func:
        pushl   %ebp
        movl    %esp, %ebp
        pushl   %edi
        pushl   %esi
...
        popl    %esi
        popl    %edi
        popl    %ebp
...
</code></pre><p>&#x4E0B;&#x9762;&#x5C31;&#x4E0D;&#x7BA1;&#x9019;&#x5169;&#x90E8;&#x5206;&#xFF08;<code>edi</code> &#x548C; <code>esi</code>&#xFF09;&#x4E86;&#xFF0C;&#x4E3B;&#x8981;&#x4F86;&#x5206;&#x6790;&#x548C;&#x51FD;&#x6578;&#x76F8;&#x95DC;&#x7684;&#x9019;&#x5E7E;&#x90E8;&#x5206;&#x5728;&#x68E7;&#x5167;&#x7684;&#x5206;&#x4F48;&#xFF1A;</p>
<ul>
<li>&#x51FD;&#x6578;&#x5C40;&#x90E8;&#x8B8A;&#x91CF;&#xFF0C;&#x5728;&#x9760;&#x8FD1;&#x68E7;&#x9802;&#x4E00;&#x7AEF;</li>
<li>&#x8ABF;&#x7528;&#x51FD;&#x6578;&#x4E4B;&#x524D;&#x7684;&#x68E7;&#x7684;&#x57FA;&#x5730;&#x5740;&#xFF08;<code>ebp</code>&#xFF0C;<code>Previous Frame Pointer</code>&#xFF09;&#xFF0C;&#x5728;&#x4E2D;&#x9593;&#x9760;&#x8FD1;&#x68E7;&#x9802;&#x65B9;&#x5411;</li>
<li>&#x8ABF;&#x7528;&#x51FD;&#x6578;&#x6307;&#x4EE4;&#x7684;&#x4E0B;&#x4E00;&#x689D;&#x6307;&#x4EE4;&#x5730;&#x5740; <code>` &#xFF08;</code>eip`&#xFF09;&#xFF0C;&#x5728;&#x4E2D;&#x9593;&#x9760;&#x8FD1;&#x68E7;&#x5E95;&#x7684;&#x65B9;&#x5411;</li>
<li>&#x51FD;&#x6578;&#x53C3;&#x6578;&#xFF0C;&#x5728;&#x9760;&#x8FD1;&#x68E7;&#x5E95;&#x7684;&#x4E00;&#x7AEF;&#xFF0C;&#x6700;&#x5F8C;&#x4E00;&#x500B;&#x53C3;&#x6578;&#x6700;&#x5148;&#x5165;&#x68E7;</li>
</ul>
<p>&#x5230;&#x9019;&#x88E1;&#xFF0C;&#x51FD;&#x6578;&#x8ABF;&#x7528;&#x6642;&#x7684;&#x76F8;&#x95DC;&#x5167;&#x5BB9;&#x5728;&#x68E7;&#x5167;&#x7684;&#x5206;&#x4F48;&#x5C31;&#x6BD4;&#x8F03;&#x6E05;&#x695A;&#x4E86;&#xFF0C;&#x5728;&#x5177;&#x9AD4;&#x5206;&#x6790;&#x7DE9;&#x885D;&#x5340;&#x6EA2;&#x51FA;&#x554F;&#x984C;&#x4E4B;&#x524D;&#xFF0C;&#x6211;&#x5011;&#x518D;&#x4F86;&#x770B;&#x4E00;&#x500B;&#x548C;&#x51FD;&#x6578;&#x95DC;&#x4FC2;&#x5F88;&#x5927;&#x7684;&#x554F;&#x984C;&#xFF0C;&#x5373;&#x51FD;&#x6578;&#x8FD4;&#x56DE;&#x503C;&#x7684;&#x5B58;&#x5132;&#x554F;&#x984C;&#xFF1A;&#x51FD;&#x6578;&#x7684;&#x8FD4;&#x56DE;&#x503C;&#x5B58;&#x653E;&#x5728;&#x5BC4;&#x5B58;&#x5668; <code>eax</code> &#x4E2D;&#x3002;</p>
<p>&#x5148;&#x4F86;&#x770B;&#x9019;&#x6BB5;&#x4EE3;&#x78BC;&#xFF1A;</p>
<pre><code>/**
 * test_return.c -- the return of a function is stored in register eax
 */

#include &lt;stdio.h&gt;

int func()
{
        __asm__ (&quot;movl $1, %eax&quot;);
}

int main()
{
        printf(&quot;the return of func: %d\n&quot;, func());

        return 0;
}
</code></pre><p>&#x7DE8;&#x8B6F;&#x904B;&#x884C;&#x5F8C;&#xFF0C;&#x53EF;&#x4EE5;&#x770B;&#x5230;&#x8FD4;&#x56DE;&#x503C;&#x70BA; 1&#xFF0C;&#x525B;&#x597D;&#x662F;&#x6211;&#x5011;&#x5728; <code>func</code> &#x51FD;&#x6578;&#x4E2D; <code>mov</code> &#x5230; <code>eax</code> &#x4E2D;&#x7684;&#x201C;&#x7ACB;&#x5373;&#x6578;&#x201D; 1&#xFF0C;&#x56E0;&#x6B64;&#x5F88;&#x5BB9;&#x6613;&#x7406;&#x89E3;&#x8FD4;&#x56DE;&#x503C;&#x5B58;&#x5132;&#x5728; <code>eax</code> &#x4E2D;&#x7684;&#x4E8B;&#x5BE6;&#xFF0C;&#x5982;&#x679C;&#x9084;&#x6709;&#x7591;&#x616E;&#xFF0C;&#x53EF;&#x4EE5;&#x518D;&#x770B;&#x770B;&#x5F59;&#x7DE8;&#x4EE3;&#x78BC;&#x3002;&#x5728;&#x51FD;&#x6578;&#x8FD4;&#x56DE;&#x4E4B;&#x5F8C;&#xFF0C;<code>eax</code> &#x4E2D;&#x7684;&#x503C;&#x7576;&#x4F5C;&#x4E86; <code>printf</code> &#x7684;&#x53C3;&#x6578;&#x58D3;&#x5165;&#x4E86;&#x68E7;&#x4E2D;&#xFF0C;&#x800C;&#x5728;&#x6E90;&#x4EE3;&#x78BC;&#x4E2D;&#x6211;&#x5011;&#x6B63;&#x662F;&#x628A; <code>func</code> &#x7684;&#x7D50;&#x679C;&#x4F5C;&#x70BA; <code>printf</code> &#x7684;&#x7B2C;&#x4E8C;&#x500B;&#x53C3;&#x6578;&#x7684;&#x3002;</p>
<pre><code>$ make test_return
cc     test_return.c   -o test_return
$ ./test_return
the return of func: 1
$ gcc -S test_return.c
$ cat test_return.s
...
        call    func
        subl    $8, %esp
        pushl   %eax      #printf&#x7684;&#x7B2C;&#x4E8C;&#x500B;&#x53C3;&#x6578;&#xFF0C;&#x628A;func&#x7684;&#x8FD4;&#x56DE;&#x503C;&#x58D3;&#x5165;&#x4E86;&#x68E7;&#x5E95;
        pushl   $.LC0     #printf&#x7684;&#x7B2C;&#x4E00;&#x500B;&#x53C3;&#x6578;the return of func: %d\n
        call    printf
...
</code></pre><p>&#x5C0D;&#x65BC;&#x7CFB;&#x7D71;&#x8ABF;&#x7528;&#xFF0C;&#x8FD4;&#x56DE;&#x503C;&#x4E5F;&#x5B58;&#x5132;&#x5728; <code>eax</code> &#x5BC4;&#x5B58;&#x5668;&#x4E2D;&#x3002;</p>
<p><span id="toc_14869_27504_10"></span></p>
<h2 id="%E7%B7%A9%E8%A1%9D%E5%8D%80%E6%BA%A2%E5%87%BA">&#x7DE9;&#x885D;&#x5340;&#x6EA2;&#x51FA;</h2>
<p><span id="toc_14869_27504_11"></span></p>
<h3 id="%E5%AF%A6%E4%BE%8B%E5%88%86%E6%9E%90%EF%BC%9A%E5%AD%97%E7%AC%A6%E4%B8%B2%E8%A4%87%E8%A3%BD">&#x5BE6;&#x4F8B;&#x5206;&#x6790;&#xFF1A;&#x5B57;&#x7B26;&#x4E32;&#x8907;&#x88FD;</h3>
<p>&#x5148;&#x4F86;&#x770B;&#x4E00;&#x6BB5;&#x7C21;&#x77ED;&#x7684;&#x4EE3;&#x78BC;&#x3002;</p>
<pre><code>/* testshellcode.c */
#include &lt;stdio.h&gt;      /* printf */
#include &lt;string.h&gt;     /* memset, memcpy */

#define BUF_SIZE 8

#ifdef STR1
# define STR_SRC &quot;AAAAAAA\0\1\0\0\0&quot;
#endif

#ifndef STR_SRC
# define STR_SRC &quot;AAAAAAA&quot;
#endif

int func(int a, int b, int c)
{
        int sum = 0;
        char buffer[BUF_SIZE];

        sum = a + b + c;

        memset(buffer, &apos;\0&apos;, BUF_SIZE);
        memcpy(buffer, STR_SRC, sizeof(STR_SRC)-1);

        return sum;
}

int main()
{
        int sum;

        sum = func(1, 2, 3);

        printf(&quot;sum = %d\n&quot;, sum);

        return 0;
}
</code></pre><p>&#x7DE8;&#x8B6F;&#x4E00;&#x4E0B;&#x770B;&#x770B;&#x7D50;&#x679C;&#xFF1A;</p>
<pre><code>$ gcc -DSTR1 -o testshellcode testshellcode.c  #&#x901A;&#x904E;-D&#x5B9A;&#x7FA9;&#x5B8F;STR1&#xFF0C;&#x5F9E;&#x800C;&#x63A1;&#x7528;&#x7B2C;&#x4E00;&#x500B;STR_SRC&#x7684;&#x503C;
$ ./testshellcode
sum = 1
</code></pre><p>&#x4E0D;&#x77E5;&#x9053;&#x4F60;&#x6709;&#x6C92;&#x6709;&#x767C;&#x73FE;&#x7570;&#x5E38;&#x5462;&#xFF1F;&#x4E0A;&#x9762;&#x7528;&#x7D05;&#x8272;&#x6A19;&#x8A18;&#x7684;&#x5730;&#x65B9;&#xFF0C;&#x672C;&#x4F86; <code>sum</code> &#x70BA; <code>1+2+3</code> &#x5373; 6&#xFF0C;&#x4F46;&#x662F;&#x5BE6;&#x969B;&#x8FD4;&#x56DE;&#x7684;&#x7ADF;&#x7136;&#x662F; 1 &#x3002;&#x5230;&#x5E95;&#x662F;&#x4EC0;&#x9EBC;&#x539F;&#x56E0;&#x5462;&#xFF1F;&#x5927;&#x5BB6;&#x61C9;&#x8A72;&#x6709;&#x6240;&#x77AD;&#x89E3;&#x4E86;&#xFF0C;&#x56E0;&#x70BA;&#x6211;&#x5011;&#x5728;&#x8907;&#x88FD;&#x5B57;&#x7B26;&#x4E32; <code>AAAAAAA\\0\\1\\0\\0\\0</code> &#x5230; <code>buf</code> &#x7684;&#x6642;&#x5019;&#x8D85;&#x51FA; <code>buf</code> &#x672C;&#x4F86;&#x7684;&#x5927;&#x5C0F;&#x3002; <code>buf</code> &#x672C;&#x4F86;&#x7684;&#x5927;&#x5C0F;&#x662F; <code>BUF_SIZE</code>&#xFF0C;8 &#x500B;&#x5B57;&#x7BC0;&#xFF0C;&#x800C;&#x6211;&#x5011;&#x8981;&#x8907;&#x88FD;&#x7684;&#x5167;&#x5BB9;&#x662F; 12 &#x500B;&#x5B57;&#x7BC0;&#xFF0C;&#x6240;&#x4EE5;&#x8D85;&#x51FA;&#x4E86;&#x56DB;&#x500B;&#x5B57;&#x7BC0;&#x3002;&#x6839;&#x64DA;&#x7B2C;&#x4E00;&#x5C0F;&#x7BC0;&#x7684;&#x5206;&#x6790;&#xFF0C;&#x6211;&#x5011;&#x7528;&#x68E7;&#x7684;&#x8B8A;&#x5316;&#x60C5;&#x6CC1;&#x4F86;&#x8868;&#x793A;&#x4E00;&#x4E0B;&#x9019;&#x500B;&#x8907;&#x88FD;&#x904E;&#x7A0B;&#xFF08;&#x5373;&#x57F7;&#x884C; <code>memcpy</code> &#x7684;&#x904E;&#x7A0B;&#xFF09;&#x3002;</p>
<pre><code>memcpy(buffer, STR_SRC, sizeof(STR_SRC)-1);

&#xFF08;&#x4F4E;&#x5730;&#x5740;&#xFF09;
&#x8907;&#x88FD;&#x4E4B;&#x524D;     ====&gt; &#x8907;&#x88FD;&#x4E4B;&#x5F8C;
0x00000000       0x41414141      #char buf[8]
0x00000000       0x00414141
0x00000006       0x00000001      #int sum
&#xFF08;&#x9AD8;&#x5730;&#x5740;&#xFF09;
</code></pre><p>&#x4E0B;&#x9762;&#x901A;&#x904E; <code>gdb</code> &#x8ABF;&#x8A66;&#x4F86;&#x78BA;&#x8A8D;&#x4E00;&#x4E0B;(&#x53EA;&#x6458;&#x9304;&#x4E86;&#x4E00;&#x4E9B;&#x7247;&#x65B7;)&#x3002;</p>
<pre><code>$ gcc -DSTR1 -g -o testshellcode testshellcode.c
$ gdb ./testshellcode
...
(gdb) l
21
22              memset(buffer, &apos;\0&apos;, BUF_SIZE);
23              memcpy(buffer, STR_SRC, sizeof(STR_SRC)-1);
24
25              return sum;
...
(gdb) break 23
Breakpoint 1 at 0x804837f: file testshellcode.c, line 23.
(gdb) break 25
Breakpoint 2 at 0x8048393: file testshellcode.c, line 25.
(gdb) r
Starting program: /mnt/hda8/Temp/c/program/testshellcode

Breakpoint 1, func (a=1, b=2, c=3) at testshellcode.c:23
23              memcpy(buffer, STR_SRC, sizeof(STR_SRC)-1);
(gdb) x/3x $esp+4
0xbfec6bd8:     0x00000000      0x00000000      0x00000006
(gdb) n

Breakpoint 2, func (a=1, b=2, c=3) at testshellcode.c:25
25              return sum;
(gdb) x/3x $esp+4
0xbfec6bd8:     0x41414141      0x00414141      0x00000001
</code></pre><p>&#x53EF;&#x4EE5;&#x770B;&#x51FA;&#xFF0C;&#x56E0;&#x70BA; C &#x8A9E;&#x8A00;&#x6C92;&#x6709;&#x5C0D;&#x6578;&#x7D44;&#x7684;&#x908A;&#x754C;&#x9032;&#x884C;&#x9650;&#x5236;&#x3002;&#x6211;&#x5011;&#x53EF;&#x4EE5;&#x5F80;&#x6578;&#x7D44;&#x4E2D;&#x5B58;&#x5165;&#x9810;&#x5B9A;&#x7FA9;&#x9577;&#x5EA6;&#x7684;&#x5B57;&#x7B26;&#x4E32;&#xFF0C;&#x5F9E;&#x800C;&#x5C0E;&#x81F4;&#x7DE9;&#x885D;&#x5340;&#x6EA2;&#x51FA;&#x3002;</p>
<p><span id="toc_14869_27504_12"></span></p>
<h3 id="%E7%B7%A9%E8%A1%9D%E5%8D%80%E6%BA%A2%E5%87%BA%E5%BE%8C%E6%9E%9C">&#x7DE9;&#x885D;&#x5340;&#x6EA2;&#x51FA;&#x5F8C;&#x679C;</h3>
<p>&#x6EA2;&#x51FA;&#x4E4B;&#x5F8C;&#x7684;&#x554F;&#x984C;&#x662F;&#x5C0E;&#x81F4;&#x8986;&#x84CB;&#x68E7;&#x7684;&#x5176;&#x4ED6;&#x5167;&#x5BB9;&#xFF0C;&#x5F9E;&#x800C;&#x53EF;&#x80FD;&#x6539;&#x8B8A;&#x7A0B;&#x5E8F;&#x539F;&#x4F86;&#x7684;&#x884C;&#x70BA;&#x3002;</p>
<p>&#x5982;&#x679C;&#x9019;&#x985E;&#x554F;&#x984C;&#x88AB;&#x201C;&#x9ED1;&#x5BA2;&#x201D;&#x5229;&#x7528;&#x90A3;&#x5C07;&#x7522;&#x751F;&#x975E;&#x5E38;&#x53EF;&#x6015;&#x7684;&#x5F8C;&#x679C;&#xFF0C;&#x5C0F;&#x5247;&#x8B93;&#x975E;&#x6CD5;&#x7528;&#x6236;&#x7372;&#x53D6;&#x4E86;&#x7CFB;&#x7D71;&#x6B0A;&#x9650;&#xFF0C;&#x628A;&#x4F60;&#x7684;&#x670D;&#x52D9;&#x5668;&#x7576;&#x6210;&#x201C;&#x6BAD;&#x5C4D;&#x201D;&#xFF0C;&#x7528;&#x4F86;&#x5C0D;&#x5176;&#x4ED6;&#x6A5F;&#x5668;&#x9032;&#x884C;&#x653B;&#x64CA;&#xFF0C;&#x56B4;&#x91CD;&#x7684;&#x5247;&#x53EF;&#x80FD;&#x88AB;&#x4EBA;&#x522A;&#x9664;&#x6578;&#x64DA;&#xFF08;&#x6240;&#x4EE5;&#x5099;&#x4EFD;&#x5F88;&#x91CD;&#x8981;&#xFF09;&#x3002;&#x5373;&#x4F7F;&#x4E0D;&#x88AB;&#x9ED1;&#x5BA2;&#x5229;&#x7528;&#xFF0C;&#x9019;&#x985E;&#x554F;&#x984C;&#x5982;&#x679C;&#x653E;&#x5728;&#x91AB;&#x7642;&#x9818;&#x57DF;&#xFF0C;&#x90A3;&#x5C07;&#x975E;&#x5E38;&#x5371;&#x96AA;&#xFF0C;&#x53EF;&#x80FD;&#x90A3;&#x500B;&#x88AB;&#x8986;&#x84CB;&#x7684;&#x6578;&#x5B57;&#x525B;&#x597D;&#x662F;&#x7528;&#x4F86;&#x63A7;&#x5236;&#x6CBB;&#x7642;&#x764C;&#x75C7;&#x7684;&#x8F3B;&#x5C04;&#x91CF;&#x7684;&#xFF0C;&#x4E00;&#x65E6;&#x51FA;&#x932F;&#xFF0C;&#x90A3;&#x53EF;&#x80FD;&#x5C0E;&#x81F4;&#x7F6E;&#x4EBA;&#x6B7B;&#x5730;&#xFF0C;&#x7576;&#x7136;&#xFF0C;&#x5982;&#x679C;&#x5728;&#x822A;&#x5929;&#x9818;&#x57DF;&#xFF0C;&#x90A3;&#x53EF;&#x80FD;&#x5C31;&#x662F;&#x597D;&#x591A;&#x500B; 0 &#x7684; <code>money</code> &#x751A;&#x81F3;&#x822A;&#x5929;&#x54E1;&#x7684;&#x640D;&#x5931;&#xFF0C;&#x5475;&#x5475;&#xFF0C;&#x201C;&#x7DE9;&#x885D;&#x5340;&#x6EA2;&#x51FA;&#xFF0C;&#x5F8C;&#x679C;&#x5F88;&#x56B4;&#x91CD;&#xFF01;&#x201D;</p>
<p><span id="toc_14869_27504_13"></span></p>
<h3 id="%E7%B7%A9%E8%A1%9D%E5%8D%80%E6%BA%A2%E5%87%BA%E6%87%89%E5%B0%8D%E7%AD%96%E7%95%A5">&#x7DE9;&#x885D;&#x5340;&#x6EA2;&#x51FA;&#x61C9;&#x5C0D;&#x7B56;&#x7565;</h3>
<p>&#x90A3;&#x9019;&#x500B;&#x600E;&#x9EBC;&#x8FA6;&#x5462;&#xFF1F;&#x8C8C;&#x4F3C;<a href="http://www.ibm.com/developerworks/cn/linux/l-overflow/index.html" target="_blank">Linux&#x4E0B;&#x7DE9;&#x885D;&#x5340;&#x6EA2;&#x51FA;&#x653B;&#x64CA;&#x7684;&#x539F;&#x7406;&#x53CA;&#x5C0D;&#x7B56;</a>&#x63D0;&#x5230;&#x6709;&#x4E00;&#x500B; <code>libsafe</code> &#x5EAB;&#xFF0C;&#x53EF;&#x4EE5;&#x81F3;&#x5C11;&#x7528;&#x4F86;&#x6AA2;&#x6E2C;&#x7A0B;&#x5E8F;&#x4E2D;&#x51FA;&#x73FE;&#x7684;&#x985E;&#x4F3C;&#x8D85;&#x51FA;&#x6578;&#x7D44;&#x908A;&#x754C;&#x7684;&#x554F;&#x984C;&#x3002;&#x5C0D;&#x65BC;&#x4E0A;&#x9762;&#x90A3;&#x500B;&#x5177;&#x9AD4;&#x554F;&#x984C;&#xFF0C;&#x70BA;&#x4E86;&#x4FDD;&#x8B77; <code>sum</code> &#x4E0D;&#x88AB;&#x4FEE;&#x6539;&#xFF0C;&#x6709;&#x4E00;&#x500B;&#x5C0F;&#x6280;&#x5DE7;&#xFF0C;&#x53EF;&#x4EE5;&#x8B93;&#x6C42;&#x548C;&#x64CD;&#x4F5C;&#x5728;&#x5B57;&#x7B26;&#x4E32;&#x8907;&#x88FD;&#x64CD;&#x4F5C;&#x4E4B;&#x5F8C;&#x4F86;&#x505A;&#xFF0C;&#x4EE5;&#x4FBF;&#x6C42;&#x548C;&#x64CD;&#x4F5C;&#x628A;&#x6EA2;&#x51FA;&#x7684;&#x90E8;&#x5206;&#x7D66;&#x91CD;&#x5BEB;&#x3002;&#x9019;&#x500B;&#x5446;&#x5925;&#x5728;&#x4E0B;&#x9762;&#x4E00;&#x584A;&#x770B;&#x6548;&#x679C;&#x5427;&#x3002;&#x7E7C;&#x7E8C;&#x770B;&#x770B;&#x7DE9;&#x885D;&#x5340;&#x7684;&#x6EA2;&#x51FA;&#x5427;&#x3002;</p>
<p>&#x5148;&#x4F86;&#x770B;&#x770B;&#x9019;&#x500B;&#x4EE3;&#x78BC;&#xFF0C;&#x9084;&#x662F; <code>testShellcode.c</code> &#x7684;&#x6539;&#x9032;&#x3002;</p>
<pre><code>/* testshellcode.c */
#include &lt;stdio.h&gt;      /* printf */
#include &lt;string.h&gt; /* memset, memcpy */
#define BUF_SIZE 8

#ifdef STR1
# define STR_SRC &quot;AAAAAAAa\1\0\0\0&quot;
#endif
#ifdef STR2
# define STR_SRC &quot;AAAAAAAa\1\0\0\0BBBBBBBB&quot;
#endif
#ifdef STR3
# define STR_SRC &quot;AAAAAAAa\1\0\0\0BBBBBBBBCCCC&quot;
#endif
#ifdef STR4
# define STR_SRC &quot;AAAAAAAa\1\0\0\0BBBBBBBBCCCCDDDD&quot;
#endif

#ifndef STR_SRC
# define STR_SRC &quot;AAAAAAA&quot;
#endif

int func(int a, int b, int c)
{
        int sum = 0;
        char buffer[BUF_SIZE] = &quot;&quot;;

        memset(buffer, &apos;\0&apos;, BUF_SIZE);
        memcpy(buffer, STR_SRC, sizeof(STR_SRC)-1);

        sum = a + b + c;     //&#x628A;&#x6C42;&#x548C;&#x64CD;&#x4F5C;&#x653E;&#x5728;&#x8907;&#x88FD;&#x64CD;&#x4F5C;&#x4E4B;&#x5F8C;&#x53EF;&#x4EE5;&#x5728;&#x4E00;&#x5B9A;&#x60C5;&#x6CC1;&#x4E0B;&#x201C;&#x4FDD;&#x8B77;&#x201D;&#x6C42;&#x548C;&#x7D50;&#x679C;

        return sum;
}

int main()
{
        int sum;

        sum = func(1, 2, 3);

        printf(&quot;sum = %d\n&quot;, sum);

        return 0;
}
</code></pre><p>&#x770B;&#x770B;&#x904B;&#x884C;&#x60C5;&#x6CC1;&#xFF1A;</p>
<pre><code>$ gcc -D STR2 -o testshellcode testshellcode.c   #&#x518D;&#x591A;&#x8907;&#x88FD;8&#x500B;&#x5B57;&#x7BC0;&#xFF0C;&#x7D50;&#x679C;&#x548C;STR1&#x6642;&#x4E00;&#x6A23;
                        #&#x539F;&#x56E0;&#x662F;edi,esi&#x9019;&#x5169;&#x500B;&#x6C92;&#x4EC0;&#x9EBC;&#x7528;&#x7684;&#xFF0C;&#x8986;&#x84CB;&#x4E86;&#x4E5F;&#x6C92;&#x95DC;&#x4FC2;
$ ./testshellcode       #&#x770B;&#x5230;&#x6C92;&#xFF1F;&#x9019;&#x7A2E;&#x60C5;&#x6CC1;&#x4E0B;&#xFF0C;&#x8B93;&#x6574;&#x6578;&#x64CD;&#x4F5C;&#x5728;&#x5B57;&#x7B26;&#x4E32;&#x8907;&#x88FD;&#x4E4B;&#x5F8C;&#x505A;&#x53EF;&#x4EE5;&#x201C;&#x4FDD;&#x8B77;&#x2018;&#x6574;&#x6578;&#x7D50;&#x679C;
sum = 6
$ gcc -D STR3 -o testshellcode testshellcode.c  #&#x518D;&#x591A;&#x8907;&#x88FD;4&#x500B;&#x5B57;&#x7BC0;&#xFF0C;&#x73FE;&#x5728;&#x5C31;&#x6703;&#x628A;ebp&#x7D66;&#x8986;&#x84CB;
                                               #&#x4E86;&#xFF0C;&#x9019;&#x6A23;&#x7576;main&#x51FD;&#x6578;&#x518D;&#x8981;&#x7528;ebp&#x8A2A;&#x554F;&#x6578;&#x64DA;
                                              #&#x6642;&#x5C31;&#x6703;&#x51FA;&#x73FE;&#x8A2A;&#x554F;&#x975E;&#x6CD5;&#x5167;&#x5B58;&#x800C;&#x5C0E;&#x81F4;&#x6BB5;&#x932F;&#x8AA4;&#x3002;
$ ./testshellcode
Segmentation fault
</code></pre><p>&#x5982;&#x679C;&#x611F;&#x8208;&#x8DA3;&#xFF0C;&#x81EA;&#x5DF1;&#x9084;&#x53EF;&#x4EE5;&#x7528;gdb&#x985E;&#x4F3C;&#x4E4B;&#x524D;&#x4E00;&#x6A23;&#x4F86;&#x67E5;&#x770B;&#x8907;&#x88FD;&#x5B57;&#x7B26;&#x4E32;&#x4EE5;&#x5F8C;&#x68E7;&#x7684;&#x8B8A;&#x5316;&#x60C5;&#x6CC1;&#x3002;</p>
<p><span id="toc_14869_27504_14"></span></p>
<h3 id="%E5%A6%82%E4%BD%95%E4%BF%9D%E8%AD%B7-ebp-%E4%B8%8D%E8%A2%AB%E4%BF%AE%E6%94%B9">&#x5982;&#x4F55;&#x4FDD;&#x8B77; ebp &#x4E0D;&#x88AB;&#x4FEE;&#x6539;</h3>
<p>&#x4E0B;&#x9762;&#x4F86;&#x505A;&#x4E00;&#x500B;&#x6BD4;&#x8F03;&#x6709;&#x8DA3;&#x7684;&#x4E8B;&#x60C5;&#xFF1A;&#x5982;&#x4F55;&#x8A2D;&#x6CD5;&#x4FDD;&#x8B77;&#x6211;&#x5011;&#x7684; <code>ebp</code> &#x4E0D;&#x88AB;&#x4FEE;&#x6539;&#x3002;</p>
<p>&#x9996;&#x5148;&#x8981;&#x660E;&#x78BA; <code>ebp</code> &#x9019;&#x500B;&#x5BC4;&#x5B58;&#x5668;&#x7684;&#x4F5C;&#x7528;&#x548C;&#x201C;&#x884C;&#x70BA;&#x201D;&#xFF0C;&#x5B83;&#x662F;&#x68E7;&#x57FA;&#x5730;&#x5740;&#xFF0C;&#x4E26;&#x4E14;&#x767C;&#x73FE;&#x5728;&#x8ABF;&#x7528;&#x4EFB;&#x4F55;&#x4E00;&#x500B;&#x51FD;&#x6578;&#x6642;&#xFF0C;&#x9019;&#x500B; <code>ebp</code> &#x7E3D;&#x662F;&#x5728;&#x7B2C;&#x4E00;&#x689D;&#x6307;&#x4EE4;&#x88AB;&#x58D3;&#x5165;&#x68E7;&#x4E2D;&#xFF0C;&#x4E26;&#x5728;&#x6700;&#x5F8C;&#x4E00;&#x689D;&#x6307;&#x4EE4;&#xFF08;<code>ret</code>&#xFF09;&#x4E4B;&#x524D;&#x88AB;&#x5F48;&#x51FA;&#x3002;&#x985E;&#x4F3C;&#x9019;&#x6A23;&#xFF1A;</p>
<pre><code>func:                        #&#x51FD;&#x6578;
       pushl %ebp            #&#x7B2C;&#x4E00;&#x689D;&#x6307;&#x4EE4;
       ...
       popl %ebp             #&#x5012;&#x6578;&#x7B2C;&#x4E8C;&#x689D;&#x6307;&#x4EE4;
       ret
</code></pre><p>&#x9084;&#x8A18;&#x5F97;&#x4E4B;&#x524D;&#xFF08;&#x7B2C;&#x4E00;&#x90E8;&#x5206;&#xFF09;&#x63D0;&#x5230;&#x7684;&#x51FD;&#x6578;&#x7684;&#x8FD4;&#x56DE;&#x503C;&#x662F;&#x5B58;&#x5132;&#x5728; <code>eax</code> &#x5BC4;&#x5B58;&#x5668;&#x4E2D;&#x7684;&#x9EBC;&#xFF1F;&#x5982;&#x679C;&#x6211;&#x5011;&#x5728;&#x4E00;&#x500B;&#x51FD;&#x6578;&#x4E2D;&#x50C5;&#x50C5;&#x505A;&#x653E;&#x9019;&#x5169;&#x689D;&#x6307;&#x4EE4;&#xFF1A;</p>
<pre><code>popl %eax
pushl %eax
</code></pre><p>&#x90A3;&#x4E0D;&#x5C31;&#x525B;&#x597D;&#x6709;&#xFF1A;</p>
<pre><code>func:                        #&#x51FD;&#x6578;
       pushl %ebp            #&#x7B2C;&#x4E00;&#x689D;&#x6307;&#x4EE4;
       popl %eax             #&#x628A;&#x525B;&#x58D3;&#x5165;&#x68E7;&#x4E2D;&#x7684;ebp&#x5F48;&#x51FA;&#x5B58;&#x653E;&#x5230;eax&#x4E2D;
       pushl %eax            #&#x53C8;&#x628A;ebp&#x58D3;&#x5165;&#x68E7;
       popl %ebp             #&#x5012;&#x6578;&#x7B2C;&#x4E8C;&#x689D;&#x6307;&#x4EE4;
       ret
</code></pre><p>&#x9019;&#x6A23;&#x6211;&#x5011;&#x6C92;&#x6709;&#x6539;&#x8B8A;&#x68E7;&#x7684;&#x72C0;&#x614B;&#xFF0C;&#x537B;&#x7372;&#x5F97;&#x4E86; <code>ebp</code> &#x7684;&#x503C;&#xFF0C;&#x5982;&#x679C;&#x5728;&#x8ABF;&#x7528;&#x4EFB;&#x4F55;&#x4E00;&#x500B;&#x51FD;&#x6578;&#x4E4B;&#x524D;&#xFF0C;&#x7372;&#x53D6;&#x9019;&#x500B; <code>ebp</code>&#xFF0C;&#x4E26;&#x4E14;&#x5728;&#x4EFB;&#x4F55;&#x4E00;&#x689D;&#x5B57;&#x7B26;&#x4E32;&#x8907;&#x88FD;&#x8A9E;&#x53E5;&#xFF08;&#x53EF;&#x80FD;&#x5C0E;&#x81F4;&#x7DE9;&#x885D;&#x5340;&#x6EA2;&#x51FA;&#x7684;&#x8A9E;&#x53E5;&#xFF09;&#x4E4B;&#x5F8C;&#x91CD;&#x65B0;&#x8A2D;&#x7F6E;&#x4E00;&#x4E0B; <code>ebp</code> &#x7684;&#x503C;&#xFF0C;&#x90A3;&#x9EBC;&#x5C31;&#x53EF;&#x4EE5;&#x4FDD;&#x8B77; <code>ebp</code> &#x5566;&#x3002;&#x5177;&#x9AD4;&#x600E;&#x9EBC;&#x5BE6;&#x73FE;&#x5462;&#xFF1F;&#x770B;&#x9019;&#x500B;&#x4EE3;&#x78BC;&#x3002;</p>
<pre><code>/* testshellcode.c */
#include &lt;stdio.h&gt;      /* printf */
#include &lt;string.h&gt; /* memset, memcpy */
#define BUF_SIZE 8

#ifdef STR1
# define STR_SRC &quot;AAAAAAAa\1\0\0\0&quot;
#endif
#ifdef STR2
# define STR_SRC &quot;AAAAAAAa\1\0\0\0BBBBBBBB&quot;
#endif
#ifdef STR3
# define STR_SRC &quot;AAAAAAAa\1\0\0\0BBBBBBBBCCCC&quot;
#endif
#ifdef STR4
# define STR_SRC &quot;AAAAAAAa\1\0\0\0BBBBBBBBCCCCDDDD&quot;
#endif

#ifndef STR_SRC
# define STR_SRC &quot;AAAAAAA&quot;
#endif

unsigned long get_ebp()
{
        __asm__ (&quot;popl %eax;&quot;
                                &quot;pushl %eax;&quot;);
}

int func(int a, int b, int c, unsigned long ebp)
{
        int sum = 0;
        char buffer[BUF_SIZE] = &quot;&quot;;

        sum = a + b + c;
        memset(buffer, &apos;\0&apos;, BUF_SIZE);
        memcpy(buffer, STR_SRC, sizeof(STR_SRC)-1);
        *(unsigned long *)(buffer+20) = ebp;
        return sum;
}

int main()
{
        int sum, ebp;

        ebp = get_ebp();
        sum = func(1, 2, 3, ebp);

        printf(&quot;sum = %d\n&quot;, sum);

        return 0;
}
</code></pre><p>&#x9019;&#x6BB5;&#x4EE3;&#x78BC;&#x548C;&#x4E4B;&#x524D;&#x7684;&#x4EE3;&#x78BC;&#x7684;&#x4E0D;&#x540C;&#x6709;&#xFF1A;</p>
<ul>
<li>&#x7D66; <code>func</code> &#x51FD;&#x6578;&#x589E;&#x52A0;&#x4E86;&#x4E00;&#x500B;&#x53C3;&#x6578; <code>ebp</code>&#xFF0C;&#xFF08;&#x5176;&#x5BE6;&#x53EF;&#x4EE5;&#x7528;&#x5168;&#x5C40;&#x8B8A;&#x91CF;&#x66FF;&#x4EE3;&#x7684;&#xFF09;</li>
<li>&#x5229;&#x7528;&#x4E86;&#x525B;&#x4ECB;&#x7D39;&#x7684;&#x539F;&#x7406;&#x5B9A;&#x7FA9;&#x4E86;&#x4E00;&#x500B;&#x51FD;&#x6578; <code>get_ebp</code> &#x4EE5;&#x4FBF;&#x7372;&#x53D6;&#x8001;&#x7684; <code>ebp</code> </li>
<li>&#x5728; <code>main</code> &#x51FD;&#x6578;&#x4E2D;&#x8ABF;&#x7528; <code>func</code> &#x4E4B;&#x524D;&#x8ABF;&#x7528;&#x4E86; <code>get_ebp</code>&#xFF0C;&#x4E26;&#x628A;&#x5B83;&#x4F5C;&#x70BA; <code>func</code> &#x7684;&#x6700;&#x5F8C;&#x4E00;&#x500B;&#x53C3;&#x6578;</li>
<li>&#x5728; <code>func</code> &#x51FD;&#x6578;&#x4E2D;&#x8ABF;&#x7528; <code>memcpy</code> &#x51FD;&#x6578;&#xFF08;&#x53EF;&#x80FD;&#x767C;&#x751F;&#x7DE9;&#x885D;&#x5340;&#x6EA2;&#x51FA;&#x7684;&#x5730;&#x65B9;&#xFF09;&#x4E4B;&#x5F8C;&#x6DFB;&#x52A0;&#x4E86;&#x4E00;&#x689D;&#x6062;&#x5FA9;&#x8A2D;&#x7F6E; <code>ebp</code> &#x7684;&#x8A9E;&#x53E5;&#xFF0C;&#x9019;&#x689D;&#x8A9E;&#x53E5;&#x5148;&#x628A; <code>buffer+20</code> &#x9019;&#x500B;&#x5730;&#x5740;&#xFF08;&#x5B58;&#x653E; <code>ebp</code> &#x7684;&#x5730;&#x5740;&#xFF0C;&#x4F60;&#x53EF;&#x4EE5;&#x985E;&#x4F3C;&#x7B2C;&#x4E00;&#x90E8;&#x5206;&#x63D0;&#x5230;&#x7684;&#x7528; <code>gdb</code> &#x4F86;&#x67E5;&#x770B;&#xFF09;&#x5F37;&#x5236;&#x8F49;&#x63DB;&#x70BA;&#x6307;&#x5411;&#x4E00;&#x500B; <code>unsigned long</code> &#x578B;&#x7684;&#x6574;&#x6578;&#xFF08;4 &#x500B;&#x5B57;&#x7BC0;&#xFF09;&#xFF0C;&#x7136;&#x5F8C;&#x628A;&#x5B83;&#x6307;&#x5411;&#x7684;&#x5167;&#x5BB9;&#x4FEE;&#x6539;&#x70BA;&#x8001;&#x7684; <code>ebp</code> &#x3002;</li>
</ul>
<p>&#x770B;&#x770B;&#x6548;&#x679C;&#xFF1A;</p>
<pre><code>$ gcc -D STR3 -o testshellcode testshellcode.c
$ ./testshellcode         #&#x73FE;&#x5728;&#x6C92;&#x6709;&#x6BB5;&#x932F;&#x8AA4;&#x4E86;&#x5427;&#xFF0C;&#x56E0;&#x70BA;ebp&#x5F97;&#x5230;&#x4E86;&#x201C;&#x4FDD;&#x8B77;&#x201D;
sum = 6
</code></pre><p><span id="toc_14869_27504_15"></span></p>
<h3 id="%E5%A6%82%E4%BD%95%E4%BF%9D%E8%AD%B7-eip-%E4%B8%8D%E8%A2%AB%E4%BF%AE%E6%94%B9%EF%BC%9F">&#x5982;&#x4F55;&#x4FDD;&#x8B77; eip &#x4E0D;&#x88AB;&#x4FEE;&#x6539;&#xFF1F;</h3>
<p>&#x5982;&#x679C;&#x6211;&#x5011;&#x8907;&#x88FD;&#x66F4;&#x591A;&#x7684;&#x5B57;&#x7BC0;&#x904E;&#x53BB;&#x4E86;&#xFF0C;&#x6BD4;&#x5982;&#x518D;&#x591A;&#x8907;&#x88FD;&#x56DB;&#x500B;&#x5B57;&#x7BC0;&#x9032;&#x53BB;&#xFF0C;&#x90A3;&#x9EBC; <code>eip</code> &#x5C31;&#x88AB;&#x8986;&#x84CB;&#x4E86;&#x3002;</p>
<pre><code>$ gcc -D STR4 -o testshellcode testshellcode.c
$ ./testshellcode
Segmentation fault
</code></pre><p>&#x540C;&#x6A23;&#x6703;&#x51FA;&#x73FE;&#x6BB5;&#x932F;&#x8AA4;&#xFF0C;&#x56E0;&#x70BA;&#x4E0B;&#x4E00;&#x689D;&#x6307;&#x4EE4;&#x7684;&#x4F4D;&#x7F6E;&#x90FD;&#x88AB;&#x6539;&#x5BEB;&#x4E86;&#xFF0C;<code>func</code> &#x8FD4;&#x56DE;&#x5F8C;&#x90FD;&#x4E0D;&#x77E5;&#x9053;&#x8981;&#x8A2A;&#x554F;&#x54EA;&#x500B;&#x201D;&#x975E;&#x6CD5;&#x201C;&#x5730;&#x5740;&#x5566;&#x3002;&#x5475;&#x5475;&#xFF0C;&#x5982;&#x679C;&#x662F;&#x4E00;&#x500B;&#x5408;&#x6CD5;&#x5730;&#x5740;&#x5462;&#xFF1F;</p>
<p>&#x5982;&#x679C;&#x5728;&#x7DE9;&#x885D;&#x5340;&#x6EA2;&#x51FA;&#x6642;&#xFF0C;<code>eip</code> &#x88AB;&#x8986;&#x84CB;&#x4E86;&#xFF0C;&#x4E26;&#x4E14;&#x88AB;&#x4FEE;&#x6539;&#x70BA;&#x4E86;&#x4E00;&#x689D;&#x5408;&#x6CD5;&#x5730;&#x5740;&#xFF0C;&#x90A3;&#x9EBC;&#x554F;&#x984C;&#x5C31;&#x975E;&#x5E38;&#x201D;&#x6709;&#x8DA3;&#x201C;&#x4E86;&#x3002;&#x5982;&#x679C;&#x9019;&#x500B;&#x5730;&#x5740;&#x525B;&#x597D;&#x662F;&#x8ABF;&#x7528;func&#x7684;&#x90A3;&#x500B;&#x5730;&#x5740;&#xFF0C;&#x90A3;&#x9EBC;&#x6574;&#x500B;&#x7A0B;&#x5E8F;&#x5C31;&#x6210;&#x4E86;&#x6B7B;&#x5FAA;&#x74B0;&#xFF0C;&#x5982;&#x679C;&#x9019;&#x500B;&#x5730;&#x5740;&#x6307;&#x5411;&#x7684;&#x4F4D;&#x7F6E;&#x525B;&#x597D;&#x6709;&#x4E00;&#x6BB5;&#x95DC;&#x6A5F;&#x4EE3;&#x78BC;&#xFF0C;&#x90A3;&#x9EBC;&#x7CFB;&#x7D71;&#x6B63;&#x5728;&#x904B;&#x884C;&#x7684;&#x6240;&#x6709;&#x670D;&#x52D9;&#x90FD;&#x5C07;&#x88AB;&#x95DC;&#x6389;&#xFF0C;&#x5982;&#x679C;&#x90A3;&#x500B;&#x5730;&#x65B9;&#x662F;&#x4E00;&#x6BB5;&#x66F4;&#x60E1;&#x610F;&#x7684;&#x4EE3;&#x78BC;&#xFF0C;&#x90A3;&#x5C31;&#xFF1F;&#x4F60;&#x53EF;&#x4EE5;&#x76E1;&#x60C5;&#x60F3;&#x50CF;&#x54E6;&#x3002;&#x5982;&#x679C;&#x662F;&#x9ED1;&#x5BA2;&#x6545;&#x610F;&#x5229;&#x7528;&#x9019;&#x500B;&#xFF0C;&#x90A3;&#x9EBC;&#x90A3;&#x4E9B;&#x4EE3;&#x78BC;&#x8C8C;&#x4F3C;&#x5C31;&#x53EB;&#x505A;<a href="http://janxin.bokee.com/4067220.html" target="_blank">shellcode</a>&#x4E86;&#x3002;</p>
<p>&#x6709;&#x6C92;&#x6709;&#x4FDD;&#x8B77; <code>eip</code> &#x7684;&#x8FA6;&#x6CD5;&#x5462;&#xFF1F;&#x5475;&#x5475;&#xFF0C;&#x61C9;&#x8A72;&#x662F;&#x6709;&#x7684;&#x5427;&#x3002;&#x4E0D;&#x77E5;&#x9053; <code>gas</code> &#x6709;&#x6C92;&#x6709;&#x985E;&#x4F3C; <code>masm</code> &#x5F59;&#x7DE8;&#x5668;&#x4E2D; <code>offset</code> &#x7684;&#x507D;&#x64CD;&#x4F5C;&#x6307;&#x4EE4;&#xFF08;&#x67E5;&#x627E;&#x4E86;&#x4E00;&#x4E0B;&#xFF0C;&#x8C8C;&#x4F3C;&#x6C92;&#x6709;&#xFF09;&#xFF0C;&#x5982;&#x679C;&#x6709;&#x7684;&#x8A71;&#x5728;&#x51FD;&#x6578;&#x8ABF;&#x7528;&#x4E4B;&#x524D;&#x8A2D;&#x7F6E;&#x4E00;&#x500B;&#x6A19;&#x865F;&#xFF0C;&#x5728;&#x5F8C;&#x9762;&#x67D0;&#x500B;&#x4F4D;&#x7F6E;&#x7372;&#x53D6;&#xFF0C;&#x518D;&#x52A0;&#x4E0A;&#x4E00;&#x500B;&#x53EF;&#x80FD;&#x7684;&#x504F;&#x79FB;&#xFF08;&#x5305;&#x62EC; <code>call</code> &#x6307;&#x4EE4;&#x7684;&#x9577;&#x5EA6;&#x548C;&#x4E00;&#x4E9B; <code>push</code> &#x6307;&#x4EE4;&#x7B49;&#xFF09;&#xFF0C;&#x61C9;&#x8A72;&#x53EF;&#x4EE5;&#x7B97;&#x51FA;&#x4F86;&#xFF0C;&#x4E0D;&#x904E;&#x8C8C;&#x4F3C;&#x6BD4;&#x8F03;&#x9EBB;&#x7169;&#xFF08;&#x6216;&#x8A31;&#x4F60;&#x9748;&#x611F;&#x5927;&#x4F5C;&#xFF0C;&#x627E;&#x5230;&#x597D;&#x8FA6;&#x6CD5;&#x4E86;&#xFF01;&#xFF09;&#xFF0C;&#x9019;&#x88E1;&#x76F4;&#x63A5;&#x901A;&#x904E; <code>gdb</code> &#x53CD;&#x5F59;&#x7DE8;&#x6C42;&#x5F97;&#x5B83;&#x76F8;&#x5C0D; <code>main</code> &#x7684;&#x504F;&#x79FB;&#x7B97;&#x51FA;&#x4F86;&#x5F97;&#x4E86;&#x3002;&#x6C42;&#x51FA;&#x4F86;&#x4EE5;&#x5F8C;&#x7528;&#x5B83;&#x4F86;&#x201D;&#x4FDD;&#x8B77;&#x201C;&#x68E7;&#x4E2D;&#x7684;&#x503C;&#x3002;</p>
<p>&#x770B;&#x770B;&#x9019;&#x500B;&#x4EE3;&#x78BC;&#xFF1A;</p>
<pre><code>/* testshellcode.c */
#include &lt;stdio.h&gt;      /* printf */
#include &lt;string.h&gt; /* memset, memcpy */
#define BUF_SIZE 8

#ifdef STR1
# define STR_SRC &quot;AAAAAAAa\1\0\0\0&quot;
#endif
#ifdef STR2
# define STR_SRC &quot;AAAAAAAa\1\0\0\0BBBBBBBB&quot;
#endif
#ifdef STR3
# define STR_SRC &quot;AAAAAAAa\1\0\0\0BBBBBBBBCCCC&quot;
#endif
#ifdef STR4
# define STR_SRC &quot;AAAAAAAa\1\0\0\0BBBBBBBBCCCCDDDD&quot;
#endif

#ifndef STR_SRC
# define STR_SRC &quot;AAAAAAA&quot;
#endif

int main();
#define OFFSET  40

unsigned long get_ebp()
{
        __asm__ (&quot;popl %eax;&quot;
                                &quot;pushl %eax;&quot;);
}

int func(int a, int b, int c, unsigned long ebp)
{
        int sum = 0;
        char buffer[BUF_SIZE] = &quot;&quot;;

        memset(buffer, &apos;\0&apos;, BUF_SIZE);
        memcpy(buffer, STR_SRC, sizeof(STR_SRC)-1);

        sum = a + b + c;

        *(unsigned long *)(buffer+20) = ebp;
        *(unsigned long *)(buffer+24) = (unsigned long)main+OFFSET;
        return sum;
}

int main()
{
        int sum, ebp;

        ebp = get_ebp();
        sum = func(1, 2, 3, ebp);

        printf(&quot;sum = %d\n&quot;, sum);

        return 0;
}
</code></pre><p>&#x770B;&#x770B;&#x6548;&#x679C;&#xFF1A;</p>
<pre><code>$ gcc -D STR4 -o testshellcode testshellcode.c
$ ./testshellcode
sum = 6
</code></pre><p>&#x9019;&#x6A23;&#xFF0C;<code>EIP</code> &#x4E5F;&#x5F97;&#x5230;&#x4E86;&#x201C;&#x4FDD;&#x8B77;&#x201D;&#xFF08;&#x9019;&#x500B;&#x65B9;&#x6CD5;&#x5F88;&#x7CDF;&#x7CD5;&#x7684;&#xFF0C;&#x5475;&#x5475;&#xFF09;&#x3002;</p>
<p>&#x985E;&#x4F3C;&#x5730;&#xFF0C;&#x5982;&#x679C;&#x518D;&#x591A;&#x8907;&#x88FD;&#x4E00;&#x4E9B;&#x5167;&#x5BB9;&#x5462;&#xFF1F;&#x90A3;&#x9EBC;&#x68E7;&#x5F8C;&#x9762;&#x7684;&#x5167;&#x5BB9;&#x90FD;&#x5C07;&#x88AB;&#x8986;&#x84CB;&#xFF0C;&#x5373;&#x50B3;&#x905E;&#x7D66; <code>func</code> &#x51FD;&#x6578;&#x7684;&#x53C3;&#x6578;&#x90FD;&#x5C07;&#x88AB;&#x8986;&#x84CB;&#xFF0C;&#x56E0;&#x6B64;&#x4E0A;&#x9762;&#x7684;&#x65B9;&#x6CD5;&#xFF0C;&#x5305;&#x62EC;&#x6240;&#x8B02;&#x7684;&#x5C0D; <code>sum</code> &#x548C; <code>ebp</code> &#x7B49;&#x503C;&#x7684;&#x4FDD;&#x8B77;&#x90FD;&#x6C92;&#x6709;&#x4EFB;&#x4F55;&#x610F;&#x7FA9;&#x4E86;&#xFF08;&#x5982;&#x679C;&#x518D;&#x5C0D;&#x5F8C;&#x9762;&#x7684;&#x53C3;&#x6578;&#x9032;&#x884C;&#x9032;&#x4E00;&#x6B65;&#x7684;&#x4FDD;&#x8B77;&#x5462;&#xFF1F;&#x6216;&#x8A31;&#x6709;&#x9EDE;&#x610F;&#x7FA9;&#xFF0C;&#x5475;&#x5475;&#xFF09;&#x3002;&#x5728;&#x9019;&#x88E1;&#xFF0C;&#x4E4B;&#x6240;&#x4EE5;&#x63D0;&#x51FA;&#x985E;&#x4F3C;&#x9019;&#x6A23;&#x7684;&#x4FDD;&#x8B77;&#x65B9;&#x6CD5;&#xFF0C;&#x5BE6;&#x969B;&#x4E0A;&#x53EA;&#x662F;&#x70BA;&#x4E86;&#x8A0E;&#x8AD6;&#x4E00;&#x4E9B;&#x6709;&#x8DA3;&#x7684;&#x7D30;&#x7BC0;&#x4E26;&#x52A0;&#x6DF1;&#x5C0D;&#x7DE9;&#x885D;&#x5340;&#x6EA2;&#x51FA;&#x9019;&#x4E00;&#x554F;&#x984C;&#x7684;&#x7406;&#x89E3;&#xFF08;&#x6216;&#x8A31;&#x6709;&#x4E00;&#x4E9B;&#x5BE6;&#x969B;&#x7684;&#x50F9;&#x503C;&#x54E6;&#xFF0C;&#x7B97;&#x662F;&#x62CB;&#x78DA;&#x5F15;&#x7389;&#x5427;&#xFF09;&#x3002;</p>
<p><span id="toc_14869_27504_16"></span></p>
<h3 id="%E7%B7%A9%E8%A1%9D%E5%8D%80%E6%BA%A2%E5%87%BA%E6%AA%A2%E6%B8%AC">&#x7DE9;&#x885D;&#x5340;&#x6EA2;&#x51FA;&#x6AA2;&#x6E2C;</h3>
<p>&#x8981;&#x78BA;&#x5BE6;&#x89E3;&#x6C7A;&#x9019;&#x985E;&#x554F;&#x984C;&#xFF0C;&#x5F9E;&#x4E3B;&#x89C0;&#x4E0A;&#x8B1B;&#xFF0C;&#x9084;&#x5F97;&#x7A0B;&#x5E8F;&#x54E1;&#x4F86;&#x505A;&#x76F8;&#x95DC;&#x7684;&#x5DE5;&#x4F5C;&#xFF0C;&#x6BD4;&#x5982;&#x9650;&#x5236;&#x5C07;&#x8981;&#x8907;&#x88FD;&#x7684;&#x5B57;&#x7B26;&#x4E32;&#x7684;&#x9577;&#x5EA6;&#xFF0C;&#x4FDD;&#x8B49;&#x5B83;&#x4E0D;&#x8D85;&#x904E;&#x7576;&#x521D;&#x7533;&#x8ACB;&#x7684;&#x7DE9;&#x885D;&#x5340;&#x7684;&#x5927;&#x5C0F;&#x3002;</p>
<p>&#x4F8B;&#x5982;&#xFF0C;&#x5728;&#x4E0A;&#x9762;&#x7684;&#x4EE3;&#x78BC;&#x4E2D;&#xFF0C;&#x6211;&#x5011;&#x5728; <code>memcpy</code> &#x4E4B;&#x524D;&#xFF0C;&#x53EF;&#x4EE5;&#x52A0;&#x5165;&#x4E00;&#x500B;&#x5224;&#x65B7;&#xFF0C;&#x4E26;&#x4E14;&#x53EF;&#x4EE5;&#x5C0D;&#x7DE9;&#x885D;&#x5340;&#x6EA2;&#x51FA;&#x9032;&#x884C;&#x5F88;&#x597D;&#x7684;&#x6AA2;&#x67E5;&#x3002;&#x5982;&#x679C;&#x80FD;&#x5920;&#x8A2D;&#x8A08;&#x4E00;&#x4E9B;&#x6BD4;&#x8F03;&#x597D;&#x7684;&#x6E2C;&#x8A66;&#x5BE6;&#x4F8B;&#x628A;&#x9019;&#x4E9B;&#x5224;&#x65B7;&#x8986;&#x84CB;&#x5230;&#xFF0C;&#x90A3;&#x9EBC;&#x76F8;&#x95DC;&#x7684;&#x554F;&#x984C;&#x5C31;&#x53EF;&#x4EE5;&#x5F97;&#x5230;&#x6BD4;&#x8F03;&#x4E0D;&#x932F;&#x7684;&#x6AA2;&#x67E5;&#x4E86;&#x3002;</p>
<pre><code>/* testshellcode.c */
#include &lt;stdio.h&gt;      /* printf */
#include &lt;string.h&gt; /* memset, memcpy */
#include &lt;stdlib.h&gt;     /* exit */
#define BUF_SIZE 8

#ifdef STR4
# define STR_SRC &quot;AAAAAAAa\1\0\0\0BBBBBBBBCCCCDDDD&quot;
#endif

#ifndef STR_SRC
# define STR_SRC &quot;AAAAAAA&quot;
#endif

int func(int a, int b, int c)
{
        int sum = 0;
        char buffer[BUF_SIZE] = &quot;&quot;;

        memset(buffer, &apos;\0&apos;, BUF_SIZE);
        if ( sizeof(STR_SRC)-1 &gt; BUF_SIZE ) {
                printf(&quot;buffer overflow!\n&quot;);
                exit(-1);
        }
        memcpy(buffer, STR_SRC, sizeof(STR_SRC)-1);

        sum = a + b + c;

        return sum;
}

int main()
{
        int sum;

        sum = func(1, 2, 3);

        printf(&quot;sum = %d\n&quot;, sum);

        return 0;
}
</code></pre><p>&#x73FE;&#x5728;&#x7684;&#x6548;&#x679C;&#x5982;&#x4E0B;&#xFF1A;</p>
<pre><code>$ gcc -DSTR4 -g -o testshellcode testshellcode.c
$ ./testshellcode      #&#x5982;&#x679C;&#x5B58;&#x5728;&#x6EA2;&#x51FA;&#xFF0C;&#x90A3;&#x9EBC;&#x5C31;&#x6703;&#x5F97;&#x5230;&#x963B;&#x6B62;&#x4E26;&#x9000;&#x51FA;&#xFF0C;&#x5F9E;&#x800C;&#x963B;&#x6B62;&#x53EF;&#x80FD;&#x7684;&#x7834;&#x58DE;
buffer overflow!
$ gcc -g -o testshellcode testshellcode.c
$ ./testshellcode
sum = 6
</code></pre><p>&#x7576;&#x7136;&#xFF0C;&#x5982;&#x679C;&#x80FD;&#x5920;&#x5728; C &#x6A19;&#x6E96;&#x88E1;&#x982D;&#x52A0;&#x5165;&#x5C0D;&#x6578;&#x7D44;&#x64CD;&#x4F5C;&#x7684;&#x9650;&#x5236;&#x53EF;&#x80FD;&#x6703;&#x66F4;&#x597D;&#xFF0C;&#x6216;&#x8005;&#x5728;&#x7DE8;&#x8B6F;&#x5668;&#x4E2D;&#x64F4;&#x5C55;&#x5C0D;&#x53EF;&#x80FD;&#x5F15;&#x8D77;&#x7DE9;&#x885D;&#x5340;&#x6EA2;&#x51FA;&#x7684;&#x8A9E;&#x6CD5;&#x6AA2;&#x67E5;&#x3002;</p>
<p><span id="toc_14869_27504_17"></span></p>
<h2 id="%E7%B7%A9%E8%A1%9D%E5%8D%80%E6%B3%A8%E5%85%A5%E5%AF%A6%E4%BE%8B">&#x7DE9;&#x885D;&#x5340;&#x6CE8;&#x5165;&#x5BE6;&#x4F8B;</h2>
<p>&#x6700;&#x5F8C;&#x7D66;&#x51FA;&#x4E00;&#x500B;&#x5229;&#x7528;&#x4E0A;&#x8FF0;&#x7DE9;&#x885D;&#x5340;&#x6EA2;&#x51FA;&#x4F86;&#x9032;&#x884C;&#x7DE9;&#x885D;&#x5340;&#x6CE8;&#x5165;&#x7684;&#x4F8B;&#x5B50;&#x3002;&#x4E5F;&#x5C31;&#x662F;&#x901A;&#x904E;&#x5F80;&#x67D0;&#x500B;&#x7DE9;&#x885D;&#x5340;&#x6CE8;&#x5165;&#x4E00;&#x4E9B;&#x4EE3;&#x78BC;&#xFF0C;&#x4E26;&#x628A;eip&#x4FEE;&#x6539;&#x70BA;&#x9019;&#x4E9B;&#x4EE3;&#x78BC;&#x7684;&#x5165;&#x53E3;&#x5F9E;&#x800C;&#x9054;&#x5230;&#x7834;&#x58DE;&#x76EE;&#x6A19;&#x7A0B;&#x5E8F;&#x884C;&#x70BA;&#x7684;&#x76EE;&#x7684;&#x3002;</p>
<p>&#x9019;&#x500B;&#x4F8B;&#x5B50;&#x4F86;&#x81EA;<a href="http://www.ibm.com/developerworks/cn/linux/l-overflow/index.html" target="_blank">Linux &#x4E0B;&#x7DE9;&#x885D;&#x5340;&#x6EA2;&#x51FA;&#x653B;&#x64CA;&#x7684;&#x539F;&#x7406;&#x53CA;&#x5C0D;&#x7B56;</a>&#xFF0C;&#x9019;&#x88E1;&#x4E3B;&#x8981;&#x5229;&#x7528;&#x4E0A;&#x9762;&#x4ECB;&#x7D39;&#x7684;&#x77E5;&#x8B58;&#x5C0D;&#x5B83;&#x9032;&#x884C;&#x4E86;&#x6BD4;&#x8F03;&#x8A73;&#x7D30;&#x7684;&#x5206;&#x6790;&#x3002;</p>
<p><span id="toc_14869_27504_18"></span></p>
<h3 id="%E6%BA%96%E5%82%99%EF%BC%9A%E6%8A%8A-c-%E8%AA%9E%E8%A8%80%E5%87%BD%E6%95%B8%E8%BD%89%E6%8F%9B%E7%82%BA%E5%AD%97%E7%AC%A6%E4%B8%B2%E5%BA%8F%E5%88%97">&#x6E96;&#x5099;&#xFF1A;&#x628A; C &#x8A9E;&#x8A00;&#x51FD;&#x6578;&#x8F49;&#x63DB;&#x70BA;&#x5B57;&#x7B26;&#x4E32;&#x5E8F;&#x5217;</h3>
<p>&#x9996;&#x5148;&#x56DE;&#x5230;&#x7B2C;&#x4E00;&#x90E8;&#x5206;&#xFF0C;&#x770B;&#x770B;&#x90A3;&#x500B; <code>Shellcode.c</code> &#x7A0B;&#x5E8F;&#x3002;&#x6211;&#x5011;&#x60F3;&#x7372;&#x53D6;&#x5B83;&#x7684;&#x5F59;&#x7DE8;&#x4EE3;&#x78BC;&#xFF0C;&#x4E26;&#x4EE5;&#x5341;&#x516D;&#x9032;&#x5236;&#x5B57;&#x7BC0;&#x7684;&#x5F62;&#x5F0F;&#x8F38;&#x51FA;&#xFF0C;&#x4EE5;&#x4FBF;&#x628A;&#x9019;&#x4E9B;&#x6307;&#x4EE4;&#x7576;&#x5B57;&#x7B26;&#x4E32;&#x5B58;&#x653E;&#x8D77;&#x4F86;&#xFF0C;&#x5F9E;&#x800C;&#x4F5C;&#x70BA;&#x7DE9;&#x885D;&#x5340;&#x6CE8;&#x5165;&#x6642;&#x7684;&#x8F38;&#x5165;&#x5B57;&#x7B26;&#x4E32;&#x3002;&#x4E0B;&#x9762;&#x901A;&#x904E; <code>gdb</code> &#x7372;&#x53D6;&#x9019;&#x4E9B;&#x5167;&#x5BB9;&#x3002;</p>
<pre><code>$ gcc -g -o shellcode shellcode.c
$ gdb ./shellcode
GNU gdb 6.6
...
(gdb) disassemble main
Dump of assembler code for function main:
...
0x08048331 &lt;main+13&gt;:   push   %ecx
0x08048332 &lt;main+14&gt;:   jmp    0x8048354 &lt;forward&gt;
0x08048334 &lt;main+16&gt;:   pop    %esi
0x08048335 &lt;main+17&gt;:   mov    $0x4,%eax
0x0804833a &lt;main+22&gt;:   mov    $0x2,%ebx
0x0804833f &lt;main+27&gt;:   mov    %esi,%ecx
0x08048341 &lt;main+29&gt;:   mov    $0xc,%edx
0x08048346 &lt;main+34&gt;:   int    $0x80
0x08048348 &lt;main+36&gt;:   mov    $0x1,%eax
0x0804834d &lt;main+41&gt;:   mov    $0x0,%ebx
0x08048352 &lt;main+46&gt;:   int    $0x80
0x08048354 &lt;forward+0&gt;: call   0x8048334 &lt;main+16&gt;
0x08048359 &lt;forward+5&gt;: dec    %eax
0x0804835a &lt;forward+6&gt;: gs
0x0804835b &lt;forward+7&gt;: insb   (%dx),%es:(%edi)
0x0804835c &lt;forward+8&gt;: insb   (%dx),%es:(%edi)
0x0804835d &lt;forward+9&gt;: outsl  %ds:(%esi),(%dx)
0x0804835e &lt;forward+10&gt;:        and    %dl,0x6f(%edi)
0x08048361 &lt;forward+13&gt;:        jb     0x80483cf &lt;__libc_csu_init+79&gt;
0x08048363 &lt;forward+15&gt;:        or     %fs:(%eax),%al
...
End of assembler dump.
(gdb) set logging on   #&#x958B;&#x555F;&#x65E5;&#x8A8C;&#x529F;&#x80FD;&#xFF0C;&#x8A18;&#x9304;&#x64CD;&#x4F5C;&#x7D50;&#x679C;
Copying output to gdb.txt.
(gdb) x/52bx main+14  #&#x4EE5;&#x5341;&#x516D;&#x9032;&#x5236;&#x55AE;&#x5B57;&#x7BC0;&#xFF08;&#x5B57;&#x7B26;&#xFF09;&#x65B9;&#x5F0F;&#x6253;&#x5370;&#x51FA;shellcode&#x7684;&#x6838;&#x5FC3;&#x4EE3;&#x78BC;
0x8048332 &lt;main+14&gt;:    0xeb    0x20    0x5e    0xb8    0x04    0x00    0x00   0x00
0x804833a &lt;main+22&gt;:    0xbb    0x02    0x00    0x00    0x00    0x89    0xf1   0xba
0x8048342 &lt;main+30&gt;:    0x0c    0x00    0x00    0x00    0xcd    0x80    0xb8   0x01
0x804834a &lt;main+38&gt;:    0x00    0x00    0x00    0xbb    0x00    0x00    0x00   0x00
0x8048352 &lt;main+46&gt;:    0xcd    0x80    0xe8    0xdb    0xff    0xff    0xff   0x48
0x804835a &lt;forward+6&gt;:  0x65    0x6c    0x6c    0x6f    0x20    0x57    0x6f   0x72
0x8048362 &lt;forward+14&gt;: 0x6c    0x64    0x0a    0x00
(gdb) quit
$ cat gdb.txt | sed -e &quot;s/^.*://g;s/\t/\\\/g;s/^/\&quot;/g;s/\$/\&quot;/g&quot;  #&#x628A;&#x65E5;&#x8A8C;&#x88E1;&#x982D;&#x7684;&#x5167;&#x5BB9;&#x8655;&#x7406;&#x4E00;&#x4E0B;&#xFF0C;&#x5F97;&#x5230;&#x9019;&#x6A23;&#x4E00;&#x500B;&#x5B57;&#x7B26;&#x4E32;
&quot;\0xeb\0x20\0x5e\0xb8\0x04\0x00\0x00\0x00&quot;
&quot;\0xbb\0x02\0x00\0x00\0x00\0x89\0xf1\0xba&quot;
&quot;\0x0c\0x00\0x00\0x00\0xcd\0x80\0xb8\0x01&quot;
&quot;\0x00\0x00\0x00\0xbb\0x00\0x00\0x00\0x00&quot;
&quot;\0xcd\0x80\0xe8\0xdb\0xff\0xff\0xff\0x48&quot;
&quot;\0x65\0x6c\0x6c\0x6f\0x20\0x57\0x6f\0x72&quot;
&quot;\0x6c\0x64\0x0a\0x00&quot;
</code></pre><p><span id="toc_14869_27504_19"></span></p>
<h3 id="%E6%B3%A8%E5%85%A5%EF%BC%9A%E5%9C%A8-c-%E8%AA%9E%E8%A8%80%E4%B8%AD%E5%9F%B7%E8%A1%8C%E5%AD%97%E7%AC%A6%E4%B8%B2%E5%8C%96%E7%9A%84%E4%BB%A3%E7%A2%BC">&#x6CE8;&#x5165;&#xFF1A;&#x5728; C &#x8A9E;&#x8A00;&#x4E2D;&#x57F7;&#x884C;&#x5B57;&#x7B26;&#x4E32;&#x5316;&#x7684;&#x4EE3;&#x78BC;</h3>
<p>&#x5F97;&#x5230;&#x4E0A;&#x9762;&#x7684;&#x5B57;&#x7B26;&#x4E32;&#x4EE5;&#x5F8C;&#x6211;&#x5011;&#x5C31;&#x53EF;&#x4EE5;&#x8A2D;&#x8A08;&#x4E00;&#x6BB5;&#x4E0B;&#x9762;&#x7684;&#x4EE3;&#x78BC;&#x5566;&#x3002;</p>
<pre><code>/* testshellcode.c */
char shellcode[]=&quot;\xeb\x20\x5e\xb8\x04\x00\x00\x00&quot;
&quot;\xbb\x02\x00\x00\x00\x89\xf1\xba&quot;
&quot;\x0c\x00\x00\x00\xcd\x80\xb8\x01&quot;
&quot;\x00\x00\x00\xbb\x00\x00\x00\x00&quot;
&quot;\xcd\x80\xe8\xdb\xff\xff\xff\x48&quot;
&quot;\x65\x6c\x6c\x6f\x20\x57\x6f\x72&quot;
&quot;\x6c\x64\x0a\x00&quot;;

void callshellcode(void)
{
   int *ret;
   ret = (int *)&amp;ret + 2;
   (*ret) = (int)shellcode;
}

int main()
{
        callshellcode();

        return 0;
}
</code></pre><p>&#x904B;&#x884C;&#x770B;&#x770B;&#xFF0C;</p>
<pre><code>$ gcc -o testshellcode testshellcode.c
$ ./testshellcode
Hello World
</code></pre><p>&#x7ADF;&#x7136;&#x6253;&#x5370;&#x51FA;&#x4E86; <code>Hello World</code>&#xFF0C;&#x5BE6;&#x969B;&#x4E0A;&#xFF0C;&#x5982;&#x679C;&#x53EA;&#x662F;&#x70BA;&#x4E86;&#x8B93; <code>Shellcode</code> &#x57F7;&#x884C;&#xFF0C;&#x6709;&#x66F4;&#x7C21;&#x55AE;&#x7684;&#x8FA6;&#x6CD5;&#xFF0C;&#x76F4;&#x63A5;&#x628A; <code>Shellcode</code> &#x9019;&#x500B;&#x5B57;&#x7B26;&#x4E32;&#x5165;&#x53E3;&#x5F37;&#x5236;&#x8F49;&#x63DB;&#x70BA;&#x4E00;&#x500B;&#x51FD;&#x6578;&#x5165;&#x53E3;&#xFF0C;&#x4E26;&#x8ABF;&#x7528;&#x5C31;&#x53EF;&#x4EE5;&#xFF0C;&#x5177;&#x9AD4;&#x898B;&#x9019;&#x6BB5;&#x4EE3;&#x78BC;&#x3002;</p>
<pre><code>char shellcode[]=&quot;\xeb\x20\x5e\xb8\x04\x00\x00\x00&quot;
&quot;\xbb\x02\x00\x00\x00\x89\xf1\xba&quot;
&quot;\x0c\x00\x00\x00\xcd\x80\xb8\x01&quot;
&quot;\x00\x00\x00\xbb\x00\x00\x00\x00&quot;
&quot;\xcd\x80\xe8\xdb\xff\xff\xff\x48&quot;
&quot;\x65\x6c\x6c\x6f\x20\x57\x6f\x72&quot;
&quot;\x6c\x64\x0a\x00&quot;;

typedef void (* func)();            //&#x5B9A;&#x7FA9;&#x4E00;&#x500B;&#x6307;&#x5411;&#x51FD;&#x6578;&#x7684;&#x6307;&#x91DD;func&#xFF0C;&#x800C;&#x51FD;&#x6578;&#x7684;&#x8FD4;&#x56DE;&#x503C;&#x548C;&#x53C3;&#x6578;&#x5747;&#x70BA;void

int main()
{
        (* (func)shellcode)();

        return 0;
}
</code></pre><p><span id="toc_14869_27504_20"></span></p>
<h3 id="%E6%B3%A8%E5%85%A5%E5%8E%9F%E7%90%86%E5%88%86%E6%9E%90">&#x6CE8;&#x5165;&#x539F;&#x7406;&#x5206;&#x6790;</h3>
<p>&#x9019;&#x88E1;&#x4E0D;&#x90A3;&#x6A23;&#x505A;&#xFF0C;&#x70BA;&#x4EC0;&#x9EBC;&#x4E5F;&#x80FD;&#x5920;&#x57F7;&#x884C;&#x5230; <code>Shellcode</code> &#x5462;&#xFF1F;&#x4ED4;&#x7D30;&#x5206;&#x6790;&#x4E00;&#x4E0B; <code>callShellcode</code> &#x88E1;&#x982D;&#x7684;&#x4EE3;&#x78BC;&#x5C31;&#x53EF;&#x4EE5;&#x5F97;&#x5230;&#x539F;&#x56E0;&#x4E86;&#x3002;</p>
<pre><code>int *ret;
</code></pre><p>&#x9019;&#x88E1;&#x5B9A;&#x7FA9;&#x4E86;&#x4E00;&#x500B;&#x6307;&#x5411;&#x6574;&#x6578;&#x7684;&#x6307;&#x91DD;&#xFF0C;<code>ret</code> &#x4F54;&#x7528; 4 &#x500B;&#x5B57;&#x7BC0;&#xFF08;&#x53EF;&#x4EE5;&#x7528; <code>sizeof(int *)</code> &#x7B97;&#x51FA;&#xFF09;&#x3002;</p>
<pre><code>ret = (int *)&amp;ret + 2;
</code></pre><p>&#x9019;&#x88E1;&#x628A; <code>ret</code> &#x4FEE;&#x6539;&#x70BA;&#x5B83;&#x672C;&#x8EAB;&#x6240;&#x5728;&#x7684;&#x5730;&#x5740;&#x518D;&#x52A0;&#x4E0A;&#x5169;&#x500B;&#x55AE;&#x4F4D;&#x3002;
&#x9996;&#x5148;&#x9700;&#x8981;&#x6C42;&#x51FA; <code>ret</code> &#x672C;&#x8EAB;&#x6240;&#x5728;&#x7684;&#x4F4D;&#x7F6E;&#xFF0C;&#x56E0;&#x70BA; <code>ret</code> &#x662F;&#x51FD;&#x6578;&#x7684;&#x4E00;&#x500B;&#x5C40;&#x90E8;&#x8B8A;&#x91CF;&#xFF0C;&#x5B83;&#x5728;&#x68E7;&#x4E2D;&#x504F;&#x68E7;&#x9802;&#x7684;&#x5730;&#x65B9;&#x3002;
&#x7136;&#x5F8C;&#x5462;&#xFF1F;&#x518D;&#x589E;&#x52A0;&#x5169;&#x500B;&#x55AE;&#x4F4D;&#xFF0C;&#x9019;&#x500B;&#x55AE;&#x4F4D;&#x662F; <code>sizeof(int)</code>&#xFF0C;&#x5373; 4 &#x500B;&#x5B57;&#x7BC0;&#x3002;&#x9019;&#x6A23;&#xFF0C;&#x65B0;&#x7684; <code>ret</code> &#x5C31;&#x662F; <code>ret</code> &#x6240;&#x5728;&#x7684;&#x4F4D;&#x7F6E;&#x52A0;&#x4E0A; 8 &#x500B;&#x5B57;&#x7BC0;&#xFF0C;&#x5373;&#x5F80;&#x68E7;&#x5E95;&#x65B9;&#x5411;&#x504F;&#x79FB; 8 &#x500B;&#x5B57;&#x7BC0;&#x7684;&#x4F4D;&#x7F6E;&#x3002;&#x5C0D;&#x65BC;&#x6211;&#x5011;&#x4E4B;&#x524D;&#x5206;&#x6790;&#x7684; <code>Shellcode</code>&#xFF0C;&#x90A3;&#x88E1;&#x61C9;&#x8A72;&#x662F; <code>edi</code>&#xFF0C;&#x4F46;&#x5BE6;&#x969B;&#x4E0A;&#x9019;&#x88E1;&#x4E26;&#x4E0D;&#x662F; <code>edi</code>&#xFF0C;&#x53EF;&#x80FD;&#x662F; <code>gcc</code> &#x5728;&#x7DE8;&#x8B6F;&#x7A0B;&#x5E8F;&#x6642;&#x6709;&#x4E0D;&#x540C;&#x7684;&#x8655;&#x7406;&#xFF0C;&#x9019;&#x88E1;&#x5BE6;&#x969B;&#x4E0A;&#x525B;&#x597D;&#x662F; <code>eip</code>&#xFF0C;&#x5373;&#x57F7;&#x884C;&#x9019;&#x689D;&#x8A9E;&#x53E5;&#x4E4B;&#x5F8C; <code>ret</code> &#x7684;&#x503C;&#x8B8A;&#x6210;&#x4E86; <code>eip</code> &#x6240;&#x5728;&#x7684;&#x4F4D;&#x7F6E;&#x3002;</p>
<pre><code>(*ret) = (int)shellcode;
</code></pre><p>&#x7531;&#x65BC;&#x4E4B;&#x524D; <code>ret</code> &#x5DF2;&#x7D93;&#x88AB;&#x4FEE;&#x6539;&#x70BA;&#x4E86; <code>eip</code> &#x6240;&#x5728;&#x7684;&#x4F4D;&#x7F6E;&#xFF0C;&#x9019;&#x6A23;&#x5C0D; <code>(*ret)</code> &#x8CE6;&#x503C;&#x5C31;&#x6703;&#x4FEE;&#x6539; <code>eip</code> &#x7684;&#x503C;&#xFF0C;&#x5373;&#x4E0B;&#x4E00;&#x689D;&#x6307;&#x4EE4;&#x7684;&#x5730;&#x5740;&#xFF0C;&#x9019;&#x88E1;&#x628A; <code>eip</code> &#x4FEE;&#x6539;&#x70BA;&#x4E86; <code>Shellcode</code> &#x7684;&#x5165;&#x53E3;&#x3002;&#x56E0;&#x6B64;&#xFF0C;&#x7576;&#x51FD;&#x6578;&#x8FD4;&#x56DE;&#x6642;&#x76F4;&#x63A5;&#x53BB;&#x57F7;&#x884C; <code>Shellcode</code> &#x88E1;&#x982D;&#x7684;&#x4EE3;&#x78BC;&#xFF0C;&#x4E26;&#x6253;&#x5370;&#x4E86; <code>Hello World</code> &#x3002;</p>
<p>&#x7528; <code>gdb</code> &#x8ABF;&#x8A66;&#x4E00;&#x4E0B;&#x770B;&#x770B;&#x76F8;&#x95DC;&#x8B8A;&#x91CF;&#x7684;&#x503C;&#x7684;&#x60C5;&#x6CC1;&#x3002;&#x9019;&#x88E1;&#x4E3B;&#x8981;&#x95DC;&#x5FC3; <code>ret</code> &#x672C;&#x8EAB;&#x3002; <code>ret</code> &#x672C;&#x8EAB;&#x662F;&#x4E00;&#x500B;&#x5730;&#x5740;&#xFF0C;&#x9996;&#x5148;&#x5B83;&#x6240;&#x5728;&#x7684;&#x4F4D;&#x7F6E;&#x8B8A;&#x6210;&#x4E86; <code>EIP</code> &#x6240;&#x5728;&#x7684;&#x4F4D;&#x7F6E;&#xFF08;&#x628A;&#x5B83;&#x81EA;&#x5DF1;&#x6240;&#x5728;&#x7684;&#x4F4D;&#x7F6E;&#x52A0;&#x4E0A; <code>2*4</code> &#x4EE5;&#x5F8C;&#x8CE6;&#x65BC;&#x81EA;&#x5DF1;&#xFF09;&#xFF0C;&#x7136;&#x5F8C;&#xFF0C;<code>EIP</code> &#x53C8;&#x6307;&#x5411;&#x4E86; <code>Shellcode</code> &#x8655;&#x7684;&#x4EE3;&#x78BC;&#x3002;</p>
<pre><code>$ gcc -g -o testshellcode testshellcode.c
$ gdb ./testshellcode
...
(gdb) l
8       void callshellcode(void)
9       {
10         int *ret;
11         ret = (int *)&amp;ret + 2;
12         (*ret) = (int)shellcode;
13      }
14
15      int main()
16      {
17              callshellcode();
(gdb) break 17
Breakpoint 1 at 0x804834d: file testshell.c, line 17.
(gdb) break 11
Breakpoint 2 at 0x804832a: file testshell.c, line 11.
(gdb) break 12
Breakpoint 3 at 0x8048333: file testshell.c, line 12.
(gdb) break 13
Breakpoint 4 at 0x804833d: file testshell.c, line 13.
(gdb) r
Starting program: /mnt/hda8/Temp/c/program/testshell

Breakpoint 1, main () at testshell.c:17
17              callshellcode();
(gdb) print $ebp       #&#x6253;&#x5370;ebp&#x5BC4;&#x5B58;&#x5668;&#x88E1;&#x7684;&#x503C;
$1 = (void *) 0xbfcfd2c8
(gdb) disassemble main
...
0x0804834d &lt;main+14&gt;:   call   0x8048324 &lt;callshellcode&gt;
0x08048352 &lt;main+19&gt;:   mov    $0x0,%eax
...
(gdb) n

Breakpoint 2, callshellcode () at testshell.c:11
11         ret = (int *)&amp;ret + 2;
(gdb) x/6x $esp
0xbfcfd2ac:     0x08048389      0xb7f4eff4      0xbfcfd36c      0xbfcfd2d8
0xbfcfd2bc:     0xbfcfd2c8      0x08048352
(gdb) print &amp;ret #&#x5206;&#x5225;&#x6253;&#x5370;&#x51FA;ret&#x6240;&#x5728;&#x7684;&#x5730;&#x5740;&#x548C;ret&#x7684;&#x503C;&#xFF0C;&#x525B;&#x597D;&#x5728;ebp&#x4E4B;&#x4E0A;&#xFF0C;&#x6211;&#x5011;&#x767C;&#x73FE;&#x9019;&#x88E1;&#x4E26;&#x6C92;&#x6709;
       #&#x4E4B;&#x524D;&#x7684;testshellcode&#x4EE3;&#x78BC;&#x4E2D;&#x7684;edi&#x548C;esi&#xFF0C;&#x53EF;&#x80FD;&#x662F;gcc&#x5728;&#x5F59;&#x7DE8;&#x7684;&#x6642;&#x5019;&#x6709;&#x4E0D;&#x540C;&#x8655;&#x7406;&#x3002;
$2 = (int **) 0xbfcfd2b8
(gdb) print ret
$3 = (int *) 0xbfcfd2d8 #&#x9019;&#x88E1;&#x7684;ret&#x662F;&#x500B;&#x96A8;&#x6A5F;&#x503C;
(gdb) n

Breakpoint 3, callshellcode () at testshell.c:12
12         (*ret) = (int)shellcode;
(gdb) print ret   #&#x57F7;&#x884C;&#x5B8C;ret = (int *)&amp;ret + 2;&#x5F8C;&#xFF0C;ret&#x8B8A;&#x6210;&#x4E86;&#x81EA;&#x5DF1;&#x5730;&#x5740;&#x52A0;&#x4E0A;2*4&#xFF0C;
                  #&#x525B;&#x597D;&#x662F;eip&#x6240;&#x5728;&#x7684;&#x4F4D;&#x7F6E;&#x3002;
$5 = (int *) 0xbfcfd2c0
(gdb) x/6x $esp
0xbfcfd2ac:     0x08048389      0xb7f4eff4      0xbfcfd36c      0xbfcfd2c0
0xbfcfd2bc:     0xbfcfd2c8      0x08048352
(gdb) x/4x *ret  #&#x6B64;&#x6642;*ret&#x525B;&#x597D;&#x70BA;eip&#xFF0C;0x8048352
0x8048352 &lt;main+19&gt;:    0x000000b8      0x8d5d5900      0x90c3fc61      0x89559090
(gdb) n

Breakpoint 4, callshellcode () at testshell.c:13
13      }
(gdb) x/6x $esp #&#x73FE;&#x5728;eip&#x88AB;&#x4FEE;&#x6539;&#x70BA;&#x4E86;shellcode&#x7684;&#x5165;&#x53E3;
0xbfcfd2ac:     0x08048389      0xb7f4eff4      0xbfcfd36c      0xbfcfd2c0
0xbfcfd2bc:     0xbfcfd2c8      0x8049560
(gdb) x/4x *ret  #&#x73FE;&#x5728;&#x4FEE;&#x6539;&#x4E86;(*ret)&#x7684;&#x503C;&#xFF0C;&#x5373;&#x4FEE;&#x6539;&#x4E86;eip&#x7684;&#x503C;&#xFF0C;&#x4F7F;eip&#x6307;&#x5411;&#x4E86;shellcode
0x8049560 &lt;shellcode&gt;:  0xb85e20eb      0x00000004      0x000002bb      0xbaf18900
</code></pre><p>&#x4E0A;&#x9762;&#x7684;&#x904E;&#x7A0B;&#x5F88;&#x96E3;&#x5F04;&#xFF0C;&#x5475;&#x5475;&#x3002;&#x4E3B;&#x8981;&#x662F;&#x6307;&#x91DD;&#x4E0D;&#x5927;&#x597D;&#x7406;&#x89E3;&#xFF0C;&#x5982;&#x679C;&#x76F4;&#x63A5;&#x628A;&#x5B83;&#x7576;&#x5730;&#x5740;&#x7E6A;&#x51FA;&#x4E0B;&#x9762;&#x7684;&#x5716;&#x53EF;&#x80FD;&#x6703;&#x5BB9;&#x6613;&#x7406;&#x89E3;&#x4E00;&#x4E9B;&#x3002;</p>
<p>callshellcode&#x68E7;&#x7684;&#x521D;&#x59CB;&#x5206;&#x4F48;&#xFF1A;</p>
<pre><code>ret=(int *)&amp;ret+2=0xbfcfd2bc+2*4=0xbfcfd2c0
0xbfcfd2b8      ret(&#x96A8;&#x6A5F;&#x503C;)                     0xbfcfd2c0
0xbfcfd2bc      ebp(&#x9019;&#x88E1;&#x4E0D;&#x95DC;&#x5FC3;)
0xbfcfd2c0      eip(0x08048352)         eip(0x8049560 )

(*ret) = (int)shellcode;&#x5373;eip=0x8049560
</code></pre><p>&#x7E3D;&#x4E4B;&#xFF0C;&#x6700;&#x5F8C;&#x9AD4;&#x73FE;&#x70BA;&#x51FD;&#x6578;&#x8ABF;&#x7528;&#x7684;&#x4E0B;&#x4E00;&#x689D;&#x6307;&#x4EE4;&#x6307;&#x91DD;&#xFF08;<code>eip</code>&#xFF09;&#x88AB;&#x4FEE;&#x6539;&#x70BA;&#x4E00;&#x6BB5;&#x6CE8;&#x5165;&#x4EE3;&#x78BC;&#x7684;&#x5165;&#x53E3;&#xFF0C;&#x5F9E;&#x800C;&#x4F7F;&#x5F97;&#x51FD;&#x6578;&#x8FD4;&#x56DE;&#x6642;&#x57F7;&#x884C;&#x4E86;&#x6CE8;&#x5165;&#x4EE3;&#x78BC;&#x3002;</p>
<p><span id="toc_14869_27504_21"></span></p>
<h3 id="%E7%B7%A9%E8%A1%9D%E5%8D%80%E6%B3%A8%E5%85%A5%E8%88%87%E9%98%B2%E7%AF%84">&#x7DE9;&#x885D;&#x5340;&#x6CE8;&#x5165;&#x8207;&#x9632;&#x7BC4;</h3>
<p>&#x9019;&#x500B;&#x7A0B;&#x5E8F;&#x88E1;&#x982D;&#x7684;&#x6CE8;&#x5165;&#x4EE3;&#x78BC;&#x548C;&#x88AB;&#x6CE8;&#x5165;&#x7A0B;&#x5E8F;&#x7ADF;&#x7136;&#x662F;&#x4E00;&#x500B;&#x7A0B;&#x5E8F;&#xFF0C;&#x50BB;&#x74DC;&#x624D;&#x81EA;&#x5DF1;&#x653B;&#x64CA;&#x81EA;&#x5DF1;&#xFF08;&#x4E0D;&#x904E;&#x6709;&#x4E9B;&#x9ED1;&#x5BA2;&#x6709;&#x53EF;&#x80FD;&#x5229;&#x7528;&#x7A0B;&#x5E8F;&#x4E2D;&#x4E00;&#x4E9B;&#x7A7A;&#x9592;&#x7A7A;&#x9593;&#x6CE8;&#x5165;&#x4EE3;&#x78BC;&#x54E6;&#xFF09;&#xFF0C;&#x771F;&#x6B63;&#x7684;&#x7DE9;&#x885D;&#x5340;&#x6CE8;&#x5165;&#x7A0B;&#x5E8F;&#x662F;&#x5206;&#x958B;&#x7684;&#xFF0C;&#x6BD4;&#x5982;&#x4F5C;&#x70BA;&#x88AB;&#x6CE8;&#x5165;&#x7A0B;&#x5E8F;&#x7684;&#x4E00;&#x500B;&#x5B57;&#x7B26;&#x4E32;&#x53C3;&#x6578;&#x3002;&#x800C;&#x5728;&#x88AB;&#x6CE8;&#x5165;&#x7A0B;&#x5E8F;&#x4E2D;&#x525B;&#x597D;&#x6C92;&#x6709;&#x505A;&#x5B57;&#x7B26;&#x4E32;&#x9577;&#x5EA6;&#x7684;&#x9650;&#x5236;&#xFF0C;&#x5F9E;&#x800C;&#x8B93;&#x9019;&#x6BB5;&#x5B57;&#x7B26;&#x4E32;&#x4E2D;&#x7684;&#x4E00;&#x90E8;&#x5206;&#x4FEE;&#x6539;&#x4E86; <code>eip</code>&#xFF0C;&#x53E6;&#x5916;&#x4E00;&#x90E8;&#x5206;&#x4F5C;&#x70BA;&#x6CE8;&#x5165;&#x4EE3;&#x78BC;&#x904B;&#x884C;&#x4E86;&#xFF0C;&#x5F9E;&#x800C;&#x5BE6;&#x73FE;&#x4E86;&#x6CE8;&#x5165;&#x7684;&#x76EE;&#x7684;&#x3002;&#x4E0D;&#x904E;&#x9019;&#x6703;&#x6D89;&#x53CA;&#x5230;&#x4E00;&#x4E9B;&#x6280;&#x5DE7;&#xFF0C;&#x5373;&#x5982;&#x4F55;&#x525B;&#x597D;&#x7528;&#x6CE8;&#x5165;&#x4EE3;&#x78BC;&#x7684;&#x5165;&#x53E3;&#x5730;&#x5740;&#x4F86;&#x4FEE;&#x6539; <code>eip</code> &#xFF08;&#x5373;&#x65B0;&#x7684; <code>eip</code> &#x80FD;&#x5920;&#x6307;&#x5411;&#x6CE8;&#x5165;&#x4EE3;&#x78BC;&#xFF09;&#xFF1F;&#x5982;&#x679C; <code>eip</code> &#x7684;&#x4F4D;&#x7F6E;&#x548C;&#x7DE9;&#x885D;&#x5340;&#x7684;&#x4F4D;&#x7F6E;&#x4E4B;&#x9593;&#x7684;&#x8DDD;&#x96E2;&#x662F;&#x78BA;&#x5B9A;&#xFF0C;&#x90A3;&#x9EBC;&#x5C31;&#x6BD4;&#x8F03;&#x597D;&#x8655;&#x7406;&#x4E86;&#xFF0C;&#x4F46;&#x5F9E;&#x4E0A;&#x9762;&#x7684;&#x5169;&#x500B;&#x4F8B;&#x5B50;&#x4E2D;&#x6211;&#x5011;&#x767C;&#x73FE;&#xFF0C;&#x6709;&#x4E00;&#x500B;&#x7DE8;&#x8B6F;&#x5F8C;&#x6709; <code>edi</code> &#x548C; <code>esi</code>&#xFF0C;&#x800C;&#x53E6;&#x5916;&#x4E00;&#x500B;&#x5247;&#x6C92;&#x6709;&#xFF0C;&#x53E6;&#x5916;&#xFF0C;&#x7DE9;&#x885D;&#x5340;&#x7684;&#x4F4D;&#x7F6E;&#xFF0C;&#x4EE5;&#x53CA;&#x88AB;&#x6CE8;&#x5165;&#x7A0B;&#x5E8F;&#x6709;&#x591A;&#x5C11;&#x500B;&#x53C3;&#x6578;&#x6211;&#x5011;&#x90FD;&#x7121;&#x6CD5;&#x9810;&#x77E5;&#xFF0C;&#x56E0;&#x6B64;&#xFF0C;&#x5982;&#x4F55;&#x8A08;&#x7B97; <code>eip</code> &#x6240;&#x5728;&#x7684;&#x4F4D;&#x7F6E;&#x5462;&#xFF1F;&#x9019;&#x4E5F;&#x6703;&#x5F88;&#x96E3;&#x78BA;&#x5B9A;&#x3002;&#x9084;&#x6709;&#xFF0C;&#x70BA;&#x4E86;&#x9632;&#x6B62;&#x7DE9;&#x885D;&#x5340;&#x6EA2;&#x51FA;&#x5E36;&#x4F86;&#x7684;&#x6CE8;&#x5165;&#x554F;&#x984C;&#xFF0C;&#x73FE;&#x5728;&#x7684;&#x64CD;&#x4F5C;&#x7CFB;&#x7D71;&#x63A1;&#x53D6;&#x4E86;&#x4E00;&#x4E9B;&#x8FA6;&#x6CD5;&#xFF0C;&#x6BD4;&#x5982;&#x8B93; <code>esp</code> &#x96A8;&#x6A5F;&#x8B8A;&#x5316;&#xFF08;&#x6BD4;&#x5982;&#x548C;&#x7CFB;&#x7D71;&#x6642;&#x9418;&#x95DC;&#x806F;&#x8D77;&#x4F86;&#xFF09;&#xFF0C;&#x6240;&#x4EE5;&#x9019;&#x4E9B;&#x63AA;&#x65BD;&#x5C07;&#x5C0E;&#x81F4;&#x6CE8;&#x5165;&#x66F4;&#x52A0;&#x56F0;&#x96E3;&#x3002;&#x5982;&#x679C;&#x6709;&#x8208;&#x8DA3;&#xFF0C;&#x4F60;&#x53EF;&#x4EE5;&#x63A5;&#x8457;&#x770B;&#x770B;&#x6700;&#x5F8C;&#x7684;&#x5E7E;&#x7BC7;&#x53C3;&#x8003;&#x8CC7;&#x6599;&#x4E26;&#x9032;&#x884C;&#x66F4;&#x6DF1;&#x5165;&#x7684;&#x7814;&#x7A76;&#x3002;</p>
<p>&#x9700;&#x8981;&#x63D0;&#x5230;&#x7684;&#x662F;&#xFF0C;&#x56E0;&#x70BA;&#x5F88;&#x591A;&#x7A0B;&#x5E8F;&#x53EF;&#x80FD;&#x4F7F;&#x7528; <code>strcpy &#x4F86;&#x9032;&#x884C;&#x5B57;&#x7B26;&#x4E32;&#x7684;&#x8907;&#x88FD;&#xFF0C;&#x5728;&#x5BE6;&#x969B;&#x7DE8;&#x5BEB;&#x7DE9;&#x885D;&#x5340;&#x6CE8;&#x5165;&#x4EE3;&#x78BC;&#x6642;&#xFF0C;&#x6703;&#x63A1;&#x53D6;&#x4E00;&#x5B9A;&#x7684;&#x8FA6;&#x6CD5;&#xFF08;&#x6307;&#x4EE4;&#x66FF;&#x63DB;&#xFF09;&#xFF0C;&#x628A;&#x4EE3;&#x78BC;&#x4E2D;&#x53EF;&#x80FD;&#x5305;&#x542B;&#x7684;</code>\0 &#x5B57;&#x7BC0;&#x53BB;&#x6389;&#xFF0C;&#x5F9E;&#x800C;&#x9632;&#x6B62; `strcpy &#x4E2D;&#x65B7;&#x5C0D;&#x6CE8;&#x5165;&#x4EE3;&#x78BC;&#x7684;&#x8907;&#x88FD;&#xFF0C;&#x9032;&#x800C;&#x53EF;&#x4EE5;&#x8907;&#x88FD;&#x5B8C;&#x6574;&#x7684;&#x6CE8;&#x5165;&#x4EE3;&#x78BC;&#x3002;&#x5177;&#x9AD4;&#x7684;&#x6280;&#x5DE7;&#x53EF;&#x4EE5;&#x53C3;&#x8003; <a href="http://www.ibm.com/developerworks/cn/linux/l-overflow/index.html" target="_blank">Linux&#x4E0B;&#x7DE9;&#x885D;&#x5340;&#x6EA2;&#x51FA;&#x653B;&#x64CA;&#x7684;&#x539F;&#x7406;&#x53CA;&#x5C0D;&#x7B56;</a>&#xFF0C;<a href="http://janxin.bokee.com/4067220.html" target="_blank">Shellcode&#x6280;&#x8853;&#x96DC;&#x8AC7;</a>&#xFF0C;<a href="http://virus.bartolich.at/virus-writing-HOWTO/_html/" target="_blank">virus-writing-HOWTO</a>&#x3002;</p>
<p><span id="toc_14869_27504_22"></span></p>
<h2 id="%E5%BE%8C%E8%A8%98">&#x5F8C;&#x8A18;</h2>
<p>&#x5BE6;&#x969B;&#x4E0A;&#x7DE9;&#x885D;&#x5340;&#x6EA2;&#x51FA;&#x61C9;&#x8A72;&#x662F;&#x8A9E;&#x6CD5;&#x548C;&#x908F;&#x8F2F;&#x65B9;&#x9762;&#x7684;&#x96D9;&#x91CD;&#x554F;&#x984C;&#xFF0C;&#x7531;&#x65BC;&#x8A9E;&#x6CD5;&#x4E0A;&#x7684;&#x4E0D;&#x56B4;&#x683C;&#xFF08;&#x5C0D;&#x6578;&#x7D44;&#x908A;&#x754C;&#x6C92;&#x6709;&#x6AA2;&#x67E5;&#xFF09;&#x5C0E;&#x81F4;&#x908F;&#x8F2F;&#x4E0A;&#x53EF;&#x80FD;&#x51FA;&#x73FE;&#x56B4;&#x91CD;&#x7F3A;&#x9677;&#xFF08;&#x7A0B;&#x5E8F;&#x57F7;&#x884C;&#x884C;&#x70BA;&#x88AB;&#x6539;&#x8B8A;&#xFF09;&#x3002;&#x53E6;&#x5916;&#xFF0C;&#x9019;&#x985E;&#x554F;&#x984C;&#x662F;&#x5C0D;&#x7A0B;&#x5E8F;&#x904B;&#x884C;&#x904E;&#x7A0B;&#x4E2D;&#x7684;&#x7A0B;&#x5E8F;&#x6620;&#x50CF;&#x7684;&#x68E7;&#x5340;&#x9032;&#x884C;&#x6CE8;&#x5165;&#x3002;&#x5BE6;&#x969B;&#x4E0A;&#x9664;&#x6B64;&#x4E4B;&#x5916;&#xFF0C;&#x7A0B;&#x5E8F;&#x5728;&#x5B89;&#x5168;&#x65B9;&#x9762;&#x9084;&#x6709;&#x5F88;&#x591A;&#x985E;&#x4F3C;&#x7684;&#x554F;&#x984C;&#x3002;&#x6BD4;&#x5982;&#xFF0C;&#x96D6;&#x7136;&#x7A0B;&#x5E8F;&#x6620;&#x50CF;&#x7684;&#x6B63;&#x6587;&#x5340;&#x53D7;&#x5230;&#x7CFB;&#x7D71;&#x4FDD;&#x8B77;&#xFF08;&#x53EA;&#x8B80;&#xFF09;&#xFF0C;&#x4F46;&#x662F;&#x5982;&#x679C;&#x5167;&#x5B58;&#xFF08;&#x786C;&#x4EF6;&#x672C;&#x8EAB;&#xFF0C;&#x5167;&#x5B58;&#x689D;&#xFF09;&#x51FA;&#x73FE;&#x6545;&#x969C;&#xFF0C;&#x5728;&#x7A0B;&#x5E8F;&#x904B;&#x884C;&#x7684;&#x904E;&#x7A0B;&#x4E2D;&#xFF0C;&#x7A0B;&#x5E8F;&#x6620;&#x50CF;&#x7684;&#x6B63;&#x6587;&#x5340;&#x7684;&#x67D0;&#x4E9B;&#x5B57;&#x7BC0;&#x5C31;&#x53EF;&#x80FD;&#x88AB;&#x4FEE;&#x6539;&#x4E86;&#xFF0C;&#x4E5F;&#x53EF;&#x80FD;&#x767C;&#x751F;&#x975E;&#x5E38;&#x56B4;&#x91CD;&#x7684;&#x5F8C;&#x679C;&#xFF0C;&#x56E0;&#x6B64;&#x7A0B;&#x5E8F;&#x904B;&#x884C;&#x904E;&#x7A0B;&#x7684;&#x6B63;&#x6587;&#x5340;&#x6AA2;&#x67E5;&#x7B49;&#x53EF;&#x80FD;&#x7684;&#x624B;&#x6BB5;&#x9700;&#x8981;&#x88AB;&#x5F15;&#x5165;&#x3002;</p>
<p><span id="toc_14869_27504_23"></span></p>
<h2 id="%E5%8F%83%E8%80%83%E8%B3%87%E6%96%99">&#x53C3;&#x8003;&#x8CC7;&#x6599;</h2>
<ul>
<li>Playing with ptrace<ul>
<li><a href="http://www.linuxjournal.com/article/6100" target="_blank">how ptrace can be used to trace system calls and change system call arguments</a></li>
<li><a href="http://www.linuxjournal.com/node/6210/print" target="_blank">setting breakpoints and injecting code into running programs</a></li>
<li><a href="http://www.ecos.sourceware.org/ml/libc-hacker/1998-05/msg00277.html" target="_blank">fix the problem of ORIG_EAX not defined</a></li>
</ul>
</li>
<li><a href="http://book.csdn.net/bookfiles/228/index.html" target="_blank">&#x300A;&#x7DE9;&#x885D;&#x5340;&#x6EA2;&#x51FA;&#x653B;&#x64CA;&#x2014;&#x2014; &#x6AA2;&#x6E2C;&#x3001;&#x5256;&#x6790;&#x8207;&#x9810;&#x9632;&#x300B;&#x7B2C;&#x4E94;&#x7AE0;</a></li>
<li><a href="http://www.ibm.com/developerworks/cn/linux/l-overflow/index.html" target="_blank">Linux&#x4E0B;&#x7DE9;&#x885D;&#x5340;&#x6EA2;&#x51FA;&#x653B;&#x64CA;&#x7684;&#x539F;&#x7406;&#x53CA;&#x5C0D;&#x7B56;</a></li>
<li><a href="http://www.ibm.com/developerworks/cn/linux/l-assembly/index.html" target="_blank">Linux &#x5F59;&#x7DE8;&#x8A9E;&#x8A00;&#x958B;&#x767C;&#x6307;&#x5357;</a></li>
<li><a href="http://janxin.bokee.com/4067220.html" target="_blank">Shellcode &#x6280;&#x8853;&#x96DC;&#x8AC7;</a></li>
</ul>

                    
                    </section>
                
                
                </div>
            </div>
        </div>

        
        <a href="../../zh/chapters/02-chapter4.html" class="navigation navigation-prev " aria-label="Previous page: 動態符號鏈接的細節"><i class="fa fa-angle-left"></i></a>
        
        
        <a href="../../zh/chapters/02-chapter6.html" class="navigation navigation-next " aria-label="Next page: 進程的內存映像"><i class="fa fa-angle-right"></i></a>
        
    </div>
</div>

        
<script src="../../gitbook/app.js"></script>

    
    <script src="../../gitbook/plugins/gitbook-plugin-google_code_prettify/google-code-prettify.js"></script>
    

    
    <script src="../../gitbook/plugins/gitbook-plugin-google_code_prettify/plugin.js"></script>
    

    
    <script src="../../gitbook/plugins/gitbook-plugin-collapsible-menu/plugin.js"></script>
    

    
    <script src="../../gitbook/plugins/gitbook-plugin-livereload/plugin.js"></script>
    

    
    <script src="../../gitbook/plugins/gitbook-plugin-maxiang/maxiang.js"></script>
    

<script>
require(["gitbook"], function(gitbook) {
    var config = {"fontSettings":{"theme":null,"family":"sans","size":2}};
    gitbook.start(config);
});
</script>

        <!-- body:end -->
    </body>
    <!-- End of book C 語言編程透視 -->
</html>
