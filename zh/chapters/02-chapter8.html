<!DOCTYPE HTML>
<html lang="en" >
    <!-- Start book C 語言編程透視 -->
    <head>
        <!-- head:start -->
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <title>打造史上最小可執行ELF文件(45字節) | C 語言編程透視</title>
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="generator" content="GitBook 2.1.0">
        
        
        <meta name="HandheldFriendly" content="true"/>
        <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
        <meta name="apple-mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-status-bar-style" content="black">
        <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../../gitbook/images/apple-touch-icon-precomposed-152.png">
        <link rel="shortcut icon" href="../../gitbook/images/favicon.ico" type="image/x-icon">
        
    <link rel="stylesheet" href="../../gitbook/style.css">
    
        
        <link rel="stylesheet" href="../../gitbook/plugins/gitbook-plugin-google_code_prettify/google-code-prettify.css">
        
    
        
        <link rel="stylesheet" href="../../gitbook/plugins/gitbook-plugin-maxiang/maxiang.css">
        
    
    

        
    
    
    <link rel="next" href="../../zh/chapters/02-chapter9.html" />
    
    
    <link rel="prev" href="../../zh/chapters/02-chapter7.html" />
    

        <!-- head:end -->
    </head>
    <body>
        <!-- body:start -->
        
    <div class="book" data-level="10" data-basepath="../.." data-revision="Wed Sep 02 2015 19:26:26 GMT+0800 (CST)">
    

<div class="book-summary">
    <div class="book-search">
        <input type="text" placeholder="Type to search" class="form-control" />
    </div>
    <ul class="summary">
        
        
        
        

        

        
    
        <li class="chapter " data-level="0" data-path="index.html">
            
                
                    <a href="../../index.html">
                        <i class="fa fa-check"></i>
                        
                        Introduction
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="1" data-path="zh/preface/01-chapter0.html">
            
                
                    <a href="../../zh/preface/01-chapter0.html">
                        <i class="fa fa-check"></i>
                        
                            <b>1.</b>
                        
                        版本修訂歷史
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="2" data-path="zh/preface/01-chapter1.html">
            
                
                    <a href="../../zh/preface/01-chapter1.html">
                        <i class="fa fa-check"></i>
                        
                            <b>2.</b>
                        
                        前言
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="3" data-path="zh/chapters/02-chapter1.html">
            
                
                    <a href="../../zh/chapters/02-chapter1.html">
                        <i class="fa fa-check"></i>
                        
                            <b>3.</b>
                        
                        把 Vim 打造成源代碼編輯器
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="4" data-path="zh/chapters/02-chapter2.html">
            
                
                    <a href="../../zh/chapters/02-chapter2.html">
                        <i class="fa fa-check"></i>
                        
                            <b>4.</b>
                        
                        Gcc 編譯的背後
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="5" data-path="zh/chapters/02-chapter3.html">
            
                
                    <a href="../../zh/chapters/02-chapter3.html">
                        <i class="fa fa-check"></i>
                        
                            <b>5.</b>
                        
                        程序執行的一剎那
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="6" data-path="zh/chapters/02-chapter4.html">
            
                
                    <a href="../../zh/chapters/02-chapter4.html">
                        <i class="fa fa-check"></i>
                        
                            <b>6.</b>
                        
                        動態符號鏈接的細節
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="7" data-path="zh/chapters/02-chapter5.html">
            
                
                    <a href="../../zh/chapters/02-chapter5.html">
                        <i class="fa fa-check"></i>
                        
                            <b>7.</b>
                        
                        緩衝區溢出與注入分析
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="8" data-path="zh/chapters/02-chapter6.html">
            
                
                    <a href="../../zh/chapters/02-chapter6.html">
                        <i class="fa fa-check"></i>
                        
                            <b>8.</b>
                        
                        進程的內存映像
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="9" data-path="zh/chapters/02-chapter7.html">
            
                
                    <a href="../../zh/chapters/02-chapter7.html">
                        <i class="fa fa-check"></i>
                        
                            <b>9.</b>
                        
                        進程和進程的基本操作
                    </a>
                
            
            
        </li>
    
        <li class="chapter active" data-level="10" data-path="zh/chapters/02-chapter8.html">
            
                
                    <a href="../../zh/chapters/02-chapter8.html">
                        <i class="fa fa-check"></i>
                        
                            <b>10.</b>
                        
                        打造史上最小可執行ELF文件(45字節)
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="11" data-path="zh/chapters/02-chapter9.html">
            
                
                    <a href="../../zh/chapters/02-chapter9.html">
                        <i class="fa fa-check"></i>
                        
                            <b>11.</b>
                        
                        代碼測試、調試與優化
                    </a>
                
            
            
        </li>
    


        
        <li class="divider"></li>
        <li>
            <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
                Published with GitBook
            </a>
        </li>
        
    </ul>
</div>

    <div class="book-body">
        <div class="body-inner">
            <div class="book-header">
    <!-- Actions Left -->
    <a href="#" class="btn pull-left toggle-summary" aria-label="Table of Contents"><i class="fa fa-align-justify"></i></a>
    <a href="#" class="btn pull-left toggle-search" aria-label="Search"><i class="fa fa-search"></i></a>
    
    <div id="font-settings-wrapper" class="dropdown pull-left">
        <a href="#" class="btn toggle-dropdown" aria-label="Font Settings"><i class="fa fa-font"></i>
        </a>
        <div class="dropdown-menu font-settings">
    <div class="dropdown-caret">
        <span class="caret-outer"></span>
        <span class="caret-inner"></span>
    </div>

    <div class="buttons">
        <button type="button" id="reduce-font-size" class="button size-2">A</button>
        <button type="button" id="enlarge-font-size" class="button size-2">A</button>
    </div>

    <div class="buttons font-family-list">
        <button type="button" data-font="0" class="button">Serif</button>
        <button type="button" data-font="1" class="button">Sans</button>
    </div>

    <div class="buttons color-theme-list">
        <button type="button" id="color-theme-preview-0" class="button size-3" data-theme="0">White</button>
        <button type="button" id="color-theme-preview-1" class="button size-3" data-theme="1">Sepia</button>
        <button type="button" id="color-theme-preview-2" class="button size-3" data-theme="2">Night</button>
    </div>
</div>

    </div>

    <!-- Actions Right -->
    
    <div class="dropdown pull-right">
        <a href="#" class="btn toggle-dropdown" aria-label="Share"><i class="fa fa-share-alt"></i>
        </a>
        <div class="dropdown-menu font-settings dropdown-left">
            <div class="dropdown-caret">
                <span class="caret-outer"></span>
                <span class="caret-inner"></span>
            </div>
            <div class="buttons">
                <button type="button" data-sharing="twitter" class="button">
                    Share on Twitter
                </button>
                <button type="button" data-sharing="google-plus" class="button">
                    Share on Google
                </button>
                <button type="button" data-sharing="facebook" class="button">
                    Share on Facebook
                </button>
                <button type="button" data-sharing="weibo" class="button">
                    Share on Weibo
                </button>
                <button type="button" data-sharing="instapaper" class="button">
                    Share on Instapaper
                </button>
            </div>
        </div>
    </div>
    

    
    <a href="#" target="_blank" class="btn pull-right google-plus-sharing-link sharing-link" data-sharing="google-plus" aria-label="Google"><i class="fa fa-google-plus"></i></a>
    
    
    <a href="#" target="_blank" class="btn pull-right facebook-sharing-link sharing-link" data-sharing="facebook" aria-label="Facebook"><i class="fa fa-facebook"></i></a>
    
    
    <a href="#" target="_blank" class="btn pull-right twitter-sharing-link sharing-link" data-sharing="twitter" aria-label="Twitter"><i class="fa fa-twitter"></i></a>
    
    
    


    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href="../../" >C 語言編程透視</a>
    </h1>
</div>

            <div class="page-wrapper" tabindex="-1">
                <div class="page-inner">
                
                
                    <section class="normal" id="section-">
                    
                        <h1 id="%E6%89%93%E9%80%A0%E5%8F%B2%E4%B8%8A%E6%9C%80%E5%B0%8F%E5%8F%AF%E5%9F%B7%E8%A1%8C-elf-%E6%96%87%E4%BB%B6%EF%BC%8845-%E5%AD%97%E7%AF%80%EF%BC%8C%E5%8F%AF%E6%89%93%E5%8D%B0%E5%AD%97%E7%AC%A6%E4%B8%B2%EF%BC%89">&#x6253;&#x9020;&#x53F2;&#x4E0A;&#x6700;&#x5C0F;&#x53EF;&#x57F7;&#x884C; ELF &#x6587;&#x4EF6;&#xFF08;45 &#x5B57;&#x7BC0;&#xFF0C;&#x53EF;&#x6253;&#x5370;&#x5B57;&#x7B26;&#x4E32;&#xFF09;</h1>
<ul>
<li><a href="#toc_3928_6176_1">&#x524D;&#x8A00;</a></li>
<li><a href="#toc_3928_6176_2">&#x53EF;&#x57F7;&#x884C;&#x6587;&#x4EF6;&#x683C;&#x5F0F;&#x7684;&#x9078;&#x53D6;</a></li>
<li><a href="#toc_3928_6176_3">&#x93C8;&#x63A5;&#x512A;&#x5316;</a></li>
<li><a href="#toc_3928_6176_4">&#x53EF;&#x57F7;&#x884C;&#x6587;&#x4EF6;&#x201C;&#x6E1B;&#x80A5;&#x201D;&#x5BE6;&#x4F8B;&#xFF08;&#x5F9E;6442&#x5230;708&#x5B57;&#x7BC0;&#xFF09;</a><ul>
<li><a href="#toc_3928_6176_5">&#x7CFB;&#x7D71;&#x9ED8;&#x8A8D;&#x7DE8;&#x8B6F;</a></li>
<li><a href="#toc_3928_6176_6">&#x4E0D;&#x63A1;&#x7528;&#x9ED8;&#x8A8D;&#x7DE8;&#x8B6F;</a></li>
<li><a href="#toc_3928_6176_7">&#x522A;&#x9664;&#x5C0D;&#x7A0B;&#x5E8F;&#x904B;&#x884C;&#x6C92;&#x6709;&#x5F71;&#x97FF;&#x7684;&#x7BC0;&#x5340;</a></li>
<li><a href="#toc_3928_6176_8">&#x522A;&#x9664;&#x53EF;&#x57F7;&#x884C;&#x6587;&#x4EF6;&#x7684;&#x7BC0;&#x5340;&#x8868;</a></li>
</ul>
</li>
<li><a href="#toc_3928_6176_9">&#x7528;&#x532F;&#x7DE8;&#x8A9E;&#x8A00;&#x4F86;&#x91CD;&#x5BEB; Hello World&#xFF08;76&#x5B57;&#x7BC0;&#xFF09;</a><ul>
<li><a href="#toc_3928_6176_10">&#x63A1;&#x7528;&#x9ED8;&#x8A8D;&#x7DE8;&#x8B6F;</a></li>
<li><a href="#toc_3928_6176_11">&#x522A;&#x9664;&#x6389;&#x5F59;&#x7DE8;&#x4EE3;&#x78BC;&#x4E2D;&#x7121;&#x95DC;&#x7DCA;&#x8981;&#x5167;&#x5BB9;</a></li>
<li><a href="#toc_3928_6176_12">&#x4E0D;&#x9ED8;&#x8A8D;&#x7DE8;&#x8B6F;&#x4E26;&#x522A;&#x9664;&#x6389;&#x7121;&#x95DC;&#x7BC0;&#x5340;&#x548C;&#x7BC0;&#x5340;&#x8868;</a></li>
<li><a href="#toc_3928_6176_13">&#x7528;&#x7CFB;&#x7D71;&#x8ABF;&#x7528;&#x53D6;&#x4EE3;&#x5EAB;&#x51FD;&#x6578;</a></li>
<li><a href="#toc_3928_6176_14">&#x628A;&#x5B57;&#x7B26;&#x4E32;&#x4F5C;&#x70BA;&#x53C3;&#x6578;&#x8F38;&#x5165;</a></li>
<li><a href="#toc_3928_6176_15">&#x5BC4;&#x5B58;&#x5668;&#x8CE6;&#x503C;&#x91CD;&#x7528;</a></li>
<li><a href="#toc_3928_6176_16">&#x901A;&#x904E;&#x6587;&#x4EF6;&#x540D;&#x50B3;&#x905E;&#x53C3;&#x6578;</a></li>
<li><a href="#toc_3928_6176_17">&#x522A;&#x9664;&#x975E;&#x5FC5;&#x8981;&#x6307;&#x4EE4;</a></li>
</ul>
</li>
<li><a href="#toc_3928_6176_18">&#x5408;&#x4F75;&#x4EE3;&#x78BC;&#x6BB5;&#x3001;&#x7A0B;&#x5E8F;&#x982D;&#x548C;&#x6587;&#x4EF6;&#x982D;&#xFF08;52&#x5B57;&#x7BC0;&#xFF09;</a><ul>
<li><a href="#toc_3928_6176_19">&#x628A;&#x4EE3;&#x78BC;&#x6BB5;&#x79FB;&#x5165;&#x6587;&#x4EF6;&#x982D;</a></li>
<li><a href="#toc_3928_6176_20">&#x628A;&#x7A0B;&#x5E8F;&#x982D;&#x79FB;&#x5165;&#x6587;&#x4EF6;&#x982D;</a></li>
<li><a href="#toc_3928_6176_21">&#x5728;&#x975E;&#x9023;&#x7E8C;&#x7684;&#x7A7A;&#x9593;&#x63D2;&#x5165;&#x4EE3;&#x78BC;</a></li>
<li><a href="#toc_3928_6176_22">&#x628A;&#x7A0B;&#x5E8F;&#x982D;&#x5B8C;&#x5168;&#x5408;&#x5165;&#x6587;&#x4EF6;&#x982D;</a></li>
</ul>
</li>
<li><a href="#toc_3928_6176_23">&#x5F59;&#x7DE8;&#x8A9E;&#x8A00;&#x6975;&#x9650;&#x7CBE;&#x7C21;&#x4E4B;&#x9053;&#xFF08;45&#x5B57;&#x7BC0;&#xFF09;</a></li>
<li><a href="#toc_3928_6176_24">&#x5C0F;&#x7D50;</a></li>
<li><a href="#toc_3928_6176_25">&#x53C3;&#x8003;&#x8CC7;&#x6599;</a></li>
</ul>
<p><span id="toc_3928_6176_1"></span></p>
<h2 id="%E5%89%8D%E8%A8%80">&#x524D;&#x8A00;</h2>
<p>&#x672C;&#x6587;&#x5F9E;&#x6E1B;&#x5C11;&#x53EF;&#x57F7;&#x884C;&#x6587;&#x4EF6;&#x5927;&#x5C0F;&#x7684;&#x89D2;&#x5EA6;&#x5206;&#x6790;&#x4E86; <code>ELF</code> &#x6587;&#x4EF6;&#xFF0C;&#x671F;&#x9593;&#x901A;&#x904E;&#x7D93;&#x5178;&#x7684; <code>Hello World</code> &#x5BE6;&#x4F8B;&#x9010;&#x6B65;&#x6F14;&#x793A;&#x5982;&#x4F55;&#x901A;&#x904E;&#x5404;&#x7A2E;&#x5E38;&#x7528;&#x5DE5;&#x5177;&#x4F86;&#x5206;&#x6790; <code>ELF</code> &#x6587;&#x4EF6;&#xFF0C;&#x4E26;&#x9010;&#x6B65;&#x7CBE;&#x7C21;&#x4EE3;&#x78BC;&#x3002;</p>
<p>&#x70BA;&#x4E86;&#x80FD;&#x5920;&#x5118;&#x91CF;&#x6E1B;&#x5C11;&#x53EF;&#x57F7;&#x884C;&#x6587;&#x4EF6;&#x7684;&#x5927;&#x5C0F;&#xFF0C;&#x6211;&#x5011;&#x5FC5;&#x9808;&#x77AD;&#x89E3;&#x53EF;&#x57F7;&#x884C;&#x6587;&#x4EF6;&#x7684;&#x683C;&#x5F0F;&#xFF0C;&#x4EE5;&#x53CA;&#x93C8;&#x63A5;&#x751F;&#x6210;&#x53EF;&#x57F7;&#x884C;&#x6587;&#x4EF6;&#x6642;&#x7684;&#x5F8C;&#x81FA;&#x7D30;&#x7BC0;&#xFF08;&#x5373;&#x6700;&#x7D42;&#x5230;&#x5E95;&#x6709;&#x54EA;&#x4E9B;&#x5167;&#x5BB9;&#x88AB;&#x93C8;&#x63A5;&#x5230;&#x4E86;&#x76EE;&#x6A19;&#x4EE3;&#x78BC;&#x4E2D;&#xFF09;&#x3002;&#x901A;&#x904E;&#x9078;&#x64C7;&#x5408;&#x9069;&#x7684;&#x53EF;&#x57F7;&#x884C;&#x6587;&#x4EF6;&#x683C;&#x5F0F;&#x4E26;&#x5254;&#x9664;&#x5C0D;&#x53EF;&#x57F7;&#x884C;&#x6587;&#x4EF6;&#x7684;&#x6700;&#x7D42;&#x904B;&#x884C;&#x6C92;&#x6709;&#x5F71;&#x97FF;&#x7684;&#x5167;&#x5BB9;&#xFF0C;&#x5C31;&#x53EF;&#x4EE5;&#x5BE6;&#x73FE;&#x76EE;&#x6A19;&#x4EE3;&#x78BC;&#x7684;&#x88C1;&#x6E1B;&#x3002;&#x56E0;&#x6B64;&#xFF0C;&#x901A;&#x904E;&#x63A2;&#x7D22;&#x6E1B;&#x5C11;&#x53EF;&#x57F7;&#x884C;&#x6587;&#x4EF6;&#x5927;&#x5C0F;&#x7684;&#x65B9;&#x6CD5;&#xFF0C;&#x5C31;&#x76F8;&#x7576;&#x65BC;&#x5BE6;&#x8E10;&#x6027;&#x5730;&#x53BB;&#x63A2;&#x7D22;&#x4E86;&#x53EF;&#x57F7;&#x884C;&#x6587;&#x4EF6;&#x7684;&#x683C;&#x5F0F;&#x4EE5;&#x53CA;&#x93C8;&#x63A5;&#x904E;&#x7A0B;&#x7684;&#x7D30;&#x7BC0;&#x3002;</p>
<p>&#x7576;&#x7136;&#xFF0C;&#x7B97;&#x6CD5;&#x7684;&#x512A;&#x5316;&#x548C;&#x7DE8;&#x7A0B;&#x8A9E;&#x8A00;&#x7684;&#x9078;&#x64C7;&#x53EF;&#x80FD;&#x5C0D;&#x76EE;&#x6A19;&#x6587;&#x4EF6;&#x7684;&#x5927;&#x5C0F;&#x6709;&#x5F88;&#x5927;&#x7684;&#x5F71;&#x97FF;&#xFF0C;&#x5728;&#x672C;&#x6587;&#x6700;&#x5F8C;&#x6211;&#x5011;&#x6703;&#x8DDF;&#x53C3;&#x8003;&#x8CC7;&#x6599; <a href="http://www.muppetlabs.com/~breadbox/software/tiny/teensy.html" target="_blank">[1]</a> &#x7684;&#x4F5C;&#x8005;&#x90A3;&#x6A23;&#x53BB;&#x63A2;&#x6C42;&#x4E00;&#x500B;&#x6253;&#x5370; <code>Hello World</code> &#x7684;&#x53EF;&#x57F7;&#x884C;&#x6587;&#x4EF6;&#x80FD;&#x5920;&#x5C0F;&#x5230;&#x4EC0;&#x9EBC;&#x6A23;&#x7684;&#x5730;&#x6B65;&#x3002;</p>
<p><span id="toc_3928_6176_2"></span></p>
<h2 id="%E5%8F%AF%E5%9F%B7%E8%A1%8C%E6%96%87%E4%BB%B6%E6%A0%BC%E5%BC%8F%E7%9A%84%E9%81%B8%E5%8F%96">&#x53EF;&#x57F7;&#x884C;&#x6587;&#x4EF6;&#x683C;&#x5F0F;&#x7684;&#x9078;&#x53D6;</h2>
<p>&#x53EF;&#x57F7;&#x884C;&#x6587;&#x4EF6;&#x683C;&#x5F0F;&#x7684;&#x9078;&#x64C7;&#x8981;&#x6EFF;&#x8DB3;&#x7684;&#x4E00;&#x500B;&#x57FA;&#x672C;&#x689D;&#x4EF6;&#x662F;&#xFF1A;&#x76EE;&#x6A19;&#x7CFB;&#x7D71;&#x652F;&#x6301;&#x8A72;&#x53EF;&#x57F7;&#x884C;&#x6587;&#x4EF6;&#x683C;&#x5F0F;&#xFF0C;&#x8CC7;&#x6599; <a href="http://blog.chinaunix.net/u/19881/showart_215242.html" target="_blank">[2]</a> &#x5206;&#x6790;&#x548C;&#x6BD4;&#x8F03;&#x4E86; <code>UNIX</code> &#x5E73;&#x81FA;&#x4E0B;&#x7684;&#x4E09;&#x7A2E;&#x53EF;&#x57F7;&#x884C;&#x6587;&#x4EF6;&#x683C;&#x5F0F;&#xFF0C;&#x9019;&#x4E09;&#x7A2E;&#x683C;&#x5F0F;&#x5BE6;&#x969B;&#x4E0A;&#x4EE3;&#x8868;&#x8457;&#x53EF;&#x57F7;&#x884C;&#x6587;&#x4EF6;&#x7684;&#x4E00;&#x500B;&#x767C;&#x5C55;&#x904E;&#x7A0B;&#xFF1A;</p>
<ul>
<li><p>a.out &#x6587;&#x4EF6;&#x683C;&#x5F0F;&#x975E;&#x5E38;&#x7DCA;&#x6E4A;&#xFF0C;&#x53EA;&#x5305;&#x542B;&#x4E86;&#x7A0B;&#x5E8F;&#x904B;&#x884C;&#x6240;&#x5FC5;&#x9808;&#x7684;&#x4FE1;&#x606F;&#xFF08;&#x6587;&#x672C;&#x3001;&#x6578;&#x64DA;&#x3001; <code>BSS</code>&#xFF09;&#xFF0C;&#x800C;&#x4E14;&#x6BCF;&#x500B; <code>section</code> &#x7684;&#x9806;&#x5E8F;&#x662F;&#x56FA;&#x5B9A;&#x7684;&#x3002;</p>
</li>
<li><p>coff &#x6587;&#x4EF6;&#x683C;&#x5F0F;&#x96D6;&#x7136;&#x5F15;&#x5165;&#x4E86;&#x4E00;&#x500B;&#x7BC0;&#x5340;&#x8868;&#x4EE5;&#x652F;&#x6301;&#x66F4;&#x591A;&#x7BC0;&#x5340;&#x4FE1;&#x606F;&#xFF0C;&#x5F9E;&#x800C;&#x63D0;&#x9AD8;&#x4E86;&#x53EF;&#x64F4;&#x5C55;&#x6027;&#xFF0C;&#x4F46;&#x662F;&#x9019;&#x7A2E;&#x6587;&#x4EF6;&#x683C;&#x5F0F;&#x7684;&#x91CD;&#x5B9A;&#x4F4D;&#x5728;&#x93C8;&#x63A5;&#x6642;&#x5C31;&#x5DF2;&#x7D93;&#x5B8C;&#x6210;&#xFF0C;&#x56E0;&#x6B64;&#x4E0D;&#x652F;&#x6301;&#x52D5;&#x614B;&#x93C8;&#x63A5;&#xFF08;&#x4E0D;&#x904E;&#x64F4;&#x5C55;&#x7684; <code>coff</code> &#x652F;&#x6301;&#xFF09;&#x3002;</p>
</li>
<li><p>elf &#x6587;&#x4EF6;&#x683C;&#x5F0F;&#x4E0D;&#x50C5;&#x52D5;&#x614B;&#x93C8;&#x63A5;&#xFF0C;&#x800C;&#x4E14;&#x6709;&#x5F88;&#x597D;&#x7684;&#x64F4;&#x5C55;&#x6027;&#x3002;&#x5B83;&#x53EF;&#x4EE5;&#x63CF;&#x8FF0;&#x53EF;&#x91CD;&#x5B9A;&#x4F4D;&#x6587;&#x4EF6;&#x3001;&#x53EF;&#x57F7;&#x884C;&#x6587;&#x4EF6;&#x548C;&#x53EF;&#x5171;&#x4EAB;&#x6587;&#x4EF6;&#xFF08;&#x52D5;&#x614B;&#x93C8;&#x63A5;&#x5EAB;&#xFF09;&#x4E09;&#x985E;&#x6587;&#x4EF6;&#x3002;</p>
</li>
</ul>
<p>&#x4E0B;&#x9762;&#x4F86;&#x770B;&#x770B; <code>ELF</code> &#x6587;&#x4EF6;&#x7684;&#x7D50;&#x69CB;&#x5716;&#xFF1A;</p>
<pre><code>&#x6587;&#x4EF6;&#x982D;&#x90E8;(ELF Header)
&#x7A0B;&#x5E8F;&#x982D;&#x90E8;&#x8868;(Program Header Table)
&#x7BC0;&#x5340;1(Section1)
&#x7BC0;&#x5340;2(Section2)
&#x7BC0;&#x5340;3(Section3)
...
&#x7BC0;&#x5340;&#x982D;&#x90E8;(Section Header Table)
</code></pre><p>&#x7121;&#x8AD6;&#x662F;&#x6587;&#x4EF6;&#x982D;&#x90E8;&#x3001;&#x7A0B;&#x5E8F;&#x982D;&#x90E8;&#x8868;&#x3001;&#x7BC0;&#x5340;&#x982D;&#x90E8;&#x8868;&#x9084;&#x662F;&#x5404;&#x500B;&#x7BC0;&#x5340;&#xFF0C;&#x90FD;&#x662F;&#x901A;&#x904E;&#x7279;&#x5B9A;&#x7684;&#x7D50;&#x69CB;&#x9AD4; <code>(struct)&#x63CF;&#x8FF0;&#x7684;&#xFF0C;&#x9019;&#x4E9B;&#x7D50;&#x69CB;&#x5728;</code>elf.h<code>&#x6587;&#x4EF6;&#x4E2D;&#x5B9A;&#x7FA9;&#x3002;&#x6587;&#x4EF6;&#x982D;&#x90E8;&#x7528;&#x65BC;&#x63CF;&#x8FF0;&#x6574;&#x500B;&#x6587;&#x4EF6;&#x7684;&#x985E;&#x578B;&#x3001;&#x5927;&#x5C0F;&#x3001;&#x904B;&#x884C;&#x5E73;&#x81FA;&#x3001;&#x7A0B;&#x5E8F;&#x5165;&#x53E3;&#x3001;&#x7A0B;&#x5E8F;&#x982D;&#x90E8;&#x8868;&#x548C;&#x7BC0;&#x5340;&#x982D;&#x90E8;&#x8868;&#x7B49;&#x4FE1;&#x606F;&#x3002;&#x4F8B;&#x5982;&#xFF0C;&#x6211;&#x5011;&#x53EF;&#x4EE5;&#x901A;&#x904E;&#x6587;&#x4EF6;&#x982D;&#x90E8;&#x67E5;&#x770B;&#x8A72;</code>ELF` &#x6587;&#x4EF6;&#x7684;&#x985E;&#x578B;&#x3002;</p>
<pre><code>$ cat hello.c   #&#x5178;&#x578B;&#x7684;hello, world&#x7A0B;&#x5E8F;
#include &lt;stdio.h&gt;

int main(void)
{
    printf(&quot;hello, world!\n&quot;);
    return 0;
}
$ gcc -c hello.c   #&#x7DE8;&#x8B6F;&#xFF0C;&#x7522;&#x751F;&#x53EF;&#x91CD;&#x5B9A;&#x5411;&#x7684;&#x76EE;&#x6A19;&#x4EE3;&#x78BC;
$ readelf -h hello.o | grep Type   #&#x901A;&#x904E;readelf&#x67E5;&#x770B;&#x6587;&#x4EF6;&#x982D;&#x90E8;&#x627E;&#x51FA;&#x8A72;&#x985E;&#x578B;
  Type:                              REL (Relocatable file)
$ gcc -o hello hello.o   #&#x751F;&#x6210;&#x53EF;&#x57F7;&#x884C;&#x6587;&#x4EF6;
$ readelf -h hello | grep Type
  Type:                              EXEC (Executable file)
$ gcc -fpic -shared -W1,-soname,libhello.so.0 -o libhello.so.0.0 hello.o  #&#x751F;&#x6210;&#x5171;&#x4EAB;&#x5EAB;
$ readelf -h libhello.so.0.0 | grep Type
  Type:                              DYN (Shared object file)
</code></pre><p>&#x90A3;&#x7BC0;&#x5340;&#x982D;&#x90E8;&#x8868;&#xFF08;&#x5C07;&#x7C21;&#x7A31;&#x7BC0;&#x5340;&#x8868;&#xFF09;&#x548C;&#x7A0B;&#x5E8F;&#x982D;&#x90E8;&#x8868;&#x6709;&#x4EC0;&#x9EBC;&#x7528;&#x5462;&#xFF1F;&#x5BE6;&#x969B;&#x4E0A;&#x524D;&#x8005;&#x53EA;&#x5C0D;&#x53EF;&#x91CD;&#x5B9A;&#x5411;&#x6587;&#x4EF6;&#x6709;&#x7528;&#xFF0C;&#x800C;&#x5F8C;&#x8005;&#x53EA;&#x5C0D;&#x53EF;&#x57F7;&#x884C;&#x6587;&#x4EF6;&#x548C;&#x53EF;&#x5171;&#x4EAB;&#x6587;&#x4EF6;&#x6709;&#x7528;&#x3002;</p>
<p>&#x7BC0;&#x5340;&#x8868;&#x662F;&#x7528;&#x4F86;&#x63CF;&#x8FF0;&#x5404;&#x7BC0;&#x5340;&#x7684;&#xFF0C;&#x5305;&#x62EC;&#x5404;&#x7BC0;&#x5340;&#x7684;&#x540D;&#x5B57;&#x3001;&#x5927;&#x5C0F;&#x3001;&#x985E;&#x578B;&#x3001;&#x865B;&#x64EC;&#x5167;&#x5B58;&#x4E2D;&#x7684;&#x4F4D;&#x7F6E;&#x3001;&#x76F8;&#x5C0D;&#x6587;&#x4EF6;&#x982D;&#x7684;&#x4F4D;&#x7F6E;&#x7B49;&#xFF0C;&#x9019;&#x6A23;&#x6240;&#x6709;&#x7BC0;&#x5340;&#x90FD;&#x901A;&#x904E;&#x7BC0;&#x5340;&#x8868;&#x7D66;&#x63CF;&#x8FF0;&#x4E86;&#xFF0C;&#x9019;&#x6A23;&#x9023;&#x63A5;&#x5668;&#x5C31;&#x53EF;&#x4EE5;&#x6839;&#x64DA;&#x6587;&#x4EF6;&#x982D;&#x90E8;&#x8868;&#x548C;&#x7BC0;&#x5340;&#x8868;&#x7684;&#x63CF;&#x8FF0;&#x4FE1;&#x606F;&#x5C0D;&#x5404;&#x7A2E;&#x8F38;&#x5165;&#x7684;&#x53EF;&#x91CD;&#x5B9A;&#x4F4D;&#x6587;&#x4EF6;&#x9032;&#x884C;&#x5408;&#x9069;&#x7684;&#x93C8;&#x63A5;&#xFF0C;&#x5305;&#x62EC;&#x7BC0;&#x5340;&#x7684;&#x5408;&#x4F75;&#x8207;&#x91CD;&#x7D44;&#x3001;&#x7B26;&#x865F;&#x7684;&#x91CD;&#x5B9A;&#x4F4D;&#xFF08;&#x78BA;&#x8A8D;&#x7B26;&#x865F;&#x5728;&#x865B;&#x64EC;&#x5167;&#x5B58;&#x4E2D;&#x7684;&#x5730;&#x5740;&#xFF09;&#x7B49;&#xFF0C;&#x628A;&#x5404;&#x500B;&#x53EF;&#x91CD;&#x5B9A;&#x5411;&#x8F38;&#x5165;&#x6587;&#x4EF6;&#x93C8;&#x63A5;&#x6210;&#x4E00;&#x500B;&#x53EF;&#x57F7;&#x884C;&#x6587;&#x4EF6;&#xFF08;&#x6216;&#x8005;&#x662F;&#x53EF;&#x5171;&#x4EAB;&#x6587;&#x4EF6;&#xFF09;&#x3002;&#x5982;&#x679C;&#x53EF;&#x57F7;&#x884C;&#x6587;&#x4EF6;&#x4E2D;&#x4F7F;&#x7528;&#x4E86;&#x52D5;&#x614B;&#x9023;&#x63A5;&#x5EAB;&#xFF0C;&#x90A3;&#x9EBC;&#x5C07;&#x5305;&#x542B;&#x4E00;&#x4E9B;&#x7528;&#x65BC;&#x52D5;&#x614B;&#x7B26;&#x865F;&#x93C8;&#x63A5;&#x7684;&#x7BC0;&#x5340;&#x3002;&#x6211;&#x5011;&#x53EF;&#x4EE5;&#x901A;&#x904E; <code>readelf -S</code> &#xFF08;&#x6216; <code>objdump -h</code>&#xFF09;&#x67E5;&#x770B;&#x7BC0;&#x5340;&#x8868;&#x4FE1;&#x606F;&#x3002;</p>
<pre><code>$ readelf -S hello  #&#x53EF;&#x57F7;&#x884C;&#x6587;&#x4EF6;&#x3001;&#x53EF;&#x5171;&#x4EAB;&#x5EAB;&#x3001;&#x53EF;&#x91CD;&#x5B9A;&#x4F4D;&#x6587;&#x4EF6;&#x9ED8;&#x8A8D;&#x90FD;&#x751F;&#x6210;&#x6709;&#x7BC0;&#x5340;&#x8868;
...
Section Headers:
  [Nr] Name              Type            Addr     Off    Size   ES Flg Lk Inf Al
  [ 0]                   NULL            00000000 000000 000000 00      0   0  0
  [ 1] .interp           PROGBITS        08048114 000114 000013 00   A  0   0  1
  [ 2] .note.ABI-tag     NOTE            08048128 000128 000020 00   A  0   0  4
  [ 3] .hash             HASH            08048148 000148 000028 04   A  5   0  4
...
    [ 7] .gnu.version      VERSYM          0804822a 00022a 00000a 02   A  5   0  2
...
  [11] .init             PROGBITS        08048274 000274 000030 00  AX  0   0  4
...
  [13] .text             PROGBITS        080482f0 0002f0 000148 00  AX  0   0 16
  [14] .fini             PROGBITS        08048438 000438 00001c 00  AX  0   0  4
...
</code></pre><p>&#x4E09;&#x7A2E;&#x985E;&#x578B;&#x6587;&#x4EF6;&#x7684;&#x7BC0;&#x5340;&#xFF08;&#x5404;&#x500B;&#x5E38;&#x898B;&#x7BC0;&#x5340;&#x7684;&#x4F5C;&#x7528;&#x8ACB;&#x53C3;&#x8003;&#x8CC7;&#x6599; <a href="http://www.x86.org/ftp/manuals/tools/elf.pdf" target="_blank">[11]</a>)&#x53EF;&#x80FD;&#x4E0D;&#x4E00;&#x6A23;&#xFF0C;&#x4F46;&#x662F;&#x6709;&#x5E7E;&#x500B;&#x7BC0;&#x5340;&#xFF0C;&#x4F8B;&#x5982; <code>.text</code>&#xFF0C;<code>.data</code>&#xFF0C;<code>.bss</code> &#x662F;&#x5FC5;&#x9808;&#x7684;&#xFF0C;&#x7279;&#x5225;&#x662F; <code>.text</code>&#xFF0C;&#x56E0;&#x70BA;&#x9019;&#x500B;&#x7BC0;&#x5340;&#x5305;&#x542B;&#x4E86;&#x4EE3;&#x78BC;&#x3002;&#x5982;&#x679C;&#x4E00;&#x500B;&#x7A0B;&#x5E8F;&#x4F7F;&#x7528;&#x4E86;&#x52D5;&#x614B;&#x93C8;&#x63A5;&#x5EAB;&#xFF08;&#x5F15;&#x7528;&#x4E86;&#x52D5;&#x614B;&#x9023;&#x63A5;&#x5EAB;&#x4E2D;&#x7684;&#x67D0;&#x500B;&#x51FD;&#x6578;&#xFF09;&#xFF0C;&#x90A3;&#x9EBC;&#x9700;&#x8981; <code>.interp</code> &#x7BC0;&#x5340;&#x4EE5;&#x4FBF;&#x544A;&#x77E5;&#x7CFB;&#x7D71;&#x4F7F;&#x7528;&#x4EC0;&#x9EBC;&#x52D5;&#x614B;&#x9023;&#x63A5;&#x5668;&#x7A0B;&#x5E8F;&#x4F86;&#x9032;&#x884C;&#x52D5;&#x614B;&#x7B26;&#x865F;&#x93C8;&#x63A5;&#xFF0C;&#x9032;&#x884C;&#x67D0;&#x4E9B;&#x7B26;&#x865F;&#x5730;&#x5740;&#x7684;&#x91CD;&#x5B9A;&#x4F4D;&#x3002;&#x901A;&#x5E38;&#xFF0C;<code>.rel.text</code> &#x7BC0;&#x5340;&#x53EA;&#x6709;&#x53EF;&#x91CD;&#x5B9A;&#x5411;&#x6587;&#x4EF6;&#x6709;&#xFF0C;&#x7528;&#x65BC;&#x93C8;&#x63A5;&#x6642;&#x5C0D;&#x4EE3;&#x78BC;&#x5340;&#x9032;&#x884C;&#x91CD;&#x5B9A;&#x5411;&#xFF0C;&#x800C; <code>.hash</code>&#xFF0C;<code>.plt</code>&#xFF0C;<code>.got</code> &#x7B49;&#x7BC0;&#x5340;&#x5247;&#x53EA;&#x6709;&#x53EF;&#x57F7;&#x884C;&#x6587;&#x4EF6;&#xFF08;&#x6216;&#x53EF;&#x5171;&#x4EAB;&#x5EAB;&#xFF09;&#x6709;&#xFF0C;&#x9019;&#x4E9B;&#x7BC0;&#x5340;&#x5C0D;&#x7A0B;&#x5E8F;&#x7684;&#x904B;&#x884C;&#x7279;&#x5225;&#x91CD;&#x8981;&#x3002;&#x9084;&#x6709;&#x4E00;&#x4E9B;&#x7BC0;&#x5340;&#xFF0C;&#x53EF;&#x80FD;&#x50C5;&#x50C5;&#x662F;&#x7528;&#x65BC;&#x8A3B;&#x91CB;&#xFF0C;&#x6BD4;&#x5982; <code>.comment</code>&#xFF0C;&#x9019;&#x4E9B;&#x5C0D;&#x7A0B;&#x5E8F;&#x7684;&#x904B;&#x884C;&#x4F3C;&#x4E4E;&#x6C92;&#x6709;&#x5F71;&#x97FF;&#xFF0C;&#x662F;&#x53EF;&#x6709;&#x53EF;&#x7121;&#x7684;&#xFF0C;&#x4E0D;&#x904E;&#x6709;&#x4E9B;&#x7BC0;&#x5340;&#x96D6;&#x7136;&#x5C0D;&#x7A0B;&#x5E8F;&#x7684;&#x904B;&#x884C;&#x6C92;&#x6709;&#x7528;&#x8655;&#xFF0C;&#x4F46;&#x662F;&#x537B;&#x53EF;&#x4EE5;&#x7528;&#x4F86;&#x8F14;&#x52A9;&#x5C0D;&#x7A0B;&#x5E8F;&#x9032;&#x884C;&#x8ABF;&#x8A66;&#x6216;&#x8005;&#x5C0D;&#x7A0B;&#x5E8F;&#x904B;&#x884C;&#x6548;&#x7387;&#x6709;&#x5F71;&#x97FF;&#x3002;</p>
<p>&#x96D6;&#x7136;&#x4E09;&#x985E;&#x6587;&#x4EF6;&#x90FD;&#x5FC5;&#x9808;&#x5305;&#x542B;&#x67D0;&#x4E9B;&#x7BC0;&#x5340;&#xFF0C;&#x4F46;&#x662F;&#x7BC0;&#x5340;&#x8868;&#x5C0D;&#x53EF;&#x91CD;&#x5B9A;&#x4F4D;&#x6587;&#x4EF6;&#x4F86;&#x8AAA;&#x624D;&#x662F;&#x5FC5;&#x9808;&#x7684;&#xFF0C;&#x800C;&#x7A0B;&#x5E8F;&#x7684;&#x57F7;&#x884C;&#x537B;&#x4E0D;&#x9700;&#x8981;&#x7BC0;&#x5340;&#x8868;&#xFF0C;&#x53EA;&#x9700;&#x8981;&#x7A0B;&#x5E8F;&#x982D;&#x90E8;&#x8868;&#x4EE5;&#x4FBF;&#x77E5;&#x9053;&#x5982;&#x4F55;&#x52A0;&#x8F09;&#x548C;&#x57F7;&#x884C;&#x6587;&#x4EF6;&#x3002;&#x4E0D;&#x904E;&#x5982;&#x679C;&#x9700;&#x8981;&#x5C0D;&#x53EF;&#x57F7;&#x884C;&#x6587;&#x4EF6;&#x6216;&#x8005;&#x52D5;&#x614B;&#x9023;&#x63A5;&#x5EAB;&#x9032;&#x884C;&#x8ABF;&#x8A66;&#xFF0C;&#x90A3;&#x9EBC;&#x7BC0;&#x5340;&#x8868;&#x537B;&#x662F;&#x5FC5;&#x8981;&#x7684;&#xFF0C;&#x5426;&#x5247;&#x8ABF;&#x8A66;&#x5668;&#x5C07;&#x4E0D;&#x77E5;&#x9053;&#x5982;&#x4F55;&#x5DE5;&#x4F5C;&#x3002;&#x4E0B;&#x9762;&#x4F86;&#x4ECB;&#x7D39;&#x7A0B;&#x5E8F;&#x982D;&#x90E8;&#x8868;&#xFF0C;&#x5B83;&#x53EF;&#x901A;&#x904E; <code>readelf -l</code>&#xFF08;&#x6216; <code>objdump -p</code>&#xFF09;&#x67E5;&#x770B;&#x3002;</p>
<pre><code>$ readelf -l hello.o #&#x5C0D;&#x65BC;&#x53EF;&#x91CD;&#x5B9A;&#x5411;&#x6587;&#x4EF6;&#xFF0C;gcc&#x6C92;&#x6709;&#x7522;&#x751F;&#x7A0B;&#x5E8F;&#x982D;&#x90E8;&#xFF0C;&#x56E0;&#x70BA;&#x5B83;&#x5C0D;&#x53EF;&#x91CD;&#x5B9A;&#x5411;&#x6587;&#x4EF6;&#x6C92;&#x7528;

There are no program headers in this file.
$  readelf -l hello  #&#x800C;&#x53EF;&#x57F7;&#x884C;&#x6587;&#x4EF6;&#x548C;&#x53EF;&#x5171;&#x4EAB;&#x6587;&#x4EF6;&#x90FD;&#x6709;&#x7A0B;&#x5E8F;&#x982D;&#x90E8;
...
Program Headers:
  Type           Offset   VirtAddr   PhysAddr   FileSiz MemSiz  Flg Align
  PHDR           0x000034 0x08048034 0x08048034 0x000e0 0x000e0 R E 0x4
  INTERP         0x000114 0x08048114 0x08048114 0x00013 0x00013 R   0x1
      [Requesting program interpreter: /lib/ld-linux.so.2]
  LOAD           0x000000 0x08048000 0x08048000 0x00470 0x00470 R E 0x1000
  LOAD           0x000470 0x08049470 0x08049470 0x0010c 0x00110 RW  0x1000
  DYNAMIC        0x000484 0x08049484 0x08049484 0x000d0 0x000d0 RW  0x4
  NOTE           0x000128 0x08048128 0x08048128 0x00020 0x00020 R   0x4
  GNU_STACK      0x000000 0x00000000 0x00000000 0x00000 0x00000 RW  0x4

 Section to Segment mapping:
  Segment Sections...
   00
   01     .interp
   02     .interp .note.ABI-tag .hash .gnu.hash .dynsym .dynstr .gnu.version .gnu.version_r .rel.dyn .rel.plt .init .plt .text .fini .rodata .eh_frame
   03     .ctors .dtors .jcr .dynamic .got .got.plt .data .bss
   04     .dynamic
   05     .note.ABI-tag
   06
$ readelf -l libhello.so.0.0  #&#x7BC0;&#x5340;&#x548C;&#x4E0A;&#x9762;&#x985E;&#x4F3C;&#xFF0C;&#x9019;&#x88E1;&#x7701;&#x7565;
</code></pre><p>&#x5F9E;&#x4E0A;&#x9762;&#x53EF;&#x770B;&#x51FA;&#x7A0B;&#x5E8F;&#x982D;&#x90E8;&#x8868;&#x63CF;&#x8FF0;&#x4E86;&#x4E00;&#x4E9B;&#x6BB5;&#xFF08;<code>Segment</code>&#xFF09;&#xFF0C;&#x9019;&#x4E9B;&#x6BB5;&#x5C0D;&#x61C9;&#x8457;&#x4E00;&#x500B;&#x6216;&#x8005;&#x591A;&#x500B;&#x7BC0;&#x5340;&#xFF0C;&#x4E0A;&#x9762;&#x7684; <code>readelf -l</code> &#x5F88;&#x597D;&#x5730;&#x986F;&#x793A;&#x4E86;&#x5404;&#x500B;&#x6BB5;&#x8207;&#x7BC0;&#x5340;&#x7684;&#x6620;&#x5C04;&#x3002;&#x9019;&#x4E9B;&#x6BB5;&#x63CF;&#x8FF0;&#x4E86;&#x6BB5;&#x7684;&#x540D;&#x5B57;&#x3001;&#x985E;&#x578B;&#x3001;&#x5927;&#x5C0F;&#x3001;&#x7B2C;&#x4E00;&#x500B;&#x5B57;&#x7BC0;&#x5728;&#x6587;&#x4EF6;&#x4E2D;&#x7684;&#x4F4D;&#x7F6E;&#x3001;&#x5C07;&#x4F54;&#x7528;&#x7684;&#x865B;&#x64EC;&#x5167;&#x5B58;&#x5927;&#x5C0F;&#x3001;&#x5728;&#x865B;&#x64EC;&#x5167;&#x5B58;&#x4E2D;&#x7684;&#x4F4D;&#x7F6E;&#x7B49;&#x3002;&#x9019;&#x6A23;&#x7CFB;&#x7D71;&#x7A0B;&#x5E8F;&#x89E3;&#x91CB;&#x5668;&#x5C07;&#x77E5;&#x9053;&#x5982;&#x4F55;&#x628A;&#x53EF;&#x57F7;&#x884C;&#x6587;&#x4EF6;&#x52A0;&#x8F09;&#x5230;&#x5167;&#x5B58;&#x4E2D;&#x4EE5;&#x53CA;&#x9032;&#x884C;&#x52D5;&#x614B;&#x93C8;&#x63A5;&#x7B49;&#x52D5;&#x4F5C;&#x3002;</p>
<p>&#x8A72;&#x53EF;&#x57F7;&#x884C;&#x6587;&#x4EF6;&#x5305;&#x542B; 7 &#x500B;&#x6BB5;&#xFF0C;<code>PHDR</code> &#x6307;&#x7A0B;&#x5E8F;&#x982D;&#x90E8;&#xFF0C;<code>INTERP</code> &#x6B63;&#x597D;&#x5C0D;&#x61C9; <code>.interp</code> &#x7BC0;&#x5340;&#xFF0C;&#x5169;&#x500B; <code>LOAD</code> &#x6BB5;&#x5305;&#x542B;&#x7A0B;&#x5E8F;&#x7684;&#x4EE3;&#x78BC;&#x548C;&#x6578;&#x64DA;&#x90E8;&#x5206;&#xFF0C;&#x5206;&#x5225;&#x5305;&#x542B;&#x6709; <code>.text</code> &#x548C; <code>.data</code>&#xFF0C;<code>.bss</code> &#x7BC0;&#x5340;&#xFF0C;<code>DYNAMIC</code> &#x6BB5;&#x5305;&#x542B; <code>.daynamic</code>&#xFF0C;&#x9019;&#x500B;&#x7BC0;&#x5340;&#x53EF;&#x80FD;&#x5305;&#x542B;&#x52D5;&#x614B;&#x9023;&#x63A5;&#x5EAB;&#x7684;&#x641C;&#x7D22;&#x8DEF;&#x5F91;&#x3001;&#x53EF;&#x91CD;&#x5B9A;&#x4F4D;&#x8868;&#x7684;&#x5730;&#x5740;&#x7B49;&#x4FE1;&#x606F;&#xFF0C;&#x5B83;&#x5011;&#x7528;&#x65BC;&#x52D5;&#x614B;&#x9023;&#x63A5;&#x5668;&#x3002; <code>NOTE</code> &#x548C; <code>GNU_STACK</code> &#x6BB5;&#x8C8C;&#x4F3C;&#x4F5C;&#x7528;&#x4E0D;&#x5927;&#xFF0C;&#x53EA;&#x662F;&#x4FDD;&#x5B58;&#x4E86;&#x4E00;&#x4E9B;&#x8F14;&#x52A9;&#x4FE1;&#x606F;&#x3002;&#x56E0;&#x6B64;&#xFF0C;&#x5C0D;&#x65BC;&#x4E00;&#x500B;&#x4E0D;&#x4F7F;&#x7528;&#x52D5;&#x614B;&#x9023;&#x63A5;&#x5EAB;&#x7684;&#x7A0B;&#x5E8F;&#x4F86;&#x8AAA;&#xFF0C;&#x53EF;&#x80FD;&#x53EA;&#x5305;&#x542B; <code>LOAD</code> &#x6BB5;&#xFF0C;&#x5982;&#x679C;&#x4E00;&#x500B;&#x7A0B;&#x5E8F;&#x6C92;&#x6709;&#x6578;&#x64DA;&#xFF0C;&#x90A3;&#x9EBC;&#x53EA;&#x6709;&#x4E00;&#x500B; <code>LOAD</code> &#x6BB5;&#x5C31;&#x53EF;&#x4EE5;&#x4E86;&#x3002;</p>
<p>&#x7E3D;&#x7D50;&#x4E00;&#x4E0B;&#xFF0C;Linux &#x96D6;&#x7136;&#x652F;&#x6301;&#x5F88;&#x591A;&#x7A2E;&#x53EF;&#x57F7;&#x884C;&#x6587;&#x4EF6;&#x683C;&#x5F0F;&#xFF0C;&#x4F46;&#x662F;&#x76EE;&#x524D; <code>ELF</code> &#x8F03;&#x901A;&#x7528;&#xFF0C;&#x6240;&#x4EE5;&#x9078;&#x64C7; <code>ELF</code> &#x4F5C;&#x70BA;&#x6211;&#x5011;&#x7684;&#x8A0E;&#x8AD6;&#x5C0D;&#x8C61;&#x3002;&#x901A;&#x904E;&#x4E0A;&#x9762;&#x5C0D; <code>ELF</code> &#x6587;&#x4EF6;&#x5206;&#x6790;&#x767C;&#x73FE;&#x4E00;&#x500B;&#x53EF;&#x57F7;&#x884C;&#x7684;&#x6587;&#x4EF6;&#x53EF;&#x80FD;&#x5305;&#x542B;&#x4E00;&#x4E9B;&#x5C0D;&#x5B83;&#x7684;&#x904B;&#x884C;&#x6C92;&#x7528;&#x7684;&#x4FE1;&#x606F;&#xFF0C;&#x6BD4;&#x5982;&#x7BC0;&#x5340;&#x8868;&#x3001;&#x4E00;&#x4E9B;&#x7528;&#x65BC;&#x8ABF;&#x8A66;&#x3001;&#x8A3B;&#x91CB;&#x7684;&#x7BC0;&#x5340;&#x3002;&#x5982;&#x679C;&#x80FD;&#x5920;&#x522A;&#x9664;&#x9019;&#x4E9B;&#x4FE1;&#x606F;&#x5C31;&#x53EF;&#x4EE5;&#x6E1B;&#x5C11;&#x53EF;&#x57F7;&#x884C;&#x6587;&#x4EF6;&#x7684;&#x5927;&#x5C0F;&#xFF0C;&#x800C;&#x4E14;&#x4E0D;&#x6703;&#x5F71;&#x97FF;&#x53EF;&#x57F7;&#x884C;&#x6587;&#x4EF6;&#x7684;&#x6B63;&#x5E38;&#x904B;&#x884C;&#x3002;</p>
<p><span id="toc_3928_6176_3"></span></p>
<h2 id="%E9%8F%88%E6%8E%A5%E5%84%AA%E5%8C%96">&#x93C8;&#x63A5;&#x512A;&#x5316;</h2>
<p>&#x5F9E;&#x4E0A;&#x9762;&#x7684;&#x8A0E;&#x8AD6;&#x4E2D;&#x5DF2;&#x7D93;&#x63A5;&#x89F8;&#x4E86;&#x52D5;&#x614B;&#x9023;&#x63A5;&#x5EAB;&#x3002; <code>ELF</code> &#x4E2D;&#x5F15;&#x5165;&#x52D5;&#x614B;&#x9023;&#x63A5;&#x5EAB;&#x5F8C;&#x6975;&#x5927;&#x5730;&#x65B9;&#x4FBF;&#x4E86;&#x516C;&#x5171;&#x51FD;&#x6578;&#x7684;&#x5171;&#x4EAB;&#xFF0C;&#x7BC0;&#x7D04;&#x4E86;&#x78C1;&#x76E4;&#x548C;&#x5167;&#x5B58;&#x7A7A;&#x9593;&#xFF0C;&#x56E0;&#x70BA;&#x4E0D;&#x518D;&#x9700;&#x8981;&#x628A;&#x90A3;&#x4E9B;&#x516C;&#x5171;&#x51FD;&#x6578;&#x7684;&#x4EE3;&#x78BC;&#x93C8;&#x63A5;&#x5230;&#x53EF;&#x57F7;&#x884C;&#x6587;&#x4EF6;&#xFF0C;&#x9019;&#x5C07;&#x6E1B;&#x5C11;&#x4E86;&#x53EF;&#x57F7;&#x884C;&#x6587;&#x4EF6;&#x7684;&#x5927;&#x5C0F;&#x3002;</p>
<p>&#x8207;&#x6B64;&#x540C;&#x6642;&#xFF0C;&#x975C;&#x614B;&#x93C8;&#x63A5;&#x53EF;&#x80FD;&#x6703;&#x5F15;&#x5165;&#x4E00;&#x4E9B;&#x5C0D;&#x4EE3;&#x78BC;&#x7684;&#x904B;&#x884C;&#x53EF;&#x80FD;&#x4E26;&#x975E;&#x5FC5;&#x9808;&#x7684;&#x5167;&#x5BB9;&#x3002;&#x4F60;&#x53EF;&#x4EE5;&#x5F9E;<a href="02-chapter2.html">&#x300A;GCC &#x7DE8;&#x8B6F;&#x7684;&#x80CC;&#x5F8C;&#xFF08;&#x7B2C;&#x4E8C;&#x90E8;&#x5206;&#xFF1A;&#x5F59;&#x7DE8;&#x548C;&#x93C8;&#x63A5;&#xFF09;&#x300B;</a> &#x77AD;&#x89E3;&#x5230; <code>GCC</code> &#x93C8;&#x63A5;&#x7684;&#x7D30;&#x7BC0;&#x3002;&#x5F9E;&#x90A3;&#x7BC7; Blog &#x4E2D;&#x4F3C;&#x4E4E;&#x53EF;&#x4EE5;&#x5F97;&#x51FA;&#x9019;&#x6A23;&#x7684;&#x7D50;&#x8AD6;&#xFF1A;&#x50C5;&#x50C5;&#x5F9E;&#x662F;&#x5426;&#x5F71;&#x97FF;&#x4E00;&#x500B; C &#x8A9E;&#x8A00;&#x7A0B;&#x5E8F;&#x904B;&#x884C;&#x7684;&#x89D2;&#x5EA6;&#x4E0A;&#x8AAA;&#xFF0C;<code>GCC</code> &#x9ED8;&#x8A8D;&#x93C8;&#x63A5;&#x5230;&#x53EF;&#x57F7;&#x884C;&#x6587;&#x4EF6;&#x7684;&#x5E7E;&#x500B;&#x53EF;&#x91CD;&#x5B9A;&#x4F4D;&#x6587;&#x4EF6; &#xFF08;<code>crt1.o</code>&#xFF0C;<code>rti.o</code>&#xFF0C;<code>crtbegin.o</code>&#xFF0C;<code>crtend.o</code>&#xFF0C;<code>crtn.o</code>&#xFF09;&#x4E26;&#x4E0D;&#x662F;&#x5FC5;&#x9808;&#x7684;&#xFF0C;&#x4E0D;&#x904E;&#x503C;&#x5F97;&#x6CE8;&#x610F;&#x7684;&#x662F;&#xFF0C;&#x5982;&#x679C;&#x6C92;&#x6709;&#x93C8;&#x63A5;&#x90A3;&#x4E9B;&#x6587;&#x4EF6;&#x4F46;&#x5728;&#x7A0B;&#x5E8F;&#x672B;&#x5C3E;&#x4F7F;&#x7528;&#x4E86; <code>return</code> &#x8A9E;&#x53E5;&#xFF0C;<code>main</code> &#x51FD;&#x6578;&#x5C07;&#x7121;&#x6CD5;&#x8FD4;&#x56DE;&#xFF0C;&#x56E0;&#x6B64;&#x9700;&#x8981;&#x66FF;&#x63DB;&#x70BA; <code>_exit</code> &#x8ABF;&#x7528;&#xFF1B;&#x53E6;&#x5916;&#xFF0C;&#x65E2;&#x7136;&#x7A0B;&#x5E8F;&#x5728;&#x9032;&#x5165; <code>main</code> &#x4E4B;&#x524D;&#x6709;&#x4E00;&#x500B;&#x5165;&#x53E3;&#xFF0C;&#x90A3;&#x9EBC; <code>main</code> &#x5165;&#x53E3;&#x5C31;&#x4E0D;&#x662F;&#x5FC5;&#x9808;&#x7684;&#x3002;&#x56E0;&#x6B64;&#xFF0C;&#x5982;&#x679C;&#x4E0D;&#x63A1;&#x7528;&#x9ED8;&#x8A8D;&#x93C8;&#x63A5;&#x4E5F;&#x53EF;&#x4EE5;&#x6E1B;&#x5C11;&#x53EF;&#x57F7;&#x884C;&#x6587;&#x4EF6;&#x7684;&#x5927;&#x5C0F;&#x3002;</p>
<p><span id="toc_3928_6176_4"></span></p>
<h2 id="%E5%8F%AF%E5%9F%B7%E8%A1%8C%E6%96%87%E4%BB%B6%E2%80%9C%E6%B8%9B%E8%82%A5%E2%80%9D%E5%AF%A6%E4%BE%8B%EF%BC%88%E5%BE%9E6442%E5%88%B0708%E5%AD%97%E7%AF%80%EF%BC%89">&#x53EF;&#x57F7;&#x884C;&#x6587;&#x4EF6;&#x201C;&#x6E1B;&#x80A5;&#x201D;&#x5BE6;&#x4F8B;&#xFF08;&#x5F9E;6442&#x5230;708&#x5B57;&#x7BC0;&#xFF09;</h2>
<p>&#x9019;&#x88E1;&#x4E3B;&#x8981;&#x662F;&#x6839;&#x64DA;&#x4E0A;&#x9762;&#x5169;&#x9EDE;&#x4F86;&#x4ECB;&#x7D39;&#x5982;&#x4F55;&#x6E1B;&#x5C11;&#x4E00;&#x500B;&#x53EF;&#x57F7;&#x884C;&#x6587;&#x4EF6;&#x7684;&#x5927;&#x5C0F;&#x3002;&#x4EE5; <code>Hello World</code> &#x70BA;&#x4F8B;&#x3002;</p>
<p>&#x9996;&#x5148;&#x4F86;&#x770B;&#x770B;&#x9ED8;&#x8A8D;&#x7DE8;&#x8B6F;&#x7522;&#x751F;&#x7684; <code>Hello World</code> &#x7684;&#x53EF;&#x57F7;&#x884C;&#x6587;&#x4EF6;&#x5927;&#x5C0F;&#x3002;</p>
<p><span id="toc_3928_6176_5"></span></p>
<h3 id="%E7%B3%BB%E7%B5%B1%E9%BB%98%E8%AA%8D%E7%B7%A8%E8%AD%AF">&#x7CFB;&#x7D71;&#x9ED8;&#x8A8D;&#x7DE8;&#x8B6F;</h3>
<p>&#x4EE3;&#x78BC;&#x540C;&#x4E0A;&#xFF0C;&#x4E0B;&#x9762;&#x662F;&#x4E00;&#x7D44;&#x6F14;&#x793A;&#xFF0C;</p>
<pre><code>$ uname -r   #&#x5148;&#x67E5;&#x770B;&#x5167;&#x6838;&#x7248;&#x672C;&#x548C;gcc&#x7248;&#x672C;&#xFF0C;&#x4EE5;&#x4FBF;&#x548C;&#x4F60;&#x7684;&#x7D50;&#x679C;&#x6BD4;&#x8F03;
2.6.22-14-generic
$ gcc --version
gcc (GCC) 4.1.3 20070929 (prerelease) (Ubuntu 4.1.2-16ubuntu2)
...
$ gcc -o hello hello.c   #&#x9ED8;&#x8A8D;&#x7DE8;&#x8B6F;
$ wc -c hello   #&#x7522;&#x751F;&#x4E00;&#x500B;&#x5927;&#x5C0F;&#x70BA;6442&#x5B57;&#x7BC0;&#x7684;&#x53EF;&#x57F7;&#x884C;&#x6587;&#x4EF6;
6442 hello
</code></pre><p><span id="toc_3928_6176_6"></span></p>
<h3 id="%E4%B8%8D%E6%8E%A1%E7%94%A8%E9%BB%98%E8%AA%8D%E7%B7%A8%E8%AD%AF">&#x4E0D;&#x63A1;&#x7528;&#x9ED8;&#x8A8D;&#x7DE8;&#x8B6F;</h3>
<p>&#x53EF;&#x4EE5;&#x8003;&#x616E;&#x7DE8;&#x8F2F;&#x6642;&#x5C31;&#x628A; <code>return 0</code> &#x66FF;&#x63DB;&#x6210; <code>_exit(0)</code> &#x5E77;&#x5305;&#x542B;&#x5B9A;&#x7FA9;&#x8A72;&#x51FD;&#x6578;&#x7684; <code>unistd.h</code> &#x982D;&#x6587;&#x4EF6;&#x3002;&#x4E0B;&#x9762;&#x662F;&#x5F9E;<a href="02-chapter2.html">&#x300A;GCC &#x7DE8;&#x8B6F;&#x7684;&#x80CC;&#x5F8C;&#xFF08;&#x7B2C;&#x4E8C;&#x90E8;&#x5206;&#xFF1A;&#x5F59;&#x7DE8;&#x548C;&#x93C8;&#x63A5;&#xFF09;&#x300B;</a>&#x7E3D;&#x7D50;&#x51FA;&#x7684; <code>Makefile</code> &#x6587;&#x4EF6;&#x3002;</p>
<pre><code>#file: Makefile
#functin: for not linking a program as the gcc do by default
#author: falcon&lt;zhangjinw@gmail.com&gt;
#update: 2008-02-23

MAIN = hello
SOURCE =
OBJS = hello.o
TARGET = hello
CC = gcc-3.4 -m32
LD = ld -m elf_i386

CFLAGSs += -S
CFLAGSc += -c
LDFLAGS += -dynamic-linker /lib/ld-linux.so.2 -L /usr/lib/ -L /lib -lc
RM = rm -f
SEDc = sed -i -e &apos;/\#include[ &quot;&lt;]*unistd.h[ &quot;&gt;]*/d;&apos; \
    -i -e &apos;1i \#include &lt;unistd.h&gt;&apos; \
    -i -e &apos;s/return 0;/_exit(0);/&apos;
SEDs = sed -i -e &apos;s/main/_start/g&apos;

all: $(TARGET)

$(TARGET):
    @$(SEDc) $(MAIN).c
    @$(CC) $(CFLAGSs) $(MAIN).c
    @$(SEDs) $(MAIN).s
    @$(CC) $(CFLAGSc) $(MAIN).s $(SOURCE)
    @$(LD) $(LDFLAGS) -o $@ $(OBJS)
clean:
    @$(RM) $(MAIN).s $(OBJS) $(TARGET)
</code></pre><p>&#x628A;&#x4E0A;&#x9762;&#x7684;&#x4EE3;&#x78BC;&#x8907;&#x88FD;&#x5230;&#x4E00;&#x500B;Makefile&#x6587;&#x4EF6;&#x4E2D;&#xFF0C;&#x4E26;&#x5229;&#x7528;&#x5B83;&#x4F86;&#x7DE8;&#x8B6F;hello.c&#x3002;</p>
<pre><code>$ make   #&#x7DE8;&#x8B6F;
$ ./hello   #&#x9019;&#x500B;&#x4E5F;&#x662F;&#x53EF;&#x4EE5;&#x6B63;&#x5E38;&#x5DE5;&#x4F5C;&#x7684;
Hello World
$ wc -c hello   #&#x4F46;&#x662F;&#x5927;&#x5C0F;&#x6E1B;&#x5C11;&#x4E86;4382&#x500B;&#x5B57;&#x7BC0;&#xFF0C;&#x6E1B;&#x5C11;&#x4E86;&#x5C07;&#x8FD1; 70%
2060 hello
$ echo &quot;6442-2060&quot; | bc
4382
$ echo &quot;(6442-2060)/6442&quot; | bc -l
.68022353306426575597
</code></pre><p>&#x5C0D;&#x65BC;&#x4E00;&#x500B;&#x6BD4;&#x8F03;&#x5C0F;&#x7684;&#x7A0B;&#x5E8F;&#xFF0C;&#x80FD;&#x5920;&#x6E1B;&#x5C11;&#x5C07;&#x8FD1; 70% &#x201C;&#x6C92;&#x7528;&#x7684;&#x201D;&#x4EE3;&#x78BC;&#x3002;</p>
<p><span id="toc_3928_6176_7"></span></p>
<h3 id="%E5%88%AA%E9%99%A4%E5%B0%8D%E7%A8%8B%E5%BA%8F%E9%81%8B%E8%A1%8C%E6%B2%92%E6%9C%89%E5%BD%B1%E9%9F%BF%E7%9A%84%E7%AF%80%E5%8D%80">&#x522A;&#x9664;&#x5C0D;&#x7A0B;&#x5E8F;&#x904B;&#x884C;&#x6C92;&#x6709;&#x5F71;&#x97FF;&#x7684;&#x7BC0;&#x5340;</h3>
<p>&#x4F7F;&#x7528;&#x4E0A;&#x8FF0; <code>Makefile</code> &#x4F86;&#x7DE8;&#x8B6F;&#x7A0B;&#x5E8F;&#xFF0C;&#x4E0D;&#x93C8;&#x63A5;&#x90A3;&#x4E9B;&#x5C0D;&#x7A0B;&#x5E8F;&#x904B;&#x884C;&#x6C92;&#x6709;&#x591A;&#x5927;&#x5F71;&#x97FF;&#x7684;&#x6587;&#x4EF6;&#xFF0C;&#x5BE6;&#x969B;&#x4E0A;&#x4E5F;&#x76F8;&#x7576;&#x65BC;&#x522A;&#x9664;&#x4E86;&#x4E00;&#x4E9B;&#x201C;&#x6C92;&#x7528;&#x201D;&#x7684;&#x7BC0;&#x5340;&#xFF0C;&#x53EF;&#x4EE5;&#x901A;&#x904E;&#x4E0B;&#x5217;&#x6F14;&#x793A;&#x770B;&#x51FA;&#x9019;&#x500B;&#x5BE6;&#x8CEA;&#x3002;</p>
<pre><code>$ make clean
$ make
$ readelf -l hello | grep &quot;0[0-9]\ \ &quot;
   00
   01     .interp
   02     .interp .hash .dynsym .dynstr .gnu.version .gnu.version_r .rel.plt .plt .text .rodata
   03     .dynamic .got.plt
   04     .dynamic
   05
$ make clean
$ gcc -o hello hello.c
$ readelf -l hello | grep &quot;0[0-9]\ \ &quot;
   00
   01     .interp
   02     .interp .note.ABI-tag .hash .gnu.hash .dynsym .dynstr .gnu.version .gnu.version_r
      .rel.dyn .rel.plt .init .plt .text .fini .rodata .eh_frame
   03     .ctors .dtors .jcr .dynamic .got .got.plt .data .bss
   04     .dynamic
   05     .note.ABI-tag
   06
</code></pre><p>&#x901A;&#x904E;&#x6BD4;&#x8F03;&#x767C;&#x73FE;&#x4F7F;&#x7528;&#x81EA;&#x5B9A;&#x7FA9;&#x7684; <code>Makefile</code> &#x6587;&#x4EF6;&#xFF0C;&#x5C11;&#x4E86;&#x9019;&#x9EBC;&#x591A;&#x7BC0;&#x5340;&#xFF1A; <code>.bss .ctors .data .dtors .eh_frame .fini .gnu.hash .got .init .jcr .note.ABI-tag .rel.dyn</code> &#x3002;
&#x518D;&#x770B;&#x770B;&#x9084;&#x6709;&#x54EA;&#x4E9B;&#x7BC0;&#x5340;&#x53EF;&#x4EE5;&#x522A;&#x9664;&#x5462;&#xFF1F;&#x901A;&#x904E;&#x4E4B;&#x524D;&#x7684;&#x5206;&#x6790;&#x767C;&#x73FE;&#x6709;&#x4E9B;&#x7BC0;&#x5340;&#x662F;&#x5FC5;&#x9808;&#x7684;&#xFF0C;&#x90A3; <code>.hash?.gnu.version?</code> &#x5462;&#xFF0C;&#x901A;&#x904E; <code>strip -R</code>&#xFF08;&#x6216; <code>objcop -R</code>&#xFF09;&#x522A;&#x9664;&#x9019;&#x4E9B;&#x7BC0;&#x5340;&#x8A66;&#x8A66;&#x3002;</p>
<pre><code>$ wc -c hello   #&#x67E5;&#x770B;&#x5927;&#x5C0F;&#xFF0C;&#x4EE5;&#x4FBF;&#x6BD4;&#x8F03;
2060
$ time ./hello    #&#x6211;&#x5011;&#x6BD4;&#x8F03;&#x4E00;&#x4E0B;&#x4E00;&#x4E9B;&#x7BC0;&#x5340;&#x5C0D;&#x57F7;&#x884C;&#x6642;&#x9593;&#x53EF;&#x80FD;&#x5B58;&#x5728;&#x7684;&#x5F71;&#x97FF;
Hello World

real    0m0.001s
user    0m0.000s
sys     0m0.000s
$ strip -R .hash hello   #&#x522A;&#x9664;.hash&#x7BC0;&#x5340;
$ wc -c hello
1448 hello
$ echo &quot;2060-1448&quot; | bc   #&#x6E1B;&#x5C11;&#x4E86;612&#x5B57;&#x7BC0;
612
$ time ./hello           #&#x767C;&#x73FE;&#x57F7;&#x884C;&#x6642;&#x9593;&#x9577;&#x4E86;&#x4E00;&#x4E9B;&#xFF08;&#x5BE6;&#x969B;&#x4E0A;&#x4E5F;&#x53EF;&#x80FD;&#x662F;&#x9032;&#x7A0B;&#x8ABF;&#x5EA6;&#x7684;&#x554F;&#x984C;&#xFF09;
Hello World

real    0m0.006s
user    0m0.000s
sys     0m0.000s
$ strip -R .gnu.version hello   #&#x522A;&#x9664;.gnu.version&#x9084;&#x662F;&#x53EF;&#x4EE5;&#x5DE5;&#x4F5C;
$ wc -c hello
1396 hello
$ echo &quot;1448-1396&quot; | bc      #&#x53C8;&#x6E1B;&#x5C11;&#x4E86;52&#x5B57;&#x7BC0;
52
$ time ./hello
Hello World

real    0m0.130s
user    0m0.004s
sys     0m0.000s
$ strip -R .gnu.version_r hello   #&#x522A;&#x9664;.gnu.version_r&#x5C31;&#x4E0D;&#x5DE5;&#x4F5C;&#x4E86;
$ time ./hello
./hello: error while loading shared libraries: ./hello: unsupported version 0 of Verneed record
</code></pre><p>&#x901A;&#x904E;&#x522A;&#x9664;&#x5404;&#x500B;&#x7BC0;&#x5340;&#x53EF;&#x4EE5;&#x67E5;&#x770B;&#x54EA;&#x4E9B;&#x7BC0;&#x5340;&#x5C0D;&#x7A0B;&#x5E8F;&#x4F86;&#x8AAA;&#x662F;&#x5FC5;&#x9808;&#x7684;&#xFF0C;&#x4E0D;&#x904E;&#x6709;&#x4E9B;&#x7BC0;&#x5340;&#x96D6;&#x7136;&#x4E26;&#x4E0D;&#x5F71;&#x97FF;&#x7A0B;&#x5E8F;&#x7684;&#x904B;&#x884C;&#x537B;&#x53EF;&#x80FD;&#x6703;&#x5F71;&#x97FF;&#x7A0B;&#x5E8F;&#x7684;&#x57F7;&#x884C;&#x6548;&#x7387;&#xFF0C;&#x9019;&#x500B;&#x53EF;&#x4EE5;&#x4E0A;&#x9762;&#x7684;&#x904B;&#x884C;&#x6642;&#x9593;&#x770B;&#x51FA;&#x500B;&#x5927;&#x6982;&#x3002;
&#x901A;&#x904E;&#x522A;&#x9664;&#x5169;&#x500B;&#x201C;&#x6C92;&#x7528;&#x201D;&#x7684;&#x7BC0;&#x5340;&#xFF0C;&#x6211;&#x5011;&#x53C8;&#x6E1B;&#x5C11;&#x4E86; <code>52+612</code>&#xFF0C;&#x5373; 664 &#x5B57;&#x7BC0;&#x3002;</p>
<p><span id="toc_3928_6176_8"></span></p>
<h3 id="%E5%88%AA%E9%99%A4%E5%8F%AF%E5%9F%B7%E8%A1%8C%E6%96%87%E4%BB%B6%E7%9A%84%E7%AF%80%E5%8D%80%E8%A1%A8">&#x522A;&#x9664;&#x53EF;&#x57F7;&#x884C;&#x6587;&#x4EF6;&#x7684;&#x7BC0;&#x5340;&#x8868;</h3>
<p>&#x7528;&#x666E;&#x901A;&#x7684;&#x5DE5;&#x5177;&#x6C92;&#x6709;&#x8FA6;&#x6CD5;&#x522A;&#x9664;&#x7BC0;&#x5340;&#x8868;&#xFF0C;&#x4F46;&#x662F;&#x53C3;&#x8003;&#x8CC7;&#x6599;<a href="http://www.muppetlabs.com/~breadbox/software/tiny/teensy.html" target="_blank">[1]</a>&#x7684;&#x4F5C;&#x8005;&#x5DF2;&#x7D93;&#x5BEB;&#x4E86;&#x9019;&#x6A23;&#x4E00;&#x500B;&#x5DE5;&#x5177;&#x3002;&#x4F60;&#x53EF;&#x4EE5;&#x5F9E;<a href="http://www.muppetlabs.com/~breadbox/software/elfkickers.html" target="_blank">&#x9019;&#x88E1;</a>&#x4E0B;&#x8F09;&#x5230;&#x90A3;&#x500B;&#x5DE5;&#x5177;&#xFF0C;&#x5B83;&#x662F;&#x8A72;&#x4F5C;&#x8005;&#x5BEB;&#x7684;&#x4E00;&#x5E8F;&#x5217;&#x5DE5;&#x5177; <code>ELFkickers</code> &#x4E2D;&#x7684;&#x4E00;&#x500B;&#x3002;</p>
<p>&#x4E0B;&#x8F09;&#x4E26;&#x7DE8;&#x8B6F;&#xFF08;<strong>&#x6CE8;</strong>&#xFF1A;1.0 &#x4E4B;&#x524D;&#x7684;&#x7248;&#x672C;&#x624D;&#x652F;&#x6301; 32 &#x4F4D;&#x548C;&#x6B63;&#x5E38;&#x7DE8;&#x8B6F;&#xFF0C;&#x65B0;&#x7248;&#x672C;&#x5728;&#x4EE3;&#x78BC;&#x4E2D;&#x660E;&#x78BA;&#x9650;&#x5B9A;&#x4E86;&#x6578;&#x64DA;&#x7D50;&#x69CB;&#x70BA; <code>Elf64</code>&#xFF09;&#xFF1A;</p>
<pre><code>$ git clone https://github.com/BR903/ELFkickers
$ cd ELFkickers/sstrip/
$ git checkout f0622afa    # &#x6AA2;&#x51FA; 1.0 &#x7248;
$ make
</code></pre><p>&#x7136;&#x5F8C;&#x8907;&#x88FD;&#x5230; <code>/usr/bin</code> &#x4E0B;&#xFF0C;&#x4E0B;&#x9762;&#x7528;&#x5B83;&#x4F86;&#x522A;&#x9664;&#x7BC0;&#x5340;&#x8868;&#x3002;</p>
<pre><code>$ sstrip hello      #&#x522A;&#x9664;ELF&#x53EF;&#x57F7;&#x884C;&#x6587;&#x4EF6;&#x7684;&#x7BC0;&#x5340;&#x8868;
$ ./hello           #&#x9084;&#x662F;&#x53EF;&#x4EE5;&#x6B63;&#x5E38;&#x904B;&#x884C;&#xFF0C;&#x8AAA;&#x660E;&#x7BC0;&#x5340;&#x8868;&#x5C0D;&#x53EF;&#x57F7;&#x884C;&#x6587;&#x4EF6;&#x7684;&#x904B;&#x884C;&#x6C92;&#x6709;&#x4EFB;&#x4F55;&#x5F71;&#x97FF;
Hello World
$ wc -c hello       #&#x5927;&#x5C0F;&#x96BB;&#x5269;&#x4E0B;708&#x500B;&#x5B57;&#x7BC0;&#x4E86;
708 hello
$ echo &quot;1396-708&quot; | bc  #&#x53C8;&#x6E1B;&#x5C11;&#x4E86;688&#x500B;&#x5B57;&#x7BC0;&#x3002;
688
</code></pre><p>&#x901A;&#x904E;&#x522A;&#x9664;&#x7BC0;&#x5340;&#x8868;&#x53C8;&#x628A;&#x53EF;&#x57F7;&#x884C;&#x6587;&#x4EF6;&#x6E1B;&#x5C11;&#x4E86; 688 &#x5B57;&#x7BC0;&#x3002;&#x73FE;&#x5728;&#x56DE;&#x982D;&#x770B;&#x770B;&#x76F8;&#x5C0D;&#x65BC; <code>gcc</code> &#x9ED8;&#x8A8D;&#x7522;&#x751F;&#x7684;&#x53EF;&#x57F7;&#x884C;&#x6587;&#x4EF6;&#xFF0C;&#x901A;&#x904E;&#x522A;&#x9664;&#x4E00;&#x4E9B;&#x7BC0;&#x5340;&#x548C;&#x7BC0;&#x5340;&#x8868;&#x5230;&#x5E95;&#x6E1B;&#x5C11;&#x4E86;&#x591A;&#x5C11;&#x5B57;&#x7BC0;&#xFF1F;&#x6E1B;&#x5E45;&#x9054;&#x5230;&#x4E86;&#x591A;&#x5C11;&#xFF1F;</p>
<pre><code>$ echo &quot;6442-708&quot; | bc   #
5734
$ echo &quot;(6442-708)/6442&quot; | bc -l
.89009624340266997826
</code></pre><p>&#x6E1B;&#x5C11;&#x4E86; 5734 &#x591A;&#x5B57;&#x7BC0;&#xFF0C;&#x6E1B;&#x5E45;&#x5C07;&#x8FD1; <code>90%</code>&#xFF0C;&#x9019;&#x8AAA;&#x660E;&#xFF1A;&#x5C0D;&#x65BC;&#x4E00;&#x500B;&#x7C21;&#x77ED;&#x7684; <code>hello.c</code> &#x7A0B;&#x5E8F;&#x800C;&#x8A00;&#xFF0C;<code>gcc</code> &#x5F15;&#x5165;&#x4E86;&#x5C07;&#x8FD1; <code>90%</code> &#x7684;&#x5C0D;&#x7A0B;&#x5E8F;&#x904B;&#x884C;&#x6C92;&#x6709;&#x5F71;&#x97FF;&#x7684;&#x6578;&#x64DA;&#x3002;&#x96D6;&#x7136;&#x901A;&#x904E;&#x522A;&#x9664;&#x7BC0;&#x5340;&#x548C;&#x7BC0;&#x5340;&#x8868;&#xFF0C;&#x4F7F;&#x5F97;&#x6700;&#x7D42;&#x7684;&#x6587;&#x4EF6;&#x53EA;&#x6709; 708 &#x5B57;&#x7BC0;&#xFF0C;&#x4F46;&#x662F;&#x6253;&#x5370;&#x4E00;&#x500B; <code>Hello World</code> &#x771F;&#x7684;&#x9700;&#x8981;&#x9019;&#x9EBC;&#x591A;&#x5B57;&#x7BC0;&#x9EBC;&#xFF1F;&#x4E8B;&#x5BE6;&#x4E0A;&#x672A;&#x5FC5;&#xFF0C;&#x56E0;&#x70BA;&#xFF1A;</p>
<ul>
<li>&#x6253;&#x5370;&#x4E00;&#x6BB5; <code>Hello World</code> &#x5B57;&#x7B26;&#x4E32;&#xFF0C;&#x6211;&#x5011;&#x7121;&#x9808;&#x8ABF;&#x7528; <code>printf</code>&#xFF0C;&#x4E5F;&#x5C31;&#x7121;&#x9808;&#x5305;&#x542B;&#x52D5;&#x614B;&#x9023;&#x63A5;&#x5EAB;&#xFF0C;&#x56E0;&#x6B64; <code>.interp</code>&#xFF0C;<code>.dynamic</code> &#x7B49;&#x7BC0;&#x5340;&#x53C8;&#x53EF;&#x4EE5;&#x53BB;&#x6389;&#x3002;&#x70BA;&#x4EC0;&#x9EBC;&#xFF1F;&#x6211;&#x5011;&#x53EF;&#x4EE5;&#x76F4;&#x63A5;&#x4F7F;&#x7528;&#x7CFB;&#x7D71;&#x8ABF;&#x7528; `(sys_write)&#x4F86;&#x6253;&#x5370;&#x5B57;&#x7B26;&#x4E32;&#x3002;</li>
<li>&#x53E6;&#x5916;&#xFF0C;&#x6211;&#x5011;&#x7121;&#x9808;&#x628A; <code>Hello World</code> &#x5B57;&#x7B26;&#x4E32;&#x5B58;&#x653E;&#x5230;&#x53EF;&#x57F7;&#x884C;&#x6587;&#x4EF6;&#x4E2D;&#xFF1F;&#x800C;&#x662F;&#x8B93;&#x7528;&#x6236;&#x628A;&#x5B83;&#x7576;&#x4F5C;&#x53C3;&#x6578;&#x8F38;&#x5165;&#x3002;</li>
</ul>
<p>&#x4E0B;&#x9762;&#xFF0C;&#x7E7C;&#x7E8C;&#x9032;&#x884C;&#x53EF;&#x57F7;&#x884C;&#x6587;&#x4EF6;&#x7684;&#x201C;&#x6E1B;&#x80A5;&#x201D;&#x3002;</p>
<p><span id="toc_3928_6176_9"></span></p>
<h2 id="%E7%94%A8%E5%8C%AF%E7%B7%A8%E8%AA%9E%E8%A8%80%E4%BE%86%E9%87%8D%E5%AF%AB-hello-world-%EF%BC%8876%E5%AD%97%E7%AF%80%EF%BC%89">&#x7528;&#x532F;&#x7DE8;&#x8A9E;&#x8A00;&#x4F86;&#x91CD;&#x5BEB;&quot;Hello World&quot;&#xFF08;76&#x5B57;&#x7BC0;&#xFF09;</h2>
<p><span id="toc_3928_6176_10"></span></p>
<h3 id="%E6%8E%A1%E7%94%A8%E9%BB%98%E8%AA%8D%E7%B7%A8%E8%AD%AF">&#x63A1;&#x7528;&#x9ED8;&#x8A8D;&#x7DE8;&#x8B6F;</h3>
<p>&#x5148;&#x4F86;&#x770B;&#x770B; <code>gcc</code> &#x9ED8;&#x8A8D;&#x7522;&#x751F;&#x7684;&#x5F59;&#x7DE8;&#x4EE3;&#x78BC;&#x60C5;&#x6CC1;&#x3002;&#x901A;&#x904E; <code>gcc</code> &#x7684; <code>-S</code> &#x9078;&#x9805;&#x53EF;&#x5F97;&#x5230;&#x5F59;&#x7DE8;&#x4EE3;&#x78BC;&#x3002;</p>
<pre><code>$ cat hello.c  #&#x9019;&#x500B;&#x662F;&#x4F7F;&#x7528;_exit&#x548C;printf&#x51FD;&#x6578;&#x7684;&#x7248;&#x672C;
#include &lt;stdio.h&gt;      /* printf */
#include &lt;unistd.h&gt;     /* _exit */

int main()
{
    printf(&quot;Hello World\n&quot;);
    _exit(0);
}
$ gcc -S hello.c    #&#x751F;&#x6210;&#x5F59;&#x7DE8;
$ cat hello.s       #&#x9019;&#x88E1;&#x662F;&#x5F59;&#x7DE8;&#x4EE3;&#x78BC;
    .file   &quot;hello.c&quot;
    .section        .rodata
.LC0:
    .string &quot;Hello World&quot;
    .text
.globl main
    .type   main, @function
main:
    leal    4(%esp), %ecx
    andl    $-16, %esp
    pushl   -4(%ecx)
    pushl   %ebp
    movl    %esp, %ebp
    pushl   %ecx
    subl    $4, %esp
    movl    $.LC0, (%esp)
    call    puts
    movl    $0, (%esp)
    call    _exit
    .size   main, .-main
    .ident  &quot;GCC: (GNU) 4.1.3 20070929 (prerelease) (Ubuntu 4.1.2-16ubuntu2)&quot;
    .section        .note.GNU-stack,&quot;&quot;,@progbits
$ gcc -o hello hello.s   #&#x770B;&#x770B;&#x9ED8;&#x8A8D;&#x7522;&#x751F;&#x7684;&#x4EE3;&#x78BC;&#x5927;&#x5C0F;
$ wc -c hello
6523 hello
</code></pre><p><span id="toc_3928_6176_11"></span></p>
<h3 id="%E5%88%AA%E9%99%A4%E6%8E%89%E5%BD%99%E7%B7%A8%E4%BB%A3%E7%A2%BC%E4%B8%AD%E7%84%A1%E9%97%9C%E7%B7%8A%E8%A6%81%E5%85%A7%E5%AE%B9">&#x522A;&#x9664;&#x6389;&#x5F59;&#x7DE8;&#x4EE3;&#x78BC;&#x4E2D;&#x7121;&#x95DC;&#x7DCA;&#x8981;&#x5167;&#x5BB9;</h3>
<p>&#x73FE;&#x5728;&#x5C0D;&#x5F59;&#x7DE8;&#x4EE3;&#x78BC; <code>hello.s</code> &#x9032;&#x884C;&#x7C21;&#x55AE;&#x7684;&#x8655;&#x7406;&#x5F97;&#x5230;&#xFF0C;</p>
<pre><code>.LC0:
    .string &quot;Hello World&quot;
    .text
.globl main
    .type   main, @function
main:
    leal    4(%esp), %ecx
    andl    $-16, %esp
    pushl   -4(%ecx)
    pushl   %ebp
    movl    %esp, %ebp
    pushl   %ecx
    subl    $4, %esp
    movl    $.LC0, (%esp)
    call    puts
    movl    $0, (%esp)
    call    _exit
</code></pre><p>&#x518D;&#x7DE8;&#x8B6F;&#x770B;&#x770B;&#xFF0C;</p>
<pre><code>$ gcc -o hello.o hello.s
$ wc -c hello
6443 hello
$ echo &quot;6523-6443&quot; | bc   #&#x50C5;&#x50C5;&#x6E1B;&#x5C11;&#x4E86;80&#x500B;&#x5B57;&#x7BC0;
80
</code></pre><p><span id="toc_3928_6176_12"></span></p>
<h3 id="%E4%B8%8D%E9%BB%98%E8%AA%8D%E7%B7%A8%E8%AD%AF%E4%B8%A6%E5%88%AA%E9%99%A4%E6%8E%89%E7%84%A1%E9%97%9C%E7%AF%80%E5%8D%80%E5%92%8C%E7%AF%80%E5%8D%80%E8%A1%A8">&#x4E0D;&#x9ED8;&#x8A8D;&#x7DE8;&#x8B6F;&#x4E26;&#x522A;&#x9664;&#x6389;&#x7121;&#x95DC;&#x7BC0;&#x5340;&#x548C;&#x7BC0;&#x5340;&#x8868;</h3>
<p>&#x5982;&#x679C;&#x4E0D;&#x63A1;&#x7528;&#x9ED8;&#x8A8D;&#x7DE8;&#x8B6F;&#x5462;&#x4E26;&#x4E14;&#x522A;&#x9664;&#x6389;&#x5C0D;&#x7A0B;&#x5E8F;&#x904B;&#x884C;&#x6C92;&#x6709;&#x5F71;&#x97FF;&#x7684;&#x7BC0;&#x5340;&#x548C;&#x7BC0;&#x5340;&#x8868;&#x5462;&#xFF1F;</p>
<pre><code>$ sed -i -e &quot;s/main/_start/g&quot; hello.s   #&#x56E0;&#x70BA;&#x6C92;&#x6709;&#x521D;&#x59CB;&#x5316;&#xFF0C;&#x6240;&#x4EE5;&#x5F97;&#x76F4;&#x63A5;&#x9032;&#x5165;&#x4EE3;&#x78BC;&#xFF0C;&#x66FF;&#x63DB;main&#x70BA;_start
$ as --32 -o  hello.o hello.s
$ ld -melf_i386 -o hello hello.o --dynamic-linker /lib/ld-linux.so.2 -L /usr/lib -lc
$ ./hello
hello world!
$ wc -c hello
1812 hello
$ echo &quot;6443-1812&quot; | bc -l   #&#x548C;&#x4E4B;&#x524D;&#x7684;&#x5BE6;&#x9A57;&#x985E;&#x4F3C;&#xFF0C;&#x4E5F;&#x6E1B;&#x5C11;&#x4E86;4k&#x5DE6;&#x53F3;
4631
$ readelf -l hello | grep &quot;\ [0-9][0-9]\ &quot;
   00
   01     .interp
   02     .interp .hash .dynsym .dynstr .gnu.version .gnu.version_r .rel.plt .plt .text
   03     .dynamic .got.plt
   04     .dynamic
$ strip -R .hash hello
$ strip -R .gnu.version hello
$ wc -c hello
1200 hello
$ sstrip hello
$ wc -c hello  #&#x9019;&#x500B;&#x7D50;&#x679C;&#x6BD4;&#x4E4B;&#x524D;&#x7684;708&#xFF08;&#x5728;&#x522A;&#x9664;&#x6240;&#x6709;&#x5783;&#x573E;&#x4FE1;&#x606F;&#x4EE5;&#x5F8C;&#xFF09;&#x500B;&#x5B57;&#x7BC0;&#x5C11;&#x4E86;708-676&#xFF0C;&#x5373;32&#x500B;&#x5B57;&#x7BC0;
676 hello
$ ./hello
Hello World
</code></pre><p>&#x5BB9;&#x6613;&#x767C;&#x73FE;&#x9019; 32 &#x5B57;&#x7BC0;&#x53EF;&#x80FD;&#x8DDF;&#x7BC0;&#x5340; <code>.rodata</code> &#x6709;&#x95DC;&#x4FC2;&#xFF0C;&#x56E0;&#x70BA;&#x525B;&#x624D;&#x5728;&#x93C8;&#x63A5;&#x5B8C;&#x4EE5;&#x5F8C;&#x67E5;&#x770B;&#x7BC0;&#x5340;&#x4FE1;&#x606F;&#x6642;&#xFF0C;&#x4E26;&#x6C92;&#x6709; <code>.rodata</code> &#x7BC0;&#x5340;&#x3002;</p>
<p><span id="toc_3928_6176_13"></span></p>
<h3 id="%E7%94%A8%E7%B3%BB%E7%B5%B1%E8%AA%BF%E7%94%A8%E5%8F%96%E4%BB%A3%E5%BA%AB%E5%87%BD%E6%95%B8">&#x7528;&#x7CFB;&#x7D71;&#x8ABF;&#x7528;&#x53D6;&#x4EE3;&#x5EAB;&#x51FD;&#x6578;</h3>
<p>&#x524D;&#x9762;&#x63D0;&#x5230;&#xFF0C;&#x5BE6;&#x969B;&#x4E0A;&#x9084;&#x53EF;&#x4EE5;&#x4E0D;&#x7528;&#x52D5;&#x614B;&#x9023;&#x63A5;&#x5EAB;&#x4E2D;&#x7684; <code>printf</code> &#x51FD;&#x6578;&#xFF0C;&#x4E5F;&#x4E0D;&#x7528;&#x76F4;&#x63A5;&#x8ABF;&#x7528; <code>_exit</code>&#xFF0C;&#x800C;&#x662F;&#x5728;&#x5F59;&#x7DE8;&#x88E1;&#x982D;&#x4F7F;&#x7528;&#x7CFB;&#x7D71;&#x8ABF;&#x7528;&#xFF0C;&#x9019;&#x6A23;&#x5C31;&#x53EF;&#x4EE5;&#x53BB;&#x6389;&#x548C;&#x52D5;&#x614B;&#x9023;&#x63A5;&#x5EAB;&#x95DC;&#x806F;&#x7684;&#x5167;&#x5BB9;&#x3002;&#x5982;&#x679C;&#x60F3;&#x4E86;&#x89E3;&#x5982;&#x4F55;&#x5728;&#x5F59;&#x7DE8;&#x4E2D;&#x4F7F;&#x7528;&#x7CFB;&#x7D71;&#x8ABF;&#x7528;&#xFF0C;&#x8ACB;&#x53C3;&#x8003;&#x8CC7;&#x6599; <a href="http://www.ibm.com/developerworks/cn/linux/l-assembly/index.html" target="_blank">[9]</a>&#x3002;&#x4F7F;&#x7528;&#x7CFB;&#x7D71;&#x8ABF;&#x7528;&#x91CD;&#x5BEB;&#x4EE5;&#x5F8C;&#x5F97;&#x5230;&#x5982;&#x4E0B;&#x4EE3;&#x78BC;&#xFF0C;</p>
<pre><code>.LC0:
    .string &quot;Hello World\xa\x0&quot;
    .text
.global _start
_start:
    xorl   %eax, %eax
    movb   $4, %al                  #eax = 4, sys_write(fd, addr, len)
    xorl   %ebx, %ebx
    incl   %ebx                     #ebx = 1, standard output
    movl   $.LC0, %ecx              #ecx = $.LC0, the address of string
    xorl   %edx, %edx
    movb   $13, %dl                 #edx = 13, the length of .string
    int    $0x80
    xorl   %eax, %eax
    movl   %eax, %ebx               #ebx = 0
    incl   %eax                     #eax = 1, sys_exit
    int    $0x80
</code></pre><p>&#x73FE;&#x5728;&#x7DE8;&#x8B6F;&#x5C31;&#x4E0D;&#x518D;&#x9700;&#x8981;&#x52D5;&#x614B;&#x93C8;&#x63A5;&#x5668; <code>ld-linux.so</code> &#x4E86;&#xFF0C;&#x4E5F;&#x4E0D;&#x518D;&#x9700;&#x8981;&#x93C8;&#x63A5;&#x4EFB;&#x4F55;&#x5EAB;&#x3002;</p>
<pre><code>$ as --32 -o hello.o hello.s
$ ld -melf_i386 -o hello hello.o
$ readelf -l hello

Elf file type is EXEC (Executable file)
Entry point 0x8048062
There are 1 program headers, starting at offset 52

Program Headers:
  Type           Offset   VirtAddr   PhysAddr   FileSiz MemSiz  Flg Align
  LOAD           0x000000 0x08048000 0x08048000 0x0007b 0x0007b R E 0x1000

 Section to Segment mapping:
  Segment Sections...
   00     .text
$ sstrip hello
$ ./hello           #&#x5B8C;&#x5168;&#x53EF;&#x4EE5;&#x6B63;&#x5E38;&#x5DE5;&#x4F5C;
Hello World
$ wc -c hello
123 hello
$ echo &quot;676-123&quot; | bc   #&#x76F8;&#x5C0D;&#x65BC;&#x4E4B;&#x524D;&#xFF0C;&#x5DF2;&#x7D93;&#x53EA;&#x9700;&#x8981;123&#x500B;&#x5B57;&#x7BC0;&#x4E86;&#xFF0C;&#x53C8;&#x6E1B;&#x5C11;&#x4E86;553&#x500B;&#x5B57;&#x7BC0;
553
</code></pre><p>&#x53EF;&#x4EE5;&#x770B;&#x5230;&#x6548;&#x679C;&#x5F88;&#x660E;&#x986F;&#xFF0C;&#x53EA;&#x5269;&#x4E0B;&#x4E00;&#x500B; <code>LOAD</code> &#x6BB5;&#xFF0C;&#x5B83;&#x5C0D;&#x61C9; <code>.text</code> &#x7BC0;&#x5340;&#x3002;</p>
<p><span id="toc_3928_6176_14"></span></p>
<h3 id="%E6%8A%8A%E5%AD%97%E7%AC%A6%E4%B8%B2%E4%BD%9C%E7%82%BA%E5%8F%83%E6%95%B8%E8%BC%B8%E5%85%A5">&#x628A;&#x5B57;&#x7B26;&#x4E32;&#x4F5C;&#x70BA;&#x53C3;&#x6578;&#x8F38;&#x5165;</h3>
<p>&#x4E0D;&#x904E;&#x662F;&#x5426;&#x9084;&#x6709;&#x8FA6;&#x6CD5;&#x5462;&#xFF1F;&#x628A; <code>Hello World</code> &#x4F5C;&#x70BA;&#x53C3;&#x6578;&#x8F38;&#x5165;&#xFF0C;&#x800C;&#x4E0D;&#x662F;&#x786C;&#x7DE8;&#x78BC;&#x5728;&#x6587;&#x4EF6;&#x4E2D;&#x3002;&#x6240;&#x4EE5;&#x5982;&#x679C;&#x8655;&#x7406;&#x53C3;&#x6578;&#x7684;&#x4EE3;&#x78BC;&#x5C11;&#x65BC; <code>Hello World</code> &#x5B57;&#x7B26;&#x4E32;&#x7684;&#x9577;&#x5EA6;&#xFF0C;&#x90A3;&#x9EBC;&#x5C31;&#x53EF;&#x4EE5;&#x9054;&#x5230;&#x6E1B;&#x5C11;&#x76EE;&#x6A19;&#x6587;&#x4EF6;&#x5927;&#x5C0F;&#x7684;&#x76EE;&#x7684;&#x3002;</p>
<p>&#x5148;&#x4F86;&#x770B;&#x4E00;&#x500B;&#x80FD;&#x5920;&#x6253;&#x5370;&#x7A0B;&#x5E8F;&#x53C3;&#x6578;&#x7684;&#x5F59;&#x7DE8;&#x8A9E;&#x8A00;&#x7A0B;&#x5E8F;&#xFF0C;&#x5B83;&#x4F86;&#x81EA;&#x53C3;&#x8003;&#x8CC7;&#x6599;<a href="http://www.ibm.com/developerworks/cn/linux/l-assembly/index.html" target="_blank">[9]</a>&#x3002;</p>
<pre><code>.text
.globl _start

_start:
    popl    %ecx            # argc
vnext:
    popl    %ecx            # argv
    test    %ecx, %ecx      # &#x7A7A;&#x6307;&#x91DD;&#x8868;&#x660E;&#x7D50;&#x675F;
    jz      exit
    movl    %ecx, %ebx
    xorl    %edx, %edx
strlen:
    movb    (%ebx), %al
    inc     %edx
    inc     %ebx
    test    %al, %al
    jnz     strlen
    movb    $10, -1(%ebx)
    movl    $4, %eax        # &#x7CFB;&#x7D71;&#x8ABF;&#x7528;&#x865F;(sys_write)
    movl    $1, %ebx        # &#x6587;&#x4EF6;&#x63CF;&#x8FF0;&#x7B26;(stdout)
    int     $0x80
    jmp     vnext
exit:
    movl    $1,%eax         # &#x7CFB;&#x7D71;&#x8ABF;&#x7528;&#x865F;(sys_exit)
    xorl    %ebx, %ebx      # &#x9000;&#x51FA;&#x4EE3;&#x78BC;
    int     $0x80
    ret
</code></pre><p>&#x7DE8;&#x8B6F;&#x770B;&#x770B;&#x6548;&#x679C;&#xFF0C;</p>
<pre><code>$ as --32 -o args.o args.s
$ ld -melf_i386 -o args args.o
$ ./args &quot;Hello World&quot;  #&#x80FD;&#x5920;&#x6253;&#x5370;&#x8F38;&#x5165;&#x7684;&#x5B57;&#x7B26;&#x4E32;&#xFF0C;&#x4E0D;&#x932F;
./args
Hello World
$ sstrip args
$ wc -c args           #&#x8655;&#x7406;&#x4EE5;&#x5F8C;&#x53EA;&#x5269;&#x4E0B;130&#x5B57;&#x7BC0;
130 args
</code></pre><p>&#x53EF;&#x4EE5;&#x770B;&#x5230;&#xFF0C;&#x9019;&#x500B;&#x7A0B;&#x5E8F;&#x53EF;&#x4EE5;&#x63A5;&#x6536;&#x7528;&#x6236;&#x8F38;&#x5165;&#x7684;&#x53C3;&#x6578;&#x4E26;&#x6253;&#x5370;&#x51FA;&#x4F86;&#xFF0C;&#x4E0D;&#x904E;&#x5F97;&#x5230;&#x7684;&#x53EF;&#x57F7;&#x884C;&#x6587;&#x4EF6;&#x70BA; 130 &#x5B57;&#x7BC0;&#xFF0C;&#x6BD4;&#x4E4B;&#x524D;&#x7684; 123 &#x500B;&#x5B57;&#x7BC0;&#x9084;&#x591A;&#x4E86; 7 &#x500B;&#x5B57;&#x7BC0;&#xFF0C;&#x770B;&#x770B;&#x9084;&#x6709;&#x6539;&#x9032;&#x9EBC;&#xFF1F;&#x5206;&#x6790;&#x4E0A;&#x9762;&#x7684;&#x4EE3;&#x78BC;&#x5F8C;&#xFF0C;&#x767C;&#x73FE;&#xFF0C;&#x539F;&#x4F86;&#x7684;&#x4EE3;&#x78BC;&#x6709;&#x4E9B;&#x5730;&#x65B9;&#x53EF;&#x80FD;&#x9032;&#x884C;&#x512A;&#x5316;&#xFF0C;&#x512A;&#x5316;&#x5F8C;&#x5F97;&#x5230;&#x5982;&#x4E0B;&#x4EE3;&#x78BC;&#x3002;</p>
<pre><code>.global _start
_start:
    popl %ecx        #&#x5F48;&#x51FA;argc
vnext:
    popl %ecx        #&#x5F48;&#x51FA;argv[0]&#x7684;&#x5730;&#x5740;
    test %ecx, %ecx  #&#x7A7A;&#x6307;&#x91DD;&#x8868;&#x660E;&#x7D50;&#x675F;
    jz exit
    movl %ecx, %ebx  #&#x8907;&#x88FD;&#x5B57;&#x7B26;&#x4E32;&#x5730;&#x5740;&#x5230;ebx&#x5BC4;&#x5B58;&#x5668;
    xorl %edx, %edx  #&#x628A;&#x5B57;&#x7B26;&#x4E32;&#x9577;&#x5EA6;&#x6E05;&#x96F6;
strlen:                         #&#x6C42;&#x8F38;&#x5165;&#x5B57;&#x7B26;&#x4E32;&#x7684;&#x9577;&#x5EA6;
    movb (%ebx), %al        #&#x8907;&#x88FD;&#x5B57;&#x7B26;&#x5230;al&#xFF0C;&#x4EE5;&#x4FBF;&#x5224;&#x65B7;&#x662F;&#x5426;&#x70BA;&#x5B57;&#x7B26;&#x4E32;&#x7D50;&#x675F;&#x7B26;\0
    inc %edx                #edx&#x5B58;&#x653E;&#x6BCF;&#x500B;&#x7576;&#x524D;&#x5B57;&#x7B26;&#x4E32;&#x7684;&#x9577;&#x5EA6;
    inc %ebx                #ebx&#x5B58;&#x653E;&#x6BCF;&#x500B;&#x7576;&#x524D;&#x5B57;&#x7B26;&#x7684;&#x5730;&#x5740;
    test %al, %al           #&#x5224;&#x65B7;&#x5B57;&#x7B26;&#x4E32;&#x662F;&#x5426;&#x7D50;&#x675F;&#xFF0C;&#x5373;&#x662F;&#x5426;&#x9047;&#x5230;\0
    jnz strlen
    movb $10, -1(%ebx)      #&#x5728;&#x5B57;&#x7B26;&#x4E32;&#x672B;&#x5C3E;&#x63D2;&#x5165;&#x4E00;&#x500B;&#x63DB;&#x884C;&#x7B26;\0xa
    xorl %eax, %eax
    movb $4, %al            #eax = 4, sys_write(fd, addr, len)
    xorl %ebx, %ebx
    incl %ebx               #ebx = 1, standard output
    int $0x80
    jmp vnext
exit:
    xorl %eax, %eax
    movl %eax, %ebx                 #ebx = 0
    incl %eax               #eax = 1, sys_exit
    int $0x80
</code></pre><p>&#x518D;&#x6E2C;&#x8A66;&#xFF08;&#x8A18;&#x5F97;&#x5148;&#x91CD;&#x65B0;&#x5F59;&#x7DE8;&#x3001;&#x93C8;&#x63A5;&#x4E26;&#x522A;&#x9664;&#x6C92;&#x7528;&#x7684;&#x7BC0;&#x5340;&#x548C;&#x7BC0;&#x5340;&#x8868;&#xFF09;&#x3002;</p>
<pre><code>$ wc -c hello
124 hello
</code></pre><p>&#x73FE;&#x5728;&#x53EA;&#x6709; 124 &#x500B;&#x5B57;&#x7BC0;&#xFF0C;&#x4E0D;&#x904E;&#x9084;&#x662F;&#x6BD4; 123 &#x500B;&#x5B57;&#x7BC0;&#x591A;&#x4E00;&#x500B;&#xFF0C;&#x9084;&#x6709;&#x4EC0;&#x9EBC;&#x512A;&#x5316;&#x7684;&#x8FA6;&#x6CD5;&#x9EBC;&#xFF1F;</p>
<p>&#x5148;&#x4F86;&#x770B;&#x770B;&#x76EE;&#x524D; <code>hello</code> &#x7684;&#x529F;&#x80FD;&#xFF0C;&#x611F;&#x89BA;&#x4E0D;&#x592A;&#x7B26;&#x5408;&#x8981;&#x6C42;&#xFF0C;&#x56E0;&#x70BA;&#x53EA;&#x9700;&#x8981;&#x6253;&#x5370; <code>Hello World</code>&#xFF0C;&#x6240;&#x4EE5;&#x4E0D;&#x5FC5;&#x8655;&#x7406;&#x6240;&#x6709;&#x7684;&#x53C3;&#x6578;&#xFF0C;&#x50C5;&#x50C5;&#x9700;&#x8981;&#x63A5;&#x6536;&#x4E26;&#x6253;&#x5370;&#x4E00;&#x500B;&#x53C3;&#x6578;&#x5C31;&#x53EF;&#x4EE5;&#x3002;&#x9019;&#x6A23;&#x7684;&#x8A71;&#xFF0C;&#x628A; <code>jmp vnext</code>&#xFF08;2 &#x5B57;&#x7BC0;&#xFF09;&#x9019;&#x500B;&#x5FAA;&#x74B0;&#x53BB;&#x6389;&#xFF0C;&#x7136;&#x5F8C;&#x5728;&#x7B2C;&#x4E00;&#x500B; <code>pop %ecx</code> &#x8A9E;&#x53E5;&#x4E4B;&#x524D;&#x52A0;&#x4E00;&#x500B; <code>pop %ecx</code>&#xFF08;1 &#x5B57;&#x7BC0;&#xFF09;&#x8A9E;&#x53E5;&#x5C31;&#x53EF;&#x4EE5;&#x3002;</p>
<pre><code>.global _start
_start:
    popl %ecx
    popl %ecx        #&#x5F48;&#x51FA;argc[0]&#x7684;&#x5730;&#x5740;
    popl %ecx        #&#x5F48;&#x51FA;argv[1]&#x7684;&#x5730;&#x5740;
    test %ecx, %ecx
    jz exit
    movl %ecx, %ebx
    xorl %edx, %edx
strlen:
    movb (%ebx), %al
    inc %edx
    inc %ebx
    test %al, %al
    jnz strlen
    movb $10, -1(%ebx)
    xorl %eax, %eax
    movb $4, %al
    xorl %ebx, %ebx
    incl %ebx
    int $0x80
exit:
    xorl %eax, %eax
    movl %eax, %ebx
    incl %eax
    int $0x80
</code></pre><p>&#x73FE;&#x5728;&#x525B;&#x597D; 123 &#x5B57;&#x7BC0;&#xFF0C;&#x548C;&#x539F;&#x4F86;&#x90A3;&#x500B;&#x4EE3;&#x78BC;&#x5927;&#x5C0F;&#x4E00;&#x6A23;&#xFF0C;&#x4E0D;&#x904E;&#x4ED4;&#x7D30;&#x5206;&#x6790;&#xFF0C;&#x9084;&#x662F;&#x6709;&#x6E1B;&#x5C11;&#x4EE3;&#x78BC;&#x7684;&#x9918;&#x5730;&#xFF1A;&#x56E0;&#x70BA;&#x5728;&#x9019;&#x500B;&#x4EE3;&#x78BC;&#x4E2D;&#xFF0C;&#x7528;&#x4E86;&#x4E00;&#x6BB5;&#x984D;&#x5916;&#x7684;&#x4EE3;&#x78BC;&#x8A08;&#x7B97;&#x5B57;&#x7B26;&#x4E32;&#x7684;&#x9577;&#x5EA6;&#xFF0C;&#x5BE6;&#x969B;&#x4E0A;&#x5982;&#x679C;&#x50C5;&#x50C5;&#x9700;&#x8981;&#x6253;&#x5370; <code>Hello World</code>&#xFF0C;&#x90A3;&#x9EBC;&#x5B57;&#x7B26;&#x4E32;&#x7684;&#x9577;&#x5EA6;&#x662F;&#x56FA;&#x5B9A;&#x7684;&#xFF0C;&#x5373; 12 &#x3002;&#x6240;&#x4EE5;&#x9019;&#x6BB5;&#x4EE3;&#x78BC;&#x53EF;&#x53BB;&#x6389;&#xFF0C;&#x8207;&#x6B64;&#x540C;&#x6642;&#x6E2C;&#x8A66;&#x5B57;&#x7B26;&#x4E32;&#x662F;&#x5426;&#x70BA;&#x7A7A;&#x4E5F;&#x5C31;&#x6C92;&#x6709;&#x5FC5;&#x8981;&#xFF08;&#x4E0D;&#x904E;&#x53EF;&#x80FD;&#x5F71;&#x97FF;&#x4EE3;&#x78BC;&#x5065;&#x58EF;&#x6027;&#xFF01;&#xFF09;&#xFF0C;&#x7576;&#x7136;&#xFF0C;&#x70BA;&#x4E86;&#x80FD;&#x5920;&#x5728;&#x6253;&#x5370;&#x5B57;&#x7B26;&#x4E32;&#x5F8C;&#x5C31;&#x63DB;&#x884C;&#xFF0C;&#x5728;&#x4E32;&#x7684;&#x672B;&#x5C3E;&#x9700;&#x8981;&#x52A0;&#x4E00;&#x500B;&#x56DE;&#x8ECA;&#xFF08;<code>$10</code>&#xFF09;&#x4E26;&#x4E14;&#x8A2D;&#x7F6E;&#x5B57;&#x7B26;&#x4E32;&#x7684;&#x9577;&#x5EA6;&#x70BA; <code>12+1</code>&#xFF0C;&#x5373; 13&#xFF0C;</p>
<pre><code>.global _start
_start:
    popl %ecx
    popl %ecx
    popl %ecx
    movb $10,12(%ecx) #&#x5728;Hello World&#x7684;&#x7D50;&#x5C3E;&#x52A0;&#x4E00;&#x500B;&#x63DB;&#x884C;&#x7B26;
    xorl %edx, %edx
    movb $13, %dl
    xorl %eax, %eax
    movb $4, %al
    xorl %ebx, %ebx
    incl %ebx
    int $0x80
    xorl %eax, %eax
    movl %eax, %ebx
    incl %eax
    int $0x80
</code></pre><p>&#x518D;&#x770B;&#x770B;&#x6548;&#x679C;&#xFF0C;</p>
<pre><code>$ wc -c hello
111 hello
</code></pre><p><span id="toc_3928_6176_15"></span></p>
<h3 id="%E5%AF%84%E5%AD%98%E5%99%A8%E8%B3%A6%E5%80%BC%E9%87%8D%E7%94%A8">&#x5BC4;&#x5B58;&#x5668;&#x8CE6;&#x503C;&#x91CD;&#x7528;</h3>
<p>&#x73FE;&#x5728;&#x53EA;&#x5269;&#x4E0B; 111 &#x5B57;&#x7BC0;&#xFF0C;&#x6BD4;&#x525B;&#x624D;&#x5C11;&#x4E86; 12 &#x5B57;&#x7BC0;&#x3002;&#x8C8C;&#x4F3C;&#x5230;&#x4E86;&#x6975;&#x9650;&#xFF1F;&#x9084;&#x6709;&#x63AA;&#x65BD;&#x9EBC;&#xFF1F;</p>
<p>&#x9084;&#x6709;&#xFF0C;&#x4ED4;&#x7D30;&#x5206;&#x6790;&#x767C;&#x73FE;&#xFF1A;&#x7CFB;&#x7D71;&#x8ABF;&#x7528; <code>sys_exit</code> &#x548C; <code>sys_write</code> &#x90FD;&#x7528;&#x5230;&#x4E86; <code>eax</code> &#x548C; <code>ebx</code> &#x5BC4;&#x5B58;&#x5668;&#xFF0C;&#x5B83;&#x5011;&#x4E4B;&#x9593;&#x525B;&#x597D;&#x6709;&#x90A3;&#x9EBC;&#x4E00;&#x9EDE;&#x5DE7;&#x5408;&#xFF1A;</p>
<ul>
<li>sys_exit &#x8ABF;&#x7528;&#x6642;&#xFF0C;<code>eax</code> &#x9700;&#x8981;&#x8A2D;&#x7F6E;&#x70BA; 1&#xFF0C;<code>ebx</code> &#x9700;&#x8981;&#x8A2D;&#x7F6E;&#x70BA; 0 &#x3002;</li>
<li>sys_write &#x8ABF;&#x7528;&#x6642;&#xFF0C;<code>ebx</code> &#x525B;&#x597D;&#x662F; 1 &#x3002;</li>
</ul>
<p>&#x56E0;&#x6B64;&#xFF0C;&#x5982;&#x679C;&#x5728; <code>sys_exit</code> &#x8ABF;&#x7528;&#x4E4B;&#x524D;&#xFF0C;&#x5148;&#x628A; <code>ebx</code> &#x8907;&#x88FD;&#x5230; <code>eax</code> &#x4E2D;&#xFF0C;&#x518D;&#x5C0D; <code>ebx</code> &#x6E1B;&#x4E00;&#xFF0C;&#x5247;&#x53EF;&#x6E1B;&#x5C11;&#x5169;&#x500B;&#x5B57;&#x7BC0;&#x3002;</p>
<p>&#x4E0D;&#x904E;&#xFF0C;&#x56E0;&#x70BA;&#x6A19;&#x6E96;&#x8F38;&#x5165;&#x3001;&#x6A19;&#x6E96;&#x8F38;&#x51FA;&#x548C;&#x6A19;&#x6E96;&#x932F;&#x8AA4;&#x90FD;&#x6307;&#x5411;&#x7D42;&#x7AEF;&#xFF0C;&#x5982;&#x679C;&#x5F80;&#x6A19;&#x6E96;&#x8F38;&#x5165;&#x5BEB;&#x5165;&#x4E00;&#x4E9B;&#x6771;&#x897F;&#xFF0C;&#x5B83;&#x9084;&#x662F;&#x6703;&#x8F38;&#x51FA;&#x5230;&#x6A19;&#x6E96;&#x8F38;&#x51FA;&#x4E0A;&#xFF0C;&#x6240;&#x4EE5;&#x5728;&#x4E0A;&#x8FF0;&#x4EE3;&#x78BC;&#x4E2D;&#x5982;&#x679C;&#x5728; <code>sys_write</code> &#x4E4B;&#x524D; <code>ebx</code> &#x8A2D;&#x7F6E;&#x70BA; 0&#xFF0C;&#x90A3;&#x9EBC;&#x4E5F;&#x53EF;&#x6B63;&#x5E38;&#x5F80;&#x5C4F;&#x5E55;&#x4E0A;&#x6253;&#x5370; <code>Hello World</code>&#xFF0C;&#x9019;&#x6A23;&#x7684;&#x8A71;&#xFF0C;<code>sys_exit</code> &#x8ABF;&#x7528;&#x524D;&#x5C31;&#x6C92;&#x5FC5;&#x8981;&#x4FEE;&#x6539; <code>ebx</code>&#xFF0C;&#x800C;&#x50C5;&#x9700;&#x628A; <code>eax</code> &#x8A2D;&#x7F6E;&#x70BA; 1&#xFF0C;&#x9019;&#x6A23;&#x5C31;&#x53EF;&#x6E1B;&#x5C11; 3 &#x500B;&#x5B57;&#x7BC0;&#x3002;</p>
<pre><code>.global _start
_start:
    popl %ecx
    popl %ecx
    popl %ecx
    movb $10,12(%ecx)
    xorl %edx, %edx
    movb $13, %dl
    xorl %eax, %eax
    movb $4, %al
    xorl %ebx, %ebx
    int $0x80
    xorl %eax, %eax
    incl %eax
    int $0x80
</code></pre><p>&#x770B;&#x770B;&#x6548;&#x679C;&#xFF0C;</p>
<pre><code>$ wc -c hello
108 hello
</code></pre><p>&#x73FE;&#x5728;&#x770B;&#x4E00;&#x4E0B;&#x7D14;&#x7CB9;&#x7684;&#x6307;&#x4EE4;&#x9084;&#x6709;&#x591A;&#x5C11;&#xFF1F;</p>
<pre><code>$ readelf -h hello | grep Size
  Size of this header:               52 (bytes)
  Size of program headers:           32 (bytes)
  Size of section headers:           0 (bytes)
$  echo &quot;108-52-32&quot; | bc
24
</code></pre><p><span id="toc_3928_6176_16"></span></p>
<h3 id="%E9%80%9A%E9%81%8E%E6%96%87%E4%BB%B6%E5%90%8D%E5%82%B3%E9%81%9E%E5%8F%83%E6%95%B8">&#x901A;&#x904E;&#x6587;&#x4EF6;&#x540D;&#x50B3;&#x905E;&#x53C3;&#x6578;</h3>
<p>&#x5C0D;&#x65BC;&#x6A19;&#x6E96;&#x7684; <code>main</code> &#x51FD;&#x6578;&#x7684;&#x5169;&#x500B;&#x53C3;&#x6578;&#xFF0C;&#x6587;&#x4EF6;&#x540D;&#x5BE6;&#x969B;&#x4E0A;&#x4F5C;&#x70BA;&#x7B2C;&#x4E8C;&#x500B;&#x53C3;&#x6578;&#xFF08;&#x6578;&#x7D44;&#xFF09;&#x7684;&#x7B2C;&#x4E00;&#x500B;&#x5143;&#x7D20;&#x50B3;&#x5165;&#xFF0C;&#x5982;&#x679C;&#x50C5;&#x50C5;&#x662F;&#x70BA;&#x4E86;&#x6253;&#x5370;&#x4E00;&#x500B;&#x5B57;&#x7B26;&#x4E32;&#xFF0C;&#x90A3;&#x9EBC;&#x53EF;&#x4EE5;&#x6253;&#x5370;&#x6587;&#x4EF6;&#x540D;&#x672C;&#x8EAB;&#x3002;&#x4F8B;&#x5982;&#xFF0C;&#x8981;&#x6253;&#x5370; <code>Hello World</code>&#xFF0C;&#x53EF;&#x4EE5;&#x628A;&#x6587;&#x4EF6;&#x540D;&#x547D;&#x540D;&#x70BA; <code>Hello World</code> &#x5373;&#x53EF;&#x3002;</p>
<p>&#x9019;&#x6A23;&#x5730;&#x8A71;&#xFF0C;&#x4EE3;&#x78BC;&#x4E2D;&#x5C31;&#x53EF;&#x4EE5;&#x522A;&#x9664;&#x6389;&#x4E00;&#x689D; <code>popl</code> &#x6307;&#x4EE4;&#xFF0C;&#x6E1B;&#x5C11; 1 &#x500B;&#x5B57;&#x7BC0;&#xFF0C;&#x8B8A;&#x6210; 107 &#x500B;&#x5B57;&#x7BC0;&#x3002;</p>
<pre><code>.global _start
_start:
    popl %ecx
    popl %ecx
    movb $10,12(%ecx)
    xorl %edx, %edx
    movb $13, %dl
    xorl %eax, %eax
    movb $4, %al
    xorl %ebx, %ebx
    int $0x80
    xorl %eax, %eax
    incl %eax
    int $0x80
</code></pre><p>&#x770B;&#x770B;&#x6548;&#x679C;&#xFF0C;</p>
<pre><code>$ as --32 -o hello.o hello.s
$ ld -melf_i386 -o hello hello.o
$ sstrip hello
$ wc -c hello
107
$ mv hello &quot;Hello World&quot;
$ export PATH=./:$PATH
$ Hello\ World
Hello World
</code></pre><p><span id="toc_3928_6176_17"></span></p>
<h3 id="%E5%88%AA%E9%99%A4%E9%9D%9E%E5%BF%85%E8%A6%81%E6%8C%87%E4%BB%A4">&#x522A;&#x9664;&#x975E;&#x5FC5;&#x8981;&#x6307;&#x4EE4;</h3>
<p>&#x5728;&#x6E2C;&#x8A66;&#x4E2D;&#x767C;&#x73FE;&#xFF0C;<code>edx</code>&#xFF0C;<code>eax</code>&#xFF0C;<code>ebx</code> &#x7684;&#x9AD8;&#x4F4D;&#x5373;&#x4F7F;&#x4E0D;&#x521D;&#x59CB;&#x5316;&#xFF0C;&#x4E5F;&#x5E38;&#x70BA; 0&#xFF0C;&#x5982;&#x679C;&#x4E0D;&#x8003;&#x616E;&#x5065;&#x58EF;&#x6027;&#xFF08;&#x50C5;&#x9019;&#x88E1;&#x5BE6;&#x9A57;&#x7528;&#xFF0C;&#x5BE6;&#x969B;&#x4F7F;&#x7528;&#x4E2D;&#x5FC5;&#x9808;&#x8003;&#x616E;&#x5065;&#x58EF;&#x6027;&#xFF09;&#xFF0C;&#x5E7E;&#x689D; <code>xorl</code> &#x6307;&#x4EE4;&#x53EF;&#x4EE5;&#x79FB;&#x9664;&#x6389;&#x3002;</p>
<p>&#x53E6;&#x5916;&#xFF0C;&#x5982;&#x679C;&#x53EA;&#x662F;&#x70BA;&#x4E86;&#x6F14;&#x793A;&#x6253;&#x5370;&#x5B57;&#x7B26;&#x4E32;&#xFF0C;&#x5B8C;&#x5168;&#x53EF;&#x4EE5;&#x4E0D;&#x7528;&#x6253;&#x5370;&#x63DB;&#x884C;&#x7B26;&#xFF0C;&#x9019;&#x6A23;&#x4E0B;&#x4F86;&#xFF0C;&#x4EE3;&#x78BC;&#x53EF;&#x4EE5;&#x7D9C;&#x5408;&#x512A;&#x5316;&#x6210;&#x5982;&#x4E0B;&#x5E7E;&#x689D;&#x6307;&#x4EE4;&#xFF1A;</p>
<pre><code>.global _start
_start:
    popl %ecx    # argc
    popl %ecx    # argv[0]
    movb $5, %dl    # &#x8A2D;&#x7F6E;&#x5B57;&#x7B26;&#x4E32;&#x9577;&#x5EA6;
    movb $4, %al    # eax = 4, &#x8A2D;&#x7F6E;&#x7CFB;&#x7D71;&#x8ABF;&#x7528;&#x865F;, sys_write(fd, addr, len) : ebx, ecx, edx
    int $0x80
    movb $1, %al
    int $0x80
</code></pre><p>&#x770B;&#x770B;&#x6548;&#x679C;&#xFF1A;</p>
<pre><code>$ as --32 -o hello.o hello.s
$ ld -melf_i386 -o hello hello.o
$ sstrip hello
$ wc -c hello
96
</code></pre><p><span id="toc_3928_6176_18"></span></p>
<h2 id="%E5%90%88%E4%BD%B5%E4%BB%A3%E7%A2%BC%E6%AE%B5%E3%80%81%E7%A8%8B%E5%BA%8F%E9%A0%AD%E5%92%8C%E6%96%87%E4%BB%B6%E9%A0%AD%EF%BC%8852%E5%AD%97%E7%AF%80%EF%BC%89">&#x5408;&#x4F75;&#x4EE3;&#x78BC;&#x6BB5;&#x3001;&#x7A0B;&#x5E8F;&#x982D;&#x548C;&#x6587;&#x4EF6;&#x982D;&#xFF08;52&#x5B57;&#x7BC0;&#xFF09;</h2>
<p><span id="toc_3928_6176_19"></span></p>
<h3 id="%E6%8A%8A%E4%BB%A3%E7%A2%BC%E6%AE%B5%E7%A7%BB%E5%85%A5%E6%96%87%E4%BB%B6%E9%A0%AD">&#x628A;&#x4EE3;&#x78BC;&#x6BB5;&#x79FB;&#x5165;&#x6587;&#x4EF6;&#x982D;</h3>
<p>&#x7D14;&#x7CB9;&#x7684;&#x6307;&#x4EE4;&#x53EA;&#x6709; <code>96-84=12</code> &#x500B;&#x5B57;&#x7BC0;&#x4E86;&#xFF0C;&#x9084;&#x6709;&#x8FA6;&#x6CD5;&#x518D;&#x6E1B;&#x5C11;&#x76EE;&#x6A19;&#x6587;&#x4EF6;&#x7684;&#x5927;&#x5C0F;&#x9EBC;&#xFF1F;&#x5982;&#x679C;&#x770B;&#x4E86;&#x53C3;&#x8003;&#x8CC7;&#x6599; <a href="http://www.muppetlabs.com/~breadbox/software/tiny/teensy.html" target="_blank">[1]</a>&#xFF0C;&#x770B;&#x6A23;&#x5B50;&#x4F60;&#x53C8;&#x8981;&#x8822;&#x8822;&#x6B32;&#x52D5;&#x4E86;&#xFF1A;&#x9019; 12 &#x500B;&#x5B57;&#x7BC0;&#x662F;&#x5426;&#x53EF;&#x4EE5;&#x63D2;&#x5165;&#x5230;&#x6587;&#x4EF6;&#x982D;&#x90E8;&#x6216;&#x7A0B;&#x5E8F;&#x982D;&#x90E8;&#xFF1F;&#x5982;&#x679C;&#x53EF;&#x4EE5;&#x90A3;&#x662F;&#x5426;&#x610F;&#x5473;&#x8457;&#x9084;&#x53EF;&#x6E1B;&#x5C11;&#x53EF;&#x57F7;&#x884C;&#x6587;&#x4EF6;&#x7684;&#x5927;&#x5C0F;&#x5462;&#xFF1F;&#x73FE;&#x5728;&#x4F86;&#x6BD4;&#x8F03;&#x4E00;&#x4E0B;&#x9019;&#x4E09;&#x90E8;&#x5206;&#x7684;&#x5341;&#x516D;&#x9032;&#x5236;&#x5167;&#x5BB9;&#x3002;</p>
<pre><code>$ hexdump -C hello -n 52     #&#x6587;&#x4EF6;&#x982D;(52bytes)
00000000  7f 45 4c 46 01 01 01 00  00 00 00 00 00 00 00 00  |.ELF............|
00000010  02 00 03 00 01 00 00 00  54 80 04 08 34 00 00 00  |........T...4...|
00000020  00 00 00 00 00 00 00 00  34 00 20 00 01 00 00 00  |........4. .....|
00000030  00 00 00 00                                       |....|
00000034
$ hexdump -C hello -s 52 -n 32    #&#x7A0B;&#x5E8F;&#x982D;(32bytes)
00000034  01 00 00 00 00 00 00 00  00 80 04 08 00 80 04 08  |................|
00000044  6c 00 00 00 6c 00 00 00  05 00 00 00 00 10 00 00  |l...l...........|
00000054
$ hexdump -C hello -s 84          #&#x5BE6;&#x969B;&#x4EE3;&#x78BC;&#x90E8;&#x5206;(12bytes)
00000054  59 59 b2 05 b0 04 cd 80  b0 01 cd 80              |YY..........|
00000060
</code></pre><p>&#x5F9E;&#x4E0A;&#x9762;&#x7D50;&#x679C;&#x767C;&#x73FE; <code>ELF</code> &#x6587;&#x4EF6;&#x982D;&#x90E8;&#x548C;&#x7A0B;&#x5E8F;&#x982D;&#x90E8;&#x9084;&#x6709;&#x597D;&#x4E9B;&#x7A7A;&#x6D1E;&#xFF08;0&#xFF09;&#xFF0C;&#x662F;&#x5426;&#x53EF;&#x4EE5;&#x628A;&#x6307;&#x4EE4;&#x5B57;&#x7BC0;&#x5206;&#x6563;&#x653E;&#x5165;&#x5230;&#x90A3;&#x4E9B;&#x7A7A;&#x6D1E;&#x88E1;&#x6216;&#x8005;&#x662F;&#x76F4;&#x63A5;&#x8986;&#x84CB;&#x6389;&#x90A3;&#x4E9B;&#x7CFB;&#x7D71;&#x4E26;&#x4E0D;&#x95DC;&#x5FC3;&#x7684;&#x5167;&#x5BB9;&#xFF1F;&#x6291;&#x6216;&#x662F;&#x628A;&#x4EE3;&#x78BC;&#x58D3;&#x7E2E;&#x4EE5;&#x5F8C;&#x653E;&#x5165;&#x53EF;&#x57F7;&#x884C;&#x6587;&#x4EF6;&#x4E2D;&#xFF0C;&#x4E26;&#x5728;&#x5176;&#x4E2D;&#x5BE6;&#x73FE;&#x4E00;&#x500B;&#x89E3;&#x58D3;&#x7E2E;&#x7B97;&#x6CD5;&#xFF1F;&#x9084;&#x53EF;&#x4EE5;&#x662F;&#x901A;&#x904E;&#x4E00;&#x4E9B;&#x4EE3;&#x78BC;&#x8986;&#x84CB;&#x7387;&#x6E2C;&#x8A66;&#x5DE5;&#x5177;&#xFF08;<code>gcov</code>&#xFF0C;<code>prof</code>&#xFF09;&#x5C0D;&#x4F60;&#x7684;&#x4EE3;&#x78BC;&#x9032;&#x884C;&#x512A;&#x5316;&#xFF1F;</p>
<p>&#x5728;&#x7E7C;&#x7E8C;&#x4ECB;&#x7D39;&#x4E4B;&#x524D;&#xFF0C;&#x5148;&#x4F86;&#x770B;&#x4E00;&#x500B; <code>dd</code> &#x5DE5;&#x5177;&#xFF0C;&#x53EF;&#x4EE5;&#x7528;&#x4F86;&#x76F4;&#x63A5;&#x201C;&#x7DE8;&#x8F2F;&#x201D; <code>ELF</code> &#x6587;&#x4EF6;&#xFF0C;&#x4F8B;&#x5982;&#xFF0C;</p>
<p>&#x76F4;&#x63A5;&#x5F80;&#x6307;&#x5B9A;&#x4F4D;&#x7F6E;&#x5BEB;&#x5165; <code>0xff</code> &#xFF1A;</p>
<pre><code>$ hexdump -C hello -n 16    # &#x5BEB;&#x5165;&#x524D;&#xFF0C;elf&#x6587;&#x4EF6;&#x524D;16&#x500B;&#x5B57;&#x7BC0;
00000000  7f 45 4c 46 01 01 01 00  00 00 00 00 00 00 00 00  |.ELF............|
00000010
$ echo -ne &quot;\xff&quot; | dd of=hello bs=1 count=1 seek=15 conv=notrunc    # &#x628A;&#x6700;&#x5F8C;&#x4E00;&#x500B;&#x5B57;&#x7BC0;0&#x8986;&#x84CB;&#x6389;
1+0 records in
1+0 records out
1 byte (1 B) copied, 3.7349e-05 s, 26.8 kB/s
$ hexdump -C hello -n 16    # &#x5BEB;&#x5165;&#x5F8C;&#x679C;&#x7136;&#x88AB;&#x8986;&#x84CB;
00000000  7f 45 4c 46 01 01 01 00  00 00 00 00 00 00 00 ff  |.ELF............|
00000010
</code></pre><ul>
<li><code>seek=15</code> &#x8868;&#x793A;&#x6307;&#x5B9A;&#x5BEB;&#x5165;&#x4F4D;&#x7F6E;&#x70BA;&#x7B2C; 15 &#x500B;&#xFF08;&#x5F9E;&#x7B2C; 0 &#x500B;&#x958B;&#x59CB;&#xFF09;</li>
<li><code>conv=notrunc</code> &#x9078;&#x9805;&#x8868;&#x793A;&#x8981;&#x4FDD;&#x7559;&#x5BEB;&#x5165;&#x4F4D;&#x7F6E;&#x4E4B;&#x5F8C;&#x7684;&#x5167;&#x5BB9;&#xFF0C;&#x9ED8;&#x8A8D;&#x60C5;&#x6CC1;&#x4E0B;&#x6703;&#x622A;&#x65B7;&#x3002;</li>
<li><code>bs=1</code> &#x8868;&#x793A;&#x4E00;&#x6B21;&#x8B80;/&#x5BEB; 1 &#x500B;</li>
<li><code>count=1</code> &#x8868;&#x793A;&#x7E3D;&#x5171;&#x5BEB; 1 &#x6B21;</li>
</ul>
<p>&#x8986;&#x84CB;&#x591A;&#x500B;&#x9023;&#x7E8C;&#x7684;&#x503C;&#xFF1A;</p>
<p>&#x628A;&#x7B2C; 12&#xFF0C;13&#xFF0C;14&#xFF0C;15 &#x9023;&#x7E8C; 4 &#x500B;&#x5B57;&#x7BC0;&#x5168;&#x90E8;&#x8CE6;&#x503C;&#x70BA; <code>0xff</code> &#x3002;</p>
<pre><code>$ echo -ne &quot;\xff\xff\xff\xff&quot; | dd of=hello bs=1 count=4 seek=12 conv=notrunc
$ hexdump -C hello -n 16
00000000  7f 45 4c 46 01 01 01 00  00 00 00 00 ff ff ff ff  |.ELF............|
00000010
</code></pre><p>&#x4E0B;&#x9762;&#xFF0C;&#x901A;&#x904E;&#x5F80;&#x6587;&#x4EF6;&#x982D;&#x6307;&#x5B9A;&#x4F4D;&#x7F6E;&#x5BEB;&#x5165; <code>0xff</code> &#x78BA;&#x8A8D;&#x54EA;&#x4E9B;&#x90E8;&#x5206;&#x5C0D;&#x65BC;&#x53EF;&#x57F7;&#x884C;&#x6587;&#x4EF6;&#x7684;&#x57F7;&#x884C;&#x662F;&#x5426;&#x6709;&#x5F71;&#x97FF;&#xFF1F;&#x9019;&#x88E1;&#x662F;&#x9010;&#x6B65;&#x6E2C;&#x8A66;&#x5F8C;&#x767C;&#x73FE;&#x4F9D;&#x7136;&#x80FD;&#x5920;&#x57F7;&#x884C;&#x7684;&#x60C5;&#x6CC1;&#xFF1A;</p>
<pre><code>$ hexdump -C hello
00000000  7f 45 4c 46 ff ff ff ff  ff ff ff ff ff ff ff ff  |.ELF............|
00000010  02 00 03 00 ff ff ff ff  54 80 04 08 34 00 00 00  |........T...4...|
00000020  ff ff ff ff ff ff ff ff  34 00 20 00 01 00 ff ff  |........4. .....|
00000030  ff ff ff ff 01 00 00 00  00 00 00 00 00 80 04 08  |................|
00000040  00 80 04 08 60 00 00 00  60 00 00 00 05 00 00 00  |....`...`.......|
00000050  00 10 00 00 59 59 b2 05  b0 04 cd 80 b0 01 cd 80  |....YY..........|
00000060
</code></pre><p>&#x53EF;&#x4EE5;&#x767C;&#x73FE;&#xFF0C;&#x6587;&#x4EF6;&#x982D;&#x90E8;&#x5206;&#xFF0C;&#x6709; 30 &#x500B;&#x5B57;&#x7BC0;&#x5373;&#x4F7F;&#x88AB;&#x7BE1;&#x6539;&#x5F8C;&#xFF0C;&#x8A72;&#x53EF;&#x57F7;&#x884C;&#x6587;&#x4EF6;&#x4F9D;&#x7136;&#x53EF;&#x4EE5;&#x6B63;&#x5E38;&#x57F7;&#x884C;&#x3002;&#x9019;&#x610F;&#x5473;&#x8457;&#xFF0C;&#x9019; 30 &#x5B57;&#x7BC0;&#x662F;&#x53EF;&#x4EE5;&#x5BEB;&#x5165;&#x5176;&#x4ED6;&#x4EE3;&#x78BC;&#x6307;&#x4EE4;&#x5B57;&#x7BC0;&#x7684;&#x3002;&#x800C;&#x6211;&#x5011;&#x7684;&#x5BE6;&#x969B;&#x4EE3;&#x78BC;&#x6307;&#x4EE4;&#x53EA;&#x5269;&#x4E0B; 12 &#x500B;&#xFF0C;&#x5B8C;&#x5168;&#x53EF;&#x4EE5;&#x76F4;&#x63A5;&#x79FB;&#x5230;&#x524D; 12 &#x500B; <code>0xff</code> &#x7684;&#x4F4D;&#x7F6E;&#xFF0C;&#x5373;&#x5F9E;&#x7B2C; 4 &#x500B;&#x5230;&#x7B2C; 15 &#x500B;&#x3002;</p>
<p>&#x800C;&#x4EE3;&#x78BC;&#x90E8;&#x5206;&#x7684;&#x8D77;&#x59CB;&#x4F4D;&#x7F6E;&#xFF0C;&#x901A;&#x904E; <code>readelf -h</code> &#x547D;&#x4EE4;&#x53EF;&#x4EE5;&#x770B;&#x5230;&#xFF1A;</p>
<pre><code>$ readelf -h hello | grep &quot;Entry&quot;
  Entry point address:               0x8048054
</code></pre><p>&#x4E0A;&#x9762;&#x5730;&#x5740;&#x7684;&#x6700;&#x5F8C;&#x5169;&#x4F4D; <code>0x54=84</code> &#x5C31;&#x662F;&#x4EE3;&#x78BC;&#x5728;&#x6587;&#x4EF6;&#x4E2D;&#x7684;&#x504F;&#x79FB;&#xFF0C;&#x4E5F;&#x5C31;&#x662F;&#x525B;&#x597D;&#x5F9E;&#x7A0B;&#x5E8F;&#x982D;&#x4E4B;&#x5F8C;&#x958B;&#x59CB;&#x7684;&#xFF0C;&#x4E5F;&#x5C31;&#x662F;&#x7528;&#x6587;&#x4EF6;&#x982D;&#xFF08;52&#xFF09;+&#x7A0B;&#x5E8F;&#x982D;&#xFF08;32&#xFF09;&#x500B;&#x5B57;&#x7BC0;&#x958B;&#x59CB;&#x7684; 12 &#x5B57;&#x7BC0;&#x8986;&#x84CB;&#x5230;&#x7B2C; 4 &#x500B;&#x5B57;&#x7BC0;&#x958B;&#x59CB;&#x7684; 12 &#x5B57;&#x7BC0;&#x5167;&#x5BB9;&#x5373;&#x53EF;&#x3002;</p>
<p>&#x4E0A;&#x9762;&#x7684; <code>dd</code> &#x547D;&#x4EE4;&#x5F9E; <code>echo</code> &#x547D;&#x4EE4;&#x7372;&#x5F97;&#x8F38;&#x5165;&#xFF0C;&#x4E0B;&#x9762;&#x9700;&#x8981;&#x901A;&#x904E;&#x53EF;&#x57F7;&#x884C;&#x6587;&#x4EF6;&#x672C;&#x8EAB;&#x7372;&#x5F97;&#x8F38;&#x5165;&#xFF0C;&#x5148;&#x628A;&#x4EE3;&#x78BC;&#x90E8;&#x5206;&#x79FB;&#x904E;&#x53BB;&#xFF1A;</p>
<pre><code>$ dd if=hello of=hello bs=1 skip=84 count=12 seek=4 conv=notrunc
12+0 records in
12+0 records out
12 bytes (12 B) copied, 4.9552e-05 s, 242 kB/s
$ hexdump -C hello
00000000  7f 45 4c 46 59 59 b2 05  b0 04 cd 80 b0 01 cd 80  |.ELFYY..........|
00000010  02 00 03 00 01 00 00 00  54 80 04 08 34 00 00 00  |........T...4...|
00000020  00 00 00 00 00 00 00 00  34 00 20 00 01 00 00 00  |........4. .....|
00000030  00 00 00 00 01 00 00 00  00 00 00 00 00 80 04 08  |................|
00000040  00 80 04 08 60 00 00 00  60 00 00 00 05 00 00 00  |....`...`.......|
00000050  00 10 00 00 59 59 b2 05  b0 04 cd 80 b0 01 cd 80  |....YY..........|
00000060
</code></pre><p>&#x63A5;&#x8457;&#x628A;&#x4EE3;&#x78BC;&#x90E8;&#x5206;&#x622A;&#x6389;&#xFF1A;</p>
<pre><code>$ dd if=hello of=hello bs=1 count=1 skip=84 seek=84
0+0 records in
0+0 records out
0 bytes (0 B) copied, 1.702e-05 s, 0.0 kB/s
$ hexdump -C hello
00000000  7f 45 4c 46 59 59 b2 05  b0 04 cd 80 b0 01 cd 80  |.ELFYY..........|
00000010  02 00 03 00 01 00 00 00  54 80 04 08 34 00 00 00  |........T...4...|
00000020  00 00 00 00 00 00 00 00  34 00 20 00 01 00 00 00  |........4. .....|
00000030  00 00 00 00 01 00 00 00  00 00 00 00 00 80 04 08  |................|
00000040  00 80 04 08 60 00 00 00  60 00 00 00 05 00 00 00  |....`...`.......|
00000050  00 10 00 00                                       |....|
00000054
</code></pre><p>&#x9019;&#x500B;&#x6642;&#x5019;&#x9084;&#x4E0D;&#x80FD;&#x57F7;&#x884C;&#xFF0C;&#x56E0;&#x70BA;&#x4EE3;&#x78BC;&#x5728;&#x6587;&#x4EF6;&#x4E2D;&#x7684;&#x4F4D;&#x7F6E;&#x88AB;&#x79FB;&#x52D5;&#x4E86;&#xFF0C;&#x76F8;&#x61C9;&#x5730;&#xFF0C;&#x6587;&#x4EF6;&#x982D;&#x4E2D;&#x7684; <code>Entry point address</code>&#xFF0C;&#x5373;&#x6587;&#x4EF6;&#x5165;&#x53E3;&#x5730;&#x5740;&#x4E5F;&#x9700;&#x8981;&#x88AB;&#x4FEE;&#x6539;&#x70BA; <code>0x8048004</code> &#x3002;</p>
<p>&#x5373;&#x9700;&#x8981;&#x628A; <code>0x54</code> &#x6240;&#x5728;&#x7684;&#x7B2C; 24 &#x500B;&#x5B57;&#x7BC0;&#x4FEE;&#x6539;&#x70BA; <code>0x04</code> &#xFF1A;</p>
<pre><code>$ echo -ne &quot;\x04&quot; | dd of=hello bs=1 count=1 seek=24 conv=notrunc
1+0 records in
1+0 records out
1 byte (1 B) copied, 3.7044e-05 s, 27.0 kB/s
$ hexdump -C hello
00000000  7f 45 4c 46 59 59 b2 05  b0 04 cd 80 b0 01 cd 80  |.ELFYY..........|
00000010  02 00 03 00 01 00 00 00  04 80 04 08 34 00 00 00  |............4...|
00000020  84 00 00 00 00 00 00 00  34 00 20 00 01 00 28 00  |........4. ...(.|
00000030  05 00 02 00 01 00 00 00  00 00 00 00 00 80 04 08  |................|
00000040  00 80 04 08 60 00 00 00  60 00 00 00 05 00 00 00  |....`...`.......|
00000050  00 10 00 00
</code></pre><p>&#x4FEE;&#x6539;&#x5F8C;&#x5C31;&#x53EF;&#x4EE5;&#x57F7;&#x884C;&#x4E86;&#x3002;</p>
<p><span id="toc_3928_6176_20"></span></p>
<h3 id="%E6%8A%8A%E7%A8%8B%E5%BA%8F%E9%A0%AD%E7%A7%BB%E5%85%A5%E6%96%87%E4%BB%B6%E9%A0%AD">&#x628A;&#x7A0B;&#x5E8F;&#x982D;&#x79FB;&#x5165;&#x6587;&#x4EF6;&#x982D;</h3>
<p>&#x7A0B;&#x5E8F;&#x982D;&#x90E8;&#x5206;&#x7D93;&#x904E;&#x6E2C;&#x8A66;&#x767C;&#x73FE;&#x57FA;&#x672C;&#x4E0A;&#x90FD;&#x4E0D;&#x80FD;&#x4FEE;&#x6539;&#x4E26;&#x4E14;&#x9700;&#x8981;&#x662F;&#x9023;&#x7E8C;&#x7684;&#xFF0C;&#x7A0B;&#x5E8F;&#x982D;&#x6709; 32 &#x500B;&#x5B57;&#x7BC0;&#xFF0C;&#x800C;&#x6587;&#x4EF6;&#x982D;&#x4E2D;&#x9023;&#x7E8C;&#x7684; <code>0xff</code> &#x53EF;&#x4EE5;&#x88AB;&#x7BE1;&#x6539;&#x7684;&#x53EA;&#x6709;&#x5F9E;&#x7B2C; 46 &#x500B;&#x958B;&#x59CB;&#x7684; 6 &#x500B;&#x4E86;&#xFF0C;&#x53E6;&#x5916;&#xFF0C;&#x7A0B;&#x5E8F;&#x982D;&#x525B;&#x597D;&#x662F; <code>01 00</code> &#x958B;&#x982D;&#xFF0C;&#x800C;&#x7B2C; 44&#xFF0C;45 &#x500B;&#x525B;&#x597D;&#x70BA; <code>01 00</code>&#xFF0C;&#x9019;&#x6A23;&#x5730;&#x8A71;&#xFF0C;&#x9019;&#x5169;&#x500B;&#x5B57;&#x7BC0;&#x6587;&#x4EF6;&#x982D;&#x53EF;&#x4EE5;&#x8DDF;&#x7A0B;&#x5E8F;&#x982D;&#x5171;&#x4EAB;&#xFF0C;&#x9019;&#x6A23;&#x5730;&#x8A71;&#xFF0C;&#x7A0B;&#x5E8F;&#x982D;&#x5C31;&#x53EF;&#x4EE5;&#x5F80;&#x6587;&#x4EF6;&#x982D;&#x88E1;&#x982D;&#x79FB;&#x52D5; 8 &#x500B;&#x5B57;&#x7BC0;&#x4E86;&#x3002;</p>
<pre><code>$ dd if=hello of=hello bs=1 skip=52 seek=44 count=32 conv=notrunc
</code></pre><p>&#x518D;&#x628A;&#x6700;&#x5F8C; 8 &#x500B;&#x6C92;&#x7528;&#x7684;&#x5B57;&#x7BC0;&#x522A;&#x9664;&#x6389;&#xFF0C;&#x4FDD;&#x7559; <code>84-8=76</code> &#x500B;&#x5B57;&#x7BC0;&#xFF1A;</p>
<pre><code>$ dd if=hello of=hello bs=1 skip=76 seek=76
$ hexdump -C hello
00000000  7f 45 4c 46 59 59 b2 05  b0 04 cd 80 b0 01 cd 80  |.ELFYY..........|
00000010  02 00 03 00 01 00 00 00  04 80 04 08 34 00 00 00  |............4...|
00000020  84 00 00 00 00 00 00 00  34 00 20 00 01 00 00 00  |........4. .....|
00000030  00 00 00 00 00 80 04 08  00 80 04 08 60 00 00 00  |............`...|
00000040  60 00 00 00 05 00 00 00  00 10 00 00              |`...........|
0000004c
</code></pre><p>&#x53E6;&#x5916;&#xFF0C;&#x9084;&#x9700;&#x8981;&#x628A;&#x6587;&#x4EF6;&#x982D;&#x4E2D;&#x7A0B;&#x5E8F;&#x982D;&#x7684;&#x4F4D;&#x7F6E;&#x4FE1;&#x606F;&#x6539;&#x70BA; 44&#xFF0C;&#x5373;&#x7B2C; 28 &#x500B;&#x5B57;&#x7BC0;&#xFF0C;&#x539F;&#x4F86;&#x662F; <code>0x34</code>&#xFF0C;&#x5373; 52 &#x7684;&#x4F4D;&#x7F6E;&#x3002;</p>
<pre><code>$ echo &quot;obase=16;ibase=10;44&quot; | bc    # &#x5148;&#x628A;44&#x8F49;&#x63DB;&#x662F;16&#x9032;&#x5236;&#x7684;0x2C
2C
$ echo -ne &quot;\x2C&quot; | dd of=hello bs=1 count=1 seek=28 conv=notrunc    # &#x4FEE;&#x6539;&#x6587;&#x4EF6;&#x982D;
1+0 records in
1+0 records out
1 byte (1 B) copied, 3.871e-05 s, 25.8 kB/s
$ hexdump -C hello
00000000  7f 45 4c 46 59 59 b2 05  b0 04 cd 80 b0 01 cd 80  |.ELFYY..........|
00000010  02 00 03 00 01 00 00 00  04 80 04 08 2c 00 00 00  |............,...|
00000020  84 00 00 00 00 00 00 00  34 00 20 00 01 00 00 00  |........4. .....|
00000030  00 00 00 00 00 80 04 08  00 80 04 08 60 00 00 00  |............`...|
00000040  60 00 00 00 05 00 00 00  00 10 00 00              |`...........|
0000004c
</code></pre><p>&#x4FEE;&#x6539;&#x5F8C;&#x5373;&#x53EF;&#x57F7;&#x884C;&#x4E86;&#xFF0C;&#x76EE;&#x524D;&#x53EA;&#x5269;&#x4E0B; 76 &#x500B;&#x5B57;&#x7BC0;&#xFF1A;</p>
<pre><code>$ wc -c hello
76
</code></pre><p><span id="toc_3928_6176_21"></span></p>
<h3 id="%E5%9C%A8%E9%9D%9E%E9%80%A3%E7%BA%8C%E7%9A%84%E7%A9%BA%E9%96%93%E6%8F%92%E5%85%A5%E4%BB%A3%E7%A2%BC">&#x5728;&#x975E;&#x9023;&#x7E8C;&#x7684;&#x7A7A;&#x9593;&#x63D2;&#x5165;&#x4EE3;&#x78BC;</h3>
<p>&#x53E6;&#x5916;&#xFF0C;&#x9084;&#x6709; 12 &#x500B;&#x5B57;&#x7BC0;&#x53EF;&#x4EE5;&#x653E;&#x4EE3;&#x78BC;&#xFF0C;&#x898B; <code>0xff</code> &#x7684;&#x5730;&#x65B9;&#xFF1A;</p>
<pre><code>$ hexdump -C hello
00000000  7f 45 4c 46 59 59 b2 05  b0 04 cd 80 b0 01 cd 80  |.ELFYY..........|
00000010  02 00 03 00 ff ff ff ff  04 80 04 08 2c 00 00 00  |............,...|
00000020  ff ff ff ff ff ff ff ff  34 00 20 00 01 00 00 00  |........4. .....|
00000030  00 00 00 00 00 80 04 08  00 80 04 08 60 00 00 00  |............`...|
00000040  60 00 00 00 05 00 00 00  00 10 00 00              |`...........|
0000004c
</code></pre><p>&#x4E0D;&#x904E;&#x56E0;&#x70BA;&#x7A7A;&#x9593;&#x4E0D;&#x662F;&#x9023;&#x7E8C;&#x7684;&#xFF0C;&#x9700;&#x8981;&#x7528;&#x5230;&#x8DF3;&#x8F49;&#x6307;&#x4EE4;&#x4F5C;&#x70BA;&#x8DF3;&#x677F;&#x5229;&#x7528;&#x4E0D;&#x540C;&#x7684;&#x7A7A;&#x9593;&#x3002;</p>
<p>&#x4F8B;&#x5982;&#xFF0C;&#x5982;&#x679C;&#x8981;&#x5229;&#x7528;&#x5F8C;&#x9762;&#x7684; <code>0xff</code> &#x7684;&#x7A7A;&#x9593;&#xFF0C;&#x53EF;&#x4EE5;&#x628A;&#x7B2C; 14&#xFF0C;15 &#x4F4D;&#x7F6E;&#x7684; <code>cd 80</code> &#x6307;&#x4EE4;&#x66FF;&#x63DB;&#x70BA;&#x4E00;&#x689D;&#x8DF3;&#x8F49;&#x6307;&#x4EE4;&#xFF0C;&#x6BD4;&#x5982;&#x8DF3;&#x8F49;&#x5230;&#x7B2C; 20 &#x500B;&#x5B57;&#x7BC0;&#x7684;&#x4F4D;&#x7F6E;&#xFF0C;&#x5F9E;&#x8DF3;&#x8F49;&#x6307;&#x4EE4;&#x4E4B;&#x5F8C;&#x7684; 16 &#x5230; 20 &#x525B;&#x597D; 4 &#x500B;&#x5B57;&#x7BC0;&#x3002;</p>
<p>&#x7136;&#x5F8C;&#x53EF;&#x4EE5;&#x53C3;&#x8003; <a href="http://sparksandflames.com/files/x86InstructionChart.html" target="_blank">X86 &#x6307;&#x4EE4;&#x7DE8;&#x78BC;&#x8868;</a>&#xFF08;&#x4E5F;&#x53EF;&#x4EE5;&#x5BEB;&#x6210;&#x5F59;&#x7DE8;&#x751F;&#x6210;&#x53EF;&#x57F7;&#x884C;&#x6587;&#x4EF6;&#x5F8C;&#x7528; <code>hexdump</code> &#x67E5;&#x770B;&#xFF09;&#xFF0C;&#x53EF;&#x4EE5;&#x628A; <code>jmp</code> &#x6307;&#x4EE4;&#x7DE8;&#x78BC;&#x70BA;&#xFF1A; <code>0xeb 0x04</code> &#x3002;</p>
<pre><code>$ echo -ne &quot;\xeb\x04&quot; | dd of=hello bs=1 count=2 seek=14 conv=notrunc
</code></pre><p>&#x7136;&#x5F8C;&#x628A;&#x539F;&#x4F86;&#x4F4D;&#x7F6E;&#x7684; <code>cd 80</code> &#x79FB;&#x52D5;&#x5230;&#x7B2C; 20 &#x500B;&#x5B57;&#x7BC0;&#x958B;&#x59CB;&#x7684;&#x4F4D;&#x7F6E;&#xFF1A;</p>
<pre><code>$ echo -ne &quot;\xcd\x80&quot; | dd of=hello bs=1 count=2 seek=20 conv=notrunc
</code></pre><p>&#x4F9D;&#x7136;&#x53EF;&#x4EE5;&#x57F7;&#x884C;&#xFF0C;&#x985E;&#x4F3C;&#x5730;&#x53EF;&#x4EE5;&#x5229;&#x7528;&#x66F4;&#x591A;&#x975E;&#x9023;&#x7E8C;&#x7684;&#x7A7A;&#x9593;&#x3002;</p>
<p><span id="toc_3928_6176_22"></span></p>
<h3 id="%E6%8A%8A%E7%A8%8B%E5%BA%8F%E9%A0%AD%E5%AE%8C%E5%85%A8%E5%90%88%E5%85%A5%E6%96%87%E4%BB%B6%E9%A0%AD">&#x628A;&#x7A0B;&#x5E8F;&#x982D;&#x5B8C;&#x5168;&#x5408;&#x5165;&#x6587;&#x4EF6;&#x982D;</h3>
<p>&#x5728;&#x95B1;&#x8B80;&#x53C3;&#x8003;&#x8CC7;&#x6599; <a href="http://www.muppetlabs.com/~breadbox/software/tiny/teensy.html" target="_blank">[1]</a>&#x5F8C;&#xFF0C;&#x767C;&#x73FE;&#x6709;&#x66F4;&#x591A;&#x6DF1;&#x5C64;&#x6B21;&#x7684;&#x63A2;&#x8A0E;&#xFF0C;&#x901A;&#x904E;&#x5206;&#x6790; Linux &#x7CFB;&#x7D71;&#x5C0D; <code>ELF</code> &#x6587;&#x4EF6;&#x982D;&#x90E8;&#x548C;&#x7A0B;&#x5E8F;&#x982D;&#x90E8;&#x7684;&#x89E3;&#x6790;&#xFF0C;&#x53EF;&#x4EE5;&#x66F4;&#x9032;&#x4E00;&#x6B65;&#x5408;&#x4F75;&#x7A0B;&#x5E8F;&#x982D;&#x548C;&#x6587;&#x4EF6;&#x982D;&#x3002;</p>
<p>&#x8A72;&#x8CC7;&#x6599;&#x80FD;&#x5920;&#x628A;&#x6700;&#x7C21;&#x7684; <code>ELF</code> &#x6587;&#x4EF6;&#xFF08;&#x7C21;&#x55AE;&#x8FD4;&#x56DE;&#x4E00;&#x500B;&#x6578;&#x503C;&#xFF09;&#x58D3;&#x7E2E;&#x5230; 45 &#x500B;&#x5B57;&#x7BC0;&#xFF0C;&#x771F;&#x5730;&#x662F;&#x975E;&#x5E38;&#x6975;&#x7AEF;&#x7684;&#x52AA;&#x529B;&#xFF0C;&#x601D;&#x8DEF;&#x53EF;&#x4EE5;&#x5145;&#x5206;&#x501F;&#x9451;&#x3002;&#x5728;&#x5145;&#x5206;&#x7406;&#x89E3;&#x539F;&#x6587;&#x7684;&#x57FA;&#x790E;&#x4E0A;&#xFF0C;&#x6211;&#x5011;&#x9032;&#x884C;&#x66F4;&#x7D30;&#x7DFB;&#x5730;&#x68B3;&#x7406;&#x3002;</p>
<p>&#x9996;&#x5148;&#x5C0D; <code>ELF</code> &#x6587;&#x4EF6;&#x982D;&#x90E8;&#x548C;&#x7A0B;&#x5E8F;&#x982D;&#x90E8;&#x505A;&#x66F4;&#x5FB9;&#x5E95;&#x7684;&#x7406;&#x89E3;&#xFF0C;&#x4E26;&#x5177;&#x9AD4;&#x5230;&#x6BCF;&#x4E00;&#x500B;&#x5B57;&#x7BC0;&#x7684;&#x542B;&#x7FA9;&#x4EE5;&#x53CA;&#x5728; Linux &#x7CFB;&#x7D71;&#x4E0B;&#x7684;&#x5BE6;&#x969B;&#x89E3;&#x6790;&#x60C5;&#x6CC1;&#x3002;</p>
<p>&#x5148;&#x4F86;&#x770B;&#x770B; <code>readelf -a</code> &#x7684;&#x7D50;&#x679C;&#xFF1A;</p>
<pre><code>$ as --32 -o hello.o hello.s
$ ld -melf_i386 -o hello hello.o
$ sstrip hello
$ readelf -a hello
ELF Header:
  Magic:   7f 45 4c 46 01 01 01 00 00 00 00 00 00 00 00 00
  Class:                             ELF32
  Data:                              2&apos;s complement, little endian
  Version:                           1 (current)
  OS/ABI:                            UNIX - System V
  ABI Version:                       0
  Type:                              EXEC (Executable file)
  Machine:                           Intel 80386
  Version:                           0x1
  Entry point address:               0x8048054
  Start of program headers:          52 (bytes into file)
  Start of section headers:          0 (bytes into file)
  Flags:                             0x0
  Size of this header:               52 (bytes)
  Size of program headers:           32 (bytes)
  Number of program headers:         1
  Size of section headers:           0 (bytes)
  Number of section headers:         0
  Section header string table index: 0

There are no sections in this file.

There are no sections to group in this file.

Program Headers:
  Type           Offset   VirtAddr   PhysAddr   FileSiz MemSiz  Flg Align
  LOAD           0x000000 0x08048000 0x08048000 0x00060 0x00060 R E 0x1000
</code></pre><p>&#x7136;&#x5F8C;&#x7D50;&#x5408; <code>/usr/include/linux/elf.h</code> &#x5206;&#x5225;&#x505A;&#x8A73;&#x7D30;&#x8A3B;&#x89E3;&#x3002;</p>
<p>&#x9996;&#x5148;&#x662F; 52 &#x5B57;&#x7BC0;&#x7684; <code>Elf</code> &#x6587;&#x4EF6;&#x982D;&#x7684;&#x7D50;&#x69CB;&#x9AD4; <code>elf32_hdr</code>&#xFF1A;</p>
<table>
<thead>
<tr>
<th>&#x8B8A;&#x91CF;&#x985E;&#x578B;</th>
<th>&#x8B8A;&#x91CF;&#x540D;</th>
<th>&#x5B57;&#x7BC0;</th>
<th>&#x8AAA;&#x660E;</th>
<th>&#x985E;&#x578B;</th>
</tr>
</thead>
<tbody>
<tr>
<td>  unsigned char</td>
<td>e_ident[EI_NIDENT]</td>
<td>16</td>
<td>.ELF &#x524D;&#x56DB;&#x500B;&#x6A19;&#x8B58;&#x6587;&#x4EF6;&#x985E;&#x578B;</td>
<td>&#x5FC5;&#x9808;</td>
</tr>
<tr>
<td>  Elf32_Half</td>
<td>e_type</td>
<td>2</td>
<td>&#x6307;&#x5B9A;&#x70BA;&#x53EF;&#x57F7;&#x884C;&#x6587;&#x4EF6;</td>
<td>&#x5FC5;&#x9808;</td>
</tr>
<tr>
<td>  Elf32_Half</td>
<td>e_machine</td>
<td>2</td>
<td>&#x6307;&#x793A;&#x76EE;&#x6A19;&#x6A5F;&#x985E;&#x578B;&#xFF0C;&#x4F8B;&#x5982;&#xFF1A;Intel 386</td>
<td>&#x5FC5;&#x9808;</td>
</tr>
<tr>
<td>  Elf32_Word</td>
<td>e_version</td>
<td>4</td>
<td>&#x7576;&#x524D;&#x53EA;&#x6709;&#x4E00;&#x500B;&#x7248;&#x672C;&#x5B58;&#x5728;&#xFF0C;&#x88AB;&#x5FFD;&#x7565;&#x4E86;</td>
<td><del>&#x53EF;&#x7BE1;&#x6539;</del></td>
</tr>
<tr>
<td>  Elf32_Addr</td>
<td>e_entry</td>
<td>4</td>
<td>&#x4EE3;&#x78BC;&#x5165;&#x53E3;=&#x52A0;&#x8F09;&#x5730;&#x5740;(p_vaddr+.text&#x504F;&#x79FB;)</td>
<td><strong>&#x53EF;&#x8ABF;&#x6574;</strong></td>
</tr>
<tr>
<td>  Elf32_Off</td>
<td>e_phoff</td>
<td>4</td>
<td>&#x7A0B;&#x5E8F;&#x982D; Phdr &#x7684;&#x504F;&#x79FB;&#x5730;&#x5740;&#xFF0C;&#x7528;&#x65BC;&#x52A0;&#x8F09;&#x4EE3;&#x78BC;</td>
<td>&#x5FC5;&#x9808;</td>
</tr>
<tr>
<td>  Elf32_Off</td>
<td>e_shoff</td>
<td>4</td>
<td>&#x6240;&#x6709;&#x7BC0;&#x5340;&#x76F8;&#x95DC;&#x4FE1;&#x606F;&#x5C0D;&#x6587;&#x4EF6;&#x57F7;&#x884C;&#x7121;&#x6548;</td>
<td><del>&#x53EF;&#x7BE1;&#x6539;</del></td>
</tr>
<tr>
<td>  Elf32_Word</td>
<td>e_flags</td>
<td>4</td>
<td>Intel &#x67B6;&#x69CB;&#x672A;&#x4F7F;&#x7528;</td>
<td><del>&#x53EF;&#x7BE1;&#x6539;</del></td>
</tr>
<tr>
<td>  Elf32_Half</td>
<td>e_ehsize</td>
<td>2</td>
<td>&#x6587;&#x4EF6;&#x982D;&#x5927;&#x5C0F;&#xFF0C;Linux &#x6C92;&#x505A;&#x6821;&#x9A57;</td>
<td><del>&#x53EF;&#x7BE1;&#x6539;</del></td>
</tr>
<tr>
<td>  Elf32_Half</td>
<td>e_phentsize</td>
<td>2</td>
<td>&#x7A0B;&#x5E8F;&#x982D;&#x5165;&#x53E3;&#x5927;&#x5C0F;&#xFF0C;&#x65B0;&#x5167;&#x6838;&#x6709;&#x7528;</td>
<td>&#x5FC5;&#x9808;</td>
</tr>
<tr>
<td>  Elf32_Half</td>
<td>e_phnum</td>
<td>2</td>
<td>&#x7A0B;&#x5E8F;&#x982D;&#x5165;&#x53E3;&#x500B;&#x6578;</td>
<td>&#x5FC5;&#x9808;</td>
</tr>
<tr>
<td>  Elf32_Half</td>
<td>e_shentsize</td>
<td>2</td>
<td>&#x6240;&#x6709;&#x7BC0;&#x5340;&#x76F8;&#x95DC;&#x4FE1;&#x606F;&#x5C0D;&#x6587;&#x4EF6;&#x57F7;&#x884C;&#x7121;&#x6548;</td>
<td><del>&#x53EF;&#x7BE1;&#x6539;</del></td>
</tr>
<tr>
<td>  Elf32_Half</td>
<td>e_shnum</td>
<td>2</td>
<td>&#x6240;&#x6709;&#x7BC0;&#x5340;&#x76F8;&#x95DC;&#x4FE1;&#x606F;&#x5C0D;&#x6587;&#x4EF6;&#x57F7;&#x884C;&#x7121;&#x6548;</td>
<td><del>&#x53EF;&#x7BE1;&#x6539;</del></td>
</tr>
<tr>
<td>  Elf32_Half</td>
<td>e_shstrndx</td>
<td>2</td>
<td>&#x6240;&#x6709;&#x7BC0;&#x5340;&#x76F8;&#x95DC;&#x4FE1;&#x606F;&#x5C0D;&#x6587;&#x4EF6;&#x57F7;&#x884C;&#x7121;&#x6548;</td>
<td><del>&#x53EF;&#x7BE1;&#x6539;</del></td>
</tr>
</tbody>
</table>
<p>&#x5176;&#x6B21;&#x662F; 32 &#x5B57;&#x7BC0;&#x7684;&#x7A0B;&#x5E8F;&#x982D;&#xFF08;Phdr&#xFF09;&#x7684;&#x7D50;&#x69CB;&#x9AD4; <code>elf32_phdr</code>&#xFF1A;</p>
<table>
<thead>
<tr>
<th>&#x8B8A;&#x91CF;&#x985E;&#x578B;</th>
<th>&#x8B8A;&#x91CF;&#x540D;</th>
<th>&#x5B57;&#x7BC0;</th>
<th>&#x8AAA;&#x660E;</th>
<th>&#x985E;&#x578B;</th>
</tr>
</thead>
<tbody>
<tr>
<td>  Elf32_Word</td>
<td>p_type</td>
<td>4</td>
<td>&#x6A19;&#x8A18;&#x70BA;&#x53EF;&#x52A0;&#x8F09;&#x6BB5;</td>
<td>&#x5FC5;&#x9808;</td>
</tr>
<tr>
<td>  Elf32_Off</td>
<td>p_offset</td>
<td>4</td>
<td>&#x76F8;&#x5C0D;&#x7A0B;&#x5E8F;&#x982D;&#x7684;&#x504F;&#x79FB;&#x5730;&#x5740;</td>
<td>&#x5FC5;&#x9808;</td>
</tr>
<tr>
<td>  Elf32_Addr</td>
<td>p_vaddr</td>
<td>4</td>
<td>&#x52A0;&#x8F09;&#x5730;&#x5740;, 0x0~0x80000000&#xFF0C;&#x9801;&#x5C0D;&#x9F4A;</td>
<td><strong>&#x53EF;&#x8ABF;&#x6574;</strong></td>
</tr>
<tr>
<td>  Elf32_Addr</td>
<td>p_paddr</td>
<td>4</td>
<td>&#x7269;&#x7406;&#x5730;&#x5740;&#xFF0C;&#x66AB;&#x6642;&#x6C92;&#x7528;</td>
<td><del>&#x53EF;&#x7BE1;&#x6539;</del></td>
</tr>
<tr>
<td>  Elf32_Word</td>
<td>p_filesz</td>
<td>4</td>
<td>&#x52A0;&#x8F09;&#x7684;&#x6587;&#x4EF6;&#x5927;&#x5C0F;&#xFF0C;&gt;=real size</td>
<td><strong>&#x53EF;&#x8ABF;&#x6574;</strong></td>
</tr>
<tr>
<td>  Elf32_Word</td>
<td>p_memsz</td>
<td>4</td>
<td>&#x52A0;&#x8F09;&#x6240;&#x9700;&#x5167;&#x5B58;&#x5927;&#x5C0F;&#xFF0C;&gt;= p_filesz</td>
<td><strong>&#x53EF;&#x8ABF;&#x6574;</strong></td>
</tr>
<tr>
<td>  Elf32_Word</td>
<td>p_flags</td>
<td>4</td>
<td>&#x6B0A;&#x9650;:read(4),exec(1), &#x5176;&#x4E2D;&#x4E00;&#x500B;&#x6697;&#x6307;&#x53E6;&#x5916;&#x4E00;&#x500B;</td>
<td><strong>&#x53EF;&#x8ABF;&#x6574;</strong></td>
</tr>
<tr>
<td>  Elf32_Word</td>
<td>p_align</td>
<td>4</td>
<td>PIC(&#x5171;&#x4EAB;&#x5EAB;&#x9700;&#x8981;)&#xFF0C;&#x5C0D;&#x57F7;&#x884C;&#x6587;&#x4EF6;&#x7121;&#x6548;</td>
<td><del>&#x53EF;&#x7BE1;&#x6539;</del></td>
</tr>
</tbody>
</table>
<p>&#x63A5;&#x8457;&#xFF0C;&#x54B1;&#x5011;&#x628A; Elf &#x4E2D;&#x7684;&#x6587;&#x4EF6;&#x982D;&#x548C;&#x7A0B;&#x5E8F;&#x982D;&#x90E8;&#x5206;<strong>&#x53EF;&#x8ABF;&#x6574;</strong>&#x548C;<del>&#x53EF;&#x7BE1;&#x6539;</del>&#x7684;&#x5B57;&#x7BC0;&#xFF08;52 + 32 = 84&#x500B;&#xFF09;&#x5168;&#x90E8;&#x7528;&#x7279;&#x5225;&#x7684;&#x5B57;&#x9AD4;&#x6A19;&#x8A18;&#x51FA;&#x4F86;&#x3002;</p>
<pre><code>$ hexdump -C hello -n 84
</code></pre><blockquote>
<p>00000000  7f 45 4c 46 <del>01 01 01 00  00 00 00 00 00 00 00 00</del></p>
<p>00000010  02 00 03 00 <del>01 00 00 00</del> <strong>54 80 04 08 34</strong> 00 00 00</p>
<p>00000020  <del>84 00 00 00 00 00 00 00</del>  34 00 20 00 01 00 <del>28 00</del></p>
<p>00000030  <del>05 00 02 00</del>|01 00 00 00  00 00 00 00 <strong>00 80 04 08</strong></p>
<p>00000040  <del>00 80 04 08</del> <strong>60 00 00 00  60 00 00 00 05 00 00 00</strong></p>
<p>00000050  <del>00 10 00 00</del></p>
<p>00000054</p>
</blockquote>
<p>&#x4E0A;&#x8FF0; <code>|</code> &#x7DDA;&#x4E4B;&#x524D;&#x70BA;&#x6587;&#x4EF6;&#x982D;&#xFF0C;&#x4E4B;&#x5F8C;&#x70BA;&#x7A0B;&#x5E8F;&#x982D;&#xFF0C;&#x4E4B;&#x524D;&#x7684; <code>000000xx</code> &#x70BA;&#x504F;&#x79FB;&#x5730;&#x5740;&#x3002;</p>
<p>&#x5982;&#x679C;&#x8981;&#x628A;&#x7A0B;&#x5E8F;&#x982D;&#x5FB9;&#x5E95;&#x5408;&#x4F75;&#x9032;&#x6587;&#x4EF6;&#x982D;&#x3002;&#x5F9E;&#x4E0A;&#x8FF0;&#x4FE1;&#x606F;&#x7D9C;&#x5408;&#x4F86;&#x770B;&#xFF0C;&#x6587;&#x4EF6;&#x982D;&#x6709; 4 &#x8655;&#x5FC5;&#x9808;&#x4FDD;&#x7559;&#xFF0C;&#x7D50;&#x5408;&#x8CC7;&#x6599; <a href="http://www.muppetlabs.com/~breadbox/software/tiny/teensy.html" target="_blank">[1]</a>&#xFF0C;&#x7D93;&#x904E;&#x5C0D;&#x6BD4;&#x767C;&#x73FE;&#xFF0C;&#x5982;&#x679C;&#x628A;&#x7B2C; 4 &#x884C;&#x958B;&#x59CB;&#x7684;&#x7A0B;&#x5E8F;&#x982D;&#x5F80;&#x4E0A;&#x5E73;&#x79FB; 3 &#x884C;&#xFF0C;&#x4E5F;&#x5C31;&#x662F;&#xFF1A;</p>
<blockquote>
<p>00000000  ========= <del>01 01 01 00  00 00 00 00 00 00 00 00</del></p>
<p>00000010  02 00 03 00 <del>01 00 00 00</del> <strong>54 80 04 08 34</strong> 00 00 00</p>
<p>00000020  <del>84 00 00 00</del></p>
<p>00000030  ========= 01 00 00 00  00 00 00 00 <strong>00 80 04 08</strong></p>
<p>00000040  <del>00 80 04 08</del> <strong>60 00 00 00  60 00 00 00 05 00 00 00</strong></p>
<p>00000050  <del>00 10 00 00</del></p>
<p>00000054</p>
</blockquote>
<p>&#x628A;&#x53EF;&#x76F4;&#x63A5;&#x5408;&#x4E26;&#x7684;&#x5148;&#x5408;&#x4F75;&#x9032;&#x53BB;&#xFF0C;&#x6548;&#x679C;&#x5982;&#x4E0B;&#xFF1A;</p>
<p>&#xFF08;&#x6587;&#x4EF6;&#x982D;&#xFF09;</p>
<blockquote>
<p>00000000  ========= 01 00 00 00  00 00 00 00 <strong>00 80 04 08</strong> (^^ p_vaddr)</p>
<p>00000010  02 00 03 00 <del>60 00 00 00</del> <strong>54 80 04 08 34</strong> 00 00 00</p>
<p>00000020  =================== ^^ e_entry ^^ e_phoff</p>
</blockquote>
<p>&#xFF08;&#x7A0B;&#x5E8F;&#x982D;&#xFF09;</p>
<blockquote>
<p>00000030  ========= 01 00 00 00  00 00 00 00 <strong>00 80 04 08</strong> (^^ p_vaddr)</p>
<p>00000040  02 00 03 00 <strong>60 00 00 00  60 00 00 00 05 00 00 00</strong></p>
<p>00000050  =========  ^^ p_filesz   ^^ p_memsz  ^^p_flags</p>
<p>00000054</p>
</blockquote>
<p>&#x63A5;&#x8457;&#x9700;&#x8981;&#x8A2D;&#x6CD5;&#x8655;&#x7406;&#x597D;&#x53EF;&#x8ABF;&#x6574;&#x7684; 6 &#x8655;&#xFF0C;&#x53EF;&#x4EE5;&#x9010;&#x500B;&#x89E3;&#x6C7A;&#xFF0C;&#x5F9E;&#x6613;&#x5230;&#x96E3;&#x3002;</p>
<ul>
<li>&#x9996;&#x5148;&#xFF0C;&#x5408;&#x4F75; <code>e_phoff</code> &#x8207; <code>p_flags</code></li>
</ul>
<p>&#x5728;&#x5408;&#x4F75;&#x7A0B;&#x5E8F;&#x982D;&#x4EE5;&#x5F8C;&#xFF0C;&#x7A0B;&#x5E8F;&#x982D;&#x7684;&#x504F;&#x79FB;&#x5730;&#x5740;&#x9700;&#x8981;&#x4FEE;&#x6539;&#x70BA; 4&#xFF0C;&#x5373;&#x6587;&#x4EF6;&#x7684;&#x7B2C; 4 &#x500B;&#x5B57;&#x7BC0;&#x958B;&#x59CB;&#xFF0C;&#x4E5F;&#x5C31;&#x662F;&#x8AAA; <code>e_phoff</code> &#x9700;&#x8981;&#x4FEE;&#x6539;&#x70BA; 04&#x3002;</p>
<p>&#x800C;&#x6070;&#x597D;&#xFF0C;<code>p_flags</code> &#x7684; <code>read(4)</code> &#x548C; <code>exec(1)</code> &#x53EF;&#x4EE5;&#x53EA;&#x9078;&#x5176;&#x4E00;&#xFF0C;&#x6240;&#x4EE5;&#xFF0C;&#x53EA;&#x4FDD;&#x7559; <code>read(4)</code> &#x5373;&#x53EF;&#xFF0C;&#x525B;&#x597D;&#x4E5F;&#x70BA; 04&#x3002;</p>
<p>&#x5408;&#x4F75;&#x5F8C;&#x6548;&#x679C;&#x5982;&#x4E0B;&#xFF1A;</p>
<p>&#xFF08;&#x6587;&#x4EF6;&#x982D;&#xFF09;</p>
<blockquote>
<p>00000000  ========= 01 00 00 00  00 00 00 00 <strong>00 80 04 08</strong> (^^ p_vaddr)</p>
<p>00000010  02 00 03 00 <del>60 00 00 00</del> <strong>54 80 04 08</strong> 04 00 00 00</p>
<p>00000020  =================== ^^ e_entry</p>
</blockquote>
<p>&#xFF08;&#x7A0B;&#x5E8F;&#x982D;&#xFF09;</p>
<blockquote>
<p>00000030  ========= 01 00 00 00  00 00 00 00 <strong>00 80 04 08</strong> (^^ p_vaddr)</p>
<p>00000040  02 00 03 00 <strong>60 00 00 00  60 00 00 00</strong> 04 00 00 00</p>
<p>00000050  =========  ^^ p_filesz   ^^ p_memsz</p>
<p>00000054</p>
</blockquote>
<ul>
<li>&#x63A5;&#x4E0B;&#x4F86;&#xFF0C;&#x5408;&#x4F75; <code>e_entry</code>&#xFF0C;<code>p_filesz</code>, <code>p_memsz</code>  &#x548C; <code>p_vaddr</code></li>
</ul>
<p>&#x5F9E;&#x65E9;&#x524D;&#x7684;&#x5206;&#x6790;&#x60C5;&#x6CC1;&#x4F86;&#x770B;&#xFF0C;&#x9019; 4 &#x500B;&#x8B8A;&#x91CF;&#x57FA;&#x672C;&#x90FD;&#x4F9D;&#x8CF4; <code>p_vaddr</code>&#xFF0C;&#x4E5F;&#x5C31;&#x662F;&#x7A0B;&#x5E8F;&#x7684;&#x52A0;&#x8F09;&#x5730;&#x5740;&#xFF0C;&#x5927;&#x9AD4;&#x7684;&#x4F9D;&#x8CF4;&#x95DC;&#x4FC2;&#x5982;&#x4E0B;&#xFF1A;</p>
<pre><code>e_entry = p_vaddr + text offset = p_vaddr + 84 = p_vaddr + 0x54

p_memsz = e_entry

p_memsz &gt;= p_filesz&#xFF0C;&#x53EF;&#x4EE5;&#x7C21;&#x55AE;&#x53D6; p_filesz = p_memsz

p_vaddr = page alignment
</code></pre><p>&#x6240;&#x4EE5;&#xFF0C;&#x9996;&#x5148;&#x9700;&#x8981;&#x78BA;&#x5B9A; <code>p_vaddr</code>&#xFF0C;&#x901A;&#x904E;&#x6E2C;&#x8A66;&#xFF0C;&#x767C;&#x73FE;<code>p_vaddr</code> &#x6700;&#x4F4E;&#x5FC5;&#x9808;&#x6709; 64k&#xFF0C;&#x4E5F;&#x5C31;&#x662F; 0x00010000&#xFF0C;&#x5C0D;&#x61C9;&#x5230; <code>hexdump</code> &#x7684; <code>little endian</code> &#x5C0E;&#x51FA;&#x7D50;&#x679C;&#xFF0C;&#x5247;&#x70BA; <code>00 00 01 00</code>&#x3002;</p>
<p>&#x9700;&#x8981;&#x6CE8;&#x610F;&#x7684;&#x662F;&#xFF0C;&#x70BA;&#x4E86;&#x5118;&#x91CF;&#x5C11;&#x4E86;&#x5206;&#x914D;&#x5167;&#x5B58;&#xFF0C;&#x6211;&#x5011;&#x9078;&#x64C7;&#x4E86;&#x4E00;&#x500B;&#x6700;&#x5C0F;&#x7684;<code>p_vaddr</code>&#xFF0C;&#x5982;&#x679C;&#x7533;&#x8ACB;&#x7684;&#x5167;&#x5B58;&#x592A;&#x5927;&#xFF0C;&#x7CFB;&#x7D71;&#x5C07;&#x7121;&#x6CD5;&#x5206;&#x914D;&#x3002;</p>
<p>&#x63A5;&#x8457;&#xFF0C;&#x8A08;&#x7B97;&#x51FA;&#x53E6;&#x5916; 3 &#x500B;&#x8B8A;&#x91CF;&#xFF1A;</p>
<pre><code>e_entry = 0x00010000 + 0x54 = 0x00010054 &#x5373; 54 00 01 00
p_memsz = 54 00 01 00
p_filesz = 54 00 01 00
</code></pre><p>&#x5B8C;&#x5168;&#x5408;&#x4F75;&#x5F8C;&#xFF0C;&#x4FEE;&#x6539;&#x5982;&#x4E0B;&#xFF1A;</p>
<p>&#xFF08;&#x6587;&#x4EF6;&#x982D;&#xFF09;</p>
<blockquote>
<p>00000000  =========   01 00 00 00  00 00 00 00  00 00 01 00</p>
<p>00000010  02 00 03 00 54 00 01 00  54 00 01 00  04 00 00 00</p>
<p>00000020  ========</p>
</blockquote>
<p>&#x597D;&#x4E86;&#xFF0C;&#x76F4;&#x63A5;&#x628A;&#x5167;&#x5BB9;&#x71D2;&#x5165;&#xFF1A;</p>
<pre><code>$ echo -ne &quot;\x01\x00\x00\x00\x00\x00\x00\x00&quot; \
       &quot;\x00\x00\x01\x00\x02\x00\x03\x00&quot; \
       &quot;\x54\x00\x01\x00\x54\x00\x01\x00\x04&quot; |\
       tr -d &apos; &apos; |\
    dd of=hello bs=1 count=25 seek=4 conv=notrunc
</code></pre><p>&#x622A;&#x6389;&#x4EE3;&#x78BC;&#xFF08;52 + 32 + 12 = 96&#xFF09;&#x4E4B;&#x5F8C;&#x7684;&#x6240;&#x6709;&#x5167;&#x5BB9;&#xFF0C;&#x67E5;&#x770B;&#x6548;&#x679C;&#x5982;&#x4E0B;&#xFF1A;</p>
<pre><code>$ dd if=hello of=hello bs=1 count=1 skip=96 seek=96
$ hexdump -C hello -n 96
00000000  7f 45 4c 46 01 00 00 00  00 00 00 00 00 00 01 00  |.ELF............|
00000010  02 00 03 00 54 00 01 00  54 00 01 00 04 00 00 00  |....T...T.......|
00000020  84 00 00 00 00 00 00 00  34 00 20 00 01 00 28 00  |........4. ...(.|
00000030  05 00 02 00 01 00 00 00  00 00 00 00 00 80 04 08  |................|
00000040  00 80 04 08 60 00 00 00  60 00 00 00 05 00 00 00  |....`...`.......|
00000050  00 10 00 00 59 59 b2 05  b0 04 cd 80 b0 01 cd 80  |....YY..........|
00000060
</code></pre><p>&#x6700;&#x5F8C;&#x7684;&#x5DE5;&#x4F5C;&#x662F;&#x67E5;&#x770B;&#x6587;&#x4EF6;&#x982D;&#x4E2D;&#x5269;&#x4E0B;&#x7684;<del>&#x53EF;&#x7BE1;&#x6539;</del>&#x7684;&#x5167;&#x5BB9;&#xFF0C;&#x4E26;&#x628A;<strong>&#x4EE3;&#x78BC;&#x90E8;&#x5206;</strong>&#x5408;&#x4F75;&#x9032;&#x53BB;&#xFF0C;&#x7A0B;&#x5E8F;&#x982D;&#x5DF2;&#x7D93;&#x5408;&#x5165;&#xFF0C;&#x4E0D;&#x518D;&#x986F;&#x793A;&#x3002;</p>
<blockquote>
<p>00000000  7f 45 4c 46 01 00 00 00  00 00 00 00 00 00 01 00</p>
<p>00000010  02 00 03 00 54 00 01 00  54 00 01 00 04 00 00 00</p>
<p>00000020  <del>84 00 00 00 00 00 00 00</del>  34 00 20 00 01 00 <del>28 00</del></p>
<p>00000030  <del>05 00 02 00</del></p>
<p>00000040</p>
<p>00000050  ============= <strong>59 59 b2 05  b0 04 cd 80 b0 01 cd 80</strong></p>
<p>00000060</p>
</blockquote>
<p>&#x6211;&#x5011;&#x7684;&#x6307;&#x4EE4;&#x6709; 12 &#x5B57;&#x7BC0;&#xFF0C;<del>&#x53EF;&#x7BE1;&#x6539;</del>&#x7684;&#x90E8;&#x5206;&#x6709; 14 &#x500B;&#x5B57;&#x7BC0;&#xFF0C;&#x7406;&#x8AD6;&#x4E0A;&#x4E00;&#x5B9A;&#x653E;&#x5F97;&#x4E0B;&#xFF0C;&#x4E0D;&#x904E;&#x56E0;&#x70BA;&#x628A;&#x7A0B;&#x5E8F;&#x982D;&#x642C;&#x9032;&#x53BB;&#x4EE5;&#x5F8C;&#xFF0C;&#x9019; 14 &#x500B;&#x5B57;&#x7BC0;&#x4E26;&#x4E0D;&#x662F;&#x9023;&#x7E8C;&#xFF0C;&#x525B;&#x597D;&#x53EF;&#x4EE5;&#x7528;&#x4E0A;&#x6211;&#x5011;&#x4E4B;&#x524D;&#x7684;&#x8DF3;&#x8F49;&#x6307;&#x4EE4;&#x8655;&#x7406;&#x8FA6;&#x6CD5;&#x4F86;&#x89E3;&#x6C7A;&#x3002;</p>
<p>&#x4E26;&#x4E14;&#xFF0C;&#x52A0;&#x5165; 2 &#x500B;&#x5B57;&#x7BC0;&#x7684;&#x8DF3;&#x8F49;&#x6307;&#x4EE4;&#xFF0C;&#x525B;&#x597D;&#x662F; 14 &#x500B;&#x5B57;&#x7BC0;&#xFF0C;&#x6070;&#x597D;&#x628A;&#x4EE3;&#x78BC;&#x4E5F;&#x5B8C;&#x5168;&#x5305;&#x542B;&#x9032;&#x4E86;&#x6587;&#x4EF6;&#x982D;&#x3002;</p>
<p>&#x5728;&#x9810;&#x7559;&#x597D;<strong>&#x8DF3;&#x8F49;&#x6307;&#x4EE4;</strong>&#x4F4D;&#x7F6E;&#x7684;&#x524D;&#x63D0;&#x4E0B;&#xFF0C;&#x6211;&#x5011;&#x628A;&#x4EE3;&#x78BC;&#x90E8;&#x5206;&#x5148;&#x5408;&#x4F75;&#x9032;&#x53BB;&#xFF1A;</p>
<blockquote>
<p>00000000  7f 45 4c 46 01 00 00 00  00 00 00 00 00 00 01 00</p>
<p>00000010  02 00 03 00 54 00 01 00  54 00 01 00 04 00 00 00</p>
<p>00000020  <strong>59 59 b2 05  b0 04</strong> <del>00 00</del>  34 00 20 00 01 00 <strong>cd 80</strong></p>
<p>00000030  <strong>b0 01 cd 80</strong></p>
</blockquote>
<p>&#x63A5;&#x4E0B;&#x4F86;&#x8A2D;&#x8A08;&#x8DF3;&#x8F49;&#x6307;&#x4EE4;&#xFF0C;&#x8DF3;&#x8F49;&#x6307;&#x4EE4;&#x9700;&#x8981;&#x5F9E;&#x6240;&#x5728;&#x4F4D;&#x7F6E;&#x8DF3;&#x5230;&#x7B2C;&#x4E00;&#x500B; <strong>cd 80</strong> &#x6240;&#x5728;&#x7684;&#x4F4D;&#x7F6E;&#xFF0C;&#x76F8;&#x8DDD; 6 &#x500B;&#x5B57;&#x7BC0;&#xFF0C;&#x6839;&#x64DA; <code>jmp</code> &#x77ED;&#x8DF3;&#x8F49;&#x7684;&#x7DE8;&#x78BC;&#x898F;&#x7BC4;&#xFF0C;&#x53EF;&#x4EE5;&#x8A2D;&#x8A08;&#x70BA; <code>0xeb 0x06</code>&#xFF0C;&#x586B;&#x5B8C;&#x5F8C;&#x6548;&#x679C;&#x5982;&#x4E0B;&#xFF1A;</p>
<blockquote>
<p>00000000  7f 45 4c 46 01 00 00 00  00 00 00 00 00 00 01 00</p>
<p>00000010  02 00 03 00 54 00 01 00  54 00 01 00 04 00 00 00</p>
<p>00000020  <strong>59 59 b2 05  b0 04 eb 06</strong> 34 00 20 00 01 00 <strong>cd 80</strong></p>
<p>00000030  <strong>b0 01 cd 80</strong></p>
</blockquote>
<p>&#x7528; <code>dd</code> &#x547D;&#x4EE4;&#x5BEB;&#x5165;&#xFF0C;&#x5206;&#x5169;&#x6BB5;&#x5BEB;&#x5165;&#xFF1A;</p>
<pre><code>$ echo -ne &quot;\x59\x59\xb2\x05\xb0\x04\xeb\x06&quot; | \
    dd of=hello bs=1 count=8 seek=32 conv=notrunc

$ echo -ne &quot;\xcd\x80\xb0\x01\xcd\x80&quot; | \
    dd of=hello bs=1 count=6 seek=46 conv=notrunc
</code></pre><p>&#x4EE3;&#x78BC;&#x5408;&#x5165;&#x4EE5;&#x5F8C;&#xFF0C;&#x9700;&#x8981;&#x4FEE;&#x6539;&#x6587;&#x4EF6;&#x982D;&#x4E2D;&#x7684;&#x4EE3;&#x78BC;&#x7684;&#x504F;&#x79FB;&#x5730;&#x5740;&#xFF0C;&#x5373; <code>e_entry</code>&#xFF0C;&#x4E5F;&#x5C31;&#x662F;&#x8981;&#x628A;&#x539F;&#x4F86;&#x7684;&#x504F;&#x79FB; 84 (0x54) &#x4FEE;&#x6539;&#x70BA;&#x73FE;&#x5728;&#x7684;&#x504F;&#x79FB;&#xFF0C;&#x5373; 0x20&#x3002;</p>
<pre><code>$ echo -ne &quot;\x20&quot; | dd of=hello bs=1 count=1 seek=24 conv=notrunc
</code></pre><p>&#x4FEE;&#x6539;&#x5B8C;&#x4EE5;&#x5F8C;&#x6070;&#x597D;&#x628A;&#x5408;&#x4F75;&#x9032;&#x7684;&#x7A0B;&#x5E8F;&#x982D; <code>p_memsz</code>&#xFF0C;&#x4E5F;&#x5C31;&#x662F;&#x5206;&#x914D;&#x7D66;&#x6587;&#x4EF6;&#x7684;&#x5167;&#x5B58;&#x6539;&#x5C0F;&#x4E86;&#xFF0C;<code>p_filesz</code>&#x4E5F;&#x5F97;&#x76F8;&#x61C9;&#x6539;&#x5C0F;&#x3002;</p>
<pre><code>$ echo -ne &quot;\x20&quot; | dd of=hello bs=1 count=1 seek=20 conv=notrunc
</code></pre><p>&#x7A0B;&#x5E8F;&#x982D;&#x548C;&#x4EE3;&#x78BC;&#x90FD;&#x5DF2;&#x7D93;&#x5408;&#x5165;&#xFF0C;&#x6700;&#x5F8C;&#xFF0C;&#x628A; 52 &#x5B57;&#x7BC0;&#x4E4B;&#x5F8C;&#x7684;&#x5167;&#x5BB9;&#x5168;&#x90E8;&#x522A;&#x6389;&#xFF1A;</p>
<pre><code>$ dd if=hello of=hello bs=1 count=1 skip=52 seek=52
$ hexdump -C hello
00000000  7f 45 4c 46 01 00 00 00  00 00 00 00 00 00 01 00  |.ELF............|
00000010  02 00 03 00 20 00 01 00  20 00 01 00 04 00 00 00  |....T...T.......|
00000020  59 59 b2 05 b0 04 eb 06  34 00 20 00 01 00 cd 80  |YY......4. .....|
00000030  b0 01 cd 80
$ export PATH=./:$PATH
$ hello
hello
</code></pre><p><strong>&#x4EE3;&#x78BC;</strong>&#x548C;<del>&#x7A0B;&#x5E8F;&#x982D;</del>&#x90E8;&#x5206;&#x5408;&#x4E26;&#x9032;&#x6587;&#x4EF6;&#x982D;&#x7684;&#x5F59;&#x7E3D;&#x60C5;&#x6CC1;&#xFF1A;</p>
<blockquote>
<p>00000000  7f 45 4c 46 <del>01 00 00 00  00 00 00 00 00 00 01 00</del></p>
<p>00000010  <del>02 00 03 00 20 00 01 00  20 00 01 00 04 00 00 00</del></p>
<p>00000020  <strong><del>59 59 b2 05</del> b0 04 eb 06</strong>  34 00 20 00 01 00 <strong>cd 80</strong></p>
<p>00000030  <strong>b0 01 cd 80</strong></p>
</blockquote>
<p>&#x6700;&#x5F8C;&#xFF0C;&#x6211;&#x5011;&#x7684;&#x6210;&#x7E3E;&#x662F;&#xFF1A;</p>
<pre><code>$ wc -c hello
52
</code></pre><p>&#x53F2;&#x4E0A;&#x6700;&#x5C0F;&#x7684;&#x53EF;&#x6253;&#x5370; <code>Hello World</code>&#xFF08;&#x6CE8;&#xFF1A;&#x8981;&#x5B8C;&#x5168;&#x6253;&#x5370;&#x5F97;&#x628A;&#x4EE3;&#x78BC;&#x4E2D;&#x7684;5&#x8A72;&#x70BA;13&#xFF0C;&#x4E26;&#x4E14;&#x628A;&#x6587;&#x4EF6;&#x540D;&#x8A72;&#x70BA;&#x8A72;&#x5B57;&#x7B26;&#x4E32;&#xFF09; &#x7684; <code>Elf</code> &#x6587;&#x4EF6;&#x662F; 52 &#x500B;&#x5B57;&#x7BC0;&#x3002;&#x6253;&#x7834;&#x4E86;&#x8CC7;&#x6599; <a href="http://www.muppetlabs.com/~breadbox/software/tiny/teensy.html" target="_blank">[1]</a> &#x4F5C;&#x8005;&#x5275;&#x9020;&#x7684;&#x7D00;&#x9304;&#xFF1A;</p>
<pre><code>$ cd ELFkickers/tiny/
$ wc -c hello
59 hello
</code></pre><p>&#x9700;&#x8981;&#x7279;&#x5225;&#x63D0;&#x5230;&#x7684;&#x662F;&#xFF0C;&#x8A72;&#x4F5C;&#x8005;&#x5275;&#x9020;&#x7684;&#x6700;&#x5C0F;&#x53EF;&#x57F7;&#x884C; Elf &#x662F; 45 &#x500B;&#x5B57;&#x7BC0;&#x3002;</p>
<p>&#x4F46;&#x662F;&#x7531;&#x65BC;&#x90A3;&#x500B;&#x7A0B;&#x5E8F;&#x53EA;&#x80FD;&#x8FD4;&#x56DE;&#x4E00;&#x500B;&#x6578;&#x503C;&#xFF0C;&#x4EE3;&#x78BC;&#x66F4;&#x7C21;&#x77ED;&#xFF0C;&#x525B;&#x597D;&#x53EF;&#x4EE5;&#x76F4;&#x63A5;&#x5D4C;&#x5165;&#x5230;&#x6587;&#x4EF6;&#x982D;&#x4E2D;&#x9593;&#xFF0C;&#x800C;&#x6587;&#x4EF6;&#x672B;&#x5C3E;&#x7684; 7 &#x500B; <code>0</code> &#x5B57;&#x7BC0;&#x7531;&#x65BC; Linux &#x52A0;&#x8F09;&#x6642;&#x6703;&#x81EA;&#x52D5;&#x586B;&#x5145;&#xFF0C;&#x6240;&#x4EE5;&#x53EF;&#x4EE5;&#x522A;&#x6389;&#xFF0C;&#x6240;&#x4EE5;&#x6700;&#x7D42;&#x7684;&#x6587;&#x4EF6;&#x5927;&#x5C0F;&#x662F; 52 - 7 &#x5373; 45 &#x500B;&#x5B57;&#x7BC0;&#x3002;</p>
<p>&#x5176;&#x5927;&#x9AD4;&#x53EF;&#x5BE6;&#x73FE;&#x5982;&#x4E0B;&#xFF1A;</p>
<pre><code>.global _start
_start:
    mov $42, %bl   # &#x8A2D;&#x7F6E;&#x8FD4;&#x56DE;&#x503C;&#x70BA; 42
    xor %eax, %eax # eax = 0
    inc %eax       # eax = eax+1, &#x8A2D;&#x7F6E;&#x7CFB;&#x7D71;&#x8ABF;&#x7528;&#x865F;, sys_exit()
    int $0x80
</code></pre><p>&#x4FDD;&#x5B58;&#x70BA; ret.s&#xFF0C;&#x7DE8;&#x8B6F;&#x548C;&#x57F7;&#x884C;&#x6548;&#x679C;&#x5982;&#x4E0B;&#xFF1A;</p>
<pre><code>$ as --32 -o ret.o ret.s
$ ld -melf_i386 -o ret ret.o
$ ./ret
42
</code></pre><p>&#x4EE3;&#x78BC;&#x5B57;&#x7BC0;&#x6578;&#x53EF;&#x9019;&#x9EBC;&#x67E5;&#x770B;&#xFF1A;</p>
<pre><code>$ ld -melf_i386 --oformat=binary -o ret.bin ret.o
$ hexdump -C ret.bin
0000000  b3 2a 31 c0 40 cd 80
0000007
</code></pre><p>&#x9019;&#x88E1;&#x53EA;&#x6709; 7 &#x689D;&#x6307;&#x4EE4;&#xFF0C;&#x525B;&#x597D;&#x53EF;&#x4EE5;&#x5D4C;&#x5165;&#xFF0C;&#x800C;&#x6700;&#x5F8C;&#x7684; 6 &#x500B;&#x5B57;&#x7BC0;&#x56E0;&#x70BA;<del>&#x53EF;&#x7BE1;&#x6539;</del>&#x70BA; 0&#xFF0C;&#x4E26;&#x4E14;&#x5167;&#x6838;&#x53EF;&#x81EA;&#x52D5;&#x586B;&#x5145; 0&#xFF0C;&#x6240;&#x4EE5;&#x4E7E;&#x8106;&#x53EF;&#x4EE5;&#x9023;&#x7E8C;&#x522A;&#x6389;&#x6700;&#x5F8C; 7 &#x500B;&#x5B57;&#x7BC0;&#x7684; 0&#xFF1A;</p>
<blockquote>
<p>00000000  7f 45 4c 46 01 00 00 00  00 00 00 00 00 00 01 00</p>
<p>00000010  02 00 03 00 54 00 01 00  54 00 01 00 04 00 00 00</p>
<p>00000020  <strong>b3 2a 31 c0 40 cd 80</strong> 00 34 00 20 00 01 00 00 00</p>
<p>00000030  00 00 00 00</p>
</blockquote>
<p>&#x53EF;&#x4EE5;&#x76F4;&#x63A5;&#x7528;&#x5DF2;&#x7D93;&#x5408;&#x4F75;&#x597D;&#x7A0B;&#x5E8F;&#x982D;&#x7684; <code>hello</code> &#x4F86;&#x505A;&#x5BE6;&#x9A57;&#xFF0C;&#x9019;&#x88E1;&#x4E00;&#x4F75;&#x622A;&#x6389;&#x6700;&#x5F8C;&#x7684; 7 &#x500B; 0 &#x5B57;&#x7BC0;&#xFF1A;</p>
<pre><code>$ cp hello ret
$ echo -ne &quot;\xb3\x2a\x31\xc0\x40\xcd\x80&quot; |\
    dd of=ret bs=1 count=8 seek=32 conv=notrunc
$ dd if=ret of=hello bs=1 count=1 skip=45 seek=45
$ hexdump -C hello
00000000  7f 45 4c 46 01 00 00 00  00 00 00 00 00 00 01 00  |.ELF............|
00000010  02 00 03 00 20 00 01 00  20 00 01 00 04 00 00 00  |.... ... .......|
00000020  b3 2a 31 c0 40 cd 80 06  34 00 20 00 01           |.*1.@...4. ..|
0000002d
$ wc -c ret
45 ret
$ ./ret
$ echo $?
42
</code></pre><p>&#x5982;&#x679C;&#x60F3;&#x5FEB;&#x901F;&#x69CB;&#x5EFA;&#x8A72; <code>Elf</code> &#x6587;&#x4EF6;&#xFF0C;&#x53EF;&#x4EE5;&#x76F4;&#x63A5;&#x4F7F;&#x7528;&#x4E0B;&#x8FF0; Shell &#x4EE3;&#x78BC;&#xFF1A;</p>
<pre><code>#!/bin/bash
#
# generate_ret_elf.sh -- Generate a 45 bytes Elf file
#
# $ bash generate_ret_elf.sh
# $ chmod a+x ret.elf
# $ ./ret.elf
# $ echo $?
# 42
#

ret=&quot;\x7f\x45\x4c\x46\x01\x00\x00\x00&quot;
ret=${ret}&quot;\x00\x00\x00\x00\x00\x00\x01\x00&quot;
ret=${ret}&quot;\x02\x00\x03\x00\x20\x00\x01\x00&quot;
ret=${ret}&quot;\x20\x00\x01\x00\x04\x00\x00\x00&quot;
ret=${ret}&quot;\xb3\x2a\x31\xc0\x40\xcd\x80\x06&quot;
ret=${ret}&quot;\x34\x00\x20\x00\x01&quot;

echo -ne $ret &gt; ret.elf
</code></pre><p>&#x53C8;&#x6216;&#x8005;&#x662F;&#x76F4;&#x63A5;&#x53C3;&#x7167;&#x8CC7;&#x6599; <a href="http://www.muppetlabs.com/~breadbox/software/tiny/teensy.html" target="_blank">[1]</a> &#x7684; <code>tiny.asm</code> &#x5C31;&#x884C;&#x4E86;&#xFF0C;&#x5176;&#x4EE3;&#x78BC;&#x5982;&#x4E0B;&#xFF1A;</p>
<pre><code>; ret.asm

  BITS 32

            org     0x00010000

            db      0x7F, &quot;ELF&quot;             ; e_ident
            dd      1                                       ; p_type
            dd      0                                       ; p_offset
            dd      $$                                      ; p_vaddr
            dw      2                       ; e_type        ; p_paddr
            dw      3                       ; e_machine
            dd      _start                  ; e_version     ; p_filesz
            dd      _start                  ; e_entry       ; p_memsz
            dd      4                       ; e_phoff       ; p_flags
  _start:
            mov     bl, 42                  ; e_shoff       ; p_align
            xor     eax, eax
            inc     eax                     ; e_flags
            int     0x80
            db      0
            dw      0x34                    ; e_ehsize
            dw      0x20                    ; e_phentsize
            db      1                       ; e_phnum
                                            ; e_shentsize
                                            ; e_shnum
                                            ; e_shstrndx

  filesize      equ     $ - $$
</code></pre><p>&#x7DE8;&#x8B6F;&#x548C;&#x904B;&#x884C;&#x6548;&#x679C;&#x5982;&#x4E0B;&#xFF1A;</p>
<pre><code>$ nasm -f bin -o ret ret.asm
$ chmod +x ret
$ ./ret ; echo $?
42
$ wc -c ret
45 ret
</code></pre><p>&#x4E0B;&#x9762;&#x4E5F;&#x7D66;&#x4E00;&#x4E0B;&#x672C;&#x6587;&#x7CBE;&#x7C21;&#x5F8C;&#x7684; <code>hello</code> &#x7684; <code>nasm</code> &#x7248;&#x672C;&#xFF1A;</p>
<pre><code>; hello.asm

  BITS 32

            org     0x00010000

            db      0x7F, &quot;ELF&quot;             ; e_ident
            dd      1                                       ; p_type
            dd      0                                       ; p_offset
            dd      $$                                      ; p_vaddr
            dw      2                       ; e_type        ; p_paddr
            dw      3                       ; e_machine
            dd      _start                  ; e_version     ; p_filesz
            dd      _start                  ; e_entry       ; p_memsz
            dd      4                       ; e_phoff       ; p_flags
  _start:
            pop     ecx     ; argc          ; e_shoff       ; p_align
            pop     ecx     ; argv[0]
            mov     dl, 5   ; str len       ; e_flags
            mov     al, 4   ; sys_write(fd, addr, len) : ebx, ecx, edx
            jmp     _next   ; jump to next part of the code
            dw      0x34                      ; e_ehsize
            dw      0x20                      ; e_phentsize
            dw      1                         ; e_phnum
  _next:        int     0x80    ; syscall         ; e_shentsize
            mov     al, 1   ; eax=1,sys_exit  ; e_shnum
            int     0x80    ; syscall         ; e_shstrndx

  filesize      equ     $ - $$
</code></pre><p>&#x7DE8;&#x8B6F;&#x548C;&#x7528;&#x6CD5;&#x5982;&#x4E0B;&#xFF1A;</p>
<pre><code>$ ./nasm -f bin -o hello hello.asm a.
$ chmod a+x hello
$ export PATH=./:$PATH
$ hello
hello
$ wc -c hello
52
</code></pre><p>&#x7D93;&#x904E;&#x4E00;&#x756A;&#x52AA;&#x529B;&#xFF0C;<code>AT&amp;T</code> &#x7684;&#x5B8C;&#x6574; binary &#x7248;&#x672C;&#x5982;&#x4E0B;&#xFF1A;</p>
<pre><code># hello.s
#
# as --32 -o hello.o hello.s
# ld -melf_i386 --oformat=binary -o hello hello.o
#

    .file &quot;hello.s&quot;
    .global _start, _load
    .equ   LOAD_ADDR, 0x00010000   # Page aligned load addr, here 64k
    .equ   E_ENTRY, LOAD_ADDR + (_start - _load)
    .equ   P_MEM_SZ, E_ENTRY
    .equ   P_FILE_SZ, P_MEM_SZ

_load:
    .byte  0x7F
    .ascii &quot;ELF&quot;                  # e_ident, Magic Number
    .long  1                                      # p_type, loadable seg
    .long  0                                      # p_offset
    .long  LOAD_ADDR                              # p_vaddr
    .word  2                      # e_type, exec  # p_paddr
    .word  3                      # e_machine, Intel 386 target
    .long  P_FILE_SZ              # e_version     # p_filesz
    .long  E_ENTRY                # e_entry       # p_memsz
    .long  4                      # e_phoff       # p_flags, read(exec)
    .text
_start:
    popl   %ecx    # argc         # e_shoff       # p_align
    popl   %ecx    # argv[0]
    mov    $5, %dl # str len      # e_flags
    mov    $4, %al # sys_write(fd, addr, len) : ebx, ecx, edx
    jmp    next    # jump to next part of the code
    .word  0x34                   # e_ehsize = 52
    .word  0x20                   # e_phentsize = 32
    .word  1                      # e_phnum = 1
    .text
_next:  int    $0x80   # syscall        # e_shentsize
    mov    $1, %al # eax=1,sys_exit # e_shnum
    int    $0x80   # syscall        # e_shstrndx
</code></pre><p>&#x7DE8;&#x8B6F;&#x548C;&#x904B;&#x884C;&#x6548;&#x679C;&#x5982;&#x4E0B;&#xFF1A;</p>
<pre><code>$ as --32 -o hello.o hello.s
$ ld -melf_i386 --oformat=binary -o hello hello.o
$ export PATH=./:$PATH
$ hello
hello
$ wc -c hello
52 hello
</code></pre><p><strong>&#x6CE8;</strong>&#xFF1A;&#x7DE8;&#x8B6F;&#x6642;&#x52D9;&#x5FC5;&#x8981;&#x52A0; <code>--oformat=binary</code> &#x53C3;&#x6578;&#xFF0C;&#x4EE5;&#x4FBF;&#x76F4;&#x63A5;&#x8DDF;&#x6E90;&#x6587;&#x4EF6;&#x69CB;&#x5EFA;&#x4E00;&#x500B;&#x4E8C;&#x9032;&#x5236;&#x7684; <code>Elf</code> &#x6587;&#x4EF6;&#xFF0C;&#x5426;&#x5247;&#x6703;&#x88AB; <code>ld</code> &#x9ED8;&#x8A8D;&#x7DE8;&#x8B6F;&#xFF0C;&#x81EA;&#x52D5;&#x586B;&#x5145;&#x5176;&#x4ED6;&#x5167;&#x5BB9;&#x3002;</p>
<p><span id="toc_3928_6176_23"></span></p>
<h2 id="%E5%BD%99%E7%B7%A8%E8%AA%9E%E8%A8%80%E6%A5%B5%E9%99%90%E7%B2%BE%E7%B0%A1%E4%B9%8B%E9%81%93%EF%BC%8845%E5%AD%97%E7%AF%80%EF%BC%89">&#x5F59;&#x7DE8;&#x8A9E;&#x8A00;&#x6975;&#x9650;&#x7CBE;&#x7C21;&#x4E4B;&#x9053;&#xFF08;45&#x5B57;&#x7BC0;&#xFF09;</h2>
<p>&#x7D93;&#x904E;&#x4E0A;&#x8FF0;&#x52AA;&#x529B;&#xFF0C;&#x6211;&#x5011;&#x5DF2;&#x7D93;&#x5B8C;&#x5168;&#x628A;&#x7A0B;&#x5E8F;&#x982D;&#x548C;&#x4EE3;&#x78BC;&#x90FD;&#x878D;&#x5165;&#x4E86; 52 &#x5B57;&#x7BC0;&#x7684; <code>Elf</code> &#x6587;&#x4EF6;&#x982D;&#xFF0C;&#x9084;&#x53EF;&#x4EE5;&#x518D;&#x9032;&#x4E00;&#x6B65;&#x55CE;&#xFF1F;</p>
<p>&#x57FA;&#x65BC;&#x8CC7;&#x6599;&#x4E00;&#xFF0C;&#x5982;&#x679C;&#x518D;&#x8981;&#x52AA;&#x529B;&#xFF0C;&#x53EA;&#x80FD;&#x8A2D;&#x6CD5;&#x628A; <code>Elf</code> &#x672B;&#x5C3E;&#x7684; 7 &#x500B; 0 &#x5B57;&#x7BC0;&#x522A;&#x9664;&#xFF0C;&#x4F46;&#x662F;&#x7531;&#x65BC;&#x4EE3;&#x78BC;&#x5DF2;&#x7D93;&#x628A; <code>Elf</code> &#x672B;&#x5C3E;&#x7684; 7 &#x5B57;&#x7BC0; 0 &#x5B57;&#x7B26;&#x90FD;&#x586B;&#x6EFF;&#x4E86;&#xFF0C;&#x6240;&#x4EE5;&#x8981;&#x60F3;&#x5728;&#x9019;&#x4E00;&#x584A;&#x52AA;&#x529B;&#xFF0C;&#x53EA;&#x80FD;&#x7E7C;&#x7E8C;&#x58D3;&#x7E2E;&#x4EE3;&#x78BC;&#x3002;</p>
<p>&#x7E7C;&#x7E8C;&#x7814;&#x7A76;&#x4E0B;&#x4EE3;&#x78BC;&#x5148;&#xFF1A;</p>
<pre><code>.global _start
_start:
    popl %ecx    # argc
    popl %ecx    # argv[0]
    movb $5, %dl    # &#x8A2D;&#x7F6E;&#x5B57;&#x7B26;&#x4E32;&#x9577;&#x5EA6;
    movb $4, %al    # eax = 4, &#x8A2D;&#x7F6E;&#x7CFB;&#x7D71;&#x8ABF;&#x7528;&#x865F;, sys_write(fd, addr, len) : ebx, ecx, edx
    int $0x80
    movb $1, %al
    int $0x80
</code></pre><p>&#x67E5;&#x770B;&#x5C0D;&#x61C9;&#x7684;&#x7DE8;&#x78BC;&#xFF1A;</p>
<pre><code>$ as --32 -o hello.o hello.s
$ ld -melf_i386 -o hello hello.o --oformat=binary
$ hexdump -C hello
00000000  59 59 b2 05 b0 04 cd 80  b0 01 cd 80              |YY..........|
0000000c
</code></pre><p>&#x6BCF;&#x689D;&#x6307;&#x4EE4;&#x5C0D;&#x61C9;&#x7684;&#x7DE8;&#x78BC;&#x6620;&#x5C04;&#x5982;&#x4E0B;&#xFF1A;</p>
<table>
<thead>
<tr>
<th>&#x6307;&#x4EE4;</th>
<th>&#x7DE8;&#x78BC;</th>
<th>&#x8AAA;&#x660E;</th>
</tr>
</thead>
<tbody>
<tr>
<td>  popl %ecx</td>
<td>59</td>
<td>argc</td>
</tr>
<tr>
<td>  popl %ecx</td>
<td>59</td>
<td>argv[0]</td>
</tr>
<tr>
<td>  movb $5, %dl</td>
<td>b2 05</td>
<td>&#x8A2D;&#x7F6E;&#x5B57;&#x7B26;&#x4E32;&#x9577;&#x5EA6;</td>
</tr>
<tr>
<td>  movb $4, %al</td>
<td>b0 04</td>
<td>eax = 4, &#x8A2D;&#x7F6E;&#x7CFB;&#x7D71;&#x8ABF;&#x7528;&#x865F;, sys_write(fd, addr, len) : ebx, ecx, edx</td>
</tr>
<tr>
<td>  int $0x80</td>
<td>cd 80</td>
<td>&#x89F8;&#x767C;&#x7CFB;&#x7D71;&#x8ABF;&#x7528;</td>
</tr>
<tr>
<td>  movb $1, %al</td>
<td>b0 01</td>
<td>eax = 1, sys_exit</td>
</tr>
<tr>
<td>  int $0x80</td>
<td>cd 80</td>
<td>&#x89F8;&#x767C;&#x7CFB;&#x7D71;&#x8ABF;&#x7528;</td>
</tr>
</tbody>
</table>
<p>&#x53EF;&#x4EE5;&#x89C0;&#x5BDF;&#x5230;&#xFF1A;</p>
<ul>
<li><code>popl</code> &#x7684;&#x6307;&#x4EE4;&#x7DE8;&#x78BC;&#x6700;&#x7C21;&#x6F54;&#x3002;</li>
<li><code>int $0x80</code> &#x91CD;&#x8907;&#x4E86;&#x5169;&#x6B21;&#xFF0C;&#x800C;&#x4E14;&#x6BCF;&#x689D;&#x90FD;&#x4F54;&#x7528;&#x4E86; 2 &#x5B57;&#x7BC0;</li>
<li><code>movb</code> &#x6BCF;&#x689D;&#x90FD;&#x4F54;&#x7528;&#x4E86; 2 &#x5B57;&#x7BC0;</li>
<li><code>eax</code> &#x6709;&#x5169;&#x6B21;&#x8CE6;&#x503C;&#xFF0C;&#x6BCF;&#x6B21;&#x4F54;&#x7528;&#x4E86; 2 &#x5B57;&#x7BC0;</li>
<li><code>popl %ecx</code> &#x53D6;&#x51FA;&#x7684; argc &#x4E26;&#x672A;&#x4F7F;&#x7528;</li>
</ul>
<p>&#x6839;&#x64DA;&#x4E4B;&#x524D;&#x901A;&#x904E;&#x53C3;&#x6578;&#x50B3;&#x905E;&#x5B57;&#x7B26;&#x4E32;&#x7684;&#x60F3;&#x6CD5;&#xFF0C;&#x54B1;&#x5011;&#x662F;&#x5426;&#x53EF;&#x4EE5;&#x8003;&#x616E;&#x901A;&#x904E;&#x53C3;&#x6578;&#x4F86;&#x8A2D;&#x7F6E;&#x8B8A;&#x91CF;&#x5462;&#xFF1F;</p>
<p>&#x7406;&#x8AD6;&#x4E0A;&#xFF0C;&#x50B3;&#x5165;&#x591A;&#x500B;&#x53C3;&#x6578;&#xFF0C;&#x901A;&#x904E; <code>pop</code> &#x5F48;&#x51FA;&#x4F86;&#x8CE6;&#x4E88; <code>eax</code>, <code>ecx</code> &#x5373;&#x53EF;&#xFF0C;&#x4F46;&#x662F;&#x5BE6;&#x969B;&#x4E0A;&#xFF0C;&#x7531;&#x65BC;&#x5F9E;&#x53C3;&#x6578;&#x68E7;&#x88E1;&#x982D; <code>pop</code> &#x51FA;&#x4F86;&#x7684;&#x53C3;&#x6578;&#x662F;&#x53C3;&#x6578;&#x7684;&#x5730;&#x5740;&#xFF0C;&#x4E26;&#x4E0D;&#x662F;&#x53C3;&#x6578;&#x672C;&#x8EAB;&#xFF0C;&#x6240;&#x4EE5;&#x8A72;&#x65B9;&#x6CD5;&#x884C;&#x4E0D;&#x901A;&#x3002;</p>
<p>&#x4E0D;&#x904E;&#x7531;&#x65BC;&#x7B2C;&#x4E00;&#x500B;&#x53C3;&#x6578;&#x53D6;&#x51FA;&#x7684;&#x662F;&#x6578;&#x5B57;&#xFF0C;&#x4E26;&#x4E14;&#x662F;&#x53C3;&#x6578;&#x500B;&#x6578;&#xFF0C;&#x800C;&#x4E14;&#x76EE;&#x524D;&#x7684;&#x90A3;&#x689D; <code>popl %ecx</code> &#x53D6;&#x51FA;&#x7684; <code>argc</code> &#x4E26;&#x6C92;&#x6709;&#x4F7F;&#x7528;&#xFF0C;&#x90A3;&#x9EBC;&#x525B;&#x597D;&#x53EF;&#x4EE5;&#x7528;&#x4F86;&#x8A2D;&#x7F6E; <code>eax</code>&#xFF0C;&#x66FF;&#x63DB;&#x5F8C;&#x5982;&#x4E0B;&#xFF1A;</p>
<pre><code>.global _start
_start:
    popl %eax    # eax = 4, &#x8A2D;&#x7F6E;&#x7CFB;&#x7D71;&#x8ABF;&#x7528;&#x865F;, sys_write(fd, addr, len) : ebx, ecx, edx
    popl %ecx    # argv[0], &#x5B57;&#x7B26;&#x4E32;
    movb $5, %dl # &#x8A2D;&#x7F6E;&#x5B57;&#x7B26;&#x4E32;&#x9577;&#x5EA6;
    int $0x80
    movb $1, %al # eax = 1, sys_exit
    int $0x80
</code></pre><p>&#x9019;&#x88E1;&#x9700;&#x8981;&#x50B3;&#x5165; 4 &#x500B;&#x53C3;&#x6578;&#xFF0C;&#x5373;&#x8B93;&#x68E7;&#x5F48;&#x51FA;&#x7684;&#x7B2C;&#x4E00;&#x500B;&#x503C;&#xFF0C;&#x4E5F;&#x5C31;&#x662F;&#x53C3;&#x6578;&#x500B;&#x6578;&#x8CE6;&#x4E88; <code>eax</code>&#xFF0C;&#x4E5F;&#x5C31;&#x662F;&#xFF1A;<code>hello 5 4 1</code>&#x3002;</p>
<p>&#x96E3;&#x9053;&#x6211;&#x5011;&#x53EA;&#x80FD;&#x628A;&#x8A72;&#x4EE3;&#x78BC;&#x512A;&#x5316;&#x5230; 10 &#x500B;&#x5B57;&#x7BC0;&#xFF1F;</p>
<p>&#x5DE7;&#x5408;&#x5730;&#x662F;&#xFF0C;&#x7576;&#x5076;&#x7136;&#x6539;&#x6210;&#x9019;&#x6A23;&#x7684;&#x60C5;&#x6CC1;&#x4E0B;&#xFF0C;&#x8A72;&#x4EE3;&#x78BC;&#x9084;&#x80FD;&#x6B63;&#x5E38;&#x8FD4;&#x56DE;&#x3002;</p>
<pre><code>.global _start
_start:
    popl %eax    # eax = 4, &#x8A2D;&#x7F6E;&#x7CFB;&#x7D71;&#x8ABF;&#x7528;&#x865F;, sys_write(fd, addr, len) : ebx, ecx, edx
    popl %ecx    # argv[0], &#x5B57;&#x7B26;&#x4E32;
    movb $5, %dl    # &#x8A2D;&#x7F6E;&#x5B57;&#x7B26;&#x4E32;&#x9577;&#x5EA6;
    int $0x80
    loop _start     # &#x89F8;&#x767C;&#x7CFB;&#x7D71;&#x9000;&#x51FA;
</code></pre><p><strong>&#x6CE8;</strong>&#xFF1A;&#x4E0A;&#x9762;&#x6211;&#x5011;&#x4F7F;&#x7528;&#x4E86; <code>loop</code> &#x6307;&#x4EE4;&#x800C;&#x4E0D;&#x662F; <code>jmp</code> &#x6307;&#x4EE4;&#xFF0C;&#x56E0;&#x70BA; <code>jmp _start</code> &#x7522;&#x751F;&#x7684;&#x4EE3;&#x78BC;&#x66F4;&#x9577;&#xFF0C;&#x800C; <code>loop _start</code> &#x6307;&#x4EE4;&#x53EA;&#x6709;&#x5169;&#x500B;&#x5B57;&#x7BC0;&#x3002;</p>
<p>&#x9019;&#x88E1;&#x76F8;&#x7576;&#x65BC;&#x522A;&#x9664;&#x4E86; <code>movb $1, %al</code>&#xFF0C;&#x6700;&#x5F8C;&#x6211;&#x5011;&#x7372;&#x5F97;&#x4E86; 8 &#x500B;&#x5B57;&#x7BC0;&#x3002;&#x4F46;&#x662F;&#x9019;&#x88E1;&#x70BA;&#x4EC0;&#x9EBC;&#x80FD;&#x5920;&#x5DE5;&#x4F5C;&#x5462;&#xFF1F;</p>
<p>&#x7D93;&#x904E;&#x5206;&#x6790; <code>arch/x86/ia32/ia32entry.S</code>&#xFF0C;&#x6211;&#x5011;&#x767C;&#x73FE;&#x7576;&#x7CFB;&#x7D71;&#x8ABF;&#x7528;&#x865F;&#x7121;&#x6548;&#x6642;&#xFF08;&#x8D85;&#x904E;&#x7CFB;&#x7D71;&#x8ABF;&#x7528;&#x5165;&#x53E3;&#x500B;&#x6578;&#xFF09;&#xFF0C;&#x5167;&#x6838;&#x70BA;&#x4E86;&#x5065;&#x58EF;&#x8003;&#x616E;&#xFF0C;&#x5FC5;&#x9808;&#x8981;&#x8655;&#x7406;&#x9019;&#x985E;&#x7570;&#x5E38;&#xFF0C;&#x4E26;&#x901A;&#x904E; <code>ia32_badsys</code> &#x8B93;&#x7CFB;&#x7D71;&#x8ABF;&#x7528;&#x6B63;&#x5E38;&#x8FD4;&#x56DE;&#x3002;</p>
<p>&#x9019;&#x500B;&#x53EF;&#x4EE5;&#x9019;&#x6A23;&#x9A57;&#x8B49;&#xFF1A;</p>
<pre><code>.global _start
_start:
    popl %eax    # argc, eax = 4, &#x8A2D;&#x7F6E;&#x7CFB;&#x7D71;&#x8ABF;&#x7528;&#x865F;, sys_write(fd, addr, len) : ebx, ecx, edx
    popl %ecx    # argv[0], &#x6587;&#x4EF6;&#x540D;
    mov $5, %dl  # argv[1]&#xFF0C;&#x5B57;&#x7B26;&#x4E32;&#x9577;&#x5EA6;
    int $0x80
    mov $0xffffffda, %eax  # &#x8A2D;&#x7F6E;&#x4E00;&#x500B;&#x975E;&#x6CD5;&#x8ABF;&#x7528;&#x865F;&#x7528;&#x65BC;&#x9000;&#x51FA;
    int $0x80
</code></pre><p>&#x90A3;&#x6700;&#x5F8C;&#x7684;&#x7D50;&#x679C;&#x662F;&#xFF0C;&#x6211;&#x5011;&#x7522;&#x751F;&#x4E86;&#x4E00;&#x500B;&#x53EF;&#x4EE5;&#x6B63;&#x5E38;&#x6253;&#x5370;&#x5B57;&#x7B26;&#x4E32;&#xFF0C;&#x5927;&#x5C0F;&#x96BB;&#x6709; 45 &#x5B57;&#x7BC0;&#x7684; <code>Elf</code> &#x6587;&#x4EF6;&#xFF0C;&#x6700;&#x7D42;&#x7684;&#x7D50;&#x679C;&#x5982;&#x4E0B;&#xFF1A;</p>
<pre><code># hello.s
#
# $ as --32 -o hello.o hello.s
# $ ld -melf_i386 --oformat=binary -o hello hello.o
# $ export PATH=./:$PATH
# $ hello 0 0 0
# hello
#

    .file &quot;hello.s&quot;
    .global _start, _load
    .equ   LOAD_ADDR, 0x00010000   # Page aligned load addr, here 64k
    .equ   E_ENTRY, LOAD_ADDR + (_start - _load)
    .equ   P_MEM_SZ, E_ENTRY
    .equ   P_FILE_SZ, P_MEM_SZ

_load:
    .byte  0x7F
    .ascii &quot;ELF&quot;              # e_ident, Magic Number
    .long  1                                      # p_type, loadable seg
    .long  0                                      # p_offset
    .long  LOAD_ADDR                              # p_vaddr
    .word  2                  # e_type, exec  # p_paddr
    .word  3                  # e_machine, Intel 386 target
    .long  P_FILE_SZ          # e_version     # p_filesz
    .long  E_ENTRY            # e_entry       # p_memsz
    .long  4                  # e_phoff       # p_flags, read(exec)
    .text
_start:
    popl   %eax    # argc     # e_shoff       # p_align
                   # 4 args, eax = 4, sys_write(fd, addr, len) : ebx, ecx, edx
                   # set 2nd eax = random addr to trigger bad syscall for exit
    popl   %ecx    # argv[0]
    mov    $5, %dl # str len  # e_flags
    int    $0x80
    loop   _start  # loop to popup a random addr as a bad syscall number
    .word  0x34               # e_ehsize = 52
    .word  0x20               # e_phentsize = 32
    .byte  1                  # e_phnum = 1, remove trailing 7 bytes with 0 value
                              # e_shentsize
                              # e_shnum
                              # e_shstrndx
</code></pre><p>&#x6548;&#x679C;&#x5982;&#x4E0B;&#xFF1A;</p>
<pre><code>$ as --32 -o hello.o hello.s
$ ld -melf_i386 -o hello hello.o --oformat=binary
$ export PATH=./:$PATH
$ hello 0 0 0
hello
$ wc -c hello
45 hello
</code></pre><p>&#x5230;&#x9019;&#x88E1;&#xFF0C;&#x6211;&#x5011;&#x7372;&#x5F97;&#x4E86;&#x53F2;&#x4E0A;&#x6700;&#x5C0F;&#x7684;&#x53EF;&#x4EE5;&#x6253;&#x5370;&#x5B57;&#x7B26;&#x4E32;&#x7684; <code>Elf</code> &#x6587;&#x4EF6;&#xFF0C;&#x662F;&#x7684;&#xFF0C;&#x53EA;&#x6709; 45 &#x500B;&#x5B57;&#x7BC0;&#x3002;</p>
<p><span id="toc_3928_6176_24"></span></p>
<h2 id="%E5%B0%8F%E7%B5%90">&#x5C0F;&#x7D50;</h2>
<p>&#x5230;&#x9019;&#x88E1;&#xFF0C;&#x95DC;&#x65BC;&#x53EF;&#x57F7;&#x884C;&#x6587;&#x4EF6;&#x7684;&#x8A0E;&#x8AD6;&#x66AB;&#x4E14;&#x7D50;&#x675F;&#xFF0C;&#x6700;&#x5F8C;&#x4F86;&#x4E00;&#x6BB5;&#x5C0F;&#x5C0F;&#x7684;&#x7E3D;&#x7D50;&#xFF0C;&#x90A3;&#x5C31;&#x662F;&#x6211;&#x5011;&#x8A2D;&#x6CD5;&#x53BB;&#x6E1B;&#x5C11;&#x53EF;&#x57F7;&#x884C;&#x6587;&#x4EF6;&#x5927;&#x5C0F;&#x7684;&#x610F;&#x7FA9;&#xFF1F;</p>
<p>&#x5BE6;&#x969B;&#x4E0A;&#xFF0C;&#x901A;&#x904E;&#x9019;&#x6A23;&#x4E00;&#x500B;&#x8A0E;&#x8AD6;&#x6DF1;&#x5165;&#x5230;&#x4E86;&#x5F88;&#x591A;&#x6280;&#x8853;&#x7684;&#x7D30;&#x7BC0;&#xFF0C;&#x5305;&#x62EC;&#x53EF;&#x57F7;&#x884C;&#x6587;&#x4EF6;&#x7684;&#x683C;&#x5F0F;&#x3001;&#x76EE;&#x6A19;&#x4EE3;&#x78BC;&#x93C8;&#x63A5;&#x7684;&#x904E;&#x7A0B;&#x3001; Linux &#x4E0B;&#x5F59;&#x7DE8;&#x8A9E;&#x8A00;&#x958B;&#x767C;&#x7B49;&#x3002;&#x8207;&#x6B64;&#x540C;&#x6642;&#xFF0C;&#x53EF;&#x57F7;&#x884C;&#x6587;&#x4EF6;&#x5927;&#x5C0F;&#x7684;&#x6E1B;&#x5C11;&#x672C;&#x8EAB;&#x5C0D;&#x5D4C;&#x5165;&#x5F0F;&#x7CFB;&#x7D71;&#x975E;&#x5E38;&#x6709;&#x7528;&#xFF0C;&#x5982;&#x679C;&#x522A;&#x9664;&#x90A3;&#x4E9B;&#x5C0D;&#x7A0B;&#x5E8F;&#x904B;&#x884C;&#x6C92;&#x6709;&#x5F71;&#x97FF;&#x7684;&#x7BC0;&#x5340;&#x548C;&#x7BC0;&#x5340;&#x8868;&#x5C07;&#x6E1B;&#x5C11;&#x76EE;&#x6A19;&#x7CFB;&#x7D71;&#x7684;&#x5927;&#x5C0F;&#xFF0C;&#x9069;&#x61C9;&#x5D4C;&#x5165;&#x5F0F;&#x7CFB;&#x7D71;&#x8CC7;&#x6E90;&#x53D7;&#x9650;&#x7684;&#x9700;&#x6C42;&#x3002;&#x9664;&#x6B64;&#x4E4B;&#x5916;&#xFF0C;&#x52D5;&#x614B;&#x9023;&#x63A5;&#x5EAB;&#x4E2D;&#x7684;&#x5F88;&#x591A;&#x51FD;&#x6578;&#x53EF;&#x80FD;&#x4E0D;&#x6703;&#x88AB;&#x4F7F;&#x7528;&#x5230;&#xFF0C;&#x56E0;&#x6B64;&#x4E5F;&#x53EF;&#x4EE5;&#x901A;&#x904E;&#x67D0;&#x7A2E;&#x65B9;&#x5F0F;&#x5254;&#x9664; <a href="http://www.gexin.com.cn/UploadFile/document2008119102415.pdf" target="_blank">[8]</a>&#xFF0C;<a href="http://sourceforge.net/projects/libraryopt" target="_blank">[10]</a> &#x3002;</p>
<p>&#x6216;&#x8A31;&#xFF0C;&#x4F60;&#x9084;&#x6703;&#x767C;&#x73FE;&#x66F4;&#x591A;&#x6709;&#x8DA3;&#x7684;&#x610F;&#x7FA9;&#xFF0C;&#x6B61;&#x8FCE;&#x7D66;&#x6211;&#x767C;&#x9001;&#x90F5;&#x4EF6;&#xFF0C;&#x4E00;&#x8D77;&#x8A0E;&#x8AD6;&#x3002;</p>
<p><span id="toc_3928_6176_25"></span></p>
<h2 id="%E5%8F%83%E8%80%83%E8%B3%87%E6%96%99">&#x53C3;&#x8003;&#x8CC7;&#x6599;</h2>
<ul>
<li><a href="http://www.muppetlabs.com/~breadbox/software/tiny/teensy.html" target="_blank">A Whirlwind Tutorial on Creating Really Teensy ELF Executables for Linux</a></li>
<li><a href="http://blog.chinaunix.net/u/19881/showart_215242.html" target="_blank">UNIX/LINUX &#x5E73;&#x81FA;&#x53EF;&#x57F7;&#x884C;&#x6587;&#x4EF6;&#x683C;&#x5F0F;&#x5206;&#x6790;</a></li>
<li><a href="http://www.xxlinux.com/linux/article/development/soft/20070424/8267.html" target="_blank">C/C++ &#x7A0B;&#x5E8F;&#x7DE8;&#x8B6F;&#x6B65;&#x9A5F;&#x8A73;&#x89E3;</a></li>
<li><a href="http://www.faqs.org/docs/Linux-HOWTO/GCC-HOWTO.html" target="_blank">The Linux GCC HOW TO</a></li>
<li><a href="http://linux.jinr.ru/usoft/WWW/www_debian.org/Documentation/elf/elf.html" target="_blank">ELF: From The Programmer&apos;s Perspective</a></li>
<li><a href="http://www.linuxforums.org/misc/understanding_elf_using_readelf_and_objdump.html" target="_blank">Understanding ELF using readelf and objdump</a></li>
<li><a href="http://www.ibm.com/developerworks/linux/library/l-shlibs.html" target="_blank">Dissecting shared libraries</a></li>
<li><a href="http://www.gexin.com.cn/UploadFile/document2008119102415.pdf" target="_blank">&#x5D4C;&#x5165;&#x5F0F; Linux &#x5C0F;&#x578B;&#x5316;&#x6280;&#x8853;</a></li>
<li><a href="http://www.ibm.com/developerworks/cn/linux/l-assembly/index.html" target="_blank">Linux &#x5F59;&#x7DE8;&#x8A9E;&#x8A00;&#x958B;&#x767C;&#x6307;&#x5357;</a></li>
<li><a href="http://sourceforge.net/projects/libraryopt" target="_blank">Library Optimizer</a></li>
<li>ELF file format and ABI&#xFF1A;<a href="http://www.x86.org/ftp/manuals/tools/elf.pdf" target="_blank">[1]</a>&#xFF0C;<a href="http://www.muppetlabs.com/~breadbox/software/ELF.txt" target="_blank">[2]</a>&#xFF0C;<a href="http://162.105.203.48/web/gaikuang/submission/TN05.ELF.Format.Summary.pdf" target="_blank">[3]</a>&#xFF0C;<a href="http://www.xfocus.net/articles/200105/174.html" target="_blank">[4]</a></li>
<li><a href="http://sparksandflames.com/files/x86InstructionChart.html" target="_blank">i386 &#x6307;&#x4EE4;&#x7DE8;&#x78BC;&#x8868;</a></li>
</ul>

                    
                    </section>
                
                
                </div>
            </div>
        </div>

        
        <a href="../../zh/chapters/02-chapter7.html" class="navigation navigation-prev " aria-label="Previous page: 進程和進程的基本操作"><i class="fa fa-angle-left"></i></a>
        
        
        <a href="../../zh/chapters/02-chapter9.html" class="navigation navigation-next " aria-label="Next page: 代碼測試、調試與優化"><i class="fa fa-angle-right"></i></a>
        
    </div>
</div>

        
<script src="../../gitbook/app.js"></script>

    
    <script src="../../gitbook/plugins/gitbook-plugin-google_code_prettify/google-code-prettify.js"></script>
    

    
    <script src="../../gitbook/plugins/gitbook-plugin-google_code_prettify/plugin.js"></script>
    

    
    <script src="../../gitbook/plugins/gitbook-plugin-collapsible-menu/plugin.js"></script>
    

    
    <script src="../../gitbook/plugins/gitbook-plugin-livereload/plugin.js"></script>
    

    
    <script src="../../gitbook/plugins/gitbook-plugin-maxiang/maxiang.js"></script>
    

<script>
require(["gitbook"], function(gitbook) {
    var config = {"fontSettings":{"theme":null,"family":"sans","size":2}};
    gitbook.start(config);
});
</script>

        <!-- body:end -->
    </body>
    <!-- End of book C 語言編程透視 -->
</html>
